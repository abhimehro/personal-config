# Enhanced Control D Configuration with Split-DNS
# DoH3 (HTTP/3 over QUIC) with intelligent local domain routing
# Profile: 2eoeqoo9ib9
# Created: 2025-08-30

[listener]
  [listener.0]
    ip = '127.0.0.1'
    port = 53

    [listener.0.policy]
      name = 'Enhanced Policy with Split-DNS'
      rules = [
        # Preserve all captive portal rules for travel/hotel WiFi
        { 'captive.apple.com' = []},
        { 'aircanadawifi.com' = []},
        { 'acwifi.com' = []},
        { 'gogoinflight.com' = []},
        { 'southwestwifi.com' = []},
        { 'singaporeair-krisworld.com' = []},
        { 'airborne.gogoinflight.com' = []},
        { 'aainflight.com' = []},
        { 'aa.viasat.com' = []},
        { 'deltawifi.com' = []},
        { 'wifi.delta.com' = []},
        { 'unitedwifi.com' = []},
        { 'shop.ba.com' = []},
        { 'alaskawifi.com' = []},
        { 'flyfi.com' = []},
        { 'wifi.airasia.com' = []},
        { 'wifi.sncf' = []},
        { 'wifi.tgv-lyria.com' = []},
        { 'freewlan.sbb.ch' = []},
        { 'register.onboard.eurostar.com' = []},
        { 'thalysnet.com' = []},
        { 'iceportal.de' = []},
        { 'vvm.mstore.msg.t-mobile.com' = []},
        { 'wifi.inflightinternet.com' = []},
        { 'captive.inflightinternet.com' = []},
        { 'airbornesecure.inflightinternet.com' = []},
        { 'ip.videotron.ca' = []},
        { 'wifi.united.com' = []},
        { 'etihadwi-fly.com' = []},
        { 'inflight-wifi.com' = []},
        { 'southwestwifi.com' = []},
        { 'wifi.cathaypacific.com' = []},
        { 'timhortonswifi.com' = []},
        { 'detectportal.firefox.com' = []},
        { 'portal.mist.com' = []},
        { 'wifi.connected.xfinity.com' = []},
        { 'vvm.ee.co.uk' = []},
        { 'wifi.tgvlyria.com' = []},
        { 'guestinternet.com' = []},
        { '*.network-auth.com' = []},
        { 'secure.datavatel.io' = []},
        { 'login.cloud5.com' = []},
        { 'wirelessportal.americanexpress.com' = []},
        { '*.globalreachtech.com' = []},
        { 'neverssl.com' = []},
        
        # Split-DNS: Local network domains (route to local router)
        { '*.local' = ['192.168.4.1']},
        { '*.lan' = ['192.168.4.1']},
        { '*.home.arpa' = ['192.168.4.1']},
        { '*.localdomain' = ['192.168.4.1']},
        
        # Development domains (route to local)
        { 'localhost' = ['127.0.0.1']},
        { '*.localhost' = ['127.0.0.1']},
        { '*.test' = ['127.0.0.1']},
        { '*.dev' = ['127.0.0.1']},
      ]

[network]
  [network.0]
    name = 'Network 0'
    cidrs = ['0.0.0.0/0']

[upstream]
  [upstream.0]
    type = 'doh3'  # HTTP/3 over QUIC for maximum performance
    endpoint = 'https://dns.controld.com/2eoeqoo9ib9'
    bootstrap_ip = '76.76.19.19'
    timeout = 5000
    
  # Fallback upstream for local DNS queries
  [upstream.1]
    type = 'plain'
    endpoint = '192.168.4.1:53'  # Your local router
    timeout = 2000