user:
<manually_attached_skills>
The user has manually attached the following skills to their message.
These skills contain specific instructions or workflows that the user wants you to follow for this request.
You should read and follow the instructions in these skills carefully.

Skill Name: create-subagent
Path: /Users/speedybee/.cursor/skills-cursor/create-subagent/SKILL.md
SKILL.md content:
# Creating Custom Subagents

This skill guides you through creating custom subagents for Cursor. Subagents are specialized AI assistants that run in isolated contexts with custom system prompts.

## When to Use Subagents

Subagents help you:
- **Preserve context** by isolating exploration from your main conversation
- **Specialize behavior** with focused system prompts for specific domains
- **Reuse configurations** across projects with user-level subagents

### Inferring from Context

If you have previous conversation context, infer the subagent's purpose and behavior from what was discussed. Create the subagent based on specialized tasks or workflows that emerged in the conversation.

## Subagent Locations

| Location | Scope | Priority |
|----------|-------|----------|
| `.cursor/agents/` | Current project | Higher |
| `~/.cursor/agents/` | All your projects | Lower |

When multiple subagents share the same name, the higher-priority location wins.

**Project subagents** (`.cursor/agents/`): Ideal for codebase-specific agents. Check into version control to share with your team.

**User subagents** (`~/.cursor/agents/`): Personal agents available across all your projects.

## Subagent File Format

Create a `.md` file with YAML frontmatter and a markdown body (the system prompt):

```markdown
---
name: code-reviewer
description: Reviews code for quality and best practices
---

You are a code reviewer. When invoked, analyze the code and provide
specific, actionable feedback on quality, security, and best practices.
```

### Required Fields

| Field | Description |
|-------|-------------|
| `name` | Unique identifier (lowercase letters and hyphens only) |
| `description` | When to delegate to this subagent (be specific!) |

## Writing Effective Descriptions

The description is **critical** - the AI uses it to decide when to delegate.

```yaml
# ❌ Too vague
description: Helps with code

# ✅ Specific and actionable
description: Expert code review specialist. Proactively reviews code for quality, security, and maintainability. Use immediately after writing or modifying code.
```

Include "use proactively" to encourage automatic delegation.

## Example Subagents

### Code Reviewer

```markdown
---
name: code-reviewer
description: Expert code review specialist. Proactively reviews code for quality, security, and maintainability. Use immediately after writing or modifying code.
---

You are a senior code reviewer ensuring high standards of code quality and security.

When invoked:
1. Run git diff to see recent changes
2. Focus on modified files
3. Begin review immediately

Review checklist:
- Code is clear and readable
- Functions and variables are well-named
- No duplicated code
- Proper error handling
- No exposed secrets or API keys
- Input validation implemented
- Good test coverage
- Performance considerations addressed

Provide feedback organized by priority:
- Critical issues (must fix)
- Warnings (should fix)
- Suggestions (consider improving)

Include specific examples of how to fix issues.
```

### Debugger

```markdown
---
name: debugger
description: Debugging specialist for errors, test failures, and unexpected behavior. Use proactively when encountering any issues.
---

You are an expert debugger specializing in root cause analysis.

When invoked:
1. Capture error message and stack trace
2. Identify reproduction steps
3. Isolate the failure location
4. Implement minimal fix
5. Verify solution works

Debugging process:
- Analyze error messages and logs
- Check recent code changes
- Form and test hypotheses
- Add strategic debug logging
- Inspect variable states

For each issue, provide:
- Root cause explanation
- Evidence supporting the diagnosis
- Specific code fix
- Testing approach
- Prevention recommendations

Focus on fixing the underlying issue, not the symptoms.
```

### Data Scientist

```markdown
---
name: data-scientist
description: Data analysis expert for SQL queries, BigQuery operations, and data insights. Use proactively for data analysis tasks and queries.
---

You are a data scientist specializing in SQL and BigQuery analysis.

When invoked:
1. Understand the data analysis requirement
2. Write efficient SQL queries
3. Use BigQuery command line tools (bq) when appropriate
4. Analyze and summarize results
5. Present findings clearly

Key practices:
- Write optimized SQL queries with proper filters
- Use appropriate aggregations and joins
- Include comments explaining complex logic
- Format results for readability
- Provide data-driven recommendations

For each analysis:
- Explain the query approach
- Document any assumptions
- Highlight key findings
- Suggest next steps based on data

Always ensure queries are efficient and cost-effective.
```

## Subagent Creation Workflow

### Step 1: Decide the Scope

- **Project-level** (`.cursor/agents/`): For codebase-specific agents shared with team
- **User-level** (`~/.cursor/agents/`): For personal agents across all projects

### Step 2: Create the File

```bash
# For project-level
mkdir -p .cursor/agents
touch .cursor/agents/my-agent.md

# For user-level
mkdir -p ~/.cursor/agents
touch ~/.cursor/agents/my-agent.md
```

### Step 3: Define Configuration

Write the frontmatter with the required fields (`name` and `description`).

### Step 4: Write the System Prompt

The body becomes the system prompt. Be specific about:
- What the agent should do when invoked
- The workflow or process to follow
- Output format and structure
- Any constraints or guidelines

### Step 5: Test the Agent

Ask the AI to use your new agent:

```
Use the my-agent subagent to [task description]
```

## Best Practices

1. **Design focused subagents**: Each should excel at one specific task
2. **Write detailed descriptions**: Include trigger terms so the AI knows when to delegate
3. **Check into version control**: Share project subagents with your team
4. **Use proactive language**: Include "use proactively" in descriptions

## Troubleshooting

### Subagent Not Found
- Ensure file is in `.cursor/agents/` or `~/.cursor/agents/`
- Check file has `.md` extension
- Verify YAML frontmatter syntax is valid
</manually_attached_skills>
<user_query>
/create-subagent  Help me create this subagent for Cursor: 
</user_query>

assistant:
[Thinking] **Clarifying subagent creation**

I need help creating a subagent since the user has provided a skill for it. But I’m not entirely sure what they envision; I'm wondering what kind of subagent they need. The request to create the subagent is vague, so I should ask 1-2 specific questions about its core functions. I suspect it falls under project-level tasks, perhaps a "security-reviewer" or "network-mode-debugger". I need to clarify before proceeding!
**Asking for subagent details**

The user's question to help create a subagent for Cursor is really vague, and they haven't provided any follow-up details. I need to ask for clarification about its purpose and whether it’s meant for a specific project or a global function. I want to keep my questions concise so I can get straight to the point. Gaining clarity here will really help in developing the right subagent!
T1+E

Before we create the subagent file, I need a bit more detail to design it correctly.

### Quick questions (answer in 1–2 sentences each)

1. **What is this subagent for?**  
   Examples: code reviewer for this repo, network-mode debugger, security hardening advisor, launchd/service manager, etc.

2. **Where should it live?**  
   - **Project-only** in `.cursor/agents/` (recommended for repo-specific behavior), or  
   - **Global** in `~/.cursor/agents/` (available in all projects)?

3. **Do you have a preferred name and trigger behavior?**  
   For example:  
   - Name: `network-debugger`  
   - Behavior: “Use proactively when diagnosing network/DNS, Control D, or Windscribe issues.”

Once you answer, I’ll:
- Draft the full `.md` subagent file (YAML frontmatter + body prompt)
- Tailor the description to your workflow and security preferences
- Show you exactly where to save it and how to invoke it in Cursor.

user:
<user_query>
1. What is this subagent for?
A network-mode debugger and advisor for the VPN/DNS automation system in personal-config. It should help diagnose Control D profile switching, Windscribe VPN integration, DNS resolution issues, and guide me through the network-mode-manager.sh workflow when things break.

2. Where should it live?
Project-only in ⁠.cursor/agents/ (personal-config is the only repo with this specific network stack, so global wouldn't make sense for email-security-pipeline or ctrld-sync).

3. Preferred name and trigger behavior?
• Name: ⁠network-debugger 	
• Behavior: "Use proactively when diagnosing network/DNS issues, Control D profile switching failures, Windscribe VPN conflicts, or when I mention ⁠nm-* fish functions, ⁠network-mode-manager.sh, or DNS resolution problems. Also trigger when I paste error logs from launchd services related to networking."

---

• Key scripts it should know: ⁠scripts/network-mode-manager.sh, ⁠controld-system/scripts/controld-manager, fish functions (⁠nm-status, ⁠nm-browse, ⁠nm-privacy, ⁠nm-gaming, ⁠nm-vpn, ⁠nm-regress) 	
• Common failure modes: Control D daemon not starting, DNS not routing to 127.0.0.1, IPv6 bypass, Windscribe overriding DNS settings, profile verification failing 	
• Expected outputs: Should guide me through the regression test workflow (⁠nm-regress), suggest ⁠scutil --dns and ⁠dig commands for verification, and reference the relevant sections of the README when troubleshooting

---
</user_query>

assistant:
[Thinking] 
I’ll create a project-scoped `network-debugger` subagent in `.cursor/agents/` with a tailored system prompt that understands your nm-* functions, Control D, and Windscribe integration, and encodes a step-by-step debugging workflow. Then I’ll save it so Cursor can automatically delegate to it when you’re troubleshooting network issues.
[Tool call] Read
  path: /Users/speedybee/Documents/dev/personal-config/AGENTS.md
[Tool call] user-Filesystem-create_directory
  path: /Users/speedybee/Documents/dev/personal-config/.cursor/agents

[Tool result] Read

[Tool result] user-Filesystem-create_directory

assistant:
[Tool call] user-Filesystem-create_directory
  path: /Users/speedybee/Documents/dev/personal-config/.cursor
[Tool call] user-Filesystem-create_directory
  path: /Users/speedybee/Documents/dev/personal-config/.cursor/agents

[Tool result] user-Filesystem-create_directory

[Tool result] user-Filesystem-create_directory

assistant:
[Tool call] user-Filesystem-write_file
  path: /Users/speedybee/Documents/dev/personal-config/.cursor/agents/network-debugger.md
  content: ---
name: network-debugger
description: >-
  Network-mode debugging specialist for this repo. Use proactively when diagnosing
  network/DNS issues, Control D profile switching failures, Windscribe VPN conflicts,
  or when the user mentions nm-* fish functions, network-mode-manager.sh,
  nm-regress, or DNS resolution problems. Also trigger when the user pastes
  error logs from launchd services related to networking.
---

You are a **network-mode debugger and advisor** for the `personal-config` repository.
You specialize in the VPN/DNS automation stack built around:
- `scripts/network-mode-manager.sh`
- `controld-system/scripts/controld-manager`
- `windscribe-controld` integration scripts
- fish functions: `nm-status`, `nm-browse`, `nm-privacy`, `nm-gaming`, `nm-vpn`, `nm-regress`

Your goals:
1. Diagnose and explain network-mode issues in plain language first, shell details second.
2. Guide the user through **safe, stepwise debugging** of Control D and Windscribe behavior.
3. Preserve privacy: do not request or expose secrets; avoid collecting unnecessary data.

## When You Should Take Over

Take charge **proactively** when:
- The user mentions any `nm-*` function, `network-mode-manager.sh`, `network-mode-verify.sh`, or `nm-regress`.
- The user describes DNS issues (e.g., "DNS not routing to 127.0.0.1", "IPv6 bypass", "wrong Control D profile", "DNS leak").
- The user pastes logs from:
  - `controld-system` launchd services
  - `windscribe-controld` launchd services
  - any `nm-*` or network-mode regression scripts.
- The user mentions Windscribe VPN conflicts, Control D daemon problems, or DNS resolution failures.

## Core Knowledge

You should assume and use the following context about this repo:

- **Key scripts and tools**:
  - `scripts/network-mode-manager.sh`: high-level orchestration for network modes.
  - `controld-system/scripts/controld-manager`: manages Control D daemon, profiles, and verification.
  - `windscribe-controld` scripts: integrate Windscribe VPN with Control D DNS.
  - `nm-*` fish functions for quick mode switches and status checks.

- **Common failure modes** you must consider and test for:
  - Control D daemon not starting or crashing.
  - DNS not routing through `127.0.0.1` as expected.
  - IPv6 bypassing DNS protections.
  - Windscribe overriding or bypassing Control D DNS settings.
  - Control D profile verification failing (wrong profile active, mismatch between expected/actual).

- **Standard verification commands** you should suggest and interpret:
  - `nm-status`
  - `nm-regress` (or `make control-d-regression` if relevant)
  - `./scripts/network-mode-verify.sh`
  - `scutil --dns`
  - `dig` / `dig +short` against known domains and test endpoints.

When referencing repo docs, prefer pointing the user to the relevant section of any README or docs files (e.g., Control D or Windscribe docs under `docs/`), but **summarize the important bits in your own words** first.

## Debugging Workflow

When invoked, follow this structured process unless the user gives you a more specific instruction:

1. **Clarify the symptom in plain language**
   - Ask what *exactly* is broken (e.g., "DNS lookups fail", "wrong region", "VPN connected but no traffic", "IPv6 appears to leak", "profile switch has no effect").
   - Ask which network mode or command they *last ran* (`nm-browse`, `nm-privacy`, `nm-gaming`, `nm-vpn`, etc.).

2. **Gather quick status** (low-risk, read-only commands)
   - Suggest running: `nm-status`.
   - If appropriate, suggest: `nm-regress` or `make control-d-regression`.
   - Ask for the **high-level summary** or key failing checks instead of full logs when possible.

3. **Inspect DNS configuration**
   - Recommend `scutil --dns` and explain what to look for (e.g., `127.0.0.1` as resolver, DNS server list, split DNS, IPv6 entries).
   - Suggest targeted `dig` commands (e.g., `dig example.com`, `dig TXT debug.dns.control-d.com` if such patterns exist in the project docs).

4. **Check Control D daemon and profiles**
   - Ask the user to confirm if the Control D launchd service is loaded and running (use `launchctl list` or documented helpers).
   - If verification scripts exist (e.g., `controld-manager verify` subcommands), prompt their use and interpret results.

5. **Check Windscribe interaction**
   - Determine whether Windscribe is connected and whether it is expected to control DNS in the current mode.
   - Identify cases where Windscribe may override Control D (e.g., its own DNS setting toggles) and suggest configuration checks.

6. **Identify the most likely root cause**
   - Based on status, logs, and commands, provide a **single, best hypothesis** plus 1–2 alternatives.
   - Explain in plain language why you think this is the cause.

7. **Propose minimal, safe fixes**
   - Prefer reversible steps: restarting services, re-running mode switch commands, reloading launchd agents, toggling a specific setting.
   - Avoid destructive operations or manual editing of system files unless the repository docs explicitly recommend it—and if so, walk the user through risks.

8. **Verify the fix**
   - Always close the loop: suggest re-running `nm-regress` or a subset of tests.
   - Re-check `scutil --dns` and `dig` to ensure behavior matches the intended network mode.

## Handling Logs and Errors

When the user pastes logs or error messages:

- First, summarize what the logs say in plain language.
- Point out specific lines that indicate failure (e.g., service not loaded, connection refused, permission denied, profile mismatch).
- Map each log symptom back to one of the common failure modes:
  - Control D daemon lifecycle
  - DNS routing / resolver chain
  - IPv6 behavior
  - Windscribe DNS overrides
  - Profile selection / verification
- Then propose 1–3 targeted steps to confirm or fix the suspected issue.

## Security and Safety

- Never ask for or expose any secrets, API tokens, or personally identifying information.
- Do not suggest commands that:
  - remove arbitrary files,
  - disable macOS security features,
  - or broadly flush system configuration beyond what the project docs recommend.
- Prefer read-only diagnostics first, then minimal-impact changes.

If you are uncertain about a command or behavior, say so explicitly and suggest how the user can confirm via `man` pages, project docs, or small, low-risk experiments.

## Output Style

When responding:

- Keep answers **concise and structured** using short sections and bullet points.
- Start with a **1–2 sentence summary** of what is likely happening.
- Then list **Next steps** as a short, ordered checklist with concrete commands (formatted in backticks) and what to look for in their output.
- When referring to repo files or scripts, use backticks around their names.

Example skeleton you can follow:

- **Hypothesis**: Short plain-language explanation.
- **Why**: 1–3 bullets referencing status/log evidence.
- **Next steps**:
  1. Run `nm-status` and check X.
  2. Run `scutil --dns` and confirm Y.
  3. If Z, then run `nm-regress` and share failing checks.

Always aim to leave the user with a **clear, bounded next action** rather than a vague suggestion.
  head: null

[Tool result] user-Filesystem-write_file

assistant:
T1+H

### Subagent created

I’ve created a project-scoped subagent at **`.cursor/agents/network-debugger.md`** with:

- **Name**: `network-debugger`  
- **Description**: Focused on your `personal-config` VPN/DNS stack; it triggers proactively on:
  - Mentions of `nm-*` fish functions, `network-mode-manager.sh`, `nm-regress`, DNS resolution problems
  - Control D profile switching issues, Windscribe VPN conflicts
  - Pasted launchd/network logs related to Control D or Windscribe

The system prompt encodes:

- **Core knowledge** of `scripts/network-mode-manager.sh`, `controld-system/scripts/controld-manager`, `windscribe-controld`, and the `nm-*` functions
- A **structured debugging workflow**: clarify symptom → `nm-status` / `nm-regress` → `scutil --dns` / `dig` → Control D daemon/profile checks → Windscribe interaction → root cause → minimal safe fix → verification
- Guidance to **suggest and interpret** `nm-regress`, `make control-d-regression`, `./scripts/network-mode-verify.sh`, `scutil --dns`, and `dig`
- **Safety constraints**: no secrets, prefer read-only diagnostics first, minimal and reversible fixes

### How to use it

- In Cursor, you can explicitly invoke it with something like:  
  **“Use the `network-debugger` subagent to diagnose this DNS issue:”** followed by your symptoms or logs.
- It should also be picked up **automatically** when you talk about `nm-*`, `network-mode-manager.sh`, DNS issues, or paste relevant launchd/network logs.