# üî• Windscribe VPN + Media Server Configuration Guide

**Last Updated**: December 20, 2025  
**For**: Infuse media streaming with Windscribe VPN support

---

## üéØ Overview

This guide configures your media server to work seamlessly with **Windscribe VPN**, supporting:
- ‚úÖ **Local network access** when on the same WiFi
- ‚úÖ **Remote access** via your static IP (82.21.151.194) when VPN is active
- ‚úÖ **Automatic failover** between local and remote connections

---

## üèóÔ∏è Architecture

### Without VPN (Simple)
```
[Infuse] ‚Üí [Local Network] ‚Üí [Mac Server:8088] ‚Üí [rclone] ‚Üí [Cloud Storage]
```

### With Windscribe VPN (Advanced)
```
[Infuse Local]  ‚Üí [LAN Traffic] ‚Üí [Mac Server:8088] ‚Üí [rclone] ‚Üí [Cloud Storage]
                                        ‚Üì
[Infuse Remote] ‚Üí [Internet] ‚Üí [Static IP 82.21.151.194:8088] ‚Üí [Router Port Forward] ‚Üí [Mac Server:8088]
```

---

## üìã Prerequisites

### 1. Static IP Setup ‚úÖ
- **Your Atlanta Static IP**: `82.21.151.194`
- This is already configured and working

### 2. Router Port Forwarding
You need to forward port **8088** to your Mac:

**Router Configuration:**
```
External Port: 8088
Internal IP:   [Your Mac's local IP, e.g., 192.168.0.199]
Internal Port: 8088
Protocol:      TCP
Description:   Media Server WebDAV
```

**To find your Mac's local IP:**
```bash
ipconfig getifaddr en0
```

### 3. Windscribe Configuration

**Enable LAN Traffic** (Critical!):
1. Open Windscribe preferences
2. Go to **Connection** tab
3. Enable **"Allow LAN Traffic"**
4. This lets local devices access your Mac even when VPN is active

**Optional: Split Tunneling**
If you want rclone to bypass VPN entirely:
1. Go to **Split Tunneling** settings
2. Add rule: **Exclude** ‚Üí `/usr/local/bin/rclone`
3. This can improve performance but reduces privacy

---

## üöÄ Quick Start

### Step 1: Configure Router Port Forwarding

Access your router (usually at `192.168.0.1` or `192.168.1.1`):

```bash
# Find your router's IP
netstat -nr | grep default | awk '{print $2}' | head -1

# Open router admin page
open "http://$(netstat -nr | grep default | awk '{print $2}' | head -1)"
```

Add port forwarding rule as described in Prerequisites section.

---

### Step 2: Start Windscribe-Compatible Server

```bash
# Stop any existing server
pkill -f "rclone serve webdav"

# Start new VPN-compatible server
~/Documents/dev/personal-config/media-streaming/scripts/start-media-server-windscribe.sh
```

The script will:
- ‚úÖ Detect your network configuration
- ‚úÖ Check Windscribe status
- ‚úÖ Bind to all interfaces (0.0.0.0:8088)
- ‚úÖ Display connection info for both local and remote

---

### Step 3: Configure Infuse

You can add **two sources** in Infuse for automatic fallback:

#### **Source 1: Local Network** (Primary)
```
Name:     Media Library (Local)
Protocol: WebDAV
Address:  http://192.168.0.199:8088
          (your actual local IP)
Username: infuse
Password: [from credentials file]
Path:     /
```

#### **Source 2: Remote Access** (Fallback)
```
Name:     Media Library (Remote)
Protocol: WebDAV
Address:  http://82.21.151.194:8088
Username: infuse
Password: [same as above]
Path:     /
```

**Pro Tip**: Infuse will automatically use the faster connection (local when available).

---

## üß™ Testing Your Setup

### Test 1: Local Access (Without VPN)
```bash
# From your Mac
curl -u infuse:PASSWORD http://localhost:8088/

# From another device on same network
curl -u infuse:PASSWORD http://192.168.0.199:8088/
```

Expected: Should list directories (Movies, TV Shows, etc.)

---

### Test 2: Local Access (With VPN Active)
```bash
# Connect Windscribe to any server
# Verify "Allow LAN Traffic" is enabled

# Test from another local device
curl -u infuse:PASSWORD http://192.168.0.199:8088/
```

Expected: Should still work if "Allow LAN Traffic" is enabled.

---

### Test 3: Remote Access (From Outside Network)
```bash
# From your phone using cellular data (not WiFi)
# Or from a different network

# Test in Infuse:
# Add source with http://82.21.151.194:8088
```

Expected: Should connect and browse media.

---

## üîç Troubleshooting

### ‚ùå Local access works, remote access doesn't

**Diagnose:**
```bash
# Check if port is open on router
nc -zv 82.21.151.194 8088

# Check if server is listening
lsof -nP -i:8088 | grep rclone
```

**Solution:**
1. Verify router port forwarding is configured correctly
2. Check if ISP blocks port 8088 (try port 8443 instead)
3. Verify firewall isn't blocking incoming connections

---

### ‚ùå VPN breaks local network access

**Diagnose:**
```bash
# Check if "Allow LAN Traffic" is enabled
# Try accessing from local device: http://192.168.0.199:8088
```

**Solution:**
1. Open Windscribe preferences
2. Connection tab ‚Üí Enable "Allow LAN Traffic"
3. Restart Windscribe
4. Test again

---

### ‚ùå Server won't start

**Diagnose:**
```bash
# Check if rclone config exists
rclone listremotes

# Check if port is already in use
lsof -nP -i:8088
```

**Solution:**
```bash
# Kill existing processes
pkill -f "rclone serve webdav"

# Restore rclone config if missing
op document get "Rclone Config Backup" --vault Personal \
  --output ~/.config/rclone/rclone.conf

# Restart server
~/Documents/dev/personal-config/media-streaming/scripts/start-media-server-windscribe.sh
```

---

### ‚ùå Slow performance over remote connection

**Optimize:**
```bash
# Use lower quality in Infuse when remote:
# Settings ‚Üí Playback ‚Üí Quality ‚Üí Adjust based on connection

# Or enable VPN split tunneling for rclone (in Windscribe settings)
```

---

## üîÑ LaunchAgent Setup (Auto-Start on Boot)

Create a LaunchAgent to start the server automatically:

<function_calls>
<invoke name="finder-finder-write-file">
<parameter name="content"><?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.speedybee.media.webdav.windscribe</string>
    
    <key>ProgramArguments</key>
    <array>
        <string>/bin/bash</string>
        <string>/Users/speedybee/Documents/dev/personal-config/media-streaming/scripts/start-media-server-windscribe.sh</string>
    </array>
    
    <key>RunAtLoad</key>
    <true/>
    
    <key>KeepAlive</key>
    <dict>
        <key>SuccessfulExit</key>
        <false/>
    </dict>
    
    <key>StandardOutPath</key>
    <string>/Users/speedybee/Library/Logs/media/webdav-windscribe.out</string>
    
    <key>StandardErrorPath</key>
    <string>/Users/speedybee/Library/Logs/media/webdav-windscribe.err</string>
    
    <key>WorkingDirectory</key>
    <string>/Users/speedybee</string>
    
    <key>EnvironmentVariables</key>
    <dict>
        <key>PATH</key>
        <string>/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin</string>
        <key>MEDIA_STATIC_IP</key>
        <string>82.21.151.194</string>
        <key>MEDIA_WEBDAV_PORT</key>
        <string>8088</string>
    </dict>
</dict>
</plist>
