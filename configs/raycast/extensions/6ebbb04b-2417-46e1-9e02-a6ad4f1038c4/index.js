"use strict";var a=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var h=Object.prototype.hasOwnProperty;var p=(e,n)=>{for(var t in n)a(e,t,{get:n[t],enumerable:!0})},S=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of f(n))!h.call(e,s)&&s!==t&&a(e,s,{get:()=>n[s],enumerable:!(r=u(n,s))||r.enumerable});return e};var g=e=>S(a({},"__esModule",{value:!0}),e);var N={};p(N,{default:()=>m});module.exports=g(N);var i=require("@raycast/api"),c=require("node:child_process"),l=require("node:os"),w={darwin:{commands:{dscacheutil:"/usr/bin/dscacheutil -flushcache",mDNSResponder:"/usr/bin/killall -HUP mDNSResponder",mdnsflushcache:"/usr/bin/discoveryutil mdnsflushcache"},shell:"/bin/bash"},win32:{commands:{ipconfig:"ipconfig /flushdns"},shell:void 0}};async function m(){let e=(0,l.platform)();if(!["darwin","win32"].includes(e)){await(0,i.showHUD)("\u{1F6AB} Unsupported operating system");return}let n=w[e],t,r;switch(e){case"darwin":{let s=await y(n);if(!s)return;t=s.command,r=s.shell;break}case"win32":{let{ipconfig:s}=n.commands;t=s,r=n.shell;break}default:await(0,i.showHUD)("\u{1F6AB} Unsupported OS");return}console.log(`\u{1F680} Executing DNS flush command: ${t} in shell: ${r}`);try{(0,c.execSync)(t,{shell:r,stdio:"ignore"}),await(0,i.showHUD)("\u2705 DNS Cache Flushed Successfully")}catch(s){await D(s,e)}}async function y(e){try{let n=(0,c.execSync)("sw_vers -productVersion").toString().trim(),t={"^1[1-5]":["dscacheutil","mDNSResponder"],"^10\\.([7-9]|1[1-4])|^10\\.10\\.[4-5]":["mDNSResponder"],"^10\\.10\\.[0-3]":["mdnsflushcache"],"^10\\.6":["dscacheutil"]},r=!1,s=[];for(let[o,d]of Object.entries(t))if(new RegExp(o).test(n)){s=d,r=!0;break}if(!r){if(!await(0,i.confirmAlert)({title:`\u26A0\uFE0F OS Version ${n} Not Tested`,message:"Attempt to flush DNS cache anyway?",primaryAction:{title:"Flush DNS"}}))return null;s=["dscacheutil","mDNSResponder"]}return{command:`osascript -e 'do shell script "${s.map(o=>e.commands[o]).join("; ")}" with administrator privileges'`,shell:e.shell}}catch(n){return console.error("\u274C Error determining macOS version:",n),await(0,i.showHUD)("Failed to determine macOS version"),null}}async function D(e,n){let t="\u26A0\uFE0F Error flushing DNS cache";if(typeof e=="object"&&e!==null&&"stderr"in e){let r=e.stderr?.toString()||"";r&&(console.error(".Stderr:",r),n==="win32"&&r.includes("The requested operation requires elevation")?t="\u26A0\uFE0F Run Raycast as Administrator":t=r.split(`
`)[0].substring(0,64))}console.error("\u{1F4A5} Execution failed:",e),await(0,i.showHUD)(t)}
