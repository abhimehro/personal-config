"use strict";var g=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var j=Object.prototype.hasOwnProperty;var z=(t,e)=>{for(var o in e)g(t,o,{get:e[o],enumerable:!0})},E=(t,e,o,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of N(e))!j.call(t,i)&&i!==o&&g(t,i,{get:()=>e[i],enumerable:!(l=D(e,i))||l.enumerable});return t};var C=t=>E(g({},"__esModule",{value:!0}),t);var O={};z(O,{default:()=>x});module.exports=C(O);var r=require("@raycast/api"),a=require("path"),u=require("fs/promises");var h=require("@raycast/api"),F=require("path"),S=require("fs/promises"),y=require("child_process");async function B(t,...e){if(process.platform==="win32")return Promise.reject(new Error("Swift functions are not supported on Windows"));let o=(0,F.join)(h.environment.assetsPath,"compiled_raycast_swift/swift");return await(0,S.chmod)(o,"755"),new Promise((l,i)=>{let p=[t];for(let m of e)try{p.push(JSON.stringify(m,(n,d)=>d===void 0?null:d))}catch(n){i(new f("Failed to serialize input to JSON: "+n.message));return}let c=(0,y.spawn)(o,p),s=[],w=[];c.stdout?.on("data",m=>{s.push(m.toString())}),c.stderr?.on("data",m=>{w.push(m.toString())}),c.on("exit",m=>{if(m===0)try{let n=s.join("").trim();n.length!=0?l(JSON.parse(n)):l(null)}catch(n){let d=new f("Failed to deserialize result from JSON: "+n.message);d.stdout=s.join("").trim(),d.stderr=w.join("").trim(),i(d)}else{let n=new f(w.join("").trim()||s.join("").trim()||"Could not get any data");n.stdout=s.join("").trim(),n.stderr=w.join("").trim(),i(n)}}),c.on("error",m=>{i(m)})})}async function P(t){return await B("compressPDF",t)}var f=class extends Error{constructor(e){super(e),this.name="SwiftError"}};async function I(t){try{return await(0,u.access)(t,u.constants.F_OK),!0}catch{return!1}}async function x(){let t=[];try{let e=await(0,r.getSelectedFinderItems)();if(!e.length)throw new Error("No PDF selected");if(t=e.filter(o=>o.path.endsWith(".pdf")),t.length===0)throw new Error("No PDF selected")}catch(e){await(0,r.showToast)({style:r.Toast.Style.Failure,title:"Could not get selected PDF files",message:String(e).trim().replace("Error: ","")})}for(let e of t){let o=(0,a.basename)(e.path);await(0,r.showToast)({style:r.Toast.Style.Animated,title:`Compressing ${o}`});let l=(0,a.dirname)(e.path),p=`${(0,a.basename)(e.path,(0,a.extname)(e.path))} - compressed${(0,a.extname)(e.path)}`,c=(0,a.join)(l,p);if(await I(c)){await(0,r.showToast)({style:r.Toast.Style.Failure,title:`"${p}" already exists.`});continue}try{let s=await P(e.path);if(s.savedPercentage===0){await(0,r.showToast)({style:r.Toast.Style.Failure,title:"No improvement",message:`${o} could not be compressed further.`});continue}await(0,u.copyFile)(s.compressedURL,c),await(0,r.showToast)({style:r.Toast.Style.Success,title:`Compressed ${o}`,message:`Saved ${s.savedPercentage}% (${$(s.originalSize)} \u2192 ${$(s.compressedSize)})`}),await(0,r.showInFinder)(c)}catch(s){await(0,r.showToast)({style:r.Toast.Style.Failure,title:`Failed to compress ${o}`,message:s instanceof Error?s.message:String(s)})}}}function $(t){return t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/1024/1024).toFixed(1)} MB`}
