"use strict";var i=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var U=(r,e)=>{for(var a in e)i(r,a,{get:e[a],enumerable:!0})},x=(r,e,a,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of R(e))!S.call(r,s)&&s!==a&&i(r,s,{get:()=>e[s],enumerable:!(o=P(e,s))||o.enumerable});return r};var E=r=>x(i({},"__esModule",{value:!0}),r);var L={};U(L,{default:()=>y});module.exports=E(L);var n=require("@raycast/api");var t=require("@raycast/api");var p=[{name:"Google Search",url:"google.com",allowParams:["q","ie"]},{name:"Baidu Search",url:"baidu.com",allowParams:["wd","ie"]},{name:"Bing Search",url:"bing.com",allowParams:["q"]},{name:"Netease Music",url:"music.163.com",allowParams:["id"]},{name:"Youtube",url:"youtube.com",allowParams:["v","search_query"]},{name:"Instagram Reel",url:"instagram.com/reel",allowParams:[]}];function c(r){let e=/(https?:\/\/[^\s]+)/g;return r.match(e)??[]}function f(r,e){let a=c(r);for(let o of a)r=r.replace(o,e.shift()||o);return r}function w(r,e){let a=r.split("?");if(a.length<2)return r;let o=a[1].split("&");if(e.length>0){let s=o.filter(l=>e.includes(l.split("=")[0]));return`${a[0]}?${s.join("&")}`}return a[0]}async function u(r){let e=c(r);if(e.length===0){await(0,t.showHUD)("No URL found");return}console.log("raw urls",e);let a=[];for(let m of e){let g=p.find(T=>m.includes(T.url))?.allowParams||[];console.log("allow params",g);let h=w(m,g);a.push(h)}console.log("new urls",a);let o=f(r,a);console.log("new text",o),await t.Clipboard.copy(o);let s=await(0,t.getFrontmostApplication)(),{exitAfterCleaning:l}=(0,t.getPreferenceValues)();l&&await(0,t.closeMainWindow)({clearRootSearch:!0,popToRootType:t.PopToRootType.Suspended}),await(0,t.showToast)({title:"Tracking parameters removed",message:o,style:t.Toast.Style.Success,primaryAction:{title:`Paste Cleaned URL to ${s.name}`,onAction:async()=>{await t.Clipboard.paste(o)}}})}async function d(r){try{return{data:await r,error:null}}catch(e){return{data:null,error:e}}}async function y(){await(0,n.showToast)({style:n.Toast.Style.Animated,title:"Getting selected text..."});let{data:r,error:e}=await d((0,n.getSelectedText)());if(e){await(0,n.showHUD)("Failed to get selected text");return}await u(r)}
