"use strict";var i=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var U=Object.prototype.hasOwnProperty;var E=(r,e)=>{for(var a in e)i(r,a,{get:e[a],enumerable:!0})},S=(r,e,a,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of R(e))!U.call(r,n)&&n!==a&&i(r,n,{get:()=>e[n],enumerable:!(o=T(e,n))||o.enumerable});return r};var x=r=>S(i({},"__esModule",{value:!0}),r);var L={};E(L,{default:()=>y});module.exports=x(L);var s=require("@raycast/api");var t=require("@raycast/api");var g=[{name:"Google Search",url:"google.com",allowParams:["q","ie"]},{name:"Baidu Search",url:"baidu.com",allowParams:["wd","ie"]},{name:"Bing Search",url:"bing.com",allowParams:["q"]},{name:"Netease Music",url:"music.163.com",allowParams:["id"]},{name:"Youtube",url:"youtube.com",allowParams:["v","search_query"]},{name:"Instagram Reel",url:"instagram.com/reel",allowParams:[]}];function c(r){let e=/(https?:\/\/[^\s]+)/g;return r.match(e)??[]}function f(r,e){let a=c(r);for(let o of a)r=r.replace(o,e.shift()||o);return r}function w(r,e){let a=r.split("?");if(a.length<2)return r;let o=a[1].split("&");if(e.length>0){let n=o.filter(l=>e.includes(l.split("=")[0]));return`${a[0]}?${n.join("&")}`}return a[0]}async function u(r){let e=c(r);if(e.length===0){await(0,t.showHUD)("No URL found");return}console.log("raw urls",e);let a=[];for(let m of e){let p=g.find(P=>m.includes(P.url))?.allowParams||[];console.log("allow params",p);let h=w(m,p);a.push(h)}console.log("new urls",a);let o=f(r,a);console.log("new text",o),await t.Clipboard.copy(o);let n=await(0,t.getFrontmostApplication)(),{exitAfterCleaning:l}=(0,t.getPreferenceValues)();l&&await(0,t.closeMainWindow)({clearRootSearch:!0,popToRootType:t.PopToRootType.Suspended}),await(0,t.showToast)({title:"Tracking parameters removed",message:o,style:t.Toast.Style.Success,primaryAction:{title:`Paste Cleaned URL to ${n.name}`,onAction:async()=>{await t.Clipboard.paste(o)}}})}async function d(r){try{return{data:await r,error:null}}catch(e){return{data:null,error:e}}}async function y(){let{data:r,error:e}=await d(s.Clipboard.readText());if(e||!r){await(0,s.showHUD)("Failed to get clipboard text");return}await u(r)}
