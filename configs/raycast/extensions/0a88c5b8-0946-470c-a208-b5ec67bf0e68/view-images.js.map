{
  "version": 3,
  "sources": ["../src/view-images.tsx"],
  "sourcesContent": ["import { writeFile } from \"node:fs/promises\";\nimport { homedir } from \"node:os\";\nimport { join } from \"node:path\";\n\nimport { useMemo, useState } from \"react\";\n\nimport { Detail, Grid, LocalStorage, ActionPanel, Action, Icon, Toast, showToast } from \"@raycast/api\";\n\nimport { StoreData, UploadResponse } from \"@/types\";\n\nexport default function Command() {\n  const [term, setTerm] = useState<string>(\"\");\n  const { history, error, loading } = useHistory(term);\n\n  if (error) return <Detail markdown={error} />;\n\n  return (\n    <Grid isLoading={loading} columns={4} onSearchTextChange={setTerm}>\n      {history.map((item) => (\n        <Grid.Item\n          key={item.id}\n          content={item.link}\n          actions={\n            <ActionPanel>\n              <Action.Push title=\"Details\" target={<MetaData {...item} />} icon={{ source: Icon.Info }} />\n              <Download url={item.link} filename={item.title ?? \"\"} />\n              <Action.OpenInBrowser url={item.link} />\n              <Action.CopyToClipboard title=\"Copy Link\" content={item.link} />\n            </ActionPanel>\n          }\n        />\n      ))}\n    </Grid>\n  );\n}\n\nconst useHistory = (term: string) => {\n  const [history, setHistory] = useState<UploadResponse[]>([]);\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState<boolean>(true);\n\n  useMemo(() => {\n    const getHistory = async () => {\n      const storageHistory: StoreData[] = JSON.parse((await LocalStorage.getItem(\"history\")) || \"[]\");\n      /**\n       * Future update can group albums pictures\n       * Workaround this to not break current history\n       */\n      const history = storageHistory.map((item) => (\"album\" in item ? item.images : item)).flat();\n\n      if (!history) {\n        setError(\"No history found\");\n        setLoading(false);\n        return;\n      }\n\n      if (term) {\n        const filtered = history.filter((item: UploadResponse) =>\n          item.title?.toLowerCase().includes(term.toLowerCase()),\n        );\n        setHistory(filtered);\n        setLoading(false);\n        return;\n      }\n\n      setHistory(history);\n      setLoading(false);\n    };\n\n    getHistory();\n  }, [term]);\n\n  return { history, error, loading };\n};\n\nconst MetaData = (item: UploadResponse) => {\n  return (\n    <Detail\n      markdown={`![${item.title}](${item.link})`}\n      metadata={\n        <Detail.Metadata>\n          <Detail.Metadata.Label title=\"Filename\" text={item?.title ?? \"Untitled\"} />\n          <Detail.Metadata.Label title=\"MIME Type\" text={item?.type} />\n          <Detail.Metadata.Label title=\"Size\" text={bytesToString(item?.size)} />\n          <Detail.Metadata.Label title=\"Dimensions\" text={`${item?.width}x${item?.height}`} />\n          <Detail.Metadata.Separator />\n          <Detail.Metadata.Label title=\"Uploaded\" text={new Date(item?.datetime * 1000).toLocaleString()} />\n        </Detail.Metadata>\n      }\n      actions={\n        <ActionPanel>\n          <Download url={item.link} filename={item.title ?? \"\"} />\n          <Action.OpenInBrowser url={item.link} />\n          <Action.CopyToClipboard title=\"Copy Link\" content={item.link} />\n        </ActionPanel>\n      }\n    />\n  );\n};\n\nexport const downloadMedia = async (url: string, filename: string) => {\n  const path = join(homedir(), \"Downloads\", filename);\n\n  try {\n    const toast = await showToast(Toast.Style.Animated, \"Downloading image\", \"Please wait...\");\n    const response = await fetch(url);\n    const arrayBuffer = await response.arrayBuffer();\n    await writeFile(path, Buffer.from(arrayBuffer));\n    toast.title = \"Downloaded\";\n    toast.message = `${path}`;\n    toast.style = Toast.Style.Success;\n  } catch {\n    await showToast(Toast.Style.Failure, \"Download failed\", \"Please try again\");\n  }\n};\n\nexport const Download: React.FC<{ url: string; filename: string }> = ({ url, filename }) => {\n  return (\n    <Action\n      title=\"Download\"\n      icon={{ source: Icon.Download }}\n      onAction={() => {\n        downloadMedia(url, filename);\n      }}\n    />\n  );\n};\n\nconst bytesToString = (bytes: number) =>\n  bytes >= 1048576\n    ? (bytes / 1048576).toFixed(1) + \"MB\"\n    : bytes >= 1024\n      ? (bytes / 1024).toFixed(1) + \"KB\"\n      : bytes + \"B\";\n"],
  "mappings": "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",
  "names": ["view_images_exports", "__export", "Download", "Command", "downloadMedia", "__toCommonJS", "import_promises", "import_node_os", "import_node_path", "import_react", "import_api", "import_jsx_runtime", "term", "setTerm", "history", "error", "loading", "useHistory", "item", "MetaData", "setHistory", "setError", "setLoading", "filtered", "bytesToString", "url", "filename", "path", "toast", "arrayBuffer", "bytes"]
}
