"use strict";var u=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var L=(t,a)=>{for(var n in a)u(t,n,{get:a[n],enumerable:!0})},x=(t,a,n,r)=>{if(a&&typeof a=="object"||typeof a=="function")for(let s of S(a))!k.call(t,s)&&s!==n&&u(t,s,{get:()=>a[s],enumerable:!(r=M(a,s))||r.enumerable});return t};var C=t=>x(u({},"__esModule",{value:!0}),t);var I={};L(I,{Download:()=>f,default:()=>m,downloadMedia:()=>h});module.exports=C(I);var g=require("node:fs/promises"),w=require("node:os"),y=require("node:path"),l=require("react"),e=require("@raycast/api"),o=require("react/jsx-runtime");function m(){let[t,a]=(0,l.useState)(""),{history:n,error:r,loading:s}=B(t);return r?(0,o.jsx)(e.Detail,{markdown:r}):(0,o.jsx)(e.Grid,{isLoading:s,columns:4,onSearchTextChange:a,children:n.map(i=>(0,o.jsx)(e.Grid.Item,{content:i.link,actions:(0,o.jsxs)(e.ActionPanel,{children:[(0,o.jsx)(e.Action.Push,{title:"Details",target:(0,o.jsx)(T,{...i}),icon:{source:e.Icon.Info}}),(0,o.jsx)(f,{url:i.link,filename:i.title??""}),(0,o.jsx)(e.Action.OpenInBrowser,{url:i.link}),(0,o.jsx)(e.Action.CopyToClipboard,{title:"Copy Link",content:i.link})]})},i.id))})}var B=t=>{let[a,n]=(0,l.useState)([]),[r,s]=(0,l.useState)(null),[i,c]=(0,l.useState)(!0);return(0,l.useMemo)(()=>{(async()=>{let p=JSON.parse(await e.LocalStorage.getItem("history")||"[]").map(d=>"album"in d?d.images:d).flat();if(!p){s("No history found"),c(!1);return}if(t){let d=p.filter(D=>D.title?.toLowerCase().includes(t.toLowerCase()));n(d),c(!1);return}n(p),c(!1)})()},[t]),{history:a,error:r,loading:i}},T=t=>(0,o.jsx)(e.Detail,{markdown:`![${t.title}](${t.link})`,metadata:(0,o.jsxs)(e.Detail.Metadata,{children:[(0,o.jsx)(e.Detail.Metadata.Label,{title:"Filename",text:t?.title??"Untitled"}),(0,o.jsx)(e.Detail.Metadata.Label,{title:"MIME Type",text:t?.type}),(0,o.jsx)(e.Detail.Metadata.Label,{title:"Size",text:b(t?.size)}),(0,o.jsx)(e.Detail.Metadata.Label,{title:"Dimensions",text:`${t?.width}x${t?.height}`}),(0,o.jsx)(e.Detail.Metadata.Separator,{}),(0,o.jsx)(e.Detail.Metadata.Label,{title:"Uploaded",text:new Date(t?.datetime*1e3).toLocaleString()})]}),actions:(0,o.jsxs)(e.ActionPanel,{children:[(0,o.jsx)(f,{url:t.link,filename:t.title??""}),(0,o.jsx)(e.Action.OpenInBrowser,{url:t.link}),(0,o.jsx)(e.Action.CopyToClipboard,{title:"Copy Link",content:t.link})]})}),h=async(t,a)=>{let n=(0,y.join)((0,w.homedir)(),"Downloads",a);try{let r=await(0,e.showToast)(e.Toast.Style.Animated,"Downloading image","Please wait..."),i=await(await fetch(t)).arrayBuffer();await(0,g.writeFile)(n,Buffer.from(i)),r.title="Downloaded",r.message=`${n}`,r.style=e.Toast.Style.Success}catch{await(0,e.showToast)(e.Toast.Style.Failure,"Download failed","Please try again")}},f=({url:t,filename:a})=>(0,o.jsx)(e.Action,{title:"Download",icon:{source:e.Icon.Download},onAction:()=>{h(t,a)}}),b=t=>t>=1048576?(t/1048576).toFixed(1)+"MB":t>=1024?(t/1024).toFixed(1)+"KB":t+"B";0&&(module.exports={Download,downloadMedia});
