"use strict";var $e=Object.create;var N=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var we=Object.getOwnPropertyNames;var ke=Object.getPrototypeOf,xe=Object.prototype.hasOwnProperty;var ve=(r,n)=>{for(var e in n)N(r,e,{get:n[e],enumerable:!0})},G=(r,n,e,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of we(n))!xe.call(r,a)&&a!==e&&N(r,a,{get:()=>n[a],enumerable:!(t=ye(n,a))||t.enumerable});return r};var W=(r,n,e)=>(e=r!=null?$e(ke(r)):{},G(n||!r||!r.__esModule?N(e,"default",{value:r,enumerable:!0}):e,r)),Se=r=>G(N({},"__esModule",{value:!0}),r);var We={};ve(We,{default:()=>de});module.exports=Se(We);var p=require("@raycast/api");var o=W(require("react")),u=require("@raycast/api");var K=Object.prototype.hasOwnProperty;function V(r,n){var e,t;if(r===n)return!0;if(r&&n&&(e=r.constructor)===n.constructor){if(e===Date)return r.getTime()===n.getTime();if(e===RegExp)return r.toString()===n.toString();if(e===Array){if((t=r.length)===n.length)for(;t--&&V(r[t],n[t]););return t===-1}if(!e||typeof r=="object"){t=0;for(e in r)if(K.call(r,e)&&++t&&!K.call(n,e)||!(e in n)||!V(r[e],n[e]))return!1;return Object.keys(n).length===t}}return r!==r&&n!==n}var _=W(require("node:fs")),z=W(require("node:path")),Q=W(require("node:crypto"));var X=require("react/jsx-runtime");var ee=require("node:url");function Ee(r){let n=(0,o.useRef)(r),e=(0,o.useRef)(0);return V(r,n.current)||(n.current=r,e.current+=1),(0,o.useMemo)(()=>n.current,[e.current])}function w(r){let n=(0,o.useRef)(r);return n.current=r,n}function te(r,n){let e=r instanceof Error?r.message:String(r);return(0,u.showToast)({style:u.Toast.Style.Failure,title:n?.title??"Something went wrong",message:n?.message??e,primaryAction:n?.primaryAction??H(r),secondaryAction:n?.primaryAction?H(r):void 0})}var H=r=>{let n=!0,e="[Extension Name]...",t="";try{let i=JSON.parse((0,_.readFileSync)((0,z.join)(u.environment.assetsPath,"..","package.json"),"utf8"));e=`[${i.title}]...`,t=`https://raycast.com/${i.owner||i.author}/${i.name}`,(!i.owner||i.access==="public")&&(n=!1)}catch{}let a=u.environment.isDevelopment||n,l=r instanceof Error?r?.stack||r?.message||"":String(r);return{title:a?"Copy Logs":"Report Error",onAction(i){i.hide(),a?u.Clipboard.copy(l):(0,u.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(e)}&extension-url=${encodeURI(t)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${l}
\`\`\`
`)}`)}}};function re(r,n,e){let t=(0,o.useRef)(0),[a,l]=(0,o.useState)({isLoading:!0}),i=w(r),f=w(e?.abortable),c=w(n||[]),s=w(e?.onError),d=w(e?.onData),m=w(e?.onWillExecute),$=w(e?.failureToastOptions),v=w(a.data),S=(0,o.useRef)(null),g=(0,o.useRef)({page:0}),E=(0,o.useRef)(!1),A=(0,o.useRef)(!0),D=(0,o.useRef)(50),k=(0,o.useCallback)(()=>(f.current&&(f.current.current?.abort(),f.current.current=new AbortController),++t.current),[f]),b=(0,o.useCallback)((...R)=>{let x=k();m.current?.(R),l(h=>({...h,isLoading:!0}));let U=Ae(i.current)(...R);function I(h){return h.name=="AbortError"||x===t.current&&(s.current?s.current(h):u.environment.launchType!==u.LaunchType.Background&&te(h,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(T){T.hide(),S.current?.(...c.current||[])}},...$.current}),l({error:h,isLoading:!1})),h}return typeof U=="function"?(E.current=!0,U(g.current).then(({data:h,hasMore:T,cursor:be})=>(x===t.current&&(g.current&&(g.current.cursor=be,g.current.lastItem=h?.[h.length-1]),d.current&&d.current(h,g.current),T&&(D.current=h.length),A.current=T,l(ge=>g.current.page===0?{data:h,isLoading:!1}:{data:(ge.data||[])?.concat(h),isLoading:!1})),h),h=>(A.current=!1,I(h)))):(E.current=!1,U.then(h=>(x===t.current&&(d.current&&d.current(h),l({data:h,isLoading:!1})),h),I))},[d,s,c,i,l,S,m,g,$,k]);S.current=b;let C=(0,o.useCallback)(()=>{g.current={page:0};let R=c.current||[];return b(...R)},[b,c]),P=(0,o.useCallback)(async(R,x)=>{let U;try{if(x?.optimisticUpdate){k(),typeof x?.rollbackOnError!="function"&&x?.rollbackOnError!==!1&&(U=structuredClone(v.current?.value));let I=x.optimisticUpdate;l(h=>({...h,data:I(h.data)}))}return await R}catch(I){if(typeof x?.rollbackOnError=="function"){let h=x.rollbackOnError;l(T=>({...T,data:h(T.data)}))}else x?.optimisticUpdate&&x?.rollbackOnError!==!1&&l(h=>({...h,data:U}));throw I}finally{x?.shouldRevalidateAfter!==!1&&(u.environment.launchType===u.LaunchType.Background||u.environment.commandMode==="menu-bar"?await C():C())}},[C,v,l,k]),M=(0,o.useCallback)(()=>{g.current.page+=1;let R=c.current||[];b(...R)},[g,c,b]);(0,o.useEffect)(()=>{g.current={page:0},e?.execute!==!1?b(...n||[]):k()},[Ee([n,e?.execute,b]),f,g]),(0,o.useEffect)(()=>()=>{k()},[k]);let he=e?.execute!==!1?a.isLoading:!1,pe={...a,isLoading:he},me=E.current?{pageSize:D.current,hasMore:A.current,onLoadMore:M}:void 0;return{...pe,revalidate:C,mutate:P,pagination:me}}function Ae(r){return r===Promise.all||r===Promise.race||r===Promise.resolve||r===Promise.reject?r.bind(Promise):r}function J(r){return typeof r!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(r))!==null}function Ce(r){return r instanceof URLSearchParams?r.toString():r}function ne(r,n=[]){function e(t){return"update"in r?r.update(t,"utf8"):r.write(t)}return{dispatch:function(t){t=Ce(t),t===null?this._null():this["_"+typeof t](t)},_object:function(t){let a=/\[object (.*)\]/i,l=Object.prototype.toString.call(t),i=a.exec(l)?.[1]??"unknown:["+l+"]";i=i.toLowerCase();let f=null;if((f=n.indexOf(t))>=0){this.dispatch("[CIRCULAR:"+f+"]");return}else n.push(t);if(Buffer.isBuffer(t))return e("buffer:"),e(t.toString("utf8"));if(i!=="object"&&i!=="function"&&i!=="asyncfunction")if(this["_"+i])this["_"+i](t);else throw new Error('Unknown object type "'+i+'"');else{let c=Object.keys(t);c=c.sort(),J(t)||c.splice(0,0,"prototype","__proto__","constructor"),e("object:"+c.length+":");let s=this;return c.forEach(function(d){s.dispatch(d),e(":"),s.dispatch(t[d]),e(",")})}},_array:function(t,a){a=typeof a<"u"?a:!1;let l=this;if(e("array:"+t.length+":"),!a||t.length<=1){t.forEach(function(c){l.dispatch(c)});return}let i=[],f=t.map(function(c){let s=Re(),d=n.slice();return ne(s,d).dispatch(c),i=i.concat(d.slice(n.length)),s.read().toString()});n=n.concat(i),f.sort(),this._array(f,!1)},_date:function(t){e("date:"+t.toJSON())},_symbol:function(t){e("symbol:"+t.toString())},_error:function(t){e("error:"+t.toString())},_boolean:function(t){e("bool:"+t.toString())},_string:function(t){e("string:"+t.length+":"),e(t.toString())},_function:function(t){e("fn:"),J(t)?this.dispatch("[native]"):this.dispatch(t.toString()),this.dispatch("function-name:"+String(t.name)),this._object(t)},_number:function(t){e("number:"+t.toString())},_xml:function(t){e("xml:"+t.toString())},_null:function(){e("Null")},_undefined:function(){e("Undefined")},_regexp:function(t){e("regex:"+t.toString())},_uint8array:function(t){e("uint8array:"),this.dispatch(Array.prototype.slice.call(t))},_uint8clampedarray:function(t){e("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(t))},_int8array:function(t){e("int8array:"),this.dispatch(Array.prototype.slice.call(t))},_uint16array:function(t){e("uint16array:"),this.dispatch(Array.prototype.slice.call(t))},_int16array:function(t){e("int16array:"),this.dispatch(Array.prototype.slice.call(t))},_uint32array:function(t){e("uint32array:"),this.dispatch(Array.prototype.slice.call(t))},_int32array:function(t){e("int32array:"),this.dispatch(Array.prototype.slice.call(t))},_float32array:function(t){e("float32array:"),this.dispatch(Array.prototype.slice.call(t))},_float64array:function(t){e("float64array:"),this.dispatch(Array.prototype.slice.call(t))},_arraybuffer:function(t){e("arraybuffer:"),this.dispatch(new Uint8Array(t))},_url:function(t){e("url:"+t.toString())},_map:function(t){e("map:");let a=Array.from(t);this._array(a,!0)},_set:function(t){e("set:");let a=Array.from(t);this._array(a,!0)},_file:function(t){e("file:"),this.dispatch([t.name,t.size,t.type,t.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){e("domwindow")},_bigint:function(t){e("bigint:"+t.toString())},_process:function(){e("process")},_timer:function(){e("timer")},_pipe:function(){e("pipe")},_tcp:function(){e("tcp")},_udp:function(){e("udp")},_tty:function(){e("tty")},_statwatcher:function(){e("statwatcher")},_securecontext:function(){e("securecontext")},_connection:function(){e("connection")},_zlib:function(){e("zlib")},_context:function(){e("context")},_nodescript:function(){e("nodescript")},_httpparser:function(){e("httpparser")},_dataview:function(){e("dataview")},_signal:function(){e("signal")},_fsevent:function(){e("fsevent")},_tlswrap:function(){e("tlswrap")}}}function Re(){return{buf:"",write:function(r){this.buf+=r},end:function(r){this.buf+=r},read:function(){return this.buf}}}function Te(r,n){let e=this[r];return e instanceof Date?`__raycast_cached_date__${e.toISOString()}`:Buffer.isBuffer(e)?`__raycast_cached_buffer__${e.toString("base64")}`:n}function _e(r,n){return typeof n=="string"&&n.startsWith("__raycast_cached_date__")?new Date(n.replace("__raycast_cached_date__","")):typeof n=="string"&&n.startsWith("__raycast_cached_buffer__")?Buffer.from(n.replace("__raycast_cached_buffer__",""),"base64"):n}function Z(r){let n=Q.default.createHash("sha1");return ne(n).dispatch(r),n.digest("hex")}var Pe=Symbol("cache without namespace"),q=new Map;function ae(r,n,e){let t=e?.cacheNamespace||Pe,a=q.get(t)||q.set(t,new u.Cache({namespace:e?.cacheNamespace})).get(t);if(!a)throw new Error("Missing cache");let l=w(r),i=w(n),f=(0,o.useSyncExternalStore)(a.subscribe,()=>{try{return a.get(l.current)}catch(m){console.error("Could not get Cache data:",m);return}}),c=(0,o.useMemo)(()=>{if(typeof f<"u"){if(f==="undefined")return;try{return JSON.parse(f,_e)}catch(m){return console.warn("The cached data is corrupted",m),i.current}}else return i.current},[f,i]),s=w(c),d=(0,o.useCallback)(m=>{let $=typeof m=="function"?m(s.current):m;if(typeof $>"u")a.set(l.current,"undefined");else{let v=JSON.stringify($,Te);a.set(l.current,v)}return $},[a,l,s]);return[c,d]}var O=Symbol();function se(r,n,e){let{initialData:t,keepPreviousData:a,internal_cacheKeySuffix:l,...i}=e||{},f=(0,o.useRef)(null),[c,s]=ae(Z(n||[])+l,O,{cacheNamespace:Z(r)}),d=(0,o.useRef)(c!==O?c:t),m=(0,o.useRef)(void 0),{mutate:$,revalidate:v,...S}=re(r,n||[],{...i,onData(k,b){m.current=b,i.onData&&i.onData(k,b),!(b&&b.page>0)&&(f.current="promise",d.current=k,s(k))}}),g,E=S.pagination;m.current&&m.current.page>0&&S.data?g=S.data:f.current==="promise"?g=d.current:a&&c!==O?(g=c,E&&(E.hasMore=!0,E.pageSize=c.length)):a&&c===O?g=d.current:c!==O?(g=c,E&&(E.hasMore=!0,E.pageSize=c.length)):g=t;let A=w(g),D=(0,o.useCallback)(async(k,b)=>{let C;try{if(b?.optimisticUpdate){typeof b?.rollbackOnError!="function"&&b?.rollbackOnError!==!1&&(C=structuredClone(A.current));let P=b.optimisticUpdate(A.current);f.current="cache",d.current=P,s(P)}return await $(k,{shouldRevalidateAfter:b?.shouldRevalidateAfter})}catch(P){if(typeof b?.rollbackOnError=="function"){let M=b.rollbackOnError(A.current);f.current="cache",d.current=M,s(M)}else b?.optimisticUpdate&&b?.rollbackOnError!==!1&&(f.current="cache",d.current=C,s(C));throw P}},[s,$,A,d,f]);return(0,o.useEffect)(()=>{c!==O&&(f.current="cache",d.current=c)},[c]),{data:g,isLoading:S.isLoading,error:S.error,mutate:m.current&&m.current.page>0?$:D,pagination:E,revalidate:v}}var Ue=10,Y=864e5,Ie={Default:100,Embed:0,Bookmark:140};function Oe(r){let n=Date.now(),e=r?r.lastVisited:0,t=r?r.frecency:0,a=(n-e)/Y,l=Math.log(2)/(Ue*Y),i=Ie.Default*Math.exp(-l*a),f=t+i;return{lastVisited:n,frecency:f}}var Le=r=>{if(process.env.NODE_ENV!=="production"&&(typeof r!="object"||!r||!("id"in r)||typeof r.id!="string"))throw new Error("Specify a key function or make sure your items have an 'id' property");return r.id};function ie(r,n){let e=w(n?.key||Le),t=w(n?.sortUnvisited),[a,l]=ae(`raycast_frecency_${n?.namespace}`,{}),i=(0,o.useCallback)(async function(d){let m=e.current(d);l($=>{let v=$[m],S=Oe(v);return{...$,[m]:S}})},[e,l]),f=(0,o.useCallback)(async function(d){let m=e.current(d);l($=>{let v={...$};return delete v[m],v})},[e,l]);return{data:(0,o.useMemo)(()=>r?r.sort((s,d)=>{let m=a[e.current(s)],$=a[e.current(d)];return m&&!$?-1:!m&&$?1:m&&$?$.frecency-m.frecency:t.current?t.current(s,d):0}):[],[a,r,e,t]),visitItem:i,resetRanking:f}}function oe(r,n){try{let e=i=>i.startsWith("http")?i:`https://${i}`,a=(typeof r=="string"?new ee.URL(e(r)):r).hostname;switch(process.env.FAVICON_PROVIDER??"raycast"){case"none":return{source:n?.fallback??u.Icon.Link,mask:n?.mask};case"apple":return{source:n?.fallback??u.Icon.Link,mask:n?.mask};case"duckduckgo":case"duckDuckGo":return{source:`https://icons.duckduckgo.com/ip3/${a}.ico`,fallback:n?.fallback??u.Icon.Link,mask:n?.mask};case"google":return{source:`https://www.google.com/s2/favicons?sz=${n?.size??64}&domain=${a}`,fallback:n?.fallback??u.Icon.Link,mask:n?.mask};case"legacy":case"raycast":default:return{source:`https://api.ray.so/favicon?url=${a}&size=${n?.size??64}`,fallback:n?.fallback??u.Icon.Link,mask:n?.mask}}}catch(e){return console.error(e),u.Icon.Link}}var fe=require("react");var L=require("path"),F=require("os"),B=require("fs"),ce=require("fs/promises");function De(){let r=(0,L.resolve)((0,F.homedir)(),"Library/Application Support/com.openai.atlas/browser-data/host/Local State");if(!(0,B.existsSync)(r))throw new Error("Local State file not found");try{let n=(0,B.readFileSync)(r,"utf-8"),t=JSON.parse(n).profile.last_used;return(0,L.resolve)((0,F.homedir)(),`Library/Application Support/com.openai.atlas/browser-data/host/${t}`)}catch(n){return console.error("Error reading Local State:",n),(0,L.resolve)((0,F.homedir)(),"Library/Application Support/com.openai.atlas/browser-data/host/Default")}}function Me(){return(0,L.resolve)(De(),"Bookmarks")}function j(r,n="",e=[]){if(r.type==="url"&&r.url){let t=r.date_added?parseInt(r.date_added):0,a=t?new Date((t/1e6-11644473600)*1e3).toLocaleDateString():"Unknown";e.push({id:r.id||"",name:r.name||"Untitled",url:r.url,dateAdded:a,folder:n||void 0})}if(r.children){let t=r.name||n;for(let a of r.children)j(a,t,e)}return e}async function Ne(){let r=Me(),n=await(0,ce.readFile)(r,"utf-8"),e=JSON.parse(n),t=[];return e.roots.bookmark_bar&&j(e.roots.bookmark_bar,"Bookmarks Bar",t),e.roots.other&&j(e.roots.other,"Other Bookmarks",t),e.roots.synced&&j(e.roots.synced,"Synced Bookmarks",t),t}function le(){return se(Ne,[],{failureToastOptions:{title:"Failed to fetch bookmarks"}})}function ue(r){try{let{hostname:n}=new URL(r);return n.replace(/^www\./,"")}catch{return r}}var y=require("react/jsx-runtime");function de(){let[r,n]=(0,fe.useState)(""),{isLoading:e,data:t,error:a}=le(),{data:l,visitItem:i,resetRanking:f}=ie(t),c=l?.filter(s=>s.name.toLowerCase().includes(r.toLowerCase())||s.url.toLowerCase().includes(r.toLowerCase()));return a?(0,y.jsx)(p.Detail,{markdown:`# ERROR 

 ${a} 

 Are you sure **ChatGPT Atlas** is installed?`}):(0,y.jsx)(p.List,{isLoading:e,searchBarPlaceholder:"Search bookmarks...",searchText:r,onSearchTextChange:n,children:c?.map(s=>(0,y.jsx)(p.List.Item,{icon:oe(s.url,{mask:p.Image.Mask.Circle}),title:s.name,subtitle:{value:ue(s.url),tooltip:s.url},accessories:[...s.folder?[{tag:s.folder}]:[],{date:new Date(s.dateAdded)}],actions:(0,y.jsxs)(p.ActionPanel,{children:[(0,y.jsxs)(p.ActionPanel.Section,{children:[(0,y.jsx)(p.Action.Open,{icon:p.Icon.Globe,title:"Open in Browser",target:s.url,application:"com.openai.atlas",onOpen:()=>i(s)}),(0,y.jsx)(p.Action.OpenWith,{icon:p.Icon.AppWindow,path:s.url,onOpen:()=>i(s)})]}),(0,y.jsxs)(p.ActionPanel.Section,{children:[(0,y.jsx)(p.Action.CopyToClipboard,{content:s.url,title:"Copy URL",shortcut:p.Keyboard.Shortcut.Common.Copy,onCopy:()=>i(s)}),(0,y.jsx)(p.Action.CopyToClipboard,{content:{html:`<a href="${s.url}">${s.name}</a>`},title:"Copy Formatted URL",shortcut:p.Keyboard.Shortcut.Common.CopyPath,onCopy:()=>i(s)}),(0,y.jsx)(p.Action.CopyToClipboard,{content:s.name,title:"Copy Title",shortcut:p.Keyboard.Shortcut.Common.CopyName,onCopy:()=>i(s)}),(0,y.jsx)(p.Action.CopyToClipboard,{content:`[${s.name}](${s.url})`,title:"Copy as Markdown",onCopy:()=>i(s)})]}),(0,y.jsx)(p.ActionPanel.Section,{children:(0,y.jsx)(p.Action,{title:"Reset Ranking",icon:p.Icon.ArrowCounterClockwise,style:p.Action.Style.Destructive,onAction:()=>f(s)})})]})},s.id))})}
