"use strict";var z=Object.create;var P=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty;var te=(e,t)=>{for(var r in t)P(e,r,{get:t[r],enumerable:!0})},M=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Z(t))!ee.call(e,o)&&o!==r&&P(e,o,{get:()=>t[o],enumerable:!(n=J(t,o))||n.enumerable});return e};var re=(e,t,r)=>(r=e!=null?z(j(e)):{},M(t||!e||!e.__esModule?P(r,"default",{value:e,enumerable:!0}):r,e)),ne=e=>M(P({},"__esModule",{value:!0}),e);var de={};te(de,{default:()=>W});module.exports=ne(de);var d=require("@raycast/api");var m=require("react"),k=require("@raycast/api");var u=require("@raycast/api");var b=require("child_process"),v=require("util");var f=require("@raycast/api");var i={FETCH_COMMIT_MESSAGE:"Failed to generate commit message",COMMIT_CHANGES:"Failed to commit changes",FETCH_PR_DESCRIPTION:"Failed to generate PR description",REPO_PATH_MISSING:"No repository path provided",INVALID_REPO:"Invalid Git repository",BRANCH_EXISTS:"Branch already exists",GIT_DIFF_EMPTY:"No changes to commit",CHECKOUT_BRANCH:"Failed to checkout branch",DELETE_BRANCH:"Failed to delete branch",CLEANUP_BRANCHES:"Failed to clean up branches",GET_CURRENT_BRANCH:"Failed to get current branch",GET_BRANCHES:"Failed to get branches",ACTIVE_BRANCH_DELETE:"Cannot delete active branch",AI_MODEL_MISSING:"No AI model provided",AI_MODEL_INVALID:"Invalid AI model"};var N=`You are a world class software engineer. I need your help writing a PR description, using this diff:
{diff}

Use this markdown template:
\`\`\`
## Summary

Provide a concise summary of the implemented changes, including new features, bug fixes, and any updates to components or properties.

## Changes

List the main changes made in this PR.
\`\`\`

Write a concise and clear PR description using the markdown template. Don't add any extra text to the response. Only respond in markdown.`;async function x(e){await(0,f.popToRoot)(),await(0,f.showToast)({style:f.Toast.Style.Failure,title:"Error",message:e})}function O(e){let t=e.message.toLowerCase();return t.includes("would be overwritten by checkout")?new Error(i.CHECKOUT_BRANCH):t.includes("not a git repository")?new Error(i.INVALID_REPO):t.includes("already exists")?new Error(i.BRANCH_EXISTS):e}function G(e,t){let r=e.message,n={[i.GIT_DIFF_EMPTY]:i.GIT_DIFF_EMPTY,[i.REPO_PATH_MISSING]:i.REPO_PATH_MISSING,[i.INVALID_REPO]:i.INVALID_REPO,"No AI model provided":i.AI_MODEL_MISSING,"Invalid AI model":i.AI_MODEL_INVALID},o=Object.entries(n).find(([a])=>r.includes(a));throw o?new Error(o[1]):new Error(t==="staged"?i.FETCH_COMMIT_MESSAGE:i.FETCH_PR_DESCRIPTION)}var ie=(0,v.promisify)(b.exec),_=[],w=!1;async function oe(){if(!w){for(w=!0;_.length>0;){let e=_.shift();if(e)try{await e()}catch(t){console.error("Error in Git operation:",t)}}w=!1}}function ae(e){return new Promise((t,r)=>{_.push(async()=>{try{let n=await e();t(n)}catch(n){r(n)}}),oe()})}async function s(e,t){return ae(async()=>{try{let{stdout:r}=await ie(e,{cwd:t});return r.trim()}catch(r){throw O(r)}})}async function S(e){try{let t=await s("git diff --staged",e);return t||(await s("git add .",e),t=await s("git diff --staged",e)),t}catch{throw new Error(i.GIT_DIFF_EMPTY)}}async function y(e){return s("git rev-parse --abbrev-ref HEAD",e)}async function B(e,t){return s(`git diff ${t}`,e)}var L=require("@raycast/api");var F=re(require("path"));async function se(e){try{return await s("git rev-parse --is-inside-work-tree",e)==="true"}catch{return!1}}async function I(){let t=(await(0,L.getPreferenceValues)())["repo-path"];if(!t)throw new Error(i.REPO_PATH_MISSING);if(!await se(t))throw new Error(i.INVALID_REPO);return t}async function T(){let e=await I();return F.default.basename(e)}var ce="medium";async function me(e){let r=(await(0,u.getPreferenceValues)())[e];if(!r)throw new Error("No AI model provided");let n=u.AI.Model[r];if(!n)throw new Error(`Invalid AI model: ${r}`);return n}async function pe({diffType:e,repoPath:t,baseBranch:r}){if(e==="staged")return await S(t);if(e==="baseBranch"&&r)return await B(t,r);throw new Error("Invalid diffType or missing baseBranch")}async function H(e){let{diffType:t,aiModelName:r,aiPrompt:n,baseBranch:o}=e;try{let a=await I(),p=await pe({diffType:t,repoPath:a,baseBranch:o});if(!p)throw new Error(i.GIT_DIFF_EMPTY);let l=await me(r),h=await u.AI.ask(`${n}${p}`,{model:l,creativity:ce}),C=await y(a);return{aiContent:h,branchName:C}}catch(a){G(a,t)}}function V(e){let[t,r]=(0,m.useState)(null),[n,o]=(0,m.useState)(null),[a,p]=(0,m.useState)(null),[l,h]=(0,m.useState)(!0);(0,m.useEffect)(()=>{C()},[]);async function C(){try{let A=(await(0,k.getPreferenceValues)())["default-base-branch"],K=e||A,{aiContent:q,branchName:Q}=await H({diffType:"baseBranch",aiModelName:"pr-description-ai-model",aiPrompt:N,baseBranch:K}),X=fe(q);r(X),p(Q)}catch(D){let A=D.message||i.FETCH_PR_DESCRIPTION;o(A)}finally{h(!1)}}return{description:t,error:n,branchName:a,isLoading:l}}function fe(e){let n=e.replace(/^```|```$/g,"").trim().split(`
`).map(o=>o.trim()).filter(Boolean);return n.length>0&&(/^(markdown|diff)$/i.test(n[0])?n.shift():n[0]=n[0].replace(/^(markdown|diff):\s*/i,"")),n.join(`
`).trim()}var g=require("@raycast/api"),E=require("react/jsx-runtime");function $({description:e,branchName:t}){return(0,E.jsxs)(g.ActionPanel,{title:t?`Branch: ${t}`:"Branch name",children:[(0,E.jsx)(g.Action.Paste,{title:"Paste PR Description",content:e}),(0,E.jsx)(g.Action.CopyToClipboard,{title:"Copy PR Description",content:e,shortcut:{modifiers:["cmd","shift"],key:"c"}})]})}var R=require("react");var c=require("react/jsx-runtime");function U({baseBranch:e="main"}){let{description:t,error:r,branchName:n,isLoading:o}=V(e),[a,p]=(0,R.useState)("");(0,R.useEffect)(()=>{l(),r&&x(r)},[r]);async function l(){let h=await T();p(h)}return(0,c.jsx)(d.Detail,{markdown:t||"Generating PR description...",metadata:n&&t?(0,c.jsxs)(d.Detail.Metadata,{children:[(0,c.jsx)(d.Detail.Metadata.Label,{title:"Repository",text:a}),(0,c.jsx)(d.Detail.Metadata.Label,{title:"Current Branch",text:n}),e&&(0,c.jsx)(d.Detail.Metadata.Label,{title:"Base Branch",text:e})]}):null,actions:t?(0,c.jsx)($,{description:t,branchName:n}):null,isLoading:o})}var Y=require("react/jsx-runtime");function W(e){return(0,Y.jsx)(U,{baseBranch:e.launchContext?.baseBranch})}
