"use strict";var m=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var S=(t,r)=>{for(var e in r)m(t,e,{get:r[e],enumerable:!0})},k=(t,r,e,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of U(r))!L.call(t,i)&&i!==e&&m(t,i,{get:()=>r[i],enumerable:!(o=F(r,i))||o.enumerable});return t};var D=t=>k(m({},"__esModule",{value:!0}),t);var O={};S(O,{default:()=>b});module.exports=D(O);var c=require("@raycast/api");var a=require("@raycast/api"),n=require("fs"),d=require("os"),s=require("path"),P=20;function v(t){return`<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>URL</key>
	<string>${t}</string>
</dict>
</plist>`}function A(t){return t.replace(/[^\w\s-]/g,"").replace(/\s+/g," ").trim().slice(0,50)}function E(){let t=(0,s.join)((0,d.homedir)(),"Library","Caches","com.raycast.save-link");try{(0,n.mkdirSync)(t,{recursive:!0})}catch{}return t}function f(t){try{let r=new URL(t);return r.protocol==="http:"||r.protocol==="https:"}catch{return!1}}function g(t){if(f(t.trim()))return t.trim();let r=/(https?:\/\/[^\s]+)/gi,e=t.match(r);if(e&&e.length>0){for(let o of e)if(f(o))return o}return null}function h(t){try{return new URL(t).hostname.replace("www.","")}catch{return"Link"}}function $(t,r=20){try{let e=(0,n.readdirSync)(t).filter(o=>o.endsWith(".webloc")).map(o=>{let i=(0,s.join)(t,o);return{name:o,path:i,mtime:(0,n.statSync)(i).mtime}}).sort((o,i)=>i.mtime.getTime()-o.mtime.getTime());if(e.length>r){let o=e.slice(r);for(let i of o)try{(0,n.unlinkSync)(i.path)}catch(l){console.warn(`Failed to delete cache file ${i.name}:`,l)}}}catch(e){console.warn("Failed to cleanup cache files:",e)}}async function w(t){let{url:r,customTitle:e,fallbackTitle:o="Link",titleSource:i="default"}=t,l=E(),u=A(e||o),y=`${u||"Link"}.webloc`,p=(0,s.join)(l,y),T=v(r);try{(0,n.writeFileSync)(p,T,"utf8")}catch(C){throw new Error(`Failed to create webloc file: ${C}`)}$(l,P);let x={file:p};await a.Clipboard.copy(x),await(0,a.showHUD)(`\u{1F4CB} Copied "${u}.webloc" to clipboard (using ${e?"custom title":i})`)}async function b(t){let{title:r}=t.arguments;try{let e=await c.Clipboard.read();if(!e.text){await(0,c.showHUD)("\u274C No text found in clipboard");return}let o=g(e.text);if(!o){await(0,c.showHUD)("\u274C No valid URL found in clipboard");return}await w({url:o,customTitle:r,fallbackTitle:h(o),titleSource:"domain name"})}catch(e){console.error("Error creating webloc file from clipboard:",e),await(0,c.showHUD)(`\u274C Failed to create webloc file: ${e instanceof Error?e.message:String(e)}`)}}
