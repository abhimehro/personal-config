"use strict";var H=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var T=(c,e)=>{for(var t in e)H(c,t,{get:e[t],enumerable:!0})},q=(c,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of F(e))!G.call(c,s)&&s!==t&&H(c,s,{get:()=>e[s],enumerable:!(n=R(e,s))||n.enumerable});return c};var Q=c=>q(H({},"__esModule",{value:!0}),c);var z={};T(z,{default:()=>k});module.exports=Q(z);var r=require("@raycast/api"),b=require("react");var v=require("@raycast/api"),L=class c{static key="history";static maxEntries=50;static async getEntries(){let e=await v.LocalStorage.getItem(c.key);return e?JSON.parse(e):[]}static async addEntry(e,t,n){let s=!0;try{let o=await this.getEntries();await c.exist(e.toLowerCase(),n)?s=!0:(o.push({language:e.trim().toLowerCase().replace("  "," "),languageCode:t.toLowerCase(),word:n,epoch:Date.now()}),o.sort((f,a)=>a.epoch-f.epoch),v.LocalStorage.setItem(c.key,JSON.stringify(o.slice(0,c.maxEntries))))}catch{s=!1}return s}static async removeEntry(e,t){let n=!0;try{let o=(await this.getEntries()).filter(i=>i.language.toLowerCase()!==e.toLowerCase()||i.word.toLowerCase()!==t.toLowerCase());v.LocalStorage.setItem(c.key,JSON.stringify(o))}catch{n=!1}return n}static async removeAll(){let e=!0;try{await v.LocalStorage.removeItem(c.key)}catch{e=!1}return e}static async exist(e,t){return(await this.getEntries()).slice(-10).some(o=>o.language===e&&o.word===t)}},C=L;var P=require("@raycast/api"),j=class c{static cache=new P.Cache;url="https://freedictionaryapi.com/api/v1/entries";urlWord="";language="";word="";languageCode="";wordQuery="";get getURL(){return this.urlWord}get getLanguage(){return this.language}constructor(e,t){this.languageCode=e,this.wordQuery=t}static capitalize(e){return e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()}async getEntry(){let e={};try{let t=this.checkCache();!t||!Object.keys(t).length?e=await this.fetchEntry():e=t}catch(t){console.error(t),e=await this.fetchEntry()}return e}checkCache(){let e={};try{let t=c.cache.get(`${this.languageCode}-${this.wordQuery}`);if(t){let n=JSON.parse(t);this.language=c.capitalize(n[Object.keys(n)?.[0]]?.language?.name||this.languageCode),this.word=n[Object.keys(n)?.[0]]?.forms[0]?.word||this.wordQuery,e=n}else e={}}catch{e=void 0}return e}async fetchEntry(){let e={};try{let t=await fetch(`${this.url}/${this.languageCode}/${this.wordQuery}`);if(t.ok){let n=await t.json();if(n.entries.length){this.language=c.capitalize(n.entries[0]?.language?.name),this.word=n.word,this.urlWord=n.source.url.replaceAll(" ","%20");let s=this.groupEntries(n);try{c.cache.set(`${this.languageCode}-${this.wordQuery}`,JSON.stringify(s))}catch(o){console.error("Failed to cache dictionary entry:",o)}e=s}}else e=void 0}catch{e=void 0}return e}groupEntries(e){let t={},n="",s="",o="";return e.entries.forEach(i=>{t[i.partOfSpeech]||(t[i.partOfSpeech]={language:i.language,partOfSpeech:i.partOfSpeech,pronunciations:[],forms:[],senses:[]},n=`# ${this.word} (_${i.partOfSpeech}_)
### Definition:
`,s=this.renderPronunciations(i),o=this.renderForms(i)),t[i.partOfSpeech].pronunciations.push(...i.pronunciations),t[i.partOfSpeech].forms.push(...i.forms),i.senses.forEach(f=>{let a={...f,markdown:(n+this.renderSenses(f)+s+o).replaceAll("..",".")};t[i.partOfSpeech].senses.push(a)})}),t}renderPronunciations(e){if(!e.pronunciations||!e.pronunciations.length)return"";let t=`### Pronunciations
`,n={};return e.pronunciations.forEach(s=>{s.tags.length?s.tags.forEach(o=>{n[o]||(n[o]={type:s.type,text:[]}),n[o].text.push(s.text)}):(n["-"]||(n["-"]={type:s.type,text:[]}),n["-"].text.push(s.text))}),Object.entries(n).length?(t+=`| Dialect | Pronunciation | Phonetic System | 
|---|---|---|
`,Object.entries(n).forEach(([s,o])=>{t+=`| ${s} | ${o.text.join(", ")} | ${o.type} |
`}),t+=`

`,t):""}renderForms(e){if(!e.forms||!e.forms.length)return"";let t=`### Forms
`,n=["inflection-template","table-tags","class"],s=["ca","cs","fr","de","el","hu","it","la","pt","ro","ru","sh","es","nl"],o=[];if(s.includes(this.languageCode)){let i=["gerund","participle","infinitive"],f=["indicative","subjunctive-i","subjunctive-ii","subjunctive","imperative"],a=["future-i","future-ii","present","imperfect","preterite","future","conditional","perfect","pluperfect","past perfect","future perfect","conditional perfect"],l=["singular","plural"],d=["first-person","second-person","third-person"],u={};e.forms.forEach(g=>{if(!g.tags.length||g.tags.some(y=>n.includes(y)))return;for(let y of a)if(g.word.includes(y.toLowerCase()))return;for(let y of l)if(g.word.includes(y.toLowerCase()))return;for(let y of d)if(g.word.includes(y.toLowerCase()))return;let p=f.find(y=>g.tags.includes(y))||(i.find(y=>g.tags.includes(y))?"non-finite":"indicative"),m=a.find(y=>g.tags.includes(y))||"",E=l.find(y=>g.tags.includes(y))||"",w=d.find(y=>g.tags.includes(y))||"";u[p]||(u[p]={}),u[p][m]||(u[p][m]={}),u[p][m][E]||(u[p][m][E]={}),u[p][m][E][w]||(u[p][m][E][w]=[]),u[p][m][E][w].push(g)}),Object.entries(u).forEach(([g,p])=>{let m=g==="non-finite";t+=`#### ${m?"Non-finite forms":`Mood: ${g}`}
`,m&&(t+=`| Name | Form |
|---|---|
`),Object.entries(p).forEach(([E,w])=>{if(m){if(E&&g!=="imperative")return;Object.entries(w).forEach(([,y])=>{Object.entries(y).forEach(([,A])=>{A.forEach(x=>{let S=`| ${x.tags.join(", ")} | ${x.word} |
`;o.includes(S)||(t+=S,o.push(S))})})}),o.length=0}else{if(!E&&g!=="imperative")return;t+=`##### Tense: ${g==="imperative"?"present":E}
`,t+=`| Person & Number | Form |
|---|---|
`,Object.entries(w).forEach(([y,A])=>{Object.entries(A).forEach(([x,S])=>{S.forEach(D=>{let O=`| ${x} ${y} | ${D.word} |
`;o.includes(O)||(t+=O,o.push(O))})})}),o.length=0}}),t+=`
`})}else e.forms.forEach(i=>{i.tags.some(f=>n.includes(f))||(t+=`- ${i.word} (${i.tags.join(", ")})
`)});return t+=`

`,t}renderSenses(e){if(!e)return"";let t="",n=(s,o=1)=>{let i="",f="  ".repeat(o);return s.forEach((a,l,d)=>{i+=`${f}${l+1}. ${a.definition}
`,a.synonyms&&a.synonyms.length&&(i+=`${f}   - **Synonyms:** ${a.synonyms.join(", ")}
`),a.antonyms&&a.antonyms.length&&(i+=`${f}   - **Antonyms:** ${a.antonyms.join(", ")}
`),a.examples&&a.examples.length&&(a.examples.length>1?a.examples.forEach((u,g)=>{i+=`${f}   - **Example ${g+1}:** "${u}"
`}):i+=`${f}   - **Example:** "${a.examples[0]}"
`),a.quotes&&a.quotes.length&&(a.quotes.length>1?a.quotes.forEach((u,g)=>{i+=`${f}   - **Quote ${g+1}:** "${u.text}" - _${u.reference}_
`}):i+=`${f}   - **Quote:** "${a.quotes[0].text}" - _${a.quotes[0].reference}_
`),a.subsenses&&a.subsenses.length&&(i+=n(a.subsenses,o+1)),l+1===d.length&&(i+=`
`)}),i};return t+=`${e.definition}
`,e.examples&&e.examples.length&&(e.examples.length>1?e.examples.forEach((s,o)=>{t+=`- **Example ${o+1}:** "${s}"
`}):t+=`- **Example:** "${e.examples[0]}"
`),e.quotes&&e.quotes.length&&(e.quotes.length>1?e.quotes.forEach((s,o)=>{t+=`- **Quote ${o+1}:** "${s.text}" - _${s.reference}_
`}):t+=`- **Quote:** "${e.quotes[0].text}" - _${e.quotes[0].reference}_
`),e.synonyms&&e.synonyms.length&&(t+=`- **Synonyms:** ${e.synonyms.join(", ")}
`),e.antonyms&&e.antonyms.length&&(t+=`- **Antonyms:** ${e.antonyms.join(", ")}
`),e.subsenses&&e.subsenses.length&&(t+=n(e.subsenses,1)),t+=`

`,t}},$=j;var h=require("react/jsx-runtime");function k(){let[c,e]=(0,b.useState)([]),[t,n]=(0,b.useState)(""),[s,o]=(0,b.useState)(!0),[i,f]=(0,b.useState)("All");(0,b.useEffect)(()=>{(async()=>{let d=await C.getEntries();e(d),o(!1)})()},[]);let a=Array.from(new Set(c.map(l=>l.language)));return(0,h.jsx)(r.List,{isLoading:s,searchText:t,onSearchTextChange:n,searchBarPlaceholder:"Filter history entries by word...",filtering:!0,searchBarAccessory:(0,h.jsxs)(r.List.Dropdown,{tooltip:"Filter by language",storeValue:!0,onChange:f,defaultValue:"All",children:[(0,h.jsx)(r.List.Dropdown.Item,{title:"All",value:"All"}),a.map(l=>(0,h.jsx)(r.List.Dropdown.Item,{title:$.capitalize(l),value:l},l))]}),children:c.length?Object.entries(c.reduce((l,d)=>(l[`${d.language}-${d.languageCode}`]||(l[`${d.language}-${d.languageCode}`]=[]),l[`${d.language}-${d.languageCode}`].push({word:d.word,epoch:d.epoch}),l),{})).filter(([l])=>i==="All"||l===i).sort(([l],[d])=>l.localeCompare(d)).map(([l,d])=>{let[u,g]=l.split("-");return(0,h.jsx)(r.List.Section,{title:`${$.capitalize(u)} (${d.length})`,children:d.filter(({word:p})=>p.toLowerCase().includes(t.toLowerCase())).map(({word:p,epoch:m})=>(0,h.jsx)(r.List.Item,{title:p,accessories:[{icon:r.Icon.Clock,date:new Date(m)}],actions:(0,h.jsxs)(r.ActionPanel,{children:[(0,h.jsx)(r.Action,{title:"Search Word",icon:r.Icon.MagnifyingGlass,shortcut:r.Keyboard.Shortcut.Common.Open,onAction:async()=>{try{await(0,r.launchCommand)({name:"search",type:r.LaunchType.UserInitiated,arguments:{language:g,word:p}})}catch{await(0,r.showToast)({style:r.Toast.Style.Failure,title:"Failed to search word",message:`There was an error searching for "${p}" (${$.capitalize(u)})`})}}}),(0,h.jsxs)(r.ActionPanel.Section,{children:[(0,h.jsx)(r.Action,{title:"Remove from History",icon:r.Icon.Trash,style:r.Action.Style.Destructive,shortcut:r.Keyboard.Shortcut.Common.Remove,onAction:async()=>{let E={title:"Remove from History",message:`"${p}" (${$.capitalize(u)}) will be removed from your history`,primaryAction:{title:"Delete",style:r.Alert.ActionStyle.Destructive,onAction:async()=>{if(await C.removeEntry(u,p)){let y=await C.getEntries();e(y),await(0,r.showToast)({style:r.Toast.Style.Success,title:"Removed from History",message:`"${p}" (${$.capitalize(u)}) has been removed from your history`})}else await(0,r.showToast)({style:r.Toast.Style.Failure,title:"Failed to remove from History",message:`"${p}" (${$.capitalize(u)}) could not be found in your history`})}}};await(0,r.confirmAlert)(E)}}),(0,h.jsx)(r.Action,{title:"Clear History",icon:r.Icon.Trash,style:r.Action.Style.Destructive,shortcut:r.Keyboard.Shortcut.Common.RemoveAll,onAction:async()=>{let E={title:"Clear History",message:"All history will be removed",primaryAction:{title:"Delete",style:r.Alert.ActionStyle.Destructive,onAction:async()=>{await C.removeAll()?(e([]),await(0,r.showToast)({style:r.Toast.Style.Success,title:"History Cleared",message:"All history has been removed"})):await(0,r.showToast)({style:r.Toast.Style.Failure,title:"Failed to clear history",message:"Could not remove all history"})}}};await(0,r.confirmAlert)(E)}})]})]})},p))},u)}):(0,h.jsx)(r.List.EmptyView,{title:"No history"})})}
