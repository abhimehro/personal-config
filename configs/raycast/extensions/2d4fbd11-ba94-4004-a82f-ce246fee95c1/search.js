"use strict";var j=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var U=(u,e)=>{for(var t in e)j(u,t,{get:e[t],enumerable:!0})},W=(u,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of J(e))!M.call(u,n)&&n!==t&&j(u,n,{get:()=>e[n],enumerable:!(s=Q(e,n))||s.enumerable});return u};var B=u=>W(j({},"__esModule",{value:!0}),u);var K={};U(K,{default:()=>I});module.exports=B(K);var r=require("@raycast/api"),b=require("react");var N=require("@raycast/api"),A=class u{static cache=new N.Cache;url="https://freedictionaryapi.com/api/v1/entries";urlWord="";language="";word="";languageCode="";wordQuery="";get getURL(){return this.urlWord}get getLanguage(){return this.language}constructor(e,t){this.languageCode=e,this.wordQuery=t}static capitalize(e){return e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()}async getEntry(){let e={};try{let t=this.checkCache();!t||!Object.keys(t).length?e=await this.fetchEntry():e=t}catch(t){console.error(t),e=await this.fetchEntry()}return e}checkCache(){let e={};try{let t=u.cache.get(`${this.languageCode}-${this.wordQuery}`);if(t){let s=JSON.parse(t);this.language=u.capitalize(s[Object.keys(s)?.[0]]?.language?.name||this.languageCode),this.word=s[Object.keys(s)?.[0]]?.forms[0]?.word||this.wordQuery,e=s}else e={}}catch{e=void 0}return e}async fetchEntry(){let e={};try{let t=await fetch(`${this.url}/${this.languageCode}/${this.wordQuery}`);if(t.ok){let s=await t.json();if(s.entries.length){this.language=u.capitalize(s.entries[0]?.language?.name),this.word=s.word,this.urlWord=s.source.url.replaceAll(" ","%20");let n=this.groupEntries(s);try{u.cache.set(`${this.languageCode}-${this.wordQuery}`,JSON.stringify(n))}catch(o){console.error("Failed to cache dictionary entry:",o)}e=n}}else e=void 0}catch{e=void 0}return e}groupEntries(e){let t={},s="",n="",o="";return e.entries.forEach(i=>{t[i.partOfSpeech]||(t[i.partOfSpeech]={language:i.language,partOfSpeech:i.partOfSpeech,pronunciations:[],forms:[],senses:[]},s=`# ${this.word} (_${i.partOfSpeech}_)
### Definition:
`,n=this.renderPronunciations(i),o=this.renderForms(i)),t[i.partOfSpeech].pronunciations.push(...i.pronunciations),t[i.partOfSpeech].forms.push(...i.forms),i.senses.forEach(g=>{let a={...g,markdown:(s+this.renderSenses(g)+n+o).replaceAll("..",".")};t[i.partOfSpeech].senses.push(a)})}),t}renderPronunciations(e){if(!e.pronunciations||!e.pronunciations.length)return"";let t=`### Pronunciations
`,s={};return e.pronunciations.forEach(n=>{n.tags.length?n.tags.forEach(o=>{s[o]||(s[o]={type:n.type,text:[]}),s[o].text.push(n.text)}):(s["-"]||(s["-"]={type:n.type,text:[]}),s["-"].text.push(n.text))}),Object.entries(s).length?(t+=`| Dialect | Pronunciation | Phonetic System | 
|---|---|---|
`,Object.entries(s).forEach(([n,o])=>{t+=`| ${n} | ${o.text.join(", ")} | ${o.type} |
`}),t+=`

`,t):""}renderForms(e){if(!e.forms||!e.forms.length)return"";let t=`### Forms
`,s=["inflection-template","table-tags","class"],n=["ca","cs","fr","de","el","hu","it","la","pt","ro","ru","sh","es","nl"],o=[];if(n.includes(this.languageCode)){let i=["gerund","participle","infinitive"],g=["indicative","subjunctive-i","subjunctive-ii","subjunctive","imperative"],a=["future-i","future-ii","present","imperfect","preterite","future","conditional","perfect","pluperfect","past perfect","future perfect","conditional perfect"],f=["singular","plural"],E=["first-person","second-person","third-person"],l={};e.forms.forEach(y=>{if(!y.tags.length||y.tags.some(c=>s.includes(c)))return;for(let c of a)if(y.word.includes(c.toLowerCase()))return;for(let c of f)if(y.word.includes(c.toLowerCase()))return;for(let c of E)if(y.word.includes(c.toLowerCase()))return;let p=g.find(c=>y.tags.includes(c))||(i.find(c=>y.tags.includes(c))?"non-finite":"indicative"),d=a.find(c=>y.tags.includes(c))||"",m=f.find(c=>y.tags.includes(c))||"",w=E.find(c=>y.tags.includes(c))||"";l[p]||(l[p]={}),l[p][d]||(l[p][d]={}),l[p][d][m]||(l[p][d][m]={}),l[p][d][m][w]||(l[p][d][m][w]=[]),l[p][d][m][w].push(y)}),Object.entries(l).forEach(([y,p])=>{let d=y==="non-finite";t+=`#### ${d?"Non-finite forms":`Mood: ${y}`}
`,d&&(t+=`| Name | Form |
|---|---|
`),Object.entries(p).forEach(([m,w])=>{if(d){if(m&&y!=="imperative")return;Object.entries(w).forEach(([,c])=>{Object.entries(c).forEach(([,v])=>{v.forEach(C=>{let x=`| ${C.tags.join(", ")} | ${C.word} |
`;o.includes(x)||(t+=x,o.push(x))})})}),o.length=0}else{if(!m&&y!=="imperative")return;t+=`##### Tense: ${y==="imperative"?"present":m}
`,t+=`| Person & Number | Form |
|---|---|
`,Object.entries(w).forEach(([c,v])=>{Object.entries(v).forEach(([C,x])=>{x.forEach(F=>{let S=`| ${C} ${c} | ${F.word} |
`;o.includes(S)||(t+=S,o.push(S))})})}),o.length=0}}),t+=`
`})}else e.forms.forEach(i=>{i.tags.some(g=>s.includes(g))||(t+=`- ${i.word} (${i.tags.join(", ")})
`)});return t+=`

`,t}renderSenses(e){if(!e)return"";let t="",s=(n,o=1)=>{let i="",g="  ".repeat(o);return n.forEach((a,f,E)=>{i+=`${g}${f+1}. ${a.definition}
`,a.synonyms&&a.synonyms.length&&(i+=`${g}   - **Synonyms:** ${a.synonyms.join(", ")}
`),a.antonyms&&a.antonyms.length&&(i+=`${g}   - **Antonyms:** ${a.antonyms.join(", ")}
`),a.examples&&a.examples.length&&(a.examples.length>1?a.examples.forEach((l,y)=>{i+=`${g}   - **Example ${y+1}:** "${l}"
`}):i+=`${g}   - **Example:** "${a.examples[0]}"
`),a.quotes&&a.quotes.length&&(a.quotes.length>1?a.quotes.forEach((l,y)=>{i+=`${g}   - **Quote ${y+1}:** "${l.text}" - _${l.reference}_
`}):i+=`${g}   - **Quote:** "${a.quotes[0].text}" - _${a.quotes[0].reference}_
`),a.subsenses&&a.subsenses.length&&(i+=s(a.subsenses,o+1)),f+1===E.length&&(i+=`
`)}),i};return t+=`${e.definition}
`,e.examples&&e.examples.length&&(e.examples.length>1?e.examples.forEach((n,o)=>{t+=`- **Example ${o+1}:** "${n}"
`}):t+=`- **Example:** "${e.examples[0]}"
`),e.quotes&&e.quotes.length&&(e.quotes.length>1?e.quotes.forEach((n,o)=>{t+=`- **Quote ${o+1}:** "${n.text}" - _${n.reference}_
`}):t+=`- **Quote:** "${e.quotes[0].text}" - _${e.quotes[0].reference}_
`),e.synonyms&&e.synonyms.length&&(t+=`- **Synonyms:** ${e.synonyms.join(", ")}
`),e.antonyms&&e.antonyms.length&&(t+=`- **Antonyms:** ${e.antonyms.join(", ")}
`),e.subsenses&&e.subsenses.length&&(t+=s(e.subsenses,1)),t+=`

`,t}},$=A;var O=require("@raycast/api"),G=class u{static key="favorites";static async getEntries(){try{let e=await O.LocalStorage.getItem(u.key);return e?JSON.parse(e.toString()):[]}catch{return[]}}static async addEntry(e,t,s,n,o,i){let g=!0;try{let a=await this.getEntries();await u.exist(e,t,o,i)?g=!0:(a.push({language:e.toLowerCase(),word:t,markdown:s,url:n,entry:o,partOfSpeech:i}),a.sort((E,l)=>E.word.localeCompare(l.word)),O.LocalStorage.setItem(u.key,JSON.stringify(a)))}catch{g=!1}return g}static async removeEntry(e,t,s,n){let o=!0;try{let g=(await this.getEntries()).filter(a=>a.language!==e.toLowerCase()||a.word!==t||a.entry!==s||a.partOfSpeech!==n);O.LocalStorage.setItem(u.key,JSON.stringify(g))}catch{o=!1}return o}static async removeAll(){let e=!0;try{await O.LocalStorage.removeItem(u.key)}catch{e=!1}return e}static async exist(e,t,s,n){return(await this.getEntries()).some(i=>i.language===e.toLowerCase()&&i.word===t&&i.entry===s&&i.partOfSpeech===n)}static async existMultiple(e,t){let s={},n=await this.getEntries();for(let[o,i]of Object.entries(e))i.senses&&i.senses.length&&i.senses.forEach((g,a)=>{let f=`${o}-${a}`,E=n.some(l=>l.language.toLowerCase()===i.language.name.toLowerCase()&&l.word.toLowerCase()===t.toLowerCase()&&l.entry===a&&l.partOfSpeech===o);s[f]=E});return s}},k=G;var P=require("@raycast/api"),D=class u{static key="history";static maxEntries=50;static async getEntries(){let e=await P.LocalStorage.getItem(u.key);return e?JSON.parse(e):[]}static async addEntry(e,t,s){let n=!0;try{let o=await this.getEntries();await u.exist(e.toLowerCase(),s)?n=!0:(o.push({language:e.trim().toLowerCase().replace("  "," "),languageCode:t.toLowerCase(),word:s,epoch:Date.now()}),o.sort((g,a)=>a.epoch-g.epoch),P.LocalStorage.setItem(u.key,JSON.stringify(o.slice(0,u.maxEntries))))}catch{n=!1}return n}static async removeEntry(e,t){let s=!0;try{let o=(await this.getEntries()).filter(i=>i.language.toLowerCase()!==e.toLowerCase()||i.word.toLowerCase()!==t.toLowerCase());P.LocalStorage.setItem(u.key,JSON.stringify(o))}catch{s=!1}return s}static async removeAll(){let e=!0;try{await P.LocalStorage.removeItem(u.key)}catch{e=!1}return e}static async exist(e,t){return(await this.getEntries()).slice(-10).some(o=>o.language===e&&o.word===t)}},q=D;var h=require("react/jsx-runtime");function I(u){let e,t=[r.Color.Blue,r.Color.Green,r.Color.Magenta,r.Color.Orange,r.Color.Purple,r.Color.Red,r.Color.Yellow],s=u.arguments.language,n=u.arguments.word,[o,i]=(0,b.useState)({}),[g,a]=(0,b.useState)(""),[f,E]=(0,b.useState)(""),[l,y]=(0,b.useState)(s),[p,d]=(0,b.useState)(!0),[m,w]=(0,b.useState)({});return(0,b.useEffect)(()=>{e=new $(s,n),e.getEntry().then(async c=>{c?(i(c),E(e.getURL),y(e.getLanguage),d(!1),Object.entries(c).length&&e.getLanguage&&(await q.addEntry(e.getLanguage,s,n)||(0,r.showToast)({style:r.Toast.Style.Failure,title:"There was an error saving the entry to your history",message:"Please try again later"}))):(d(!1),i({}),(0,r.showToast)({style:r.Toast.Style.Failure,title:"There was an error searching the word",message:"Please try again later"}))}).catch(()=>{d(!1),i({}),(0,r.showToast)({style:r.Toast.Style.Failure,title:"There was an error searching the word",message:"Please try again later"})})},[s,n]),(0,b.useEffect)(()=>{let c=async()=>{let v=await k.existMultiple(o,n);w({...v})};Object.keys(o).length&&c()},[o,l,n]),(0,h.jsx)(r.List,{isLoading:p,searchText:g,onSearchTextChange:a,searchBarPlaceholder:p?"Loading. Please wait...":"Filter by definition...",filtering:!0,isShowingDetail:!0,children:Object.keys(o).length?Object.entries(o).map(([c,v],C)=>{let x=t[C%t.length];return(0,h.jsx)(r.List.Section,{title:`${$.capitalize(c)} (${v.senses.length})`,children:v.senses.map((F,S)=>{let R=`${c}-${S}`,L=m[R]||!1;return(0,h.jsx)(r.List.Item,{title:"",accessories:L?[{icon:r.Icon.Star}]:[],icon:{source:r.Icon.Dot,tintColor:x},subtitle:F.definition,detail:(0,h.jsx)(r.List.Item.Detail,{markdown:F.markdown||"No details available."}),actions:(0,h.jsxs)(r.ActionPanel,{children:[(0,h.jsx)(r.Action,{title:"Open in Browser",icon:r.Icon.Globe,onAction:()=>{f&&(0,r.open)(f)}}),(0,h.jsx)(r.Action,{title:L?"Remove from Favorites":"Add to Favorites",icon:L?r.Icon.StarDisabled:r.Icon.Star,style:L?r.Action.Style.Destructive:r.Action.Style.Regular,shortcut:L?r.Keyboard.Shortcut.Common.Remove:r.Keyboard.Shortcut.Common.Pin,onAction:async()=>{if(!L)await k.addEntry(l,n,F.markdown||"",f||"",S,c)?(await(0,r.showToast)({style:r.Toast.Style.Success,title:"Added to Favorites",message:`"${n}" (${$.capitalize(l)}) has been added to your favorites`}),w(T=>({...T,[R]:!0}))):await(0,r.showToast)({style:r.Toast.Style.Failure,title:"Failed to add to Favorites",message:`"${n}" (${$.capitalize(l)}) is already in your favorites`});else{let H={title:"Remove from Favorites",message:`"${n}" (${$.capitalize(l)}) will be removed from your favorites`,primaryAction:{title:"Delete",style:r.Alert.ActionStyle.Destructive,onAction:async()=>{await(0,r.showToast)({style:r.Toast.Style.Success,title:"Removed from Favorites",message:`"${n}" (${$.capitalize(l)}) has been removed from your favorites`})}}};await(0,r.confirmAlert)(H)&&(await k.removeEntry(l,n,S,c)?w(z=>({...z,[R]:!1})):await(0,r.showToast)({style:r.Toast.Style.Failure,title:"Failed to remove from Favorites",message:`"${n}" (${$.capitalize(l)}) is not in your favorites`}))}}}),(0,h.jsx)(r.Action,{title:"Copy to Clipboard",icon:r.Icon.Clipboard,shortcut:r.Keyboard.Shortcut.Common.Copy,onAction:()=>{r.Clipboard.copy(F.definition),(0,r.showHUD)(`The definitions for "${n}" (${$.capitalize(l)}) have been copied to clipboard`)}})]})},`${n}-${c}-${S}`)})},c)}):(0,h.jsx)(r.List.EmptyView,{title:"No definitions found"})})}
