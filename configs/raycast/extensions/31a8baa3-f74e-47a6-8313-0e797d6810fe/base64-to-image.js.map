{
  "version": 3,
  "sources": ["../src/base64-to-image.tsx", "../src/libs/imageUtils.ts"],
  "sourcesContent": ["import { Form, ActionPanel, Action, showToast, Detail, Toast, Icon, Color } from \"@raycast/api\";\nimport { useState } from \"react\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport os from \"os\";\nimport { calculateBase64Size, getImageDimensionsFromBase64, isValidBase64, formatFileSize } from \"./libs/imageUtils\";\n\ntype Values = {\n  base64: string;\n  outputFormat: string;\n};\n\ninterface Image {\n  image: string;\n  extension: string;\n  size: number;\n  dimensions: {\n    width: number;\n    height: number;\n  };\n}\n\nexport default function Base64ToImage() {\n  const [image, setImage] = useState<Image | null>(null);\n\n  async function handleSubmit({ base64, outputFormat }: Values) {\n    if (!base64) {\n      showToast({\n        title: \"Error\",\n        message: \"Please enter a base64 string\",\n        style: Toast.Style.Failure,\n      });\n      return;\n    }\n\n    const cleanedBase64 = base64.replaceAll('\"', \"\").replaceAll(\"'\", \"\");\n    if (!isValidBase64(cleanedBase64)) {\n      showToast({\n        title: \"Error\",\n        message: \"Invalid base64 string. Please check your input.\",\n        style: Toast.Style.Failure,\n      });\n      return;\n    }\n\n    let imageData: string;\n    let extension: string;\n\n    if (!cleanedBase64.startsWith(\"data:image/\")) {\n      imageData = `data:image/${outputFormat};base64,${cleanedBase64}`;\n      extension = outputFormat;\n    } else {\n      imageData = cleanedBase64;\n      extension = outputFormat || cleanedBase64.split(\",\")[0].split(\"/\")[1];\n    }\n\n    try {\n      const dimensions = getImageDimensionsFromBase64(base64);\n      setImage({\n        image: imageData,\n        extension: extension,\n        dimensions: dimensions || { width: 0, height: 0 },\n        size: calculateBase64Size(base64),\n      });\n    } catch (error) {\n      showToast({\n        title: \"Error\",\n        message: \"Unsupported image format or invalid base64 string\",\n        style: Toast.Style.Failure,\n      });\n    }\n  }\n\n  function handleDownload() {\n    if (!image) return;\n\n    const downloadsPath = path.join(os.homedir(), \"Downloads\");\n    const fileName = `image_${Date.now()}.${image.extension}`;\n    const filePath = path.join(downloadsPath, fileName);\n\n    const base64Data = image.image.replace(/^data:image\\/\\w+;base64,/, \"\");\n    const buffer = Buffer.from(base64Data, \"base64\");\n\n    fs.writeFile(filePath, buffer, (err) => {\n      if (err) {\n        showToast({\n          title: \"Error\",\n          message: \"Failed to download image\",\n          style: Toast.Style.Failure,\n        });\n      } else {\n        showToast({\n          title: \"Success\",\n          message: `Image downloaded to ${filePath}`,\n          style: Toast.Style.Success,\n        });\n      }\n    });\n  }\n\n  if (image) {\n    return (\n      <Detail\n        markdown={`![Converted Image](${image.image})`}\n        actions={\n          <ActionPanel>\n            <ActionPanel.Section>\n              <Action\n                title=\"Convert Another\"\n                onAction={() => setImage(null)}\n                icon={Icon.ArrowClockwise}\n                shortcut={{ modifiers: [\"cmd\"], key: \"r\" }}\n              />\n              <Action\n                title=\"Download Image\"\n                onAction={handleDownload}\n                icon={Icon.Download}\n                shortcut={{ modifiers: [\"cmd\"], key: \"d\" }}\n              />\n            </ActionPanel.Section>\n            <ActionPanel.Section>\n              <Action.CopyToClipboard\n                title=\"Copy Image Base64\"\n                content={image.image}\n                shortcut={{ modifiers: [\"cmd\"], key: \"c\" }}\n              />\n            </ActionPanel.Section>\n          </ActionPanel>\n        }\n        metadata={\n          <Detail.Metadata>\n            <Detail.Metadata.Label title=\"Format\" text={image.extension.toUpperCase()} />\n            <Detail.Metadata.Separator />\n            <Detail.Metadata.Label title=\"Dimensions\" text={`${image.dimensions.width}x${image.dimensions.height}`} />\n            <Detail.Metadata.Separator />\n            <Detail.Metadata.Label title=\"Size\" text={formatFileSize(image.size)} />\n            <Detail.Metadata.Separator />\n            <Detail.Metadata.TagList title=\"Actions\">\n              <Detail.Metadata.TagList.Item text=\"Download\" color={Color.Blue} />\n              <Detail.Metadata.TagList.Item text=\"Copy Base64\" color={Color.Green} />\n            </Detail.Metadata.TagList>\n          </Detail.Metadata>\n        }\n      />\n    );\n  }\n\n  return (\n    <Form\n      actions={\n        <ActionPanel>\n          <Action.SubmitForm title=\"Convert to Image\" onSubmit={handleSubmit} />\n        </ActionPanel>\n      }\n    >\n      <Form.TextArea\n        id=\"base64\"\n        title=\"Base64\"\n        placeholder=\"Paste your base64 image here\"\n        info=\"You can also drag and drop a text file containing the base64 string\"\n      />\n      <Form.Dropdown id=\"outputFormat\" title=\"Output Format\" defaultValue=\"png\">\n        <Form.Dropdown.Item value=\"png\" title=\"PNG\" />\n        <Form.Dropdown.Item value=\"jpeg\" title=\"JPEG\" />\n        <Form.Dropdown.Item value=\"webp\" title=\"WebP\" />\n      </Form.Dropdown>\n    </Form>\n  );\n}\n", "import { Buffer } from \"buffer\";\n\n/**\n * Extracts the width and height of an image from its base64 representation.\n * @param base64 The base64 string of the image.\n * @returns An object containing the width and height of the image, or null if extraction fails.\n */\nexport function getImageDimensionsFromBase64(base64: string): { width: number; height: number } | null {\n  try {\n    // Remove the data URL prefix if present\n    const cleanedBase64 = base64.replace(/^data:image\\/\\w+;base64,/, \"\");\n\n    // Decode the base64 string\n    const buffer = Buffer.from(cleanedBase64, \"base64\");\n\n    // Check for PNG signature\n    if (buffer.toString(\"hex\", 0, 8) === \"89504e470d0a1a0a\") {\n      // PNG: Width is at bytes 16-19, height at 20-23\n      const width = buffer.readUInt32BE(16);\n      const height = buffer.readUInt32BE(20);\n      return { width, height };\n    }\n\n    // Check for JPEG signature\n    if (buffer[0] === 0xff && buffer[1] === 0xd8) {\n      let offset = 2;\n      while (offset < buffer.length) {\n        // Check for Start of Frame markers\n        if (buffer[offset] === 0xff && (buffer[offset + 1] === 0xc0 || buffer[offset + 1] === 0xc2)) {\n          const height = buffer.readUInt16BE(offset + 5);\n          const width = buffer.readUInt16BE(offset + 7);\n          return { width, height };\n        }\n        offset += 2 + buffer.readUInt16BE(offset + 2);\n      }\n    }\n\n    // Check for WebP signature\n    if (buffer.toString(\"ascii\", 0, 4) === \"RIFF\" && buffer.toString(\"ascii\", 8, 12) === \"WEBP\") {\n      // WebP: Width and height are stored in VP8/VP8L chunk\n      const vp8Signature = buffer.toString(\"ascii\", 12, 15);\n      if (vp8Signature === \"VP8\") {\n        // Simple WebP format\n        const width = buffer.readUInt16LE(26) & 0x3fff;\n        const height = buffer.readUInt16LE(28) & 0x3fff;\n        return { width, height };\n      } else if (vp8Signature === \"VP8L\") {\n        // Lossless WebP format\n        const bits = buffer.readUInt32LE(21);\n        const width = (bits & 0x3fff) + 1;\n        const height = ((bits >> 14) & 0x3fff) + 1;\n        return { width, height };\n      }\n    }\n\n    // Unsupported format or unable to extract dimensions\n    return null;\n  } catch (error) {\n    console.error(\"Error extracting image dimensions:\", error);\n    return null;\n  }\n}\n\nexport function calculateBase64Size(base64String: string): number {\n  const padding = base64String.endsWith(\"==\") ? 2 : base64String.endsWith(\"=\") ? 1 : 0;\n  return (base64String.length * 3) / 4 - padding;\n}\n\nexport function isValidBase64(str: string): boolean {\n  try {\n    if (!str) return false;\n\n    let base64Data = str;\n    if (str.startsWith(\"data:image/\")) {\n      const parts = str.split(\",\");\n      if (parts.length !== 2) return false;\n      base64Data = parts[1];\n    }\n\n    if (base64Data.length % 4 !== 0) return false;\n    if (!/^[A-Za-z0-9+/=]*$/.test(base64Data)) return false;\n\n    const lastPadding = base64Data.indexOf(\"=\");\n    if (lastPadding !== -1) {\n      if (lastPadding !== base64Data.length - 1 && lastPadding !== base64Data.length - 2) return false;\n      if (base64Data.indexOf(\"=\") !== lastPadding) return false;\n    }\n\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport function formatFileSize(bytes: number): string {\n  const MB = 1024 * 1024;\n  const KB = 1024;\n\n  if (bytes > MB) {\n    return `${(bytes / MB).toFixed(2)} MB`;\n  }\n  return `${(bytes / KB).toFixed(2)} KB`;\n}\n"],
  "mappings": "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",
  "names": ["base64_to_image_exports", "__export", "Base64ToImage", "__toCommonJS", "import_api", "import_react", "import_fs", "import_path", "import_os", "import_buffer", "getImageDimensionsFromBase64", "base64", "cleanedBase64", "buffer", "width", "height", "offset", "vp8Signature", "bits", "error", "calculateBase64Size", "base64String", "padding", "isValidBase64", "str", "base64Data", "parts", "lastPadding", "formatFileSize", "bytes", "import_jsx_runtime", "Base64ToImage", "image", "setImage", "handleSubmit", "base64", "outputFormat", "cleanedBase64", "isValidBase64", "imageData", "extension", "dimensions", "getImageDimensionsFromBase64", "calculateBase64Size", "handleDownload", "downloadsPath", "path", "os", "fileName", "filePath", "base64Data", "buffer", "fs", "err", "formatFileSize"]
}
