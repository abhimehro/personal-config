"use strict";var F=Object.create;var f=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var L=(t,i)=>{for(var a in i)f(t,a,{get:i[a],enumerable:!0})},h=(t,i,a,o)=>{if(i&&typeof i=="object"||typeof i=="function")for(let r of M(i))!E.call(t,r)&&r!==a&&f(t,r,{get:()=>i[r],enumerable:!(o=P(i,r))||o.enumerable});return t};var g=(t,i,a)=>(a=t!=null?F(A(t)):{},h(i||!t||!t.__esModule?f(a,"default",{value:t,enumerable:!0}):a,t)),$=t=>h(f({},"__esModule",{value:!0}),t);var C={};L(C,{default:()=>D});module.exports=$(C);var e=require("@raycast/api"),I=require("react"),S=g(require("fs")),u=g(require("path")),y=g(require("os"));var p=require("buffer");function w(t){try{let i=t.replace(/^data:image\/\w+;base64,/,""),a=p.Buffer.from(i,"base64");if(a.toString("hex",0,8)==="89504e470d0a1a0a"){let o=a.readUInt32BE(16),r=a.readUInt32BE(20);return{width:o,height:r}}if(a[0]===255&&a[1]===216){let o=2;for(;o<a.length;){if(a[o]===255&&(a[o+1]===192||a[o+1]===194)){let r=a.readUInt16BE(o+5);return{width:a.readUInt16BE(o+7),height:r}}o+=2+a.readUInt16BE(o+2)}}if(a.toString("ascii",0,4)==="RIFF"&&a.toString("ascii",8,12)==="WEBP"){let o=a.toString("ascii",12,15);if(o==="VP8"){let r=a.readUInt16LE(26)&16383,s=a.readUInt16LE(28)&16383;return{width:r,height:s}}else if(o==="VP8L"){let r=a.readUInt32LE(21),s=(r&16383)+1,l=(r>>14&16383)+1;return{width:s,height:l}}}return null}catch(i){return console.error("Error extracting image dimensions:",i),null}}function x(t){let i=t.endsWith("==")?2:t.endsWith("=")?1:0;return t.length*3/4-i}function B(t){try{if(!t)return!1;let i=t;if(t.startsWith("data:image/")){let o=t.split(",");if(o.length!==2)return!1;i=o[1]}if(i.length%4!==0||!/^[A-Za-z0-9+/=]*$/.test(i))return!1;let a=i.indexOf("=");return!(a!==-1&&(a!==i.length-1&&a!==i.length-2||i.indexOf("=")!==a))}catch{return!1}}function b(t){return t>1048576?`${(t/1048576).toFixed(2)} MB`:`${(t/1024).toFixed(2)} KB`}var n=require("react/jsx-runtime");function D(){let[t,i]=(0,I.useState)(null);async function a({base64:r,outputFormat:s}){if(!r){(0,e.showToast)({title:"Error",message:"Please enter a base64 string",style:e.Toast.Style.Failure});return}let l=r.replaceAll('"',"").replaceAll("'","");if(!B(l)){(0,e.showToast)({title:"Error",message:"Invalid base64 string. Please check your input.",style:e.Toast.Style.Failure});return}let d,c;l.startsWith("data:image/")?(d=l,c=s||l.split(",")[0].split("/")[1]):(d=`data:image/${s};base64,${l}`,c=s);try{let m=w(r);i({image:d,extension:c,dimensions:m||{width:0,height:0},size:x(r)})}catch{(0,e.showToast)({title:"Error",message:"Unsupported image format or invalid base64 string",style:e.Toast.Style.Failure})}}function o(){if(!t)return;let r=u.default.join(y.default.homedir(),"Downloads"),s=`image_${Date.now()}.${t.extension}`,l=u.default.join(r,s),d=t.image.replace(/^data:image\/\w+;base64,/,""),c=Buffer.from(d,"base64");S.default.writeFile(l,c,m=>{m?(0,e.showToast)({title:"Error",message:"Failed to download image",style:e.Toast.Style.Failure}):(0,e.showToast)({title:"Success",message:`Image downloaded to ${l}`,style:e.Toast.Style.Success})})}return t?(0,n.jsx)(e.Detail,{markdown:`![Converted Image](${t.image})`,actions:(0,n.jsxs)(e.ActionPanel,{children:[(0,n.jsxs)(e.ActionPanel.Section,{children:[(0,n.jsx)(e.Action,{title:"Convert Another",onAction:()=>i(null),icon:e.Icon.ArrowClockwise,shortcut:{modifiers:["cmd"],key:"r"}}),(0,n.jsx)(e.Action,{title:"Download Image",onAction:o,icon:e.Icon.Download,shortcut:{modifiers:["cmd"],key:"d"}})]}),(0,n.jsx)(e.ActionPanel.Section,{children:(0,n.jsx)(e.Action.CopyToClipboard,{title:"Copy Image Base64",content:t.image,shortcut:{modifiers:["cmd"],key:"c"}})})]}),metadata:(0,n.jsxs)(e.Detail.Metadata,{children:[(0,n.jsx)(e.Detail.Metadata.Label,{title:"Format",text:t.extension.toUpperCase()}),(0,n.jsx)(e.Detail.Metadata.Separator,{}),(0,n.jsx)(e.Detail.Metadata.Label,{title:"Dimensions",text:`${t.dimensions.width}x${t.dimensions.height}`}),(0,n.jsx)(e.Detail.Metadata.Separator,{}),(0,n.jsx)(e.Detail.Metadata.Label,{title:"Size",text:b(t.size)}),(0,n.jsx)(e.Detail.Metadata.Separator,{}),(0,n.jsxs)(e.Detail.Metadata.TagList,{title:"Actions",children:[(0,n.jsx)(e.Detail.Metadata.TagList.Item,{text:"Download",color:e.Color.Blue}),(0,n.jsx)(e.Detail.Metadata.TagList.Item,{text:"Copy Base64",color:e.Color.Green})]})]})}):(0,n.jsxs)(e.Form,{actions:(0,n.jsx)(e.ActionPanel,{children:(0,n.jsx)(e.Action.SubmitForm,{title:"Convert to Image",onSubmit:a})}),children:[(0,n.jsx)(e.Form.TextArea,{id:"base64",title:"Base64",placeholder:"Paste your base64 image here",info:"You can also drag and drop a text file containing the base64 string"}),(0,n.jsxs)(e.Form.Dropdown,{id:"outputFormat",title:"Output Format",defaultValue:"png",children:[(0,n.jsx)(e.Form.Dropdown.Item,{value:"png",title:"PNG"}),(0,n.jsx)(e.Form.Dropdown.Item,{value:"jpeg",title:"JPEG"}),(0,n.jsx)(e.Form.Dropdown.Item,{value:"webp",title:"WebP"})]})]})}
