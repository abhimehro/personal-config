"use strict";var h=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var E=(t,r)=>{for(var e in r)h(t,e,{get:r[e],enumerable:!0})},T=(t,r,e,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of P(r))!k.call(t,o)&&o!==e&&h(t,o,{get:()=>r[o],enumerable:!(n=M(r,o))||n.enumerable});return t};var L=t=>T(h({},"__esModule",{value:!0}),t);var it={};E(it,{default:()=>z});module.exports=L(it);var l=require("@raycast/api");var I=require("@raycast/api"),R=()=>{let{versionManager:t}=(0,I.getPreferenceValues)();return{versionManager:t}},u=R();var a=require("node:child_process");var A=()=>{if(u.versionManager==="nvm"){let{stdout:t}=(0,a.spawnSync)("source ~/.zshrc; command -v nvm",{shell:"/bin/zsh"});return t.length===0?(console.error("nvm is not installed"),!1):!0}},S=t=>{let r=/v\d+\.\d+\.\d+|system/g;return t.map(n=>{let o=n.match(r);if(!o)return null;let s=o[0],i=n.includes("->")?"default":null,c=s.startsWith("v")?`v${s.split(".")[0].slice(1)}.x`:s;return{title:s,type:i,group:c}}).filter(n=>n!==null)},F=()=>{let{stdout:t,stderr:r}=(0,a.spawnSync)("source ~/.zshrc; nvm ls --no-alias",{shell:"/bin/zsh"});if(r.length>0){let n=r.toString();return console.error(n),[]}let e=t.toString().trim();if(e){let n=e.split(`
`);return S(n).reverse()}return[]},B=()=>{let{stdout:t,stderr:r}=(0,a.spawnSync)("source ~/.zshrc; nvm ls-remote",{shell:"/bin/zsh"});if(r.length>0){let n=r.toString();return console.error(n),[]}let e=t.toString().trim();if(e){let n=e.split(`
`);return S(n).reverse()}return[]},D=t=>{let{stdout:r,stderr:e}=(0,a.spawnSync)(`source ~/.zshrc; nvm install ${t}`,{shell:"/bin/zsh"});if(e.length>0){let o=e.toString();if(console.error(o),o.includes("Setting locale failed."))return"";throw new Error(o)}return r.toString().trim()},U=t=>{let{stdout:r,stderr:e}=(0,a.spawnSync)(`source ~/.zshrc; nvm uninstall ${t}`,{shell:"/bin/zsh"});if(e.length>0){let o=e.toString();return console.error(o),""}return r.toString().trim()},j=t=>{let{stdout:r,stderr:e}=(0,a.spawnSync)(`source ~/.zshrc; nvm alias default ${t}`,{shell:"/bin/zsh"});if(e.length>0){let o=e.toString().trim();throw console.error(o),new Error(o)}return r.toString().trim()},b={name:"nvm",list:F,listRemote:B,install:D,uninstall:U,default:j,isInstalled:A()};var m=require("node:child_process");function g(){return{PATH:"/usr/local/bin:/usr/bin:/bin:/opt/homebrew/bin:"}}var H=()=>{if(u.versionManager==="fnm"){let{stdout:t,stderr:r}=(0,m.spawnSync)("which",["fnm"],{env:g()});if(r.length>0){let n=r.toString();return console.error(n),""}return t.toString().trim()}return""},d=H(),W=()=>{if(u.versionManager==="fnm")return d?!0:(console.error("fnm is not installed"),!1)},q=()=>{let{stdout:t,stderr:r}=(0,m.spawnSync)(d,["list"]);if(r.length>0){let n=r.toString();return console.error(n),[]}let e=t.toString().trim();return e?e.split(`
`).map(s=>{let[,i,c]=s.split(" ");return i==="system"?null:{title:i,type:c||null,group:i.replace(/\.\d+\.\d+$/,".x")||"none"}}).filter(Boolean).reverse():[]},C=()=>{let{stdout:t,stderr:r}=(0,m.spawnSync)(d,["list-remote"]);if(r.length>0){let n=r.toString();return console.error(n),[]}let e=t.toString().trim();return e?e.split(`
`).map(s=>{let[i,c]=s.split(" ");return{title:i,type:c||null,group:i.replace(/\.\d+\.\d+$/,".x")||"none"}}).filter(Boolean).reverse():[]},G=t=>{let{stdout:r,stderr:e}=(0,m.spawnSync)(d,["install",t]);if(e.length>0){let o=e.toString();throw console.error(o),new Error(o)}return r.toString().trim()},J=t=>{let{stdout:r,stderr:e}=(0,m.spawnSync)(d,["uninstall",t]);if(e.length>0){let o=e.toString();throw console.error(o),new Error(o)}return r.toString().trim()},K=t=>{let{stdout:r,stderr:e}=(0,m.spawnSync)(d,["default",t]);if(console.log(e.toString()),e.length>0){let o=e.toString();throw console.error(o),new Error(o)}return r.toString().trim()},y={name:"fnm",list:q,listRemote:C,install:G,uninstall:J,default:K,isInstalled:W()};var N=require("node:child_process");var w=(t,r)=>{let[e,...n]=t.split(" "),{stdout:o,stderr:s}=(0,N.spawnSync)(e,n,{env:g(),shell:"/bin/zsh"});if(s.length>0){let c=s.toString();throw console.error(c),new Error(s.toString())}let i=o.toString().trim();return r?r(i):i},Q=t=>w(`source ${t}`),V=t=>w(`which ${t}`),X=t=>!!V(t),f={which:V,commandExists:X,source:Q,run:w};var p=require("@raycast/api"),Y=t=>{if(!/^node@[0-9]{2}/.test(t))throw new Error("brew expects the version on the format node@version, only a few versions are supported by brew")},Z=()=>u.versionManager==="brew",_=()=>{try{return f.commandExists("brew")}catch{return!1}},O=()=>Z()&&_(),$=()=>{try{return f.run("brew list --versions | grep node",r=>r.split(`
`)).map(r=>{let[e,n]=r.split(" ");return{title:`v${n}`,type:e,group:"Installed"}})}catch(t){console.log(t),(0,p.showToast)({style:p.Toast.Style.Failure,title:"unknown error",message:"something went wrong"})}return[]},tt=()=>f.run("brew search '/^node(@[0-9]*)?$/'",r=>r.replaceAll(/\n/g," ").replaceAll(/\s{2,}/g," ").split(" ")).map(r=>({title:r,type:r,group:"Remote"})),rt=t=>f.run(`brew install ${t}`),et=t=>{let e=$().find(n=>n.title===t);if(!e){let n=`couldn't find version to uninstall, ${e}`;throw console.log(n),new Error(n)}f.run(`brew uninstall ${e.type}`)},nt=t=>{Y(t),f.run(`brew link --overwrite ${t}`)},x={name:"brew",list:$,listRemote:tt,install:rt,uninstall:et,default:nt,isInstalled:O()};var ot=u.versionManager,st=()=>{switch(ot){case"nvm":return b;case"fnm":return y;case"brew":return x;default:return{name:"",list:()=>[],listRemote:()=>[],install:t=>{console.log("install",t)},uninstall:t=>{console.log("uninstall",t)},default:t=>{console.log("default",t)},isInstalled:!1}}},v=st();async function z(t){let{version:r}=t.arguments;if(!v.isInstalled)await(0,l.confirmAlert)({title:"Version Manager is not installed"});else try{await(0,l.showToast)(l.Toast.Style.Animated,`Making ${r} default`),await v.default(r),await(0,l.showToast)(l.Toast.Style.Success,`Now ${r} is your default node version`)}catch(n){await(0,l.showToast)(l.Toast.Style.Failure,`Failed to make ${r} default, ${n.message}`)}}
