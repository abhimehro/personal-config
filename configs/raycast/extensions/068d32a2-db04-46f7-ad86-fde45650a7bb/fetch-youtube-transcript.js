"use strict";var de=Object.create;var v=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,ge=Object.prototype.hasOwnProperty;var x=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),be=(e,t)=>{for(var r in t)v(e,r,{get:t[r],enumerable:!0})},P=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of pe(t))!ge.call(e,a)&&a!==r&&v(e,a,{get:()=>t[a],enumerable:!(n=he(t,a))||n.enumerable});return e};var g=(e,t,r)=>(r=e!=null?de(me(e)):{},P(t||!e||!e.__esModule?v(r,"default",{value:e,enumerable:!0}):r,e)),ye=e=>P(v({},"__esModule",{value:!0}),e);var I=x(w=>{"use strict";Object.defineProperty(w,"__esModule",{value:!0});w.sync=w.isexe=void 0;var $e=require("fs"),we=require("fs/promises"),ke=async(e,t={})=>{let{ignoreErrors:r=!1}=t;try{return U(await(0,we.stat)(e),t)}catch(n){let a=n;if(r||a.code==="EACCES")return!1;throw a}};w.isexe=ke;var xe=(e,t={})=>{let{ignoreErrors:r=!1}=t;try{return U((0,$e.statSync)(e),t)}catch(n){let a=n;if(r||a.code==="EACCES")return!1;throw a}};w.sync=xe;var U=(e,t)=>e.isFile()&&ve(e,t),ve=(e,t)=>{let r=t.uid??process.getuid?.(),n=t.groups??process.getgroups?.()??[],a=t.gid??process.getgid?.()??n[0];if(r===void 0||a===void 0)throw new Error("cannot get uid or gid");let i=new Set([a,...n]),s=e.mode,l=e.uid,d=e.gid,o=parseInt("100",8),f=parseInt("010",8),p=parseInt("001",8),m=o|f;return!!(s&p||s&f&&i.has(d)||s&o&&l===r||s&m&&r===0)}});var L=x(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.sync=k.isexe=void 0;var Ee=require("fs"),Se=require("fs/promises"),_e=async(e,t={})=>{let{ignoreErrors:r=!1}=t;try{return O(await(0,Se.stat)(e),e,t)}catch(n){let a=n;if(r||a.code==="EACCES")return!1;throw a}};k.isexe=_e;var Te=(e,t={})=>{let{ignoreErrors:r=!1}=t;try{return O((0,Ee.statSync)(e),e,t)}catch(n){let a=n;if(r||a.code==="EACCES")return!1;throw a}};k.sync=Te;var Ae=(e,t)=>{let{pathExt:r=process.env.PATHEXT||""}=t,n=r.split(";");if(n.indexOf("")!==-1)return!0;for(let a=0;a<n.length;a++){let i=n[a].toLowerCase(),s=e.substring(e.length-i.length).toLowerCase();if(i&&s===i)return!0}return!1},O=(e,t,r)=>e.isFile()&&Ae(t,r)});var D=x(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0})});var N=x(u=>{"use strict";var z=u&&u.__createBinding||(Object.create?(function(e,t,r,n){n===void 0&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}):(function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]})),Pe=u&&u.__setModuleDefault||(Object.create?(function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}):function(e,t){e.default=t}),V=u&&u.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.prototype.hasOwnProperty.call(e,r)&&z(t,e,r);return Pe(t,e),t},Re=u&&u.__exportStar||function(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&z(t,e,r)};Object.defineProperty(u,"__esModule",{value:!0});u.sync=u.isexe=u.posix=u.win32=void 0;var j=V(I());u.posix=j;var W=V(L());u.win32=W;Re(D(),u);var Ce=process.env._ISEXE_TEST_PLATFORM_||process.platform,F=Ce==="win32"?W:j;u.isexe=F.isexe;u.sync=F.sync});var Q=x((Xe,X)=>{var{isexe:Ue,sync:Ie}=N(),{join:Oe,delimiter:Le,sep:B,posix:G}=require("path"),H=process.platform==="win32",K=new RegExp(`[${G.sep}${B===G.sep?"":B}]`.replace(/(\\)/g,"\\$1")),Me=new RegExp(`^\\.${K.source}`),Z=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"}),J=(e,{path:t=process.env.PATH,pathExt:r=process.env.PATHEXT,delimiter:n=Le})=>{let a=e.match(K)?[""]:[...H?[process.cwd()]:[],...(t||"").split(n)];if(H){let i=r||[".EXE",".CMD",".BAT",".COM"].join(n),s=i.split(n).flatMap(l=>[l,l.toLowerCase()]);return e.includes(".")&&s[0]!==""&&s.unshift(""),{pathEnv:a,pathExt:s,pathExtExe:i}}return{pathEnv:a,pathExt:[""]}},q=(e,t)=>{let r=/^".*"$/.test(e)?e.slice(1,-1):e;return(!r&&Me.test(t)?t.slice(0,2):"")+Oe(r,t)},Y=async(e,t={})=>{let{pathEnv:r,pathExt:n,pathExtExe:a}=J(e,t),i=[];for(let s of r){let l=q(s,e);for(let d of n){let o=l+d;if(await Ue(o,{pathExt:a,ignoreErrors:!0})){if(!t.all)return o;i.push(o)}}}if(t.all&&i.length)return i;if(t.nothrow)return null;throw Z(e)},De=(e,t={})=>{let{pathEnv:r,pathExt:n,pathExtExe:a}=J(e,t),i=[];for(let s of r){let l=q(s,e);for(let d of n){let o=l+d;if(Ie(o,{pathExt:a,ignoreErrors:!0})){if(!t.all)return o;i.push(o)}}}if(t.all&&i.length)return i;if(t.nothrow)return null;throw Z(e)};X.exports=Y;Y.sync=De});var Fe={};be(Fe,{default:()=>ue});module.exports=ye(Fe);var h=require("@raycast/api");var y=g(require("react")),c=require("@raycast/api");var $=g(require("node:fs")),E=g(require("node:path"));var C=require("react/jsx-runtime");function S(e,t){let r=e instanceof Error?e.message:String(e);return(0,c.showToast)({style:c.Toast.Style.Failure,title:t?.title??"Something went wrong",message:t?.message??r,primaryAction:t?.primaryAction??R(e),secondaryAction:t?.primaryAction?R(e):void 0})}var R=e=>{let t=!0,r="[Extension Name]...",n="";try{let s=JSON.parse((0,$.readFileSync)((0,E.join)(c.environment.assetsPath,"..","package.json"),"utf8"));r=`[${s.title}]...`,n=`https://raycast.com/${s.owner||s.author}/${s.name}`,(!s.owner||s.access==="public")&&(t=!1)}catch{}let a=c.environment.isDevelopment||t,i=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:a?"Copy Logs":"Report Error",onAction(s){s.hide(),a?c.Clipboard.copy(i):(0,c.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(n)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${i}
\`\`\`
`)}`)}}};var ce=require("fs"),A=g(require("path")),le=g(require("os"));var _=require("fs"),ee=g(require("fs")),te=g(require("path")),re=g(require("os")),ne=require("child_process"),ae=g(Q());function se(e){let t=[/(?:https?:\/\/)?(?:www\.)?youtu\.be\/([a-zA-Z0-9_-]+)/,/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]+)/,/(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([a-zA-Z0-9_-]+)/];for(let r of t){let n=e.match(r);if(n&&n[1])return n[1]}return null}var b=null;function ze(){if(b)return b;if(process.env.YT_DLP_PATH&&process.env.YT_DLP_PATH.trim()!=="")return b=process.env.YT_DLP_PATH,b;let e=["/opt/homebrew/bin/yt-dlp","/usr/local/bin/yt-dlp","/usr/bin/yt-dlp"];for(let t of e)if(ee.existsSync(t))return b=t,b;try{return b=ae.default.sync("yt-dlp"),b}catch{throw new Error("yt-dlp executable not found. Please install yt-dlp and ensure it is in your PATH, or set the YT_DLP_PATH environment variable.")}}function T(e,t){return new Promise((r,n)=>{(0,ne.execFile)(e,t,{shell:!1},(a,i,s)=>{if(a){let l=`Command failed: ${a.message}
stdout: ${i}
stderr: ${s}`;n(new Error(l));return}r({stdout:i,stderr:s})})})}async function Ve(e){try{await T(e,["--version"])}catch{throw new Error("yt-dlp is not installed or not found in your PATH. Please install yt-dlp and ensure it is accessible from the command line.")}}function ie(e){return e.replace(/[/\\?%*:|"<>]/g,"-").replace(/\s+/g," ").trim().substring(0,255)}function je(e){let t=e.split(/\r?\n/),r=[],n="",a=/^\d{2}:\d{2}:\d{2}\.\d{3}/,i=/<[^>]*>/g,s=/^Kind:\s*captions\s*Language:\s*[a-z]{2}(\s|\n)+/i;for(let l of t){let d=l.trim();if(d===""||/^\d+$/.test(d)||d.includes("WEBVTT")||a.test(d))continue;let o=d.replace(i,"").trim();o&&o!==n&&(r.push(o),n=o)}return r.join(" ").replace(s,"").replace(/\s*Kind:\s*captions\s*Language:\s*[a-z]{2}(\s|\n)+/gi," ").trim()}async function We(e,t="en"){let r=ze();await Ve(r);let n=Date.now(),a=te.default.join(re.default.tmpdir(),`temp_transcript_${n}`),i=`${a}.${t}.vtt`,s=["--get-title",e],l=null;try{let{stdout:f,stderr:p}=await T(r,s);l=f.trim(),p&&p.toLowerCase().includes("fail")&&console.error("Failed to get video title:",p)}catch(f){console.error("Error fetching video title:",f)}let d=["--write-auto-subs","--skip-download","--sub-lang",t,"--output",a,e],o=null;try{let{stdout:f}=await T(r,d);if(f.includes("No captions found")||f.includes("no subtitles"))return{transcript:null,videoTitle:l};try{o=await _.promises.readFile(i,{encoding:"utf8"})}catch(m){let fe=m instanceof Error?m.message:String(m);throw new Error(`Failed to read transcript file: ${fe}`)}return{transcript:o?je(o):"",videoTitle:l}}catch(f){let p=f instanceof Error?f.message:String(f);throw console.error(`An error occurred during transcript retrieval: ${p}`),new Error(`Transcript retrieval failed: ${p}`)}finally{try{await _.promises.unlink(i)}catch{}}}async function oe(e,t="en"){let r=`https://www.youtube.com/watch?v=${e}`,{transcript:n,videoTitle:a}=await We(r,t);if(!n)throw new Error("Transcript Not Available - No captions found in any language");return{transcript:n,title:a||`YouTube Video ${e}`}}async function ue(e){let{videoUrl:t,action:r}=e.arguments,{defaultAction:n,defaultDownloadFolder:a,defaultLanguage:i}=(0,h.getPreferenceValues)();if(!t){await S("YouTube URL is required");return}try{let s=se(t);if(!s)throw new Error("Invalid YouTube URL. Please provide a valid URL.");await(0,h.showToast)({style:h.Toast.Style.Animated,title:"Fetching transcript..."});let{transcript:l,title:d}=await oe(s,i||"en"),o=r||n||"save";if(o==="save"){let f=a||A.default.join(le.default.homedir(),"Downloads"),p=ie(d),m=A.default.join(f,`${p}_transcript.txt`);await ce.promises.writeFile(m,l),await(0,h.showToast)({style:h.Toast.Style.Success,title:"Transcript fetched and saved",message:`Saved to: ${m}`,primaryAction:{title:"Open File",onAction:()=>(0,h.open)(m)},secondaryAction:{title:"Open Folder",onAction:()=>(0,h.open)(f)}})}else o==="copy"&&(await h.Clipboard.copy(l),await(0,h.showToast)({style:h.Toast.Style.Success,title:"Transcript copied to clipboard"}))}catch(s){let d=(s instanceof Error?s.message:String(s)).includes("yt-dlp")?"yt-dlp not found":"Failed to fetch transcript";await S(s,{title:d})}}
