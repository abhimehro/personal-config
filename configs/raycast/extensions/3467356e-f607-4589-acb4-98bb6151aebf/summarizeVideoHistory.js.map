{
  "version": 3,
  "sources": ["../src/summarizeVideoHistory.tsx", "../src/components/summary/FollowUpList.tsx", "../src/const/toast_messages.ts", "../src/utils/generateQuestionId.ts", "../src/utils/getAiInstructionSnippets.ts", "../src/hooks/useHistory.ts"],
  "sourcesContent": ["import { Action, ActionPanel, Icon, List, showToast, Toast } from \"@raycast/api\";\nimport { useEffect, useState } from \"react\";\nimport FollowUpList from \"./components/summary/FollowUpList\";\nimport { type HistoryItem, useHistory } from \"./hooks/useHistory\";\nimport type { Question } from \"./hooks/useQuestions\";\nimport { ALERT, QUESTION_ANSWERED } from \"./const/toast_messages\";\n\nexport default function Command() {\n  const [history, setHistory] = useState<HistoryItem[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const { getHistory, addToHistory } = useHistory();\n\n  useEffect(() => {\n    loadHistory();\n  }, []);\n\n  async function handleQuestionsUpdate(historyItem: HistoryItem, updatedQuestions: Question[]) {\n    try {\n      const updatedItem = {\n        ...historyItem,\n        questions: updatedQuestions,\n        createdAt: new Date(),\n      };\n\n      await addToHistory(updatedItem);\n      await loadHistory();\n\n      await showToast({\n        style: Toast.Style.Success,\n        title: QUESTION_ANSWERED.title,\n        message: QUESTION_ANSWERED.message,\n      });\n    } catch (error) {\n      await showToast({\n        style: Toast.Style.Failure,\n        title: ALERT.title,\n        message: String(error),\n      });\n    }\n  }\n\n  async function loadHistory() {\n    try {\n      const items = await getHistory();\n      setHistory(items);\n    } catch (error) {\n      await showToast({\n        style: Toast.Style.Failure,\n        title: \"Failed to load history\",\n        message: String(error),\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  }\n\n  return (\n    <List isLoading={isLoading}>\n      {history.map((item) => (\n        <List.Item\n          key={`${item.id}-${item.aiService}`}\n          icon={Icon.Video}\n          title={item.title}\n          subtitle={new Date(item.createdAt).toLocaleDateString()}\n          accessories={[{ text: item.aiService }]}\n          actions={\n            <ActionPanel>\n              <Action.Push\n                icon={Icon.Document}\n                title=\"Check Details\"\n                target={\n                  <FollowUpList\n                    transcript={item.summary}\n                    questions={item.questions}\n                    onQuestionsUpdate={(updatedQuestions) => handleQuestionsUpdate(item, updatedQuestions)}\n                  />\n                }\n              />\n            </ActionPanel>\n          }\n        />\n      ))}\n    </List>\n  );\n}\n", "/* Copy All Q&A would be weirdly formatted otherwise */\n/* eslint-disable @raycast/prefer-title-case */\nimport { Action, ActionPanel, AI, List, showToast, Toast } from \"@raycast/api\";\nimport { useState, useEffect, useCallback } from \"react\";\nimport { FINDING_ANSWER } from \"../../const/toast_messages\";\nimport type { Question } from \"../../hooks/useQuestions\";\nimport { generateQuestionId } from \"../../utils/generateQuestionId\";\nimport { getFollowUpQuestionSnippet } from \"../../utils/getAiInstructionSnippets\";\n\ntype FollowUpListProps = {\n  transcript: string;\n  questions: Question[];\n  onQuestionsUpdate?: (updatedQuestions: Question[]) => void;\n};\n\nexport default function FollowUpList({\n  transcript,\n  questions: initialQuestions,\n  onQuestionsUpdate,\n}: FollowUpListProps) {\n  const [question, setQuestion] = useState(\"\");\n  const [selectedQuestionId, setSelectedQuestionId] = useState(initialQuestions[0]?.id ?? \"\");\n  const [questions, setQuestions] = useState(initialQuestions);\n\n  useEffect(() => {\n    if (onQuestionsUpdate) {\n      onQuestionsUpdate(questions);\n    }\n  }, [questions, onQuestionsUpdate]);\n\n  const updateQuestions = useCallback((updatedQuestions: Question[]) => {\n    setQuestions(updatedQuestions);\n  }, []);\n\n  const handleAdditionalQuestion = async () => {\n    if (!question) return;\n    const qID = generateQuestionId();\n    const questionText = question;\n\n    const toast = await showToast({\n      style: Toast.Style.Animated,\n      title: FINDING_ANSWER.title,\n      message: FINDING_ANSWER.message,\n    });\n\n    const answer = AI.ask(getFollowUpQuestionSnippet(questionText, transcript));\n\n    const updatedQuestions = [\n      {\n        id: qID,\n        question: questionText,\n        answer: \"\",\n      },\n      ...questions,\n    ];\n    updateQuestions(updatedQuestions);\n\n    setQuestion(\"\");\n    let isFirstChunk = true;\n    answer.on(\"data\", (data) => {\n      if (isFirstChunk) {\n        toast.show();\n        isFirstChunk = false;\n      }\n      setQuestions((prevQuestions) => {\n        return prevQuestions.map((q) => (q.id === qID ? { ...q, answer: q.answer + data } : q));\n      });\n    });\n\n    answer.finally(() => {\n      toast.hide();\n      setSelectedQuestionId(qID);\n    });\n  };\n\n  const copyQuestionsAndAnswers = () => {\n    const followUps = questions.length\n      ? `Questions:\\n${questions.map((q) => `Q: ${q.question}\\nA: ${q.answer}`).join(\"\\n\\n\")}`\n      : \"\";\n\n    return `${followUps}`;\n  };\n\n  const copySelectedAnswer = () => {\n    const selectedQuestion = questions.find((q) => q.id === selectedQuestionId);\n    if (!selectedQuestion) return \"\";\n\n    return selectedQuestion.id === questions[0]?.id\n      ? selectedQuestion.answer // Just return the summary without Q/A format\n      : `Q: ${selectedQuestion.question}\\nA: ${selectedQuestion.answer}`;\n  };\n\n  return (\n    <List\n      filtering={false}\n      isShowingDetail\n      navigationTitle=\"Additional Questions\"\n      onSearchTextChange={setQuestion}\n      searchText={question}\n      searchBarPlaceholder=\"Ask another question\"\n      selectedItemId={selectedQuestionId}\n      searchBarAccessory={\n        <ActionPanel>\n          <Action.SubmitForm onSubmit={handleAdditionalQuestion} />\n          <Action.CopyToClipboard title=\"Copy Selected Answer\" content={copySelectedAnswer()} />\n          <Action.CopyToClipboard title=\"Copy All Q&A\" content={copyQuestionsAndAnswers()} />\n        </ActionPanel>\n      }\n    >\n      {questions.map((question) => (\n        <List.Item\n          key={question.id}\n          title={question.question}\n          detail={<List.Item.Detail markdown={question.answer} />}\n          id={question.id}\n        />\n      ))}\n    </List>\n  );\n}\n", "export const LONG_VIDEO = {\n  title: \"\u2757\",\n  message: \"Quite a lot of information in that video, hold on.\",\n};\n\nexport const SUMMARIZING_VIDEO = {\n  title: \"\uD83D\uDCA1\",\n  message: \"Summarizing video\",\n};\n\nexport const SUCCESS_SUMMARIZING_VIDEO = {\n  title: \"\uD83D\uDCDD\",\n  message: \"Video summarized!\",\n};\n\nexport const ALERT = {\n  title: \"\uD83D\uDEA8\",\n};\n\nexport const FINDING_ANSWER = {\n  title: \"\uD83D\uDD0D\",\n  message: \"Answering your question\",\n};\n\nexport const QUESTION_ANSWERED = {\n  title: \"\u2705\",\n  message: \"Answer has been saved!\",\n};\n\nexport const GETTING_VIDEO_URL = {\n  title: \"\uD83D\uDD17\",\n  message: \"Checking video URL\",\n};\n\nexport const GETTING_VIDEO_URL_FROM_BROWSER = {\n  title: \"\uD83D\uDD17\",\n  message: \"Checking Browser Extension\",\n};\n\nexport const GETTING_VIDEO_URL_FROM_CLIPBOARD = {\n  title: \"\uD83D\uDD17\",\n  message: \"Checking Clipboard\",\n};\n", "export function generateQuestionId(): string {\n  return `q-${Date.now()}`;\n}\n", "export function getSummaryBlockSnippet(\n  index: number,\n  splitTranscripts: number,\n  summaryBlock: string,\n  MAX_CHARS: number,\n) {\n  return `Summarize this transcription of a youtube video.\n    The transcription is split into parts and this is part ${index} of ${splitTranscripts}.\n    Be as concise as possible.\n    Do not use more then ${MAX_CHARS / splitTranscripts} characters.\n    \n    Here is the transcript: ${summaryBlock}`;\n}\n\nexport function getAiInstructionSnippet(language: string, temporarySummary: string, transcript: string | undefined) {\n  return `Summarize the following transcription of a youtube video as a list of the most important points each starting with a fitting emoji. Ignore Sponsor Segments and Video Sponsors. Answer in ${language}.\n  \n  Format:\n\n  [Emoji] [List Item] &nbsp;&nbsp;\n  \n  Here is the transcript: ${temporarySummary.length > 0 ? temporarySummary : transcript}`;\n}\n\nexport function getFollowUpQuestionSnippet(question: string, transcript: string) {\n  return `The following text is the content of a video. Refer to it as video. You already summarized it for the person asking a question. Answer with a list starting with a fitting emoji. Ignore Sponsor Segments and Video Sponsors.\n  \n  Format:\n\n  [Emoji] [List Item] &nbsp;&nbsp;\n  \n  Here is the transcript: ${transcript}. This is the question: ${question}`;\n}\n", "import { LocalStorage } from \"@raycast/api\";\nimport type { Question } from \"./useQuestions\";\n\nexport type HistoryItem = {\n  aiService: string;\n  createdAt: Date;\n  id: string;\n  questions: Question[];\n  summary: string;\n  title: string;\n  videoUrl: string;\n};\n\nconst HISTORY_KEYS_PREFIX = \"youtube-summary-\";\nconst HISTORY_KEYS_LIST_KEY = \"youtube-summary-keys\";\n\nexport const useHistory = () => {\n  const addToHistory = async (item: HistoryItem) => {\n    const uniqueKey = `${item.id}-${item.aiService}`;\n    await LocalStorage.setItem(`${HISTORY_KEYS_PREFIX}${uniqueKey}`, JSON.stringify(item));\n\n    const keys = await getHistoryKeys();\n    if (!keys.includes(uniqueKey)) {\n      keys.unshift(uniqueKey);\n      await LocalStorage.setItem(HISTORY_KEYS_LIST_KEY, JSON.stringify(keys));\n    }\n  };\n\n  const getHistory = async (): Promise<HistoryItem[]> => {\n    const keys = await getHistoryKeys();\n    const items = await Promise.all(\n      keys.map(async (key) => {\n        const itemString = await LocalStorage.getItem<string>(`${HISTORY_KEYS_PREFIX}${key}`);\n        if (!itemString) return null;\n        const item = JSON.parse(itemString);\n        item.createdAt = new Date(item.createdAt);\n        return item;\n      }),\n    );\n    return items.filter((item): item is HistoryItem => item !== null);\n  };\n\n  const getHistoryKeys = async (): Promise<string[]> => {\n    const keysString = await LocalStorage.getItem<string>(HISTORY_KEYS_LIST_KEY);\n    return keysString ? JSON.parse(keysString) : [];\n  };\n\n  return {\n    addToHistory,\n    getHistory,\n  };\n};\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAAkE,wBAClEC,EAAoC,iBCCpC,IAAAC,EAAgE,wBAChEC,EAAiD,iBCY1C,IAAMC,EAAQ,CACnB,MAAO,WACT,EAEaC,EAAiB,CAC5B,MAAO,YACP,QAAS,yBACX,EAEaC,EAAoB,CAC/B,MAAO,SACP,QAAS,wBACX,EC3BO,SAASC,GAA6B,CAC3C,MAAO,KAAK,KAAK,IAAI,CAAC,EACxB,CCsBO,SAASC,EAA2BC,EAAkBC,EAAoB,CAC/E,MAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAMmBA,CAAU,2BAA2BD,CAAQ,EACzE,CHsEQ,IAAAE,EAAA,6BAvFO,SAARC,EAA8B,CACnC,WAAAC,EACA,UAAWC,EACX,kBAAAC,CACF,EAAsB,CACpB,GAAM,CAACC,EAAUC,CAAW,KAAI,YAAS,EAAE,EACrC,CAACC,EAAoBC,CAAqB,KAAI,YAASL,EAAiB,CAAC,GAAG,IAAM,EAAE,EACpF,CAACM,EAAWC,CAAY,KAAI,YAASP,CAAgB,KAE3D,aAAU,IAAM,CACVC,GACFA,EAAkBK,CAAS,CAE/B,EAAG,CAACA,EAAWL,CAAiB,CAAC,EAEjC,IAAMO,KAAkB,eAAaC,GAAiC,CACpEF,EAAaE,CAAgB,CAC/B,EAAG,CAAC,CAAC,EAECC,EAA2B,SAAY,CAC3C,GAAI,CAACR,EAAU,OACf,IAAMS,EAAMC,EAAmB,EACzBC,EAAeX,EAEfY,EAAQ,QAAM,aAAU,CAC5B,MAAO,QAAM,MAAM,SACnB,MAAOC,EAAe,MACtB,QAASA,EAAe,OAC1B,CAAC,EAEKC,EAAS,KAAG,IAAIC,EAA2BJ,EAAcd,CAAU,CAAC,EAEpEU,EAAmB,CACvB,CACE,GAAIE,EACJ,SAAUE,EACV,OAAQ,EACV,EACA,GAAGP,CACL,EACAE,EAAgBC,CAAgB,EAEhCN,EAAY,EAAE,EACd,IAAIe,EAAe,GACnBF,EAAO,GAAG,OAASG,GAAS,CACtBD,IACFJ,EAAM,KAAK,EACXI,EAAe,IAEjBX,EAAca,GACLA,EAAc,IAAKC,GAAOA,EAAE,KAAOV,EAAM,CAAE,GAAGU,EAAG,OAAQA,EAAE,OAASF,CAAK,EAAIE,CAAE,CACvF,CACH,CAAC,EAEDL,EAAO,QAAQ,IAAM,CACnBF,EAAM,KAAK,EACXT,EAAsBM,CAAG,CAC3B,CAAC,CACH,EAEMW,EAA0B,IAKvB,GAJWhB,EAAU,OACxB;AAAA,EAAeA,EAAU,IAAKe,GAAM,MAAMA,EAAE,QAAQ;AAAA,KAAQA,EAAE,MAAM,EAAE,EAAE,KAAK;AAAA;AAAA,CAAM,CAAC,GACpF,EAEe,GAGfE,EAAqB,IAAM,CAC/B,IAAMC,EAAmBlB,EAAU,KAAMe,GAAMA,EAAE,KAAOjB,CAAkB,EAC1E,OAAKoB,EAEEA,EAAiB,KAAOlB,EAAU,CAAC,GAAG,GACzCkB,EAAiB,OACjB,MAAMA,EAAiB,QAAQ;AAAA,KAAQA,EAAiB,MAAM,GAJpC,EAKhC,EAEA,SACE,OAAC,QACC,UAAW,GACX,gBAAe,GACf,gBAAgB,uBAChB,mBAAoBrB,EACpB,WAAYD,EACZ,qBAAqB,uBACrB,eAAgBE,EAChB,sBACE,QAAC,eACC,oBAAC,SAAO,WAAP,CAAkB,SAAUM,EAA0B,KACvD,OAAC,SAAO,gBAAP,CAAuB,MAAM,uBAAuB,QAASa,EAAmB,EAAG,KACpF,OAAC,SAAO,gBAAP,CAAuB,MAAM,eAAe,QAASD,EAAwB,EAAG,GACnF,EAGD,SAAAhB,EAAU,IAAKJ,MACd,OAAC,OAAK,KAAL,CAEC,MAAOA,EAAS,SAChB,UAAQ,OAAC,OAAK,KAAK,OAAV,CAAiB,SAAUA,EAAS,OAAQ,EACrD,GAAIA,EAAS,IAHRA,EAAS,EAIhB,CACD,EACH,CAEJ,CIvHA,IAAAuB,EAA6B,wBAavBC,EAAsB,mBACtBC,EAAwB,uBAEjBC,EAAa,IAAM,CAC9B,IAAMC,EAAe,MAAOC,GAAsB,CAChD,IAAMC,EAAY,GAAGD,EAAK,EAAE,IAAIA,EAAK,SAAS,GAC9C,MAAM,eAAa,QAAQ,GAAGJ,CAAmB,GAAGK,CAAS,GAAI,KAAK,UAAUD,CAAI,CAAC,EAErF,IAAME,EAAO,MAAMC,EAAe,EAC7BD,EAAK,SAASD,CAAS,IAC1BC,EAAK,QAAQD,CAAS,EACtB,MAAM,eAAa,QAAQJ,EAAuB,KAAK,UAAUK,CAAI,CAAC,EAE1E,EAEME,EAAa,SAAoC,CACrD,IAAMF,EAAO,MAAMC,EAAe,EAUlC,OATc,MAAM,QAAQ,IAC1BD,EAAK,IAAI,MAAOG,GAAQ,CACtB,IAAMC,EAAa,MAAM,eAAa,QAAgB,GAAGV,CAAmB,GAAGS,CAAG,EAAE,EACpF,GAAI,CAACC,EAAY,OAAO,KACxB,IAAMN,EAAO,KAAK,MAAMM,CAAU,EAClC,OAAAN,EAAK,UAAY,IAAI,KAAKA,EAAK,SAAS,EACjCA,CACT,CAAC,CACH,GACa,OAAQA,GAA8BA,IAAS,IAAI,CAClE,EAEMG,EAAiB,SAA+B,CACpD,IAAMI,EAAa,MAAM,eAAa,QAAgBV,CAAqB,EAC3E,OAAOU,EAAa,KAAK,MAAMA,CAAU,EAAI,CAAC,CAChD,EAEA,MAAO,CACL,aAAAR,EACA,WAAAK,CACF,CACF,ELoBkB,IAAAI,EAAA,6BAhEH,SAARC,GAA2B,CAChC,GAAM,CAACC,EAASC,CAAU,KAAI,YAAwB,CAAC,CAAC,EAClD,CAACC,EAAWC,CAAY,KAAI,YAAS,EAAI,EACzC,CAAE,WAAAC,EAAY,aAAAC,CAAa,EAAIC,EAAW,KAEhD,aAAU,IAAM,CACdC,EAAY,CACd,EAAG,CAAC,CAAC,EAEL,eAAeC,EAAsBC,EAA0BC,EAA8B,CAC3F,GAAI,CACF,IAAMC,EAAc,CAClB,GAAGF,EACH,UAAWC,EACX,UAAW,IAAI,IACjB,EAEA,MAAML,EAAaM,CAAW,EAC9B,MAAMJ,EAAY,EAElB,QAAM,aAAU,CACd,MAAO,QAAM,MAAM,QACnB,MAAOK,EAAkB,MACzB,QAASA,EAAkB,OAC7B,CAAC,CACH,OAASC,EAAO,CACd,QAAM,aAAU,CACd,MAAO,QAAM,MAAM,QACnB,MAAOC,EAAM,MACb,QAAS,OAAOD,CAAK,CACvB,CAAC,CACH,CACF,CAEA,eAAeN,GAAc,CAC3B,GAAI,CACF,IAAMQ,EAAQ,MAAMX,EAAW,EAC/BH,EAAWc,CAAK,CAClB,OAASF,EAAO,CACd,QAAM,aAAU,CACd,MAAO,QAAM,MAAM,QACnB,MAAO,yBACP,QAAS,OAAOA,CAAK,CACvB,CAAC,CACH,QAAE,CACAV,EAAa,EAAK,CACpB,CACF,CAEA,SACE,OAAC,QAAK,UAAWD,EACd,SAAAF,EAAQ,IAAKgB,MACZ,OAAC,OAAK,KAAL,CAEC,KAAM,OAAK,MACX,MAAOA,EAAK,MACZ,SAAU,IAAI,KAAKA,EAAK,SAAS,EAAE,mBAAmB,EACtD,YAAa,CAAC,CAAE,KAAMA,EAAK,SAAU,CAAC,EACtC,WACE,OAAC,eACC,mBAAC,SAAO,KAAP,CACC,KAAM,OAAK,SACX,MAAM,gBACN,UACE,OAACC,EAAA,CACC,WAAYD,EAAK,QACjB,UAAWA,EAAK,UAChB,kBAAoBN,GAAqBF,EAAsBQ,EAAMN,CAAgB,EACvF,EAEJ,EACF,GAlBG,GAAGM,EAAK,EAAE,IAAIA,EAAK,SAAS,EAoBnC,CACD,EACH,CAEJ",
  "names": ["summarizeVideoHistory_exports", "__export", "Command", "__toCommonJS", "import_api", "import_react", "import_api", "import_react", "ALERT", "FINDING_ANSWER", "QUESTION_ANSWERED", "generateQuestionId", "getFollowUpQuestionSnippet", "question", "transcript", "import_jsx_runtime", "FollowUpList", "transcript", "initialQuestions", "onQuestionsUpdate", "question", "setQuestion", "selectedQuestionId", "setSelectedQuestionId", "questions", "setQuestions", "updateQuestions", "updatedQuestions", "handleAdditionalQuestion", "qID", "generateQuestionId", "questionText", "toast", "FINDING_ANSWER", "answer", "getFollowUpQuestionSnippet", "isFirstChunk", "data", "prevQuestions", "q", "copyQuestionsAndAnswers", "copySelectedAnswer", "selectedQuestion", "import_api", "HISTORY_KEYS_PREFIX", "HISTORY_KEYS_LIST_KEY", "useHistory", "addToHistory", "item", "uniqueKey", "keys", "getHistoryKeys", "getHistory", "key", "itemString", "keysString", "import_jsx_runtime", "Command", "history", "setHistory", "isLoading", "setIsLoading", "getHistory", "addToHistory", "useHistory", "loadHistory", "handleQuestionsUpdate", "historyItem", "updatedQuestions", "updatedItem", "QUESTION_ANSWERED", "error", "ALERT", "items", "item", "FollowUpList"]
}
