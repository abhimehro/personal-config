"use strict";var _h=Object.create;var qo=Object.defineProperty;var wh=Object.getOwnPropertyDescriptor;var Sh=Object.getOwnPropertyNames;var Rh=Object.getPrototypeOf,Ah=Object.prototype.hasOwnProperty;var Es=(r,e)=>()=>(r&&(e=r(r=0)),e);var me=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Gu=(r,e)=>{for(var t in e)qo(r,t,{get:e[t],enumerable:!0})},Yu=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Sh(e))!Ah.call(r,o)&&o!==t&&qo(r,o,{get:()=>e[o],enumerable:!(n=wh(e,o))||n.enumerable});return r};var ht=(r,e,t)=>(t=r!=null?_h(Rh(r)):{},Yu(e||!r||!r.__esModule?qo(t,"default",{value:r,enumerable:!0}):t,r)),Th=r=>Yu(qo({},"__esModule",{value:!0}),r);var Ku=me(($o,Ju)=>{(function(r,e){typeof $o=="object"&&typeof Ju<"u"?e($o):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.WebStreamsPolyfill={}))})($o,(function(r){"use strict";function e(){}function t(s){return typeof s=="object"&&s!==null||typeof s=="function"}let n=e;function o(s,i){try{Object.defineProperty(s,"name",{value:i,configurable:!0})}catch{}}let a=Promise,u=Promise.prototype.then,d=Promise.reject.bind(a);function h(s){return new a(s)}function f(s){return h(i=>i(s))}function g(s){return d(s)}function S(s,i,l){return u.call(s,i,l)}function I(s,i,l){S(S(s,i,l),void 0,n)}function _(s,i){I(s,i)}function A(s,i){I(s,void 0,i)}function C(s,i,l){return S(s,i,l)}function B(s){S(s,void 0,n)}let L=s=>{if(typeof queueMicrotask=="function")L=queueMicrotask;else{let i=f(void 0);L=l=>S(i,l)}return L(s)};function E(s,i,l){if(typeof s!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(s,i,l)}function F(s,i,l){try{return f(E(s,i,l))}catch(p){return g(p)}}let D=16384;class M{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(i){let l=this._back,p=l;l._elements.length===D-1&&(p={_elements:[],_next:void 0}),l._elements.push(i),p!==l&&(this._back=p,l._next=p),++this._size}shift(){let i=this._front,l=i,p=this._cursor,b=p+1,T=i._elements,v=T[p];return b===D&&(l=i._next,b=0),--this._size,this._cursor=b,i!==l&&(this._front=l),T[p]=void 0,v}forEach(i){let l=this._cursor,p=this._front,b=p._elements;for(;(l!==b.length||p._next!==void 0)&&!(l===b.length&&(p=p._next,b=p._elements,l=0,b.length===0));)i(b[l]),++l}peek(){let i=this._front,l=this._cursor;return i._elements[l]}}let W=Symbol("[[AbortSteps]]"),z=Symbol("[[ErrorSteps]]"),y=Symbol("[[CancelSteps]]"),Z=Symbol("[[PullSteps]]"),N=Symbol("[[ReleaseSteps]]");function k(s,i){s._ownerReadableStream=i,i._reader=s,i._state==="readable"?Ae(s):i._state==="closed"?j(s):Q(s,i._storedError)}function ee(s,i){let l=s._ownerReadableStream;return ot(l,i)}function se(s){let i=s._ownerReadableStream;i._state==="readable"?ce(s,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):Qt(s,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),i._readableStreamController[N](),i._reader=void 0,s._ownerReadableStream=void 0}function oe(s){return new TypeError("Cannot "+s+" a stream using a released reader")}function Ae(s){s._closedPromise=h((i,l)=>{s._closedPromise_resolve=i,s._closedPromise_reject=l})}function Q(s,i){Ae(s),ce(s,i)}function j(s){Ae(s),ft(s)}function ce(s,i){s._closedPromise_reject!==void 0&&(B(s._closedPromise),s._closedPromise_reject(i),s._closedPromise_resolve=void 0,s._closedPromise_reject=void 0)}function Qt(s,i){Q(s,i)}function ft(s){s._closedPromise_resolve!==void 0&&(s._closedPromise_resolve(void 0),s._closedPromise_resolve=void 0,s._closedPromise_reject=void 0)}let ln=Number.isFinite||function(s){return typeof s=="number"&&isFinite(s)},Oi=Math.trunc||function(s){return s<0?Math.ceil(s):Math.floor(s)};function uo(s){return typeof s=="object"||typeof s=="function"}function Me(s,i){if(s!==void 0&&!uo(s))throw new TypeError(`${i} is not an object.`)}function De(s,i){if(typeof s!="function")throw new TypeError(`${i} is not a function.`)}function m(s){return typeof s=="object"&&s!==null||typeof s=="function"}function c(s,i){if(!m(s))throw new TypeError(`${i} is not an object.`)}function P(s,i,l){if(s===void 0)throw new TypeError(`Parameter ${i} is required in '${l}'.`)}function w(s,i,l){if(s===void 0)throw new TypeError(`${i} is required in '${l}'.`)}function ne(s){return Number(s)}function ue(s){return s===0?0:s}function de(s){return ue(Oi(s))}function we(s,i){let p=Number.MAX_SAFE_INTEGER,b=Number(s);if(b=ue(b),!ln(b))throw new TypeError(`${i} is not a finite number`);if(b=de(b),b<0||b>p)throw new TypeError(`${i} is outside the accepted range of 0 to ${p}, inclusive`);return!ln(b)||b===0?0:b}function ke(s,i){if(!Kt(s))throw new TypeError(`${i} is not a ReadableStream.`)}function qe(s){return new Xe(s)}function fe(s,i){s._reader._readRequests.push(i)}function $e(s,i,l){let b=s._reader._readRequests.shift();l?b._closeSteps():b._chunkSteps(i)}function un(s){return s._reader._readRequests.length}function hs(s){let i=s._reader;return!(i===void 0||!nt(i))}class Xe{constructor(i){if(P(i,1,"ReadableStreamDefaultReader"),ke(i,"First parameter"),Zt(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");k(this,i),this._readRequests=new M}get closed(){return nt(this)?this._closedPromise:g(co("closed"))}cancel(i=void 0){return nt(this)?this._ownerReadableStream===void 0?g(oe("cancel")):ee(this,i):g(co("cancel"))}read(){if(!nt(this))return g(co("read"));if(this._ownerReadableStream===void 0)return g(oe("read from"));let i,l,p=h((T,v)=>{i=T,l=v});return ps(this,{_chunkSteps:T=>i({value:T,done:!1}),_closeSteps:()=>i({value:void 0,done:!0}),_errorSteps:T=>l(T)}),p}releaseLock(){if(!nt(this))throw co("releaseLock");this._ownerReadableStream!==void 0&&Ff(this)}}Object.defineProperties(Xe.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),o(Xe.prototype.cancel,"cancel"),o(Xe.prototype.read,"read"),o(Xe.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Xe.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function nt(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_readRequests")?!1:s instanceof Xe}function ps(s,i){let l=s._ownerReadableStream;l._disturbed=!0,l._state==="closed"?i._closeSteps():l._state==="errored"?i._errorSteps(l._storedError):l._readableStreamController[Z](i)}function Ff(s){se(s);let i=new TypeError("Reader was released");$l(s,i)}function $l(s,i){let l=s._readRequests;s._readRequests=new M,l.forEach(p=>{p._errorSteps(i)})}function co(s){return new TypeError(`ReadableStreamDefaultReader.prototype.${s} can only be used on a ReadableStreamDefaultReader`)}let Bf=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class Ul{constructor(i,l){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=i,this._preventCancel=l}next(){let i=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?C(this._ongoingPromise,i,i):i(),this._ongoingPromise}return(i){let l=()=>this._returnSteps(i);return this._ongoingPromise?C(this._ongoingPromise,l,l):l()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let i=this._reader,l,p,b=h((v,q)=>{l=v,p=q});return ps(i,{_chunkSteps:v=>{this._ongoingPromise=void 0,L(()=>l({value:v,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,se(i),l({value:void 0,done:!0})},_errorSteps:v=>{this._ongoingPromise=void 0,this._isFinished=!0,se(i),p(v)}}),b}_returnSteps(i){if(this._isFinished)return Promise.resolve({value:i,done:!0});this._isFinished=!0;let l=this._reader;if(!this._preventCancel){let p=ee(l,i);return se(l),C(p,()=>({value:i,done:!0}))}return se(l),f({value:i,done:!0})}}let Wl={next(){return jl(this)?this._asyncIteratorImpl.next():g(Hl("next"))},return(s){return jl(this)?this._asyncIteratorImpl.return(s):g(Hl("return"))}};Object.setPrototypeOf(Wl,Bf);function Nf(s,i){let l=qe(s),p=new Ul(l,i),b=Object.create(Wl);return b._asyncIteratorImpl=p,b}function jl(s){if(!t(s)||!Object.prototype.hasOwnProperty.call(s,"_asyncIteratorImpl"))return!1;try{return s._asyncIteratorImpl instanceof Ul}catch{return!1}}function Hl(s){return new TypeError(`ReadableStreamAsyncIterator.${s} can only be used on a ReadableSteamAsyncIterator`)}let Vl=Number.isNaN||function(s){return s!==s};var Di,ki,Li;function bs(s){return s.slice()}function zl(s,i,l,p,b){new Uint8Array(s).set(new Uint8Array(l,p,b),i)}let Pt=s=>(typeof s.transfer=="function"?Pt=i=>i.transfer():typeof structuredClone=="function"?Pt=i=>structuredClone(i,{transfer:[i]}):Pt=i=>i,Pt(s)),Gt=s=>(typeof s.detached=="boolean"?Gt=i=>i.detached:Gt=i=>i.byteLength===0,Gt(s));function Ql(s,i,l){if(s.slice)return s.slice(i,l);let p=l-i,b=new ArrayBuffer(p);return zl(b,0,s,i,p),b}function fo(s,i){let l=s[i];if(l!=null){if(typeof l!="function")throw new TypeError(`${String(i)} is not a function`);return l}}function Mf(s){let i={[Symbol.iterator]:()=>s.iterator},l=(async function*(){return yield*i})(),p=l.next;return{iterator:l,nextMethod:p,done:!1}}let Fi=(Li=(Di=Symbol.asyncIterator)!==null&&Di!==void 0?Di:(ki=Symbol.for)===null||ki===void 0?void 0:ki.call(Symbol,"Symbol.asyncIterator"))!==null&&Li!==void 0?Li:"@@asyncIterator";function Gl(s,i="sync",l){if(l===void 0)if(i==="async"){if(l=fo(s,Fi),l===void 0){let T=fo(s,Symbol.iterator),v=Gl(s,"sync",T);return Mf(v)}}else l=fo(s,Symbol.iterator);if(l===void 0)throw new TypeError("The object is not iterable");let p=E(l,s,[]);if(!t(p))throw new TypeError("The iterator method must return an object");let b=p.next;return{iterator:p,nextMethod:b,done:!1}}function qf(s){let i=E(s.nextMethod,s.iterator,[]);if(!t(i))throw new TypeError("The iterator.next() method must return an object");return i}function $f(s){return!!s.done}function Uf(s){return s.value}function Wf(s){return!(typeof s!="number"||Vl(s)||s<0)}function Yl(s){let i=Ql(s.buffer,s.byteOffset,s.byteOffset+s.byteLength);return new Uint8Array(i)}function Bi(s){let i=s._queue.shift();return s._queueTotalSize-=i.size,s._queueTotalSize<0&&(s._queueTotalSize=0),i.value}function Ni(s,i,l){if(!Wf(l)||l===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");s._queue.push({value:i,size:l}),s._queueTotalSize+=l}function jf(s){return s._queue.peek().value}function Yt(s){s._queue=new M,s._queueTotalSize=0}function Xl(s){return s===DataView}function Hf(s){return Xl(s.constructor)}function Vf(s){return Xl(s)?1:s.BYTES_PER_ELEMENT}class Rr{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Mi(this))throw ji("view");return this._view}respond(i){if(!Mi(this))throw ji("respond");if(P(i,1,"respond"),i=we(i,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Gt(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");bo(this._associatedReadableByteStreamController,i)}respondWithNewView(i){if(!Mi(this))throw ji("respondWithNewView");if(P(i,1,"respondWithNewView"),!ArrayBuffer.isView(i))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Gt(i.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");go(this._associatedReadableByteStreamController,i)}}Object.defineProperties(Rr.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),o(Rr.prototype.respond,"respond"),o(Rr.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Rr.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Ct{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Ar(this))throw ys("byobRequest");return Wi(this)}get desiredSize(){if(!Ar(this))throw ys("desiredSize");return iu(this)}close(){if(!Ar(this))throw ys("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let i=this._controlledReadableByteStream._state;if(i!=="readable")throw new TypeError(`The stream (in ${i} state) is not in the readable state and cannot be closed`);gs(this)}enqueue(i){if(!Ar(this))throw ys("enqueue");if(P(i,1,"enqueue"),!ArrayBuffer.isView(i))throw new TypeError("chunk must be an array buffer view");if(i.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(i.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let l=this._controlledReadableByteStream._state;if(l!=="readable")throw new TypeError(`The stream (in ${l} state) is not in the readable state and cannot be enqueued to`);po(this,i)}error(i=void 0){if(!Ar(this))throw ys("error");Je(this,i)}[y](i){Jl(this),Yt(this);let l=this._cancelAlgorithm(i);return ho(this),l}[Z](i){let l=this._controlledReadableByteStream;if(this._queueTotalSize>0){ou(this,i);return}let p=this._autoAllocateChunkSize;if(p!==void 0){let b;try{b=new ArrayBuffer(p)}catch(v){i._errorSteps(v);return}let T={buffer:b,bufferByteLength:p,byteOffset:0,byteLength:p,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(T)}fe(l,i),Tr(this)}[N](){if(this._pendingPullIntos.length>0){let i=this._pendingPullIntos.peek();i.readerType="none",this._pendingPullIntos=new M,this._pendingPullIntos.push(i)}}}Object.defineProperties(Ct.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),o(Ct.prototype.close,"close"),o(Ct.prototype.enqueue,"enqueue"),o(Ct.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ct.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Ar(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_controlledReadableByteStream")?!1:s instanceof Ct}function Mi(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_associatedReadableByteStreamController")?!1:s instanceof Rr}function Tr(s){if(!Xf(s))return;if(s._pulling){s._pullAgain=!0;return}s._pulling=!0;let l=s._pullAlgorithm();I(l,()=>(s._pulling=!1,s._pullAgain&&(s._pullAgain=!1,Tr(s)),null),p=>(Je(s,p),null))}function Jl(s){$i(s),s._pendingPullIntos=new M}function qi(s,i){let l=!1;s._state==="closed"&&(l=!0);let p=Kl(i);i.readerType==="default"?$e(s,p,l):rm(s,p,l)}function Kl(s){let i=s.bytesFilled,l=s.elementSize;return new s.viewConstructor(s.buffer,s.byteOffset,i/l)}function mo(s,i,l,p){s._queue.push({buffer:i,byteOffset:l,byteLength:p}),s._queueTotalSize+=p}function Zl(s,i,l,p){let b;try{b=Ql(i,l,l+p)}catch(T){throw Je(s,T),T}mo(s,b,0,p)}function eu(s,i){i.bytesFilled>0&&Zl(s,i.buffer,i.byteOffset,i.bytesFilled),cn(s)}function tu(s,i){let l=Math.min(s._queueTotalSize,i.byteLength-i.bytesFilled),p=i.bytesFilled+l,b=l,T=!1,v=p%i.elementSize,q=p-v;q>=i.minimumFill&&(b=q-i.bytesFilled,T=!0);let Y=s._queue;for(;b>0;){let H=Y.peek(),X=Math.min(b,H.byteLength),te=i.byteOffset+i.bytesFilled;zl(i.buffer,te,H.buffer,H.byteOffset,X),H.byteLength===X?Y.shift():(H.byteOffset+=X,H.byteLength-=X),s._queueTotalSize-=X,ru(s,X,i),b-=X}return T}function ru(s,i,l){l.bytesFilled+=i}function nu(s){s._queueTotalSize===0&&s._closeRequested?(ho(s),Ts(s._controlledReadableByteStream)):Tr(s)}function $i(s){s._byobRequest!==null&&(s._byobRequest._associatedReadableByteStreamController=void 0,s._byobRequest._view=null,s._byobRequest=null)}function Ui(s){for(;s._pendingPullIntos.length>0;){if(s._queueTotalSize===0)return;let i=s._pendingPullIntos.peek();tu(s,i)&&(cn(s),qi(s._controlledReadableByteStream,i))}}function zf(s){let i=s._controlledReadableByteStream._reader;for(;i._readRequests.length>0;){if(s._queueTotalSize===0)return;let l=i._readRequests.shift();ou(s,l)}}function Qf(s,i,l,p){let b=s._controlledReadableByteStream,T=i.constructor,v=Vf(T),{byteOffset:q,byteLength:Y}=i,H=l*v,X;try{X=Pt(i.buffer)}catch(ie){p._errorSteps(ie);return}let te={buffer:X,bufferByteLength:X.byteLength,byteOffset:q,byteLength:Y,bytesFilled:0,minimumFill:H,elementSize:v,viewConstructor:T,readerType:"byob"};if(s._pendingPullIntos.length>0){s._pendingPullIntos.push(te),uu(b,p);return}if(b._state==="closed"){let ie=new T(te.buffer,te.byteOffset,0);p._closeSteps(ie);return}if(s._queueTotalSize>0){if(tu(s,te)){let ie=Kl(te);nu(s),p._chunkSteps(ie);return}if(s._closeRequested){let ie=new TypeError("Insufficient bytes to fill elements in the given buffer");Je(s,ie),p._errorSteps(ie);return}}s._pendingPullIntos.push(te),uu(b,p),Tr(s)}function Gf(s,i){i.readerType==="none"&&cn(s);let l=s._controlledReadableByteStream;if(Hi(l))for(;cu(l)>0;){let p=cn(s);qi(l,p)}}function Yf(s,i,l){if(ru(s,i,l),l.readerType==="none"){eu(s,l),Ui(s);return}if(l.bytesFilled<l.minimumFill)return;cn(s);let p=l.bytesFilled%l.elementSize;if(p>0){let b=l.byteOffset+l.bytesFilled;Zl(s,l.buffer,b-p,p)}l.bytesFilled-=p,qi(s._controlledReadableByteStream,l),Ui(s)}function su(s,i){let l=s._pendingPullIntos.peek();$i(s),s._controlledReadableByteStream._state==="closed"?Gf(s,l):Yf(s,i,l),Tr(s)}function cn(s){return s._pendingPullIntos.shift()}function Xf(s){let i=s._controlledReadableByteStream;return i._state!=="readable"||s._closeRequested||!s._started?!1:!!(hs(i)&&un(i)>0||Hi(i)&&cu(i)>0||iu(s)>0)}function ho(s){s._pullAlgorithm=void 0,s._cancelAlgorithm=void 0}function gs(s){let i=s._controlledReadableByteStream;if(!(s._closeRequested||i._state!=="readable")){if(s._queueTotalSize>0){s._closeRequested=!0;return}if(s._pendingPullIntos.length>0){let l=s._pendingPullIntos.peek();if(l.bytesFilled%l.elementSize!==0){let p=new TypeError("Insufficient bytes to fill elements in the given buffer");throw Je(s,p),p}}ho(s),Ts(i)}}function po(s,i){let l=s._controlledReadableByteStream;if(s._closeRequested||l._state!=="readable")return;let{buffer:p,byteOffset:b,byteLength:T}=i;if(Gt(p))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let v=Pt(p);if(s._pendingPullIntos.length>0){let q=s._pendingPullIntos.peek();if(Gt(q.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");$i(s),q.buffer=Pt(q.buffer),q.readerType==="none"&&eu(s,q)}if(hs(l))if(zf(s),un(l)===0)mo(s,v,b,T);else{s._pendingPullIntos.length>0&&cn(s);let q=new Uint8Array(v,b,T);$e(l,q,!1)}else Hi(l)?(mo(s,v,b,T),Ui(s)):mo(s,v,b,T);Tr(s)}function Je(s,i){let l=s._controlledReadableByteStream;l._state==="readable"&&(Jl(s),Yt(s),ho(s),Lu(l,i))}function ou(s,i){let l=s._queue.shift();s._queueTotalSize-=l.byteLength,nu(s);let p=new Uint8Array(l.buffer,l.byteOffset,l.byteLength);i._chunkSteps(p)}function Wi(s){if(s._byobRequest===null&&s._pendingPullIntos.length>0){let i=s._pendingPullIntos.peek(),l=new Uint8Array(i.buffer,i.byteOffset+i.bytesFilled,i.byteLength-i.bytesFilled),p=Object.create(Rr.prototype);Kf(p,s,l),s._byobRequest=p}return s._byobRequest}function iu(s){let i=s._controlledReadableByteStream._state;return i==="errored"?null:i==="closed"?0:s._strategyHWM-s._queueTotalSize}function bo(s,i){let l=s._pendingPullIntos.peek();if(s._controlledReadableByteStream._state==="closed"){if(i!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(i===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(l.bytesFilled+i>l.byteLength)throw new RangeError("bytesWritten out of range")}l.buffer=Pt(l.buffer),su(s,i)}function go(s,i){let l=s._pendingPullIntos.peek();if(s._controlledReadableByteStream._state==="closed"){if(i.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(i.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(l.byteOffset+l.bytesFilled!==i.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(l.bufferByteLength!==i.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(l.bytesFilled+i.byteLength>l.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let b=i.byteLength;l.buffer=Pt(i.buffer),su(s,b)}function au(s,i,l,p,b,T,v){i._controlledReadableByteStream=s,i._pullAgain=!1,i._pulling=!1,i._byobRequest=null,i._queue=i._queueTotalSize=void 0,Yt(i),i._closeRequested=!1,i._started=!1,i._strategyHWM=T,i._pullAlgorithm=p,i._cancelAlgorithm=b,i._autoAllocateChunkSize=v,i._pendingPullIntos=new M,s._readableStreamController=i;let q=l();I(f(q),()=>(i._started=!0,Tr(i),null),Y=>(Je(i,Y),null))}function Jf(s,i,l){let p=Object.create(Ct.prototype),b,T,v;i.start!==void 0?b=()=>i.start(p):b=()=>{},i.pull!==void 0?T=()=>i.pull(p):T=()=>f(void 0),i.cancel!==void 0?v=Y=>i.cancel(Y):v=()=>f(void 0);let q=i.autoAllocateChunkSize;if(q===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");au(s,p,b,T,v,l,q)}function Kf(s,i,l){s._associatedReadableByteStreamController=i,s._view=l}function ji(s){return new TypeError(`ReadableStreamBYOBRequest.prototype.${s} can only be used on a ReadableStreamBYOBRequest`)}function ys(s){return new TypeError(`ReadableByteStreamController.prototype.${s} can only be used on a ReadableByteStreamController`)}function Zf(s,i){Me(s,i);let l=s?.mode;return{mode:l===void 0?void 0:em(l,`${i} has member 'mode' that`)}}function em(s,i){if(s=`${s}`,s!=="byob")throw new TypeError(`${i} '${s}' is not a valid enumeration value for ReadableStreamReaderMode`);return s}function tm(s,i){var l;Me(s,i);let p=(l=s?.min)!==null&&l!==void 0?l:1;return{min:we(p,`${i} has member 'min' that`)}}function lu(s){return new Xt(s)}function uu(s,i){s._reader._readIntoRequests.push(i)}function rm(s,i,l){let b=s._reader._readIntoRequests.shift();l?b._closeSteps(i):b._chunkSteps(i)}function cu(s){return s._reader._readIntoRequests.length}function Hi(s){let i=s._reader;return!(i===void 0||!Er(i))}class Xt{constructor(i){if(P(i,1,"ReadableStreamBYOBReader"),ke(i,"First parameter"),Zt(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Ar(i._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");k(this,i),this._readIntoRequests=new M}get closed(){return Er(this)?this._closedPromise:g(yo("closed"))}cancel(i=void 0){return Er(this)?this._ownerReadableStream===void 0?g(oe("cancel")):ee(this,i):g(yo("cancel"))}read(i,l={}){if(!Er(this))return g(yo("read"));if(!ArrayBuffer.isView(i))return g(new TypeError("view must be an array buffer view"));if(i.byteLength===0)return g(new TypeError("view must have non-zero byteLength"));if(i.buffer.byteLength===0)return g(new TypeError("view's buffer must have non-zero byteLength"));if(Gt(i.buffer))return g(new TypeError("view's buffer has been detached"));let p;try{p=tm(l,"options")}catch(H){return g(H)}let b=p.min;if(b===0)return g(new TypeError("options.min must be greater than 0"));if(Hf(i)){if(b>i.byteLength)return g(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(b>i.length)return g(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return g(oe("read from"));let T,v,q=h((H,X)=>{T=H,v=X});return du(this,i,b,{_chunkSteps:H=>T({value:H,done:!1}),_closeSteps:H=>T({value:H,done:!0}),_errorSteps:H=>v(H)}),q}releaseLock(){if(!Er(this))throw yo("releaseLock");this._ownerReadableStream!==void 0&&nm(this)}}Object.defineProperties(Xt.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),o(Xt.prototype.cancel,"cancel"),o(Xt.prototype.read,"read"),o(Xt.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Xt.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Er(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_readIntoRequests")?!1:s instanceof Xt}function du(s,i,l,p){let b=s._ownerReadableStream;b._disturbed=!0,b._state==="errored"?p._errorSteps(b._storedError):Qf(b._readableStreamController,i,l,p)}function nm(s){se(s);let i=new TypeError("Reader was released");fu(s,i)}function fu(s,i){let l=s._readIntoRequests;s._readIntoRequests=new M,l.forEach(p=>{p._errorSteps(i)})}function yo(s){return new TypeError(`ReadableStreamBYOBReader.prototype.${s} can only be used on a ReadableStreamBYOBReader`)}function _s(s,i){let{highWaterMark:l}=s;if(l===void 0)return i;if(Vl(l)||l<0)throw new RangeError("Invalid highWaterMark");return l}function _o(s){let{size:i}=s;return i||(()=>1)}function wo(s,i){Me(s,i);let l=s?.highWaterMark,p=s?.size;return{highWaterMark:l===void 0?void 0:ne(l),size:p===void 0?void 0:sm(p,`${i} has member 'size' that`)}}function sm(s,i){return De(s,i),l=>ne(s(l))}function om(s,i){Me(s,i);let l=s?.abort,p=s?.close,b=s?.start,T=s?.type,v=s?.write;return{abort:l===void 0?void 0:im(l,s,`${i} has member 'abort' that`),close:p===void 0?void 0:am(p,s,`${i} has member 'close' that`),start:b===void 0?void 0:lm(b,s,`${i} has member 'start' that`),write:v===void 0?void 0:um(v,s,`${i} has member 'write' that`),type:T}}function im(s,i,l){return De(s,l),p=>F(s,i,[p])}function am(s,i,l){return De(s,l),()=>F(s,i,[])}function lm(s,i,l){return De(s,l),p=>E(s,i,[p])}function um(s,i,l){return De(s,l),(p,b)=>F(s,i,[p,b])}function mu(s,i){if(!dn(s))throw new TypeError(`${i} is not a WritableStream.`)}function cm(s){if(typeof s!="object"||s===null)return!1;try{return typeof s.aborted=="boolean"}catch{return!1}}let dm=typeof AbortController=="function";function fm(){if(dm)return new AbortController}class Jt{constructor(i={},l={}){i===void 0?i=null:c(i,"First parameter");let p=wo(l,"Second parameter"),b=om(i,"First parameter");if(pu(this),b.type!==void 0)throw new RangeError("Invalid type is specified");let v=_o(p),q=_s(p,1);vm(this,b,q,v)}get locked(){if(!dn(this))throw Eo("locked");return fn(this)}abort(i=void 0){return dn(this)?fn(this)?g(new TypeError("Cannot abort a stream that already has a writer")):So(this,i):g(Eo("abort"))}close(){return dn(this)?fn(this)?g(new TypeError("Cannot close a stream that already has a writer")):mt(this)?g(new TypeError("Cannot close an already-closing stream")):bu(this):g(Eo("close"))}getWriter(){if(!dn(this))throw Eo("getWriter");return hu(this)}}Object.defineProperties(Jt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),o(Jt.prototype.abort,"abort"),o(Jt.prototype.close,"close"),o(Jt.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Jt.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function hu(s){return new xt(s)}function mm(s,i,l,p,b=1,T=()=>1){let v=Object.create(Jt.prototype);pu(v);let q=Object.create(mn.prototype);return Ru(v,q,s,i,l,p,b,T),v}function pu(s){s._state="writable",s._storedError=void 0,s._writer=void 0,s._writableStreamController=void 0,s._writeRequests=new M,s._inFlightWriteRequest=void 0,s._closeRequest=void 0,s._inFlightCloseRequest=void 0,s._pendingAbortRequest=void 0,s._backpressure=!1}function dn(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_writableStreamController")?!1:s instanceof Jt}function fn(s){return s._writer!==void 0}function So(s,i){var l;if(s._state==="closed"||s._state==="errored")return f(void 0);s._writableStreamController._abortReason=i,(l=s._writableStreamController._abortController)===null||l===void 0||l.abort(i);let p=s._state;if(p==="closed"||p==="errored")return f(void 0);if(s._pendingAbortRequest!==void 0)return s._pendingAbortRequest._promise;let b=!1;p==="erroring"&&(b=!0,i=void 0);let T=h((v,q)=>{s._pendingAbortRequest={_promise:void 0,_resolve:v,_reject:q,_reason:i,_wasAlreadyErroring:b}});return s._pendingAbortRequest._promise=T,b||zi(s,i),T}function bu(s){let i=s._state;if(i==="closed"||i==="errored")return g(new TypeError(`The stream (in ${i} state) is not in the writable state and cannot be closed`));let l=h((b,T)=>{let v={_resolve:b,_reject:T};s._closeRequest=v}),p=s._writer;return p!==void 0&&s._backpressure&&i==="writable"&&ea(p),Im(s._writableStreamController),l}function hm(s){return h((l,p)=>{let b={_resolve:l,_reject:p};s._writeRequests.push(b)})}function Vi(s,i){if(s._state==="writable"){zi(s,i);return}Qi(s)}function zi(s,i){let l=s._writableStreamController;s._state="erroring",s._storedError=i;let p=s._writer;p!==void 0&&yu(p,i),!_m(s)&&l._started&&Qi(s)}function Qi(s){s._state="errored",s._writableStreamController[z]();let i=s._storedError;if(s._writeRequests.forEach(b=>{b._reject(i)}),s._writeRequests=new M,s._pendingAbortRequest===void 0){Ro(s);return}let l=s._pendingAbortRequest;if(s._pendingAbortRequest=void 0,l._wasAlreadyErroring){l._reject(i),Ro(s);return}let p=s._writableStreamController[W](l._reason);I(p,()=>(l._resolve(),Ro(s),null),b=>(l._reject(b),Ro(s),null))}function pm(s){s._inFlightWriteRequest._resolve(void 0),s._inFlightWriteRequest=void 0}function bm(s,i){s._inFlightWriteRequest._reject(i),s._inFlightWriteRequest=void 0,Vi(s,i)}function gm(s){s._inFlightCloseRequest._resolve(void 0),s._inFlightCloseRequest=void 0,s._state==="erroring"&&(s._storedError=void 0,s._pendingAbortRequest!==void 0&&(s._pendingAbortRequest._resolve(),s._pendingAbortRequest=void 0)),s._state="closed";let l=s._writer;l!==void 0&&vu(l)}function ym(s,i){s._inFlightCloseRequest._reject(i),s._inFlightCloseRequest=void 0,s._pendingAbortRequest!==void 0&&(s._pendingAbortRequest._reject(i),s._pendingAbortRequest=void 0),Vi(s,i)}function mt(s){return!(s._closeRequest===void 0&&s._inFlightCloseRequest===void 0)}function _m(s){return!(s._inFlightWriteRequest===void 0&&s._inFlightCloseRequest===void 0)}function wm(s){s._inFlightCloseRequest=s._closeRequest,s._closeRequest=void 0}function Sm(s){s._inFlightWriteRequest=s._writeRequests.shift()}function Ro(s){s._closeRequest!==void 0&&(s._closeRequest._reject(s._storedError),s._closeRequest=void 0);let i=s._writer;i!==void 0&&Ki(i,s._storedError)}function Gi(s,i){let l=s._writer;l!==void 0&&i!==s._backpressure&&(i?Lm(l):ea(l)),s._backpressure=i}class xt{constructor(i){if(P(i,1,"WritableStreamDefaultWriter"),mu(i,"First parameter"),fn(i))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=i,i._writer=this;let l=i._state;if(l==="writable")!mt(i)&&i._backpressure?Io(this):Iu(this),vo(this);else if(l==="erroring")Zi(this,i._storedError),vo(this);else if(l==="closed")Iu(this),Dm(this);else{let p=i._storedError;Zi(this,p),Eu(this,p)}}get closed(){return vr(this)?this._closedPromise:g(Ir("closed"))}get desiredSize(){if(!vr(this))throw Ir("desiredSize");if(this._ownerWritableStream===void 0)throw Ss("desiredSize");return Em(this)}get ready(){return vr(this)?this._readyPromise:g(Ir("ready"))}abort(i=void 0){return vr(this)?this._ownerWritableStream===void 0?g(Ss("abort")):Rm(this,i):g(Ir("abort"))}close(){if(!vr(this))return g(Ir("close"));let i=this._ownerWritableStream;return i===void 0?g(Ss("close")):mt(i)?g(new TypeError("Cannot close an already-closing stream")):gu(this)}releaseLock(){if(!vr(this))throw Ir("releaseLock");this._ownerWritableStream!==void 0&&_u(this)}write(i=void 0){return vr(this)?this._ownerWritableStream===void 0?g(Ss("write to")):wu(this,i):g(Ir("write"))}}Object.defineProperties(xt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),o(xt.prototype.abort,"abort"),o(xt.prototype.close,"close"),o(xt.prototype.releaseLock,"releaseLock"),o(xt.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(xt.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function vr(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_ownerWritableStream")?!1:s instanceof xt}function Rm(s,i){let l=s._ownerWritableStream;return So(l,i)}function gu(s){let i=s._ownerWritableStream;return bu(i)}function Am(s){let i=s._ownerWritableStream,l=i._state;return mt(i)||l==="closed"?f(void 0):l==="errored"?g(i._storedError):gu(s)}function Tm(s,i){s._closedPromiseState==="pending"?Ki(s,i):km(s,i)}function yu(s,i){s._readyPromiseState==="pending"?Pu(s,i):Fm(s,i)}function Em(s){let i=s._ownerWritableStream,l=i._state;return l==="errored"||l==="erroring"?null:l==="closed"?0:Au(i._writableStreamController)}function _u(s){let i=s._ownerWritableStream,l=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");yu(s,l),Tm(s,l),i._writer=void 0,s._ownerWritableStream=void 0}function wu(s,i){let l=s._ownerWritableStream,p=l._writableStreamController,b=Pm(p,i);if(l!==s._ownerWritableStream)return g(Ss("write to"));let T=l._state;if(T==="errored")return g(l._storedError);if(mt(l)||T==="closed")return g(new TypeError("The stream is closing or closed and cannot be written to"));if(T==="erroring")return g(l._storedError);let v=hm(l);return Cm(p,i,b),v}let Su={};class mn{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!Yi(this))throw Ji("abortReason");return this._abortReason}get signal(){if(!Yi(this))throw Ji("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(i=void 0){if(!Yi(this))throw Ji("error");this._controlledWritableStream._state==="writable"&&Tu(this,i)}[W](i){let l=this._abortAlgorithm(i);return Ao(this),l}[z](){Yt(this)}}Object.defineProperties(mn.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(mn.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Yi(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_controlledWritableStream")?!1:s instanceof mn}function Ru(s,i,l,p,b,T,v,q){i._controlledWritableStream=s,s._writableStreamController=i,i._queue=void 0,i._queueTotalSize=void 0,Yt(i),i._abortReason=void 0,i._abortController=fm(),i._started=!1,i._strategySizeAlgorithm=q,i._strategyHWM=v,i._writeAlgorithm=p,i._closeAlgorithm=b,i._abortAlgorithm=T;let Y=Xi(i);Gi(s,Y);let H=l(),X=f(H);I(X,()=>(i._started=!0,To(i),null),te=>(i._started=!0,Vi(s,te),null))}function vm(s,i,l,p){let b=Object.create(mn.prototype),T,v,q,Y;i.start!==void 0?T=()=>i.start(b):T=()=>{},i.write!==void 0?v=H=>i.write(H,b):v=()=>f(void 0),i.close!==void 0?q=()=>i.close():q=()=>f(void 0),i.abort!==void 0?Y=H=>i.abort(H):Y=()=>f(void 0),Ru(s,b,T,v,q,Y,l,p)}function Ao(s){s._writeAlgorithm=void 0,s._closeAlgorithm=void 0,s._abortAlgorithm=void 0,s._strategySizeAlgorithm=void 0}function Im(s){Ni(s,Su,0),To(s)}function Pm(s,i){try{return s._strategySizeAlgorithm(i)}catch(l){return ws(s,l),1}}function Au(s){return s._strategyHWM-s._queueTotalSize}function Cm(s,i,l){try{Ni(s,i,l)}catch(b){ws(s,b);return}let p=s._controlledWritableStream;if(!mt(p)&&p._state==="writable"){let b=Xi(s);Gi(p,b)}To(s)}function To(s){let i=s._controlledWritableStream;if(!s._started||i._inFlightWriteRequest!==void 0)return;if(i._state==="erroring"){Qi(i);return}if(s._queue.length===0)return;let p=jf(s);p===Su?xm(s):Om(s,p)}function ws(s,i){s._controlledWritableStream._state==="writable"&&Tu(s,i)}function xm(s){let i=s._controlledWritableStream;wm(i),Bi(s);let l=s._closeAlgorithm();Ao(s),I(l,()=>(gm(i),null),p=>(ym(i,p),null))}function Om(s,i){let l=s._controlledWritableStream;Sm(l);let p=s._writeAlgorithm(i);I(p,()=>{pm(l);let b=l._state;if(Bi(s),!mt(l)&&b==="writable"){let T=Xi(s);Gi(l,T)}return To(s),null},b=>(l._state==="writable"&&Ao(s),bm(l,b),null))}function Xi(s){return Au(s)<=0}function Tu(s,i){let l=s._controlledWritableStream;Ao(s),zi(l,i)}function Eo(s){return new TypeError(`WritableStream.prototype.${s} can only be used on a WritableStream`)}function Ji(s){return new TypeError(`WritableStreamDefaultController.prototype.${s} can only be used on a WritableStreamDefaultController`)}function Ir(s){return new TypeError(`WritableStreamDefaultWriter.prototype.${s} can only be used on a WritableStreamDefaultWriter`)}function Ss(s){return new TypeError("Cannot "+s+" a stream using a released writer")}function vo(s){s._closedPromise=h((i,l)=>{s._closedPromise_resolve=i,s._closedPromise_reject=l,s._closedPromiseState="pending"})}function Eu(s,i){vo(s),Ki(s,i)}function Dm(s){vo(s),vu(s)}function Ki(s,i){s._closedPromise_reject!==void 0&&(B(s._closedPromise),s._closedPromise_reject(i),s._closedPromise_resolve=void 0,s._closedPromise_reject=void 0,s._closedPromiseState="rejected")}function km(s,i){Eu(s,i)}function vu(s){s._closedPromise_resolve!==void 0&&(s._closedPromise_resolve(void 0),s._closedPromise_resolve=void 0,s._closedPromise_reject=void 0,s._closedPromiseState="resolved")}function Io(s){s._readyPromise=h((i,l)=>{s._readyPromise_resolve=i,s._readyPromise_reject=l}),s._readyPromiseState="pending"}function Zi(s,i){Io(s),Pu(s,i)}function Iu(s){Io(s),ea(s)}function Pu(s,i){s._readyPromise_reject!==void 0&&(B(s._readyPromise),s._readyPromise_reject(i),s._readyPromise_resolve=void 0,s._readyPromise_reject=void 0,s._readyPromiseState="rejected")}function Lm(s){Io(s)}function Fm(s,i){Zi(s,i)}function ea(s){s._readyPromise_resolve!==void 0&&(s._readyPromise_resolve(void 0),s._readyPromise_resolve=void 0,s._readyPromise_reject=void 0,s._readyPromiseState="fulfilled")}function Bm(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let ta=Bm();function Nm(s){if(!(typeof s=="function"||typeof s=="object")||s.name!=="DOMException")return!1;try{return new s,!0}catch{return!1}}function Mm(){let s=ta?.DOMException;return Nm(s)?s:void 0}function qm(){let s=function(l,p){this.message=l||"",this.name=p||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return o(s,"DOMException"),s.prototype=Object.create(Error.prototype),Object.defineProperty(s.prototype,"constructor",{value:s,writable:!0,configurable:!0}),s}let $m=Mm()||qm();function Cu(s,i,l,p,b,T){let v=qe(s),q=hu(i);s._disturbed=!0;let Y=!1,H=f(void 0);return h((X,te)=>{let ie;if(T!==void 0){if(ie=()=>{let G=T.reason!==void 0?T.reason:new $m("Aborted","AbortError"),re=[];p||re.push(()=>i._state==="writable"?So(i,G):f(void 0)),b||re.push(()=>s._state==="readable"?ot(s,G):f(void 0)),Le(()=>Promise.all(re.map(ae=>ae())),!0,G)},T.aborted){ie();return}T.addEventListener("abort",ie)}function it(){return h((G,re)=>{function ae(Ue){Ue?G():S(gn(),ae,re)}ae(!1)})}function gn(){return Y?f(!0):S(q._readyPromise,()=>h((G,re)=>{ps(v,{_chunkSteps:ae=>{H=S(wu(q,ae),void 0,e),G(!1)},_closeSteps:()=>G(!0),_errorSteps:re})}))}if(Dt(s,v._closedPromise,G=>(p?Ke(!0,G):Le(()=>So(i,G),!0,G),null)),Dt(i,q._closedPromise,G=>(b?Ke(!0,G):Le(()=>ot(s,G),!0,G),null)),Pe(s,v._closedPromise,()=>(l?Ke():Le(()=>Am(q)),null)),mt(i)||i._state==="closed"){let G=new TypeError("the destination writable stream closed before all data could be piped to it");b?Ke(!0,G):Le(()=>ot(s,G),!0,G)}B(it());function tr(){let G=H;return S(H,()=>G!==H?tr():void 0)}function Dt(G,re,ae){G._state==="errored"?ae(G._storedError):A(re,ae)}function Pe(G,re,ae){G._state==="closed"?ae():_(re,ae)}function Le(G,re,ae){if(Y)return;Y=!0,i._state==="writable"&&!mt(i)?_(tr(),Ue):Ue();function Ue(){return I(G(),()=>kt(re,ae),yn=>kt(!0,yn)),null}}function Ke(G,re){Y||(Y=!0,i._state==="writable"&&!mt(i)?_(tr(),()=>kt(G,re)):kt(G,re))}function kt(G,re){return _u(q),se(v),T!==void 0&&T.removeEventListener("abort",ie),G?te(re):X(void 0),null}})}class Ot{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Po(this))throw xo("desiredSize");return ra(this)}close(){if(!Po(this))throw xo("close");if(!pn(this))throw new TypeError("The stream is not in a state that permits close");Pr(this)}enqueue(i=void 0){if(!Po(this))throw xo("enqueue");if(!pn(this))throw new TypeError("The stream is not in a state that permits enqueue");return hn(this,i)}error(i=void 0){if(!Po(this))throw xo("error");st(this,i)}[y](i){Yt(this);let l=this._cancelAlgorithm(i);return Co(this),l}[Z](i){let l=this._controlledReadableStream;if(this._queue.length>0){let p=Bi(this);this._closeRequested&&this._queue.length===0?(Co(this),Ts(l)):Rs(this),i._chunkSteps(p)}else fe(l,i),Rs(this)}[N](){}}Object.defineProperties(Ot.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),o(Ot.prototype.close,"close"),o(Ot.prototype.enqueue,"enqueue"),o(Ot.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ot.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function Po(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_controlledReadableStream")?!1:s instanceof Ot}function Rs(s){if(!xu(s))return;if(s._pulling){s._pullAgain=!0;return}s._pulling=!0;let l=s._pullAlgorithm();I(l,()=>(s._pulling=!1,s._pullAgain&&(s._pullAgain=!1,Rs(s)),null),p=>(st(s,p),null))}function xu(s){let i=s._controlledReadableStream;return!pn(s)||!s._started?!1:!!(Zt(i)&&un(i)>0||ra(s)>0)}function Co(s){s._pullAlgorithm=void 0,s._cancelAlgorithm=void 0,s._strategySizeAlgorithm=void 0}function Pr(s){if(!pn(s))return;let i=s._controlledReadableStream;s._closeRequested=!0,s._queue.length===0&&(Co(s),Ts(i))}function hn(s,i){if(!pn(s))return;let l=s._controlledReadableStream;if(Zt(l)&&un(l)>0)$e(l,i,!1);else{let p;try{p=s._strategySizeAlgorithm(i)}catch(b){throw st(s,b),b}try{Ni(s,i,p)}catch(b){throw st(s,b),b}}Rs(s)}function st(s,i){let l=s._controlledReadableStream;l._state==="readable"&&(Yt(s),Co(s),Lu(l,i))}function ra(s){let i=s._controlledReadableStream._state;return i==="errored"?null:i==="closed"?0:s._strategyHWM-s._queueTotalSize}function Um(s){return!xu(s)}function pn(s){let i=s._controlledReadableStream._state;return!s._closeRequested&&i==="readable"}function Ou(s,i,l,p,b,T,v){i._controlledReadableStream=s,i._queue=void 0,i._queueTotalSize=void 0,Yt(i),i._started=!1,i._closeRequested=!1,i._pullAgain=!1,i._pulling=!1,i._strategySizeAlgorithm=v,i._strategyHWM=T,i._pullAlgorithm=p,i._cancelAlgorithm=b,s._readableStreamController=i;let q=l();I(f(q),()=>(i._started=!0,Rs(i),null),Y=>(st(i,Y),null))}function Wm(s,i,l,p){let b=Object.create(Ot.prototype),T,v,q;i.start!==void 0?T=()=>i.start(b):T=()=>{},i.pull!==void 0?v=()=>i.pull(b):v=()=>f(void 0),i.cancel!==void 0?q=Y=>i.cancel(Y):q=()=>f(void 0),Ou(s,b,T,v,q,l,p)}function xo(s){return new TypeError(`ReadableStreamDefaultController.prototype.${s} can only be used on a ReadableStreamDefaultController`)}function jm(s,i){return Ar(s._readableStreamController)?Vm(s):Hm(s)}function Hm(s,i){let l=qe(s),p=!1,b=!1,T=!1,v=!1,q,Y,H,X,te,ie=h(Pe=>{te=Pe});function it(){return p?(b=!0,f(void 0)):(p=!0,ps(l,{_chunkSteps:Le=>{L(()=>{b=!1;let Ke=Le,kt=Le;T||hn(H._readableStreamController,Ke),v||hn(X._readableStreamController,kt),p=!1,b&&it()})},_closeSteps:()=>{p=!1,T||Pr(H._readableStreamController),v||Pr(X._readableStreamController),(!T||!v)&&te(void 0)},_errorSteps:()=>{p=!1}}),f(void 0))}function gn(Pe){if(T=!0,q=Pe,v){let Le=bs([q,Y]),Ke=ot(s,Le);te(Ke)}return ie}function tr(Pe){if(v=!0,Y=Pe,T){let Le=bs([q,Y]),Ke=ot(s,Le);te(Ke)}return ie}function Dt(){}return H=As(Dt,it,gn),X=As(Dt,it,tr),A(l._closedPromise,Pe=>(st(H._readableStreamController,Pe),st(X._readableStreamController,Pe),(!T||!v)&&te(void 0),null)),[H,X]}function Vm(s){let i=qe(s),l=!1,p=!1,b=!1,T=!1,v=!1,q,Y,H,X,te,ie=h(G=>{te=G});function it(G){A(G._closedPromise,re=>(G!==i||(Je(H._readableStreamController,re),Je(X._readableStreamController,re),(!T||!v)&&te(void 0)),null))}function gn(){Er(i)&&(se(i),i=qe(s),it(i)),ps(i,{_chunkSteps:re=>{L(()=>{p=!1,b=!1;let ae=re,Ue=re;if(!T&&!v)try{Ue=Yl(re)}catch(yn){Je(H._readableStreamController,yn),Je(X._readableStreamController,yn),te(ot(s,yn));return}T||po(H._readableStreamController,ae),v||po(X._readableStreamController,Ue),l=!1,p?Dt():b&&Pe()})},_closeSteps:()=>{l=!1,T||gs(H._readableStreamController),v||gs(X._readableStreamController),H._readableStreamController._pendingPullIntos.length>0&&bo(H._readableStreamController,0),X._readableStreamController._pendingPullIntos.length>0&&bo(X._readableStreamController,0),(!T||!v)&&te(void 0)},_errorSteps:()=>{l=!1}})}function tr(G,re){nt(i)&&(se(i),i=lu(s),it(i));let ae=re?X:H,Ue=re?H:X;du(i,G,1,{_chunkSteps:_n=>{L(()=>{p=!1,b=!1;let wn=re?v:T;if(re?T:v)wn||go(ae._readableStreamController,_n);else{let Qu;try{Qu=Yl(_n)}catch(aa){Je(ae._readableStreamController,aa),Je(Ue._readableStreamController,aa),te(ot(s,aa));return}wn||go(ae._readableStreamController,_n),po(Ue._readableStreamController,Qu)}l=!1,p?Dt():b&&Pe()})},_closeSteps:_n=>{l=!1;let wn=re?v:T,Mo=re?T:v;wn||gs(ae._readableStreamController),Mo||gs(Ue._readableStreamController),_n!==void 0&&(wn||go(ae._readableStreamController,_n),!Mo&&Ue._readableStreamController._pendingPullIntos.length>0&&bo(Ue._readableStreamController,0)),(!wn||!Mo)&&te(void 0)},_errorSteps:()=>{l=!1}})}function Dt(){if(l)return p=!0,f(void 0);l=!0;let G=Wi(H._readableStreamController);return G===null?gn():tr(G._view,!1),f(void 0)}function Pe(){if(l)return b=!0,f(void 0);l=!0;let G=Wi(X._readableStreamController);return G===null?gn():tr(G._view,!0),f(void 0)}function Le(G){if(T=!0,q=G,v){let re=bs([q,Y]),ae=ot(s,re);te(ae)}return ie}function Ke(G){if(v=!0,Y=G,T){let re=bs([q,Y]),ae=ot(s,re);te(ae)}return ie}function kt(){}return H=ku(kt,Dt,Le),X=ku(kt,Pe,Ke),it(i),[H,X]}function zm(s){return t(s)&&typeof s.getReader<"u"}function Qm(s){return zm(s)?Ym(s.getReader()):Gm(s)}function Gm(s){let i,l=Gl(s,"async"),p=e;function b(){let v;try{v=qf(l)}catch(Y){return g(Y)}let q=f(v);return C(q,Y=>{if(!t(Y))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if($f(Y))Pr(i._readableStreamController);else{let X=Uf(Y);hn(i._readableStreamController,X)}})}function T(v){let q=l.iterator,Y;try{Y=fo(q,"return")}catch(te){return g(te)}if(Y===void 0)return f(void 0);let H;try{H=E(Y,q,[v])}catch(te){return g(te)}let X=f(H);return C(X,te=>{if(!t(te))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return i=As(p,b,T,0),i}function Ym(s){let i,l=e;function p(){let T;try{T=s.read()}catch(v){return g(v)}return C(T,v=>{if(!t(v))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(v.done)Pr(i._readableStreamController);else{let q=v.value;hn(i._readableStreamController,q)}})}function b(T){try{return f(s.cancel(T))}catch(v){return g(v)}}return i=As(l,p,b,0),i}function Xm(s,i){Me(s,i);let l=s,p=l?.autoAllocateChunkSize,b=l?.cancel,T=l?.pull,v=l?.start,q=l?.type;return{autoAllocateChunkSize:p===void 0?void 0:we(p,`${i} has member 'autoAllocateChunkSize' that`),cancel:b===void 0?void 0:Jm(b,l,`${i} has member 'cancel' that`),pull:T===void 0?void 0:Km(T,l,`${i} has member 'pull' that`),start:v===void 0?void 0:Zm(v,l,`${i} has member 'start' that`),type:q===void 0?void 0:eh(q,`${i} has member 'type' that`)}}function Jm(s,i,l){return De(s,l),p=>F(s,i,[p])}function Km(s,i,l){return De(s,l),p=>F(s,i,[p])}function Zm(s,i,l){return De(s,l),p=>E(s,i,[p])}function eh(s,i){if(s=`${s}`,s!=="bytes")throw new TypeError(`${i} '${s}' is not a valid enumeration value for ReadableStreamType`);return s}function th(s,i){return Me(s,i),{preventCancel:!!s?.preventCancel}}function Du(s,i){Me(s,i);let l=s?.preventAbort,p=s?.preventCancel,b=s?.preventClose,T=s?.signal;return T!==void 0&&rh(T,`${i} has member 'signal' that`),{preventAbort:!!l,preventCancel:!!p,preventClose:!!b,signal:T}}function rh(s,i){if(!cm(s))throw new TypeError(`${i} is not an AbortSignal.`)}function nh(s,i){Me(s,i);let l=s?.readable;w(l,"readable","ReadableWritablePair"),ke(l,`${i} has member 'readable' that`);let p=s?.writable;return w(p,"writable","ReadableWritablePair"),mu(p,`${i} has member 'writable' that`),{readable:l,writable:p}}class ve{constructor(i={},l={}){i===void 0?i=null:c(i,"First parameter");let p=wo(l,"Second parameter"),b=Xm(i,"First parameter");if(na(this),b.type==="bytes"){if(p.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let T=_s(p,0);Jf(this,b,T)}else{let T=_o(p),v=_s(p,1);Wm(this,b,v,T)}}get locked(){if(!Kt(this))throw Cr("locked");return Zt(this)}cancel(i=void 0){return Kt(this)?Zt(this)?g(new TypeError("Cannot cancel a stream that already has a reader")):ot(this,i):g(Cr("cancel"))}getReader(i=void 0){if(!Kt(this))throw Cr("getReader");return Zf(i,"First parameter").mode===void 0?qe(this):lu(this)}pipeThrough(i,l={}){if(!Kt(this))throw Cr("pipeThrough");P(i,1,"pipeThrough");let p=nh(i,"First parameter"),b=Du(l,"Second parameter");if(Zt(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(fn(p.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let T=Cu(this,p.writable,b.preventClose,b.preventAbort,b.preventCancel,b.signal);return B(T),p.readable}pipeTo(i,l={}){if(!Kt(this))return g(Cr("pipeTo"));if(i===void 0)return g("Parameter 1 is required in 'pipeTo'.");if(!dn(i))return g(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let p;try{p=Du(l,"Second parameter")}catch(b){return g(b)}return Zt(this)?g(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):fn(i)?g(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Cu(this,i,p.preventClose,p.preventAbort,p.preventCancel,p.signal)}tee(){if(!Kt(this))throw Cr("tee");let i=jm(this);return bs(i)}values(i=void 0){if(!Kt(this))throw Cr("values");let l=th(i,"First parameter");return Nf(this,l.preventCancel)}[Fi](i){return this.values(i)}static from(i){return Qm(i)}}Object.defineProperties(ve,{from:{enumerable:!0}}),Object.defineProperties(ve.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),o(ve.from,"from"),o(ve.prototype.cancel,"cancel"),o(ve.prototype.getReader,"getReader"),o(ve.prototype.pipeThrough,"pipeThrough"),o(ve.prototype.pipeTo,"pipeTo"),o(ve.prototype.tee,"tee"),o(ve.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ve.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(ve.prototype,Fi,{value:ve.prototype.values,writable:!0,configurable:!0});function As(s,i,l,p=1,b=()=>1){let T=Object.create(ve.prototype);na(T);let v=Object.create(Ot.prototype);return Ou(T,v,s,i,l,p,b),T}function ku(s,i,l){let p=Object.create(ve.prototype);na(p);let b=Object.create(Ct.prototype);return au(p,b,s,i,l,0,void 0),p}function na(s){s._state="readable",s._reader=void 0,s._storedError=void 0,s._disturbed=!1}function Kt(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_readableStreamController")?!1:s instanceof ve}function Zt(s){return s._reader!==void 0}function ot(s,i){if(s._disturbed=!0,s._state==="closed")return f(void 0);if(s._state==="errored")return g(s._storedError);Ts(s);let l=s._reader;if(l!==void 0&&Er(l)){let b=l._readIntoRequests;l._readIntoRequests=new M,b.forEach(T=>{T._closeSteps(void 0)})}let p=s._readableStreamController[y](i);return C(p,e)}function Ts(s){s._state="closed";let i=s._reader;if(i!==void 0&&(ft(i),nt(i))){let l=i._readRequests;i._readRequests=new M,l.forEach(p=>{p._closeSteps()})}}function Lu(s,i){s._state="errored",s._storedError=i;let l=s._reader;l!==void 0&&(ce(l,i),nt(l)?$l(l,i):fu(l,i))}function Cr(s){return new TypeError(`ReadableStream.prototype.${s} can only be used on a ReadableStream`)}function Fu(s,i){Me(s,i);let l=s?.highWaterMark;return w(l,"highWaterMark","QueuingStrategyInit"),{highWaterMark:ne(l)}}let Bu=s=>s.byteLength;o(Bu,"size");class Oo{constructor(i){P(i,1,"ByteLengthQueuingStrategy"),i=Fu(i,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!Mu(this))throw Nu("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Mu(this))throw Nu("size");return Bu}}Object.defineProperties(Oo.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Oo.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Nu(s){return new TypeError(`ByteLengthQueuingStrategy.prototype.${s} can only be used on a ByteLengthQueuingStrategy`)}function Mu(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_byteLengthQueuingStrategyHighWaterMark")?!1:s instanceof Oo}let qu=()=>1;o(qu,"size");class Do{constructor(i){P(i,1,"CountQueuingStrategy"),i=Fu(i,"First parameter"),this._countQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!Uu(this))throw $u("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Uu(this))throw $u("size");return qu}}Object.defineProperties(Do.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Do.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function $u(s){return new TypeError(`CountQueuingStrategy.prototype.${s} can only be used on a CountQueuingStrategy`)}function Uu(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_countQueuingStrategyHighWaterMark")?!1:s instanceof Do}function sh(s,i){Me(s,i);let l=s?.cancel,p=s?.flush,b=s?.readableType,T=s?.start,v=s?.transform,q=s?.writableType;return{cancel:l===void 0?void 0:lh(l,s,`${i} has member 'cancel' that`),flush:p===void 0?void 0:oh(p,s,`${i} has member 'flush' that`),readableType:b,start:T===void 0?void 0:ih(T,s,`${i} has member 'start' that`),transform:v===void 0?void 0:ah(v,s,`${i} has member 'transform' that`),writableType:q}}function oh(s,i,l){return De(s,l),p=>F(s,i,[p])}function ih(s,i,l){return De(s,l),p=>E(s,i,[p])}function ah(s,i,l){return De(s,l),(p,b)=>F(s,i,[p,b])}function lh(s,i,l){return De(s,l),p=>F(s,i,[p])}class ko{constructor(i={},l={},p={}){i===void 0&&(i=null);let b=wo(l,"Second parameter"),T=wo(p,"Third parameter"),v=sh(i,"First parameter");if(v.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(v.writableType!==void 0)throw new RangeError("Invalid writableType specified");let q=_s(T,0),Y=_o(T),H=_s(b,1),X=_o(b),te,ie=h(it=>{te=it});uh(this,ie,H,X,q,Y),dh(this,v),v.start!==void 0?te(v.start(this._transformStreamController)):te(void 0)}get readable(){if(!Wu(this))throw zu("readable");return this._readable}get writable(){if(!Wu(this))throw zu("writable");return this._writable}}Object.defineProperties(ko.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ko.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function uh(s,i,l,p,b,T){function v(){return i}function q(ie){return hh(s,ie)}function Y(ie){return ph(s,ie)}function H(){return bh(s)}s._writable=mm(v,q,H,Y,l,p);function X(){return gh(s)}function te(ie){return yh(s,ie)}s._readable=As(v,X,te,b,T),s._backpressure=void 0,s._backpressureChangePromise=void 0,s._backpressureChangePromise_resolve=void 0,Lo(s,!0),s._transformStreamController=void 0}function Wu(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_transformStreamController")?!1:s instanceof ko}function ju(s,i){st(s._readable._readableStreamController,i),sa(s,i)}function sa(s,i){Bo(s._transformStreamController),ws(s._writable._writableStreamController,i),oa(s)}function oa(s){s._backpressure&&Lo(s,!1)}function Lo(s,i){s._backpressureChangePromise!==void 0&&s._backpressureChangePromise_resolve(),s._backpressureChangePromise=h(l=>{s._backpressureChangePromise_resolve=l}),s._backpressure=i}class er{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Fo(this))throw No("desiredSize");let i=this._controlledTransformStream._readable._readableStreamController;return ra(i)}enqueue(i=void 0){if(!Fo(this))throw No("enqueue");Hu(this,i)}error(i=void 0){if(!Fo(this))throw No("error");fh(this,i)}terminate(){if(!Fo(this))throw No("terminate");mh(this)}}Object.defineProperties(er.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),o(er.prototype.enqueue,"enqueue"),o(er.prototype.error,"error"),o(er.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(er.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Fo(s){return!t(s)||!Object.prototype.hasOwnProperty.call(s,"_controlledTransformStream")?!1:s instanceof er}function ch(s,i,l,p,b){i._controlledTransformStream=s,s._transformStreamController=i,i._transformAlgorithm=l,i._flushAlgorithm=p,i._cancelAlgorithm=b,i._finishPromise=void 0,i._finishPromise_resolve=void 0,i._finishPromise_reject=void 0}function dh(s,i){let l=Object.create(er.prototype),p,b,T;i.transform!==void 0?p=v=>i.transform(v,l):p=v=>{try{return Hu(l,v),f(void 0)}catch(q){return g(q)}},i.flush!==void 0?b=()=>i.flush(l):b=()=>f(void 0),i.cancel!==void 0?T=v=>i.cancel(v):T=()=>f(void 0),ch(s,l,p,b,T)}function Bo(s){s._transformAlgorithm=void 0,s._flushAlgorithm=void 0,s._cancelAlgorithm=void 0}function Hu(s,i){let l=s._controlledTransformStream,p=l._readable._readableStreamController;if(!pn(p))throw new TypeError("Readable side is not in a state that permits enqueue");try{hn(p,i)}catch(T){throw sa(l,T),l._readable._storedError}Um(p)!==l._backpressure&&Lo(l,!0)}function fh(s,i){ju(s._controlledTransformStream,i)}function Vu(s,i){let l=s._transformAlgorithm(i);return C(l,void 0,p=>{throw ju(s._controlledTransformStream,p),p})}function mh(s){let i=s._controlledTransformStream,l=i._readable._readableStreamController;Pr(l);let p=new TypeError("TransformStream terminated");sa(i,p)}function hh(s,i){let l=s._transformStreamController;if(s._backpressure){let p=s._backpressureChangePromise;return C(p,()=>{let b=s._writable;if(b._state==="erroring")throw b._storedError;return Vu(l,i)})}return Vu(l,i)}function ph(s,i){let l=s._transformStreamController;if(l._finishPromise!==void 0)return l._finishPromise;let p=s._readable;l._finishPromise=h((T,v)=>{l._finishPromise_resolve=T,l._finishPromise_reject=v});let b=l._cancelAlgorithm(i);return Bo(l),I(b,()=>(p._state==="errored"?bn(l,p._storedError):(st(p._readableStreamController,i),ia(l)),null),T=>(st(p._readableStreamController,T),bn(l,T),null)),l._finishPromise}function bh(s){let i=s._transformStreamController;if(i._finishPromise!==void 0)return i._finishPromise;let l=s._readable;i._finishPromise=h((b,T)=>{i._finishPromise_resolve=b,i._finishPromise_reject=T});let p=i._flushAlgorithm();return Bo(i),I(p,()=>(l._state==="errored"?bn(i,l._storedError):(Pr(l._readableStreamController),ia(i)),null),b=>(st(l._readableStreamController,b),bn(i,b),null)),i._finishPromise}function gh(s){return Lo(s,!1),s._backpressureChangePromise}function yh(s,i){let l=s._transformStreamController;if(l._finishPromise!==void 0)return l._finishPromise;let p=s._writable;l._finishPromise=h((T,v)=>{l._finishPromise_resolve=T,l._finishPromise_reject=v});let b=l._cancelAlgorithm(i);return Bo(l),I(b,()=>(p._state==="errored"?bn(l,p._storedError):(ws(p._writableStreamController,i),oa(s),ia(l)),null),T=>(ws(p._writableStreamController,T),oa(s),bn(l,T),null)),l._finishPromise}function No(s){return new TypeError(`TransformStreamDefaultController.prototype.${s} can only be used on a TransformStreamDefaultController`)}function ia(s){s._finishPromise_resolve!==void 0&&(s._finishPromise_resolve(),s._finishPromise_resolve=void 0,s._finishPromise_reject=void 0)}function bn(s,i){s._finishPromise_reject!==void 0&&(B(s._finishPromise),s._finishPromise_reject(i),s._finishPromise_resolve=void 0,s._finishPromise_reject=void 0)}function zu(s){return new TypeError(`TransformStream.prototype.${s} can only be used on a TransformStream`)}r.ByteLengthQueuingStrategy=Oo,r.CountQueuingStrategy=Do,r.ReadableByteStreamController=Ct,r.ReadableStream=ve,r.ReadableStreamBYOBReader=Xt,r.ReadableStreamBYOBRequest=Rr,r.ReadableStreamDefaultController=Ot,r.ReadableStreamDefaultReader=Xe,r.TransformStream=ko,r.TransformStreamDefaultController=er,r.WritableStream=Jt,r.WritableStreamDefaultController=mn,r.WritableStreamDefaultWriter=xt}))});var Zu=me(()=>{if(!globalThis.ReadableStream)try{let r=require("node:process"),{emitWarning:e}=r;try{r.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),r.emitWarning=e}catch(t){throw r.emitWarning=e,t}}catch{Object.assign(globalThis,Ku())}try{let{Blob:r}=require("buffer");r&&!r.prototype.stream&&(r.prototype.stream=function(t){let n=0,o=this;return new ReadableStream({type:"bytes",async pull(a){let d=await o.slice(n,Math.min(o.size,n+65536)).arrayBuffer();n+=d.byteLength,a.enqueue(new Uint8Array(d)),n===o.size&&a.close()}})})}catch{}});async function*la(r,e=!0){for(let t of r)if("stream"in t)yield*t.stream();else if(ArrayBuffer.isView(t))if(e){let n=t.byteOffset,o=t.byteOffset+t.byteLength;for(;n!==o;){let a=Math.min(o-n,ec),u=t.buffer.slice(n,n+a);n+=u.byteLength,yield new Uint8Array(u)}}else yield t;else{let n=0,o=t;for(;n!==o.size;){let u=await o.slice(n,Math.min(o.size,n+ec)).arrayBuffer();n+=u.byteLength,yield new Uint8Array(u)}}}var ty,ec,tc,vh,Lt,vs=Es(()=>{ty=ht(Zu(),1);ec=65536;tc=class ua{#e=[];#t="";#r=0;#n="transparent";constructor(e=[],t={}){if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof t!="object"&&typeof t!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");t===null&&(t={});let n=new TextEncoder;for(let a of e){let u;ArrayBuffer.isView(a)?u=new Uint8Array(a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength)):a instanceof ArrayBuffer?u=new Uint8Array(a.slice(0)):a instanceof ua?u=a:u=n.encode(`${a}`),this.#r+=ArrayBuffer.isView(u)?u.byteLength:u.size,this.#e.push(u)}this.#n=`${t.endings===void 0?"transparent":t.endings}`;let o=t.type===void 0?"":String(t.type);this.#t=/^[\x20-\x7E]*$/.test(o)?o:""}get size(){return this.#r}get type(){return this.#t}async text(){let e=new TextDecoder,t="";for await(let n of la(this.#e,!1))t+=e.decode(n,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){let e=new Uint8Array(this.size),t=0;for await(let n of la(this.#e,!1))e.set(n,t),t+=n.length;return e.buffer}stream(){let e=la(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(t){let n=await e.next();n.done?t.close():t.enqueue(n.value)},async cancel(){await e.return()}})}slice(e=0,t=this.size,n=""){let{size:o}=this,a=e<0?Math.max(o+e,0):Math.min(e,o),u=t<0?Math.max(o+t,0):Math.min(t,o),d=Math.max(u-a,0),h=this.#e,f=[],g=0;for(let I of h){if(g>=d)break;let _=ArrayBuffer.isView(I)?I.byteLength:I.size;if(a&&_<=a)a-=_,u-=_;else{let A;ArrayBuffer.isView(I)?(A=I.subarray(a,Math.min(_,u)),g+=A.byteLength):(A=I.slice(a,Math.min(_,u)),g+=A.size),u-=_,f.push(A),a=0}}let S=new ua([],{type:String(n).toLowerCase()});return S.#r=d,S.#e=f,S}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(tc.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});vh=tc,Lt=vh});var Ih,Ph,Sn,ca=Es(()=>{vs();Ih=class extends Lt{#e=0;#t="";constructor(e,t,n={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,n),n===null&&(n={});let o=n.lastModified===void 0?Date.now():Number(n.lastModified);Number.isNaN(o)||(this.#e=o),this.#t=String(t)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof Lt&&/^(File)$/.test(e[Symbol.toStringTag])}},Ph=Ih,Sn=Ph});function sc(r,e=Lt){var t=`${rc()}${rc()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),n=[],o=`--${t}\r
Content-Disposition: form-data; name="`;return r.forEach((a,u)=>typeof a=="string"?n.push(o+da(u)+`"\r
\r
${a.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):n.push(o+da(u)+`"; filename="${da(a.name,1)}"\r
Content-Type: ${a.type||"application/octet-stream"}\r
\r
`,a,`\r
`)),n.push(`--${t}--`),new e(n,{type:"multipart/form-data; boundary="+t})}var Is,Ch,xh,rc,Oh,nc,da,xr,Or,Uo=Es(()=>{vs();ca();({toStringTag:Is,iterator:Ch,hasInstance:xh}=Symbol),rc=Math.random,Oh="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),nc=(r,e,t)=>(r+="",/^(Blob|File)$/.test(e&&e[Is])?[(t=t!==void 0?t+"":e[Is]=="File"?e.name:"blob",r),e.name!==t||e[Is]=="blob"?new Sn([e],t,e):e]:[r,e+""]),da=(r,e)=>(e?r:r.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),xr=(r,e,t)=>{if(e.length<t)throw new TypeError(`Failed to execute '${r}' on 'FormData': ${t} arguments required, but only ${e.length} present.`)},Or=class{#e=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[Is](){return"FormData"}[Ch](){return this.entries()}static[xh](e){return e&&typeof e=="object"&&e[Is]==="FormData"&&!Oh.some(t=>typeof e[t]!="function")}append(...e){xr("append",arguments,2),this.#e.push(nc(...e))}delete(e){xr("delete",arguments,1),e+="",this.#e=this.#e.filter(([t])=>t!==e)}get(e){xr("get",arguments,1),e+="";for(var t=this.#e,n=t.length,o=0;o<n;o++)if(t[o][0]===e)return t[o][1];return null}getAll(e,t){return xr("getAll",arguments,1),t=[],e+="",this.#e.forEach(n=>n[0]===e&&t.push(n[1])),t}has(e){return xr("has",arguments,1),e+="",this.#e.some(t=>t[0]===e)}forEach(e,t){xr("forEach",arguments,1);for(var[n,o]of this)e.call(t,o,n,this)}set(...e){xr("set",arguments,2);var t=[],n=!0;e=nc(...e),this.#e.forEach(o=>{o[0]===e[0]?n&&(n=!t.push(e)):t.push(o)}),n&&t.push(e),this.#e=t}*entries(){yield*this.#e}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}}});var uc=me((hy,lc)=>{if(!globalThis.DOMException)try{let{MessageChannel:r}=require("worker_threads"),e=new r().port1,t=new ArrayBuffer;e.postMessage(t,[t,t])}catch(r){r.constructor.name==="DOMException"&&(globalThis.DOMException=r.constructor)}lc.exports=globalThis.DOMException});var jo,Dh,gy,ma=Es(()=>{jo=require("node:fs"),Dh=ht(uc(),1);ca();vs();({stat:gy}=jo.promises)});var dc={};Gu(dc,{toFormData:()=>qh});function Mh(r){let e=r.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let t=e[2]||e[3]||"",n=t.slice(t.lastIndexOf("\\")+1);return n=n.replace(/%22/g,'"'),n=n.replace(/&#(\d{4});/g,(o,a)=>String.fromCharCode(a)),n}async function qh(r,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let t=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!t)throw new TypeError("no or bad content-type header, no multipart boundary");let n=new ha(t[1]||t[2]),o,a,u,d,h,f,g=[],S=new Or,I=L=>{u+=B.decode(L,{stream:!0})},_=L=>{g.push(L)},A=()=>{let L=new Sn(g,f,{type:h});S.append(d,L)},C=()=>{S.append(d,u)},B=new TextDecoder("utf-8");B.decode(),n.onPartBegin=function(){n.onPartData=I,n.onPartEnd=C,o="",a="",u="",d="",h="",f=null,g.length=0},n.onHeaderField=function(L){o+=B.decode(L,{stream:!0})},n.onHeaderValue=function(L){a+=B.decode(L,{stream:!0})},n.onHeaderEnd=function(){if(a+=B.decode(),o=o.toLowerCase(),o==="content-disposition"){let L=a.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);L&&(d=L[2]||L[3]||""),f=Mh(a),f&&(n.onPartData=_,n.onPartEnd=A)}else o==="content-type"&&(h=a);a="",o=""};for await(let L of r)n.write(L);return n.end(),S}var pt,le,cc,rr,Ho,Vo,kh,Cs,Lh,Fh,Bh,Nh,Dr,ha,fc=Es(()=>{ma();Uo();pt=0,le={START_BOUNDARY:pt++,HEADER_FIELD_START:pt++,HEADER_FIELD:pt++,HEADER_VALUE_START:pt++,HEADER_VALUE:pt++,HEADER_VALUE_ALMOST_DONE:pt++,HEADERS_ALMOST_DONE:pt++,PART_DATA_START:pt++,PART_DATA:pt++,END:pt++},cc=1,rr={PART_BOUNDARY:cc,LAST_BOUNDARY:cc*=2},Ho=10,Vo=13,kh=32,Cs=45,Lh=58,Fh=97,Bh=122,Nh=r=>r|32,Dr=()=>{},ha=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=Dr,this.onHeaderField=Dr,this.onHeadersEnd=Dr,this.onHeaderValue=Dr,this.onPartBegin=Dr,this.onPartData=Dr,this.onPartEnd=Dr,this.boundaryChars={},e=`\r
--`+e;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n),this.boundaryChars[t[n]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=le.START_BOUNDARY}write(e){let t=0,n=e.length,o=this.index,{lookbehind:a,boundary:u,boundaryChars:d,index:h,state:f,flags:g}=this,S=this.boundary.length,I=S-1,_=e.length,A,C,B=D=>{this[D+"Mark"]=t},L=D=>{delete this[D+"Mark"]},E=(D,M,W,z)=>{(M===void 0||M!==W)&&this[D](z&&z.subarray(M,W))},F=(D,M)=>{let W=D+"Mark";W in this&&(M?(E(D,this[W],t,e),delete this[W]):(E(D,this[W],e.length,e),this[W]=0))};for(t=0;t<n;t++)switch(A=e[t],f){case le.START_BOUNDARY:if(h===u.length-2){if(A===Cs)g|=rr.LAST_BOUNDARY;else if(A!==Vo)return;h++;break}else if(h-1===u.length-2){if(g&rr.LAST_BOUNDARY&&A===Cs)f=le.END,g=0;else if(!(g&rr.LAST_BOUNDARY)&&A===Ho)h=0,E("onPartBegin"),f=le.HEADER_FIELD_START;else return;break}A!==u[h+2]&&(h=-2),A===u[h+2]&&h++;break;case le.HEADER_FIELD_START:f=le.HEADER_FIELD,B("onHeaderField"),h=0;case le.HEADER_FIELD:if(A===Vo){L("onHeaderField"),f=le.HEADERS_ALMOST_DONE;break}if(h++,A===Cs)break;if(A===Lh){if(h===1)return;F("onHeaderField",!0),f=le.HEADER_VALUE_START;break}if(C=Nh(A),C<Fh||C>Bh)return;break;case le.HEADER_VALUE_START:if(A===kh)break;B("onHeaderValue"),f=le.HEADER_VALUE;case le.HEADER_VALUE:A===Vo&&(F("onHeaderValue",!0),E("onHeaderEnd"),f=le.HEADER_VALUE_ALMOST_DONE);break;case le.HEADER_VALUE_ALMOST_DONE:if(A!==Ho)return;f=le.HEADER_FIELD_START;break;case le.HEADERS_ALMOST_DONE:if(A!==Ho)return;E("onHeadersEnd"),f=le.PART_DATA_START;break;case le.PART_DATA_START:f=le.PART_DATA,B("onPartData");case le.PART_DATA:if(o=h,h===0){for(t+=I;t<_&&!(e[t]in d);)t+=S;t-=I,A=e[t]}if(h<u.length)u[h]===A?(h===0&&F("onPartData",!0),h++):h=0;else if(h===u.length)h++,A===Vo?g|=rr.PART_BOUNDARY:A===Cs?g|=rr.LAST_BOUNDARY:h=0;else if(h-1===u.length)if(g&rr.PART_BOUNDARY){if(h=0,A===Ho){g&=~rr.PART_BOUNDARY,E("onPartEnd"),E("onPartBegin"),f=le.HEADER_FIELD_START;break}}else g&rr.LAST_BOUNDARY&&A===Cs?(E("onPartEnd"),f=le.END,g=0):h=0;if(h>0)a[h-1]=A;else if(o>0){let D=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);E("onPartData",0,o,D),o=0,B("onPartData"),t--}break;case le.END:break;default:throw new Error(`Unexpected state entered: ${f}`)}F("onHeaderField"),F("onHeaderValue"),F("onPartData"),this.index=h,this.state=f,this.flags=g}end(){if(this.state===le.HEADER_FIELD_START&&this.index===0||this.state===le.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==le.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});var ul=me(Ti=>{(function(r){r.parser=function(m,c){return new t(m,c)},r.SAXParser=t,r.SAXStream=f,r.createStream=h,r.MAX_BUFFER_LENGTH=64*1024;var e=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];r.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function t(m,c){if(!(this instanceof t))return new t(m,c);var P=this;o(P),P.q=P.c="",P.bufferCheckPosition=r.MAX_BUFFER_LENGTH,P.opt=c||{},P.opt.lowercase=P.opt.lowercase||P.opt.lowercasetags,P.looseCase=P.opt.lowercase?"toLowerCase":"toUpperCase",P.tags=[],P.closed=P.closedRoot=P.sawRoot=!1,P.tag=P.error=null,P.strict=!!m,P.noscript=!!(m||P.opt.noscript),P.state=y.BEGIN,P.strictEntities=P.opt.strictEntities,P.ENTITIES=P.strictEntities?Object.create(r.XML_ENTITIES):Object.create(r.ENTITIES),P.attribList=[],P.opt.xmlns&&(P.ns=Object.create(A)),P.trackPosition=P.opt.position!==!1,P.trackPosition&&(P.position=P.line=P.column=0),N(P,"onready")}Object.create||(Object.create=function(m){function c(){}c.prototype=m;var P=new c;return P}),Object.keys||(Object.keys=function(m){var c=[];for(var P in m)m.hasOwnProperty(P)&&c.push(P);return c});function n(m){for(var c=Math.max(r.MAX_BUFFER_LENGTH,10),P=0,w=0,ne=e.length;w<ne;w++){var ue=m[e[w]].length;if(ue>c)switch(e[w]){case"textNode":ee(m);break;case"cdata":k(m,"oncdata",m.cdata),m.cdata="";break;case"script":k(m,"onscript",m.script),m.script="";break;default:oe(m,"Max buffer length exceeded: "+e[w])}P=Math.max(P,ue)}var de=r.MAX_BUFFER_LENGTH-P;m.bufferCheckPosition=de+m.position}function o(m){for(var c=0,P=e.length;c<P;c++)m[e[c]]=""}function a(m){ee(m),m.cdata!==""&&(k(m,"oncdata",m.cdata),m.cdata=""),m.script!==""&&(k(m,"onscript",m.script),m.script="")}t.prototype={end:function(){Ae(this)},write:De,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){a(this)}};var u;try{u=require("stream").Stream}catch{u=function(){}}var d=r.EVENTS.filter(function(m){return m!=="error"&&m!=="end"});function h(m,c){return new f(m,c)}function f(m,c){if(!(this instanceof f))return new f(m,c);u.apply(this),this._parser=new t(m,c),this.writable=!0,this.readable=!0;var P=this;this._parser.onend=function(){P.emit("end")},this._parser.onerror=function(w){P.emit("error",w),P._parser.error=null},this._decoder=null,d.forEach(function(w){Object.defineProperty(P,"on"+w,{get:function(){return P._parser["on"+w]},set:function(ne){if(!ne)return P.removeAllListeners(w),P._parser["on"+w]=ne,ne;P.on(w,ne)},enumerable:!0,configurable:!1})})}f.prototype=Object.create(u.prototype,{constructor:{value:f}}),f.prototype.write=function(m){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(m)){if(!this._decoder){var c=require("string_decoder").StringDecoder;this._decoder=new c("utf8")}m=this._decoder.write(m)}return this._parser.write(m.toString()),this.emit("data",m),!0},f.prototype.end=function(m){return m&&m.length&&this.write(m),this._parser.end(),!0},f.prototype.on=function(m,c){var P=this;return!P._parser["on"+m]&&d.indexOf(m)!==-1&&(P._parser["on"+m]=function(){var w=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);w.splice(0,0,m),P.emit.apply(P,w)}),u.prototype.on.call(P,m,c)};var g="[CDATA[",S="DOCTYPE",I="http://www.w3.org/XML/1998/namespace",_="http://www.w3.org/2000/xmlns/",A={xml:I,xmlns:_},C=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,B=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,L=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,E=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function F(m){return m===" "||m===`
`||m==="\r"||m==="	"}function D(m){return m==='"'||m==="'"}function M(m){return m===">"||F(m)}function W(m,c){return m.test(c)}function z(m,c){return!W(m,c)}var y=0;r.STATE={BEGIN:y++,BEGIN_WHITESPACE:y++,TEXT:y++,TEXT_ENTITY:y++,OPEN_WAKA:y++,SGML_DECL:y++,SGML_DECL_QUOTED:y++,DOCTYPE:y++,DOCTYPE_QUOTED:y++,DOCTYPE_DTD:y++,DOCTYPE_DTD_QUOTED:y++,COMMENT_STARTING:y++,COMMENT:y++,COMMENT_ENDING:y++,COMMENT_ENDED:y++,CDATA:y++,CDATA_ENDING:y++,CDATA_ENDING_2:y++,PROC_INST:y++,PROC_INST_BODY:y++,PROC_INST_ENDING:y++,OPEN_TAG:y++,OPEN_TAG_SLASH:y++,ATTRIB:y++,ATTRIB_NAME:y++,ATTRIB_NAME_SAW_WHITE:y++,ATTRIB_VALUE:y++,ATTRIB_VALUE_QUOTED:y++,ATTRIB_VALUE_CLOSED:y++,ATTRIB_VALUE_UNQUOTED:y++,ATTRIB_VALUE_ENTITY_Q:y++,ATTRIB_VALUE_ENTITY_U:y++,CLOSE_TAG:y++,CLOSE_TAG_SAW_WHITE:y++,SCRIPT:y++,SCRIPT_ENDING:y++},r.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},r.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(r.ENTITIES).forEach(function(m){var c=r.ENTITIES[m],P=typeof c=="number"?String.fromCharCode(c):c;r.ENTITIES[m]=P});for(var Z in r.STATE)r.STATE[r.STATE[Z]]=Z;y=r.STATE;function N(m,c,P){m[c]&&m[c](P)}function k(m,c,P){m.textNode&&ee(m),N(m,c,P)}function ee(m){m.textNode=se(m.opt,m.textNode),m.textNode&&N(m,"ontext",m.textNode),m.textNode=""}function se(m,c){return m.trim&&(c=c.trim()),m.normalize&&(c=c.replace(/\s+/g," ")),c}function oe(m,c){return ee(m),m.trackPosition&&(c+=`
Line: `+m.line+`
Column: `+m.column+`
Char: `+m.c),c=new Error(c),m.error=c,N(m,"onerror",c),m}function Ae(m){return m.sawRoot&&!m.closedRoot&&Q(m,"Unclosed root tag"),m.state!==y.BEGIN&&m.state!==y.BEGIN_WHITESPACE&&m.state!==y.TEXT&&oe(m,"Unexpected end"),ee(m),m.c="",m.closed=!0,N(m,"onend"),t.call(m,m.strict,m.opt),m}function Q(m,c){if(typeof m!="object"||!(m instanceof t))throw new Error("bad call to strictFail");m.strict&&oe(m,c)}function j(m){m.strict||(m.tagName=m.tagName[m.looseCase]());var c=m.tags[m.tags.length-1]||m,P=m.tag={name:m.tagName,attributes:{}};m.opt.xmlns&&(P.ns=c.ns),m.attribList.length=0,k(m,"onopentagstart",P)}function ce(m,c){var P=m.indexOf(":"),w=P<0?["",m]:m.split(":"),ne=w[0],ue=w[1];return c&&m==="xmlns"&&(ne="xmlns",ue=""),{prefix:ne,local:ue}}function Qt(m){if(m.strict||(m.attribName=m.attribName[m.looseCase]()),m.attribList.indexOf(m.attribName)!==-1||m.tag.attributes.hasOwnProperty(m.attribName)){m.attribName=m.attribValue="";return}if(m.opt.xmlns){var c=ce(m.attribName,!0),P=c.prefix,w=c.local;if(P==="xmlns")if(w==="xml"&&m.attribValue!==I)Q(m,"xml: prefix must be bound to "+I+`
Actual: `+m.attribValue);else if(w==="xmlns"&&m.attribValue!==_)Q(m,"xmlns: prefix must be bound to "+_+`
Actual: `+m.attribValue);else{var ne=m.tag,ue=m.tags[m.tags.length-1]||m;ne.ns===ue.ns&&(ne.ns=Object.create(ue.ns)),ne.ns[w]=m.attribValue}m.attribList.push([m.attribName,m.attribValue])}else m.tag.attributes[m.attribName]=m.attribValue,k(m,"onattribute",{name:m.attribName,value:m.attribValue});m.attribName=m.attribValue=""}function ft(m,c){if(m.opt.xmlns){var P=m.tag,w=ce(m.tagName);P.prefix=w.prefix,P.local=w.local,P.uri=P.ns[w.prefix]||"",P.prefix&&!P.uri&&(Q(m,"Unbound namespace prefix: "+JSON.stringify(m.tagName)),P.uri=w.prefix);var ne=m.tags[m.tags.length-1]||m;P.ns&&ne.ns!==P.ns&&Object.keys(P.ns).forEach(function(nt){k(m,"onopennamespace",{prefix:nt,uri:P.ns[nt]})});for(var ue=0,de=m.attribList.length;ue<de;ue++){var we=m.attribList[ue],ke=we[0],qe=we[1],fe=ce(ke,!0),$e=fe.prefix,un=fe.local,hs=$e===""?"":P.ns[$e]||"",Xe={name:ke,value:qe,prefix:$e,local:un,uri:hs};$e&&$e!=="xmlns"&&!hs&&(Q(m,"Unbound namespace prefix: "+JSON.stringify($e)),Xe.uri=$e),m.tag.attributes[ke]=Xe,k(m,"onattribute",Xe)}m.attribList.length=0}m.tag.isSelfClosing=!!c,m.sawRoot=!0,m.tags.push(m.tag),k(m,"onopentag",m.tag),c||(!m.noscript&&m.tagName.toLowerCase()==="script"?m.state=y.SCRIPT:m.state=y.TEXT,m.tag=null,m.tagName=""),m.attribName=m.attribValue="",m.attribList.length=0}function ln(m){if(!m.tagName){Q(m,"Weird empty close tag."),m.textNode+="</>",m.state=y.TEXT;return}if(m.script){if(m.tagName!=="script"){m.script+="</"+m.tagName+">",m.tagName="",m.state=y.SCRIPT;return}k(m,"onscript",m.script),m.script=""}var c=m.tags.length,P=m.tagName;m.strict||(P=P[m.looseCase]());for(var w=P;c--;){var ne=m.tags[c];if(ne.name!==w)Q(m,"Unexpected close tag");else break}if(c<0){Q(m,"Unmatched closing tag: "+m.tagName),m.textNode+="</"+m.tagName+">",m.state=y.TEXT;return}m.tagName=P;for(var ue=m.tags.length;ue-- >c;){var de=m.tag=m.tags.pop();m.tagName=m.tag.name,k(m,"onclosetag",m.tagName);var we={};for(var ke in de.ns)we[ke]=de.ns[ke];var qe=m.tags[m.tags.length-1]||m;m.opt.xmlns&&de.ns!==qe.ns&&Object.keys(de.ns).forEach(function(fe){var $e=de.ns[fe];k(m,"onclosenamespace",{prefix:fe,uri:$e})})}c===0&&(m.closedRoot=!0),m.tagName=m.attribValue=m.attribName="",m.attribList.length=0,m.state=y.TEXT}function Oi(m){var c=m.entity,P=c.toLowerCase(),w,ne="";return m.ENTITIES[c]?m.ENTITIES[c]:m.ENTITIES[P]?m.ENTITIES[P]:(c=P,c.charAt(0)==="#"&&(c.charAt(1)==="x"?(c=c.slice(2),w=parseInt(c,16),ne=w.toString(16)):(c=c.slice(1),w=parseInt(c,10),ne=w.toString(10))),c=c.replace(/^0+/,""),isNaN(w)||ne.toLowerCase()!==c?(Q(m,"Invalid character entity"),"&"+m.entity+";"):String.fromCodePoint(w))}function uo(m,c){c==="<"?(m.state=y.OPEN_WAKA,m.startTagPosition=m.position):F(c)||(Q(m,"Non-whitespace before first tag."),m.textNode=c,m.state=y.TEXT)}function Me(m,c){var P="";return c<m.length&&(P=m.charAt(c)),P}function De(m){var c=this;if(this.error)throw this.error;if(c.closed)return oe(c,"Cannot write after close. Assign an onready handler.");if(m===null)return Ae(c);typeof m=="object"&&(m=m.toString());for(var P=0,w="";w=Me(m,P++),c.c=w,!!w;)switch(c.trackPosition&&(c.position++,w===`
`?(c.line++,c.column=0):c.column++),c.state){case y.BEGIN:if(c.state=y.BEGIN_WHITESPACE,w==="\uFEFF")continue;uo(c,w);continue;case y.BEGIN_WHITESPACE:uo(c,w);continue;case y.TEXT:if(c.sawRoot&&!c.closedRoot){for(var ne=P-1;w&&w!=="<"&&w!=="&";)w=Me(m,P++),w&&c.trackPosition&&(c.position++,w===`
`?(c.line++,c.column=0):c.column++);c.textNode+=m.substring(ne,P-1)}w==="<"&&!(c.sawRoot&&c.closedRoot&&!c.strict)?(c.state=y.OPEN_WAKA,c.startTagPosition=c.position):(!F(w)&&(!c.sawRoot||c.closedRoot)&&Q(c,"Text data outside of root node."),w==="&"?c.state=y.TEXT_ENTITY:c.textNode+=w);continue;case y.SCRIPT:w==="<"?c.state=y.SCRIPT_ENDING:c.script+=w;continue;case y.SCRIPT_ENDING:w==="/"?c.state=y.CLOSE_TAG:(c.script+="<"+w,c.state=y.SCRIPT);continue;case y.OPEN_WAKA:if(w==="!")c.state=y.SGML_DECL,c.sgmlDecl="";else if(!F(w))if(W(C,w))c.state=y.OPEN_TAG,c.tagName=w;else if(w==="/")c.state=y.CLOSE_TAG,c.tagName="";else if(w==="?")c.state=y.PROC_INST,c.procInstName=c.procInstBody="";else{if(Q(c,"Unencoded <"),c.startTagPosition+1<c.position){var ue=c.position-c.startTagPosition;w=new Array(ue).join(" ")+w}c.textNode+="<"+w,c.state=y.TEXT}continue;case y.SGML_DECL:(c.sgmlDecl+w).toUpperCase()===g?(k(c,"onopencdata"),c.state=y.CDATA,c.sgmlDecl="",c.cdata=""):c.sgmlDecl+w==="--"?(c.state=y.COMMENT,c.comment="",c.sgmlDecl=""):(c.sgmlDecl+w).toUpperCase()===S?(c.state=y.DOCTYPE,(c.doctype||c.sawRoot)&&Q(c,"Inappropriately located doctype declaration"),c.doctype="",c.sgmlDecl=""):w===">"?(k(c,"onsgmldeclaration",c.sgmlDecl),c.sgmlDecl="",c.state=y.TEXT):(D(w)&&(c.state=y.SGML_DECL_QUOTED),c.sgmlDecl+=w);continue;case y.SGML_DECL_QUOTED:w===c.q&&(c.state=y.SGML_DECL,c.q=""),c.sgmlDecl+=w;continue;case y.DOCTYPE:w===">"?(c.state=y.TEXT,k(c,"ondoctype",c.doctype),c.doctype=!0):(c.doctype+=w,w==="["?c.state=y.DOCTYPE_DTD:D(w)&&(c.state=y.DOCTYPE_QUOTED,c.q=w));continue;case y.DOCTYPE_QUOTED:c.doctype+=w,w===c.q&&(c.q="",c.state=y.DOCTYPE);continue;case y.DOCTYPE_DTD:c.doctype+=w,w==="]"?c.state=y.DOCTYPE:D(w)&&(c.state=y.DOCTYPE_DTD_QUOTED,c.q=w);continue;case y.DOCTYPE_DTD_QUOTED:c.doctype+=w,w===c.q&&(c.state=y.DOCTYPE_DTD,c.q="");continue;case y.COMMENT:w==="-"?c.state=y.COMMENT_ENDING:c.comment+=w;continue;case y.COMMENT_ENDING:w==="-"?(c.state=y.COMMENT_ENDED,c.comment=se(c.opt,c.comment),c.comment&&k(c,"oncomment",c.comment),c.comment=""):(c.comment+="-"+w,c.state=y.COMMENT);continue;case y.COMMENT_ENDED:w!==">"?(Q(c,"Malformed comment"),c.comment+="--"+w,c.state=y.COMMENT):c.state=y.TEXT;continue;case y.CDATA:w==="]"?c.state=y.CDATA_ENDING:c.cdata+=w;continue;case y.CDATA_ENDING:w==="]"?c.state=y.CDATA_ENDING_2:(c.cdata+="]"+w,c.state=y.CDATA);continue;case y.CDATA_ENDING_2:w===">"?(c.cdata&&k(c,"oncdata",c.cdata),k(c,"onclosecdata"),c.cdata="",c.state=y.TEXT):w==="]"?c.cdata+="]":(c.cdata+="]]"+w,c.state=y.CDATA);continue;case y.PROC_INST:w==="?"?c.state=y.PROC_INST_ENDING:F(w)?c.state=y.PROC_INST_BODY:c.procInstName+=w;continue;case y.PROC_INST_BODY:if(!c.procInstBody&&F(w))continue;w==="?"?c.state=y.PROC_INST_ENDING:c.procInstBody+=w;continue;case y.PROC_INST_ENDING:w===">"?(k(c,"onprocessinginstruction",{name:c.procInstName,body:c.procInstBody}),c.procInstName=c.procInstBody="",c.state=y.TEXT):(c.procInstBody+="?"+w,c.state=y.PROC_INST_BODY);continue;case y.OPEN_TAG:W(B,w)?c.tagName+=w:(j(c),w===">"?ft(c):w==="/"?c.state=y.OPEN_TAG_SLASH:(F(w)||Q(c,"Invalid character in tag name"),c.state=y.ATTRIB));continue;case y.OPEN_TAG_SLASH:w===">"?(ft(c,!0),ln(c)):(Q(c,"Forward-slash in opening tag not followed by >"),c.state=y.ATTRIB);continue;case y.ATTRIB:if(F(w))continue;w===">"?ft(c):w==="/"?c.state=y.OPEN_TAG_SLASH:W(C,w)?(c.attribName=w,c.attribValue="",c.state=y.ATTRIB_NAME):Q(c,"Invalid attribute name");continue;case y.ATTRIB_NAME:w==="="?c.state=y.ATTRIB_VALUE:w===">"?(Q(c,"Attribute without value"),c.attribValue=c.attribName,Qt(c),ft(c)):F(w)?c.state=y.ATTRIB_NAME_SAW_WHITE:W(B,w)?c.attribName+=w:Q(c,"Invalid attribute name");continue;case y.ATTRIB_NAME_SAW_WHITE:if(w==="=")c.state=y.ATTRIB_VALUE;else{if(F(w))continue;Q(c,"Attribute without value"),c.tag.attributes[c.attribName]="",c.attribValue="",k(c,"onattribute",{name:c.attribName,value:""}),c.attribName="",w===">"?ft(c):W(C,w)?(c.attribName=w,c.state=y.ATTRIB_NAME):(Q(c,"Invalid attribute name"),c.state=y.ATTRIB)}continue;case y.ATTRIB_VALUE:if(F(w))continue;D(w)?(c.q=w,c.state=y.ATTRIB_VALUE_QUOTED):(Q(c,"Unquoted attribute value"),c.state=y.ATTRIB_VALUE_UNQUOTED,c.attribValue=w);continue;case y.ATTRIB_VALUE_QUOTED:if(w!==c.q){w==="&"?c.state=y.ATTRIB_VALUE_ENTITY_Q:c.attribValue+=w;continue}Qt(c),c.q="",c.state=y.ATTRIB_VALUE_CLOSED;continue;case y.ATTRIB_VALUE_CLOSED:F(w)?c.state=y.ATTRIB:w===">"?ft(c):w==="/"?c.state=y.OPEN_TAG_SLASH:W(C,w)?(Q(c,"No whitespace between attributes"),c.attribName=w,c.attribValue="",c.state=y.ATTRIB_NAME):Q(c,"Invalid attribute name");continue;case y.ATTRIB_VALUE_UNQUOTED:if(!M(w)){w==="&"?c.state=y.ATTRIB_VALUE_ENTITY_U:c.attribValue+=w;continue}Qt(c),w===">"?ft(c):c.state=y.ATTRIB;continue;case y.CLOSE_TAG:if(c.tagName)w===">"?ln(c):W(B,w)?c.tagName+=w:c.script?(c.script+="</"+c.tagName,c.tagName="",c.state=y.SCRIPT):(F(w)||Q(c,"Invalid tagname in closing tag"),c.state=y.CLOSE_TAG_SAW_WHITE);else{if(F(w))continue;z(C,w)?c.script?(c.script+="</"+w,c.state=y.SCRIPT):Q(c,"Invalid tagname in closing tag."):c.tagName=w}continue;case y.CLOSE_TAG_SAW_WHITE:if(F(w))continue;w===">"?ln(c):Q(c,"Invalid characters in closing tag");continue;case y.TEXT_ENTITY:case y.ATTRIB_VALUE_ENTITY_Q:case y.ATTRIB_VALUE_ENTITY_U:var de,we;switch(c.state){case y.TEXT_ENTITY:de=y.TEXT,we="textNode";break;case y.ATTRIB_VALUE_ENTITY_Q:de=y.ATTRIB_VALUE_QUOTED,we="attribValue";break;case y.ATTRIB_VALUE_ENTITY_U:de=y.ATTRIB_VALUE_UNQUOTED,we="attribValue";break}w===";"?(c[we]+=Oi(c),c.entity="",c.state=de):W(c.entity.length?E:L,w)?c.entity+=w:(Q(c,"Invalid character in entity name"),c[we]+="&"+c.entity+w,c.entity="",c.state=de);continue;default:throw new Error(c,"Unknown state: "+c.state)}return c.position>=c.bufferCheckPosition&&n(c),c}String.fromCodePoint||(function(){var m=String.fromCharCode,c=Math.floor,P=function(){var w=16384,ne=[],ue,de,we=-1,ke=arguments.length;if(!ke)return"";for(var qe="";++we<ke;){var fe=Number(arguments[we]);if(!isFinite(fe)||fe<0||fe>1114111||c(fe)!==fe)throw RangeError("Invalid code point: "+fe);fe<=65535?ne.push(fe):(fe-=65536,ue=(fe>>10)+55296,de=fe%1024+56320,ne.push(ue,de)),(we+1===ke||ne.length>w)&&(qe+=m.apply(null,ne),ne.length=0)}return qe};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:P,configurable:!0,writable:!0}):String.fromCodePoint=P})()})(typeof Ti>"u"?Ti.sax={}:Ti)});var eo=me((cl,Fd)=>{"use strict";var Ld=cl&&cl.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},db=Ld(require("http")),fb=Ld(require("https")),mb=require("stream"),kd={"http:":db.default,"https:":fb.default},hb=new Set([301,302,303,307,308]),pb=new Set([429,503]),bb=["connect","continue","information","socket","timeout","upgrade"],gb=["aborted"];vt.MinigetError=class extends Error{constructor(e,t){super(e),this.statusCode=t}};vt.defaultOptions={maxRedirects:10,maxRetries:2,maxReconnects:0,backoff:{inc:100,max:1e4}};function vt(r,e={}){var t;let n=Object.assign({},vt.defaultOptions,e),o=new mb.PassThrough({highWaterMark:n.highWaterMark});o.destroyed=o.aborted=!1;let a,u,d,h=0,f=0,g,S=0,I,_=!1,A=0,C,B=0;if(!((t=n.headers)===null||t===void 0)&&t.Range){let N=/bytes=(\d+)-(\d+)?/.exec(`${n.headers.Range}`);N&&(A=parseInt(N[1],10),C=parseInt(N[2],10))}n.acceptEncoding&&(n.headers=Object.assign({"Accept-Encoding":Object.keys(n.acceptEncoding).join(", ")},n.headers));let L=()=>d&&B>0,E=()=>!_||B===I,F=N=>{d=null,f=0;let k=n.backoff.inc,ee=Math.min(k,n.backoff.max);g=setTimeout(z,ee),o.emit("reconnect",S,N)},D=N=>e.method!=="HEAD"&&!E()&&S++<n.maxReconnects?(F(N),!0):!1,M=N=>{if(o.destroyed)return!1;if(L())return D(N.err);if((!N.err||N.err.message==="ENOTFOUND")&&f++<n.maxRetries){let k=N.retryAfter||Math.min(f*n.backoff.inc,n.backoff.max);return g=setTimeout(z,k),o.emit("retry",f,N.err),!0}return!1},W=(N,k)=>{for(let ee of k)N.on(ee,o.emit.bind(o,ee))},z=()=>{let N={},k;try{let j=typeof r=="string"?new URL(r):r;N=Object.assign({},{host:j.host,hostname:j.hostname,path:j.pathname+j.search+j.hash,port:j.port,protocol:j.protocol}),j.username&&(N.auth=`${j.username}:${j.password}`),k=kd[String(N.protocol)]}catch{}if(!k){o.emit("error",new vt.MinigetError(`Invalid URL: ${r}`));return}if(Object.assign(N,n),_&&B>0){let j=B+A,ce=C||"";N.headers=Object.assign({},N.headers,{Range:`bytes=${j}-${ce}`})}if(n.transform){try{N=n.transform(N)}catch(j){o.emit("error",j);return}if((!N||N.protocol)&&(k=kd[String(N?.protocol)],!k)){o.emit("error",new vt.MinigetError("Invalid URL object from `transform` function"));return}}let ee=j=>{o.destroyed||o.readableEnded||(oe(),M({err:j})?a.removeListener("close",se):o.emit("error",j))},se=()=>{oe(),M({})},oe=()=>{a.removeListener("close",se),u?.removeListener("data",Ae),d?.removeListener("end",Q)},Ae=j=>{B+=j.length},Q=()=>{oe(),D()||o.end()};a=k.request(N,j=>{if(!o.destroyed){if(hb.has(j.statusCode)){if(h++>=n.maxRedirects)o.emit("error",new vt.MinigetError("Too many redirects"));else{if(j.headers.location)r=j.headers.location;else{let ce=new vt.MinigetError("Redirect status code given with no location",j.statusCode);o.emit("error",ce),oe();return}setTimeout(z,parseInt(j.headers["retry-after"]||"0",10)*1e3),o.emit("redirect",r)}oe();return}else if(pb.has(j.statusCode)){if(!M({retryAfter:parseInt(j.headers["retry-after"]||"0",10)})){let ce=new vt.MinigetError(`Status code: ${j.statusCode}`,j.statusCode);o.emit("error",ce)}oe();return}else if(j.statusCode&&(j.statusCode<200||j.statusCode>=400)){let ce=new vt.MinigetError(`Status code: ${j.statusCode}`,j.statusCode);j.statusCode>=500?ee(ce):o.emit("error",ce),oe();return}if(d=j,n.acceptEncoding&&j.headers["content-encoding"])for(let ce of j.headers["content-encoding"].split(", ").reverse()){let Qt=n.acceptEncoding[ce];Qt&&(d=d.pipe(Qt()),d.on("error",ee))}I||(I=parseInt(`${j.headers["content-length"]}`,10),_=j.headers["accept-ranges"]==="bytes"&&I>0&&n.maxReconnects>0),j.on("data",Ae),d.on("end",Q),d.pipe(o,{end:!_}),u=j,o.emit("response",j),j.on("error",ee),W(j,gb)}}),a.on("error",ee),a.on("close",se),W(a,bb),o.destroyed&&Z(...y),o.emit("request",a),a.end()};o.abort=N=>{console.warn("`MinigetStream#abort()` has been deprecated in favor of `MinigetStream#destroy()`"),o.aborted=!0,o.emit("abort"),o.destroy(N)};let y,Z=N=>{a.destroy(N),d?.unpipe(o),d?.destroy(),clearTimeout(g)};return o._destroy=(...N)=>{o.destroyed=!0,a?Z(...N):y=N},o.text=()=>new Promise((N,k)=>{let ee="";o.setEncoding("utf8"),o.on("data",se=>ee+=se),o.on("end",()=>N(ee)),o.on("error",k)}),process.nextTick(z),o}Fd.exports=vt});var dl=me((wE,yb)=>{yb.exports={name:"ytdl-core",description:"YouTube video downloader in pure javascript.",keywords:["youtube","video","download"],version:"4.11.5",repository:{type:"git",url:"git://github.com/fent/node-ytdl-core.git"},author:"fent <fentbox@gmail.com> (https://github.com/fent)",contributors:["Tobias Kutscha (https://github.com/TimeForANinja)","Andrew Kelley (https://github.com/andrewrk)","Mauricio Allende (https://github.com/mallendeo)","Rodrigo Altamirano (https://github.com/raltamirano)","Jim Buck (https://github.com/JimmyBoh)","Pawe\u0142 Ruci\u0144ski (https://github.com/Roki100)","Alexander Paolini (https://github.com/Million900o)"],main:"./lib/index.js",types:"./typings/index.d.ts",files:["lib","typings"],scripts:{test:"nyc --reporter=lcov --reporter=text-summary npm run test:unit","test:unit":"mocha --ignore test/irl-test.js test/*-test.js --timeout 4000","test:irl":"mocha --timeout 16000 test/irl-test.js",lint:"eslint ./","lint:fix":"eslint --fix ./","lint:typings":"tslint typings/index.d.ts","lint:typings:fix":"tslint --fix typings/index.d.ts"},dependencies:{m3u8stream:"^0.8.6",miniget:"^4.2.2",sax:"^1.1.3"},devDependencies:{"@types/node":"^13.1.0","assert-diff":"^3.0.1",dtslint:"^3.6.14",eslint:"^6.8.0",mocha:"^7.0.0","muk-require":"^1.2.0",nock:"^13.0.4",nyc:"^15.0.0",sinon:"^9.0.0","stream-equal":"~1.1.0",typescript:"^3.9.7"},engines:{node:">=12"},license:"MIT"}});var us=me(Ne=>{var Nd=eo();Ne.between=(r,e,t)=>{let n;if(e instanceof RegExp){let o=r.match(e);if(!o)return"";n=o.index+o[0].length}else{if(n=r.indexOf(e),n===-1)return"";n+=e.length}return r=r.slice(n),n=r.indexOf(t),n===-1?"":(r=r.slice(0,n),r)};Ne.parseAbbreviatedNumber=r=>{let e=r.replace(",",".").replace(" ","").match(/([\d,.]+)([MK]?)/);if(e){let[,t,n]=e;return t=parseFloat(t),Math.round(n==="M"?t*1e6:n==="K"?t*1e3:t)}return null};var _b=[{start:'"',end:'"'},{start:"'",end:"'"},{start:"`",end:"`"},{start:"/",end:"/",startPrefix:/(^|[[{:;,/])\s?$/}];Ne.cutAfterJS=r=>{let e,t;if(r[0]==="["?(e="[",t="]"):r[0]==="{"&&(e="{",t="}"),!e)throw new Error(`Can't cut unsupported JSON (need to begin with [ or { ) but got: ${r[0]}`);let n=null,o=!1,a=0,u;for(u=0;u<r.length;u++){if(!o&&n!==null&&r[u]===n.end){n=null;continue}else if(!o&&n===null){for(let d of _b)if(r[u]===d.start&&(!d.startPrefix||r.substring(u-10,u).match(d.startPrefix))){n=d;break}if(n!==null)continue}if(o=r[u]==="\\"&&!o,n===null&&(r[u]===e?a++:r[u]===t&&a--,a===0))return r.substring(0,u+1)}throw Error("Can't cut unsupported JSON (no matching closing bracket found)")};Ne.playError=(r,e,t=Error)=>{let n=r&&r.playabilityStatus;return n&&e.includes(n.status)?new t(n.reason||n.messages&&n.messages[0]):null};Ne.exposedMiniget=(r,e={},t)=>{let n=Nd(r,t||e.requestOptions);return typeof e.requestCallback=="function"&&e.requestCallback(n),n};Ne.deprecate=(r,e,t,n,o)=>{Object.defineProperty(r,e,{get:()=>(console.warn(`\`${n}\` will be removed in a near future release, use \`${o}\` instead.`),t)})};var Bd=dl(),wb=1e3*60*60*12;Ne.lastUpdateCheck=0;Ne.checkForUpdates=()=>!process.env.YTDL_NO_UPDATE&&!Bd.version.startsWith("0.0.0-")&&Date.now()-Ne.lastUpdateCheck>=wb?(Ne.lastUpdateCheck=Date.now(),Nd("https://api.github.com/repos/fent/node-ytdl-core/releases/latest",{headers:{"User-Agent":"ytdl-core"}}).text().then(r=>{JSON.parse(r).tag_name!==`v${Bd.version}`&&console.warn('\x1B[33mWARNING:\x1B[0m ytdl-core is out of date! Update with "npm install ytdl-core@latest".')},r=>{console.warn("Error checking for updates:",r.message),console.warn("You can disable this check by setting the `YTDL_NO_UPDATE` env variable.")})):null;Ne.getRandomIPv6=r=>{if(!Rb(r))throw Error("Invalid IPv6 format");let[e,t]=r.split("/"),n=parseInt(t);if(!n||n>128||n<24)throw Error("Invalid IPv6 subnet");let o=Ab(e);return new Array(8).fill(1).map(()=>Math.floor(Math.random()*65535)).map((d,h)=>{let f=Math.min(n,16);n-=f;let g=65535-(2**(16-f)-1);return(o[h]&g)+(d&(g^65535))}).map(d=>d.toString("16")).join(":")};var Sb=/^(([0-9a-f]{1,4}:)(:[0-9a-f]{1,4}){1,6}|([0-9a-f]{1,4}:){1,2}(:[0-9a-f]{1,4}){1,5}|([0-9a-f]{1,4}:){1,3}(:[0-9a-f]{1,4}){1,4}|([0-9a-f]{1,4}:){1,4}(:[0-9a-f]{1,4}){1,3}|([0-9a-f]{1,4}:){1,5}(:[0-9a-f]{1,4}){1,2}|([0-9a-f]{1,4}:){1,6}(:[0-9a-f]{1,4})|([0-9a-f]{1,4}:){1,7}(([0-9a-f]{1,4})|:))\/(1[0-1]\d|12[0-8]|\d{1,2})$/,Rb=Ne.isIPv6=r=>Sb.test(r),Ab=Ne.normalizeIP=r=>{let e=r.split("::").map(a=>a.split(":")),t=e[0]||[],n=e[1]||[];n.reverse();let o=new Array(8).fill(0);for(let a=0;a<Math.min(t.length,8);a++)o[a]=parseInt(t[a],16)||0;for(let a=0;a<Math.min(n.length,8);a++)o[7-a]=parseInt(n[a],16)||0;return o}});var qd=me((RE,Md)=>{Md.exports={5:{mimeType:'video/flv; codecs="Sorenson H.283, mp3"',qualityLabel:"240p",bitrate:25e4,audioBitrate:64},6:{mimeType:'video/flv; codecs="Sorenson H.263, mp3"',qualityLabel:"270p",bitrate:8e5,audioBitrate:64},13:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:null,bitrate:5e5,audioBitrate:null},17:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:"144p",bitrate:5e4,audioBitrate:24},18:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:96},22:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},34:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},35:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"480p",bitrate:8e5,audioBitrate:128},36:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:"240p",bitrate:175e3,audioBitrate:32},37:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:3e6,audioBitrate:192},38:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"3072p",bitrate:35e5,audioBitrate:192},43:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},44:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"480p",bitrate:1e6,audioBitrate:128},45:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},46:{mimeType:'audio/webm; codecs="vp8, vorbis"',qualityLabel:"1080p",bitrate:null,audioBitrate:192},82:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:96},83:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"240p",bitrate:5e5,audioBitrate:96},84:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},85:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:3e6,audioBitrate:192},91:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"144p",bitrate:1e5,audioBitrate:48},92:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"240p",bitrate:15e4,audioBitrate:48},93:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},94:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"480p",bitrate:8e5,audioBitrate:128},95:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:15e5,audioBitrate:256},96:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:25e5,audioBitrate:256},100:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:null,audioBitrate:128},101:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:null,audioBitrate:192},102:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"720p",bitrate:null,audioBitrate:192},120:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:128},127:{mimeType:'audio/ts; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:96},128:{mimeType:'audio/ts; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:96},132:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"240p",bitrate:15e4,audioBitrate:48},133:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"240p",bitrate:2e5,audioBitrate:null},134:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"360p",bitrate:3e5,audioBitrate:null},135:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"480p",bitrate:5e5,audioBitrate:null},136:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"720p",bitrate:1e6,audioBitrate:null},137:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1080p",bitrate:25e5,audioBitrate:null},138:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"4320p",bitrate:135e5,audioBitrate:null},139:{mimeType:'audio/mp4; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:48},140:{mimeType:'audio/m4a; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:128},141:{mimeType:'audio/mp4; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:256},151:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:5e4,audioBitrate:24},160:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"144p",bitrate:1e5,audioBitrate:null},171:{mimeType:'audio/webm; codecs="vorbis"',qualityLabel:null,bitrate:null,audioBitrate:128},172:{mimeType:'audio/webm; codecs="vorbis"',qualityLabel:null,bitrate:null,audioBitrate:192},242:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p",bitrate:1e5,audioBitrate:null},243:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"360p",bitrate:25e4,audioBitrate:null},244:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"480p",bitrate:5e5,audioBitrate:null},247:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p",bitrate:7e5,audioBitrate:null},248:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p",bitrate:15e5,audioBitrate:null},249:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:48},250:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:64},251:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:160},264:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1440p",bitrate:4e6,audioBitrate:null},266:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"2160p",bitrate:125e5,audioBitrate:null},271:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p",bitrate:9e6,audioBitrate:null},272:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"4320p",bitrate:2e7,audioBitrate:null},278:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"144p 30fps",bitrate:8e4,audioBitrate:null},298:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"720p",bitrate:3e6,audioBitrate:null},299:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1080p",bitrate:55e5,audioBitrate:null},300:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:1318e3,audioBitrate:48},302:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p HFR",bitrate:25e5,audioBitrate:null},303:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p HFR",bitrate:5e6,audioBitrate:null},308:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p HFR",bitrate:1e7,audioBitrate:null},313:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p",bitrate:13e6,audioBitrate:null},315:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p HFR",bitrate:2e7,audioBitrate:null},330:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"144p HDR, HFR",bitrate:8e4,audioBitrate:null},331:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p HDR, HFR",bitrate:1e5,audioBitrate:null},332:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"360p HDR, HFR",bitrate:25e4,audioBitrate:null},333:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p HDR, HFR",bitrate:5e5,audioBitrate:null},334:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p HDR, HFR",bitrate:1e6,audioBitrate:null},335:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p HDR, HFR",bitrate:15e5,audioBitrate:null},336:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p HDR, HFR",bitrate:5e6,audioBitrate:null},337:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p HDR, HFR",bitrate:12e6,audioBitrate:null}}});var pl=me(It=>{var Tb=us(),Eb=qd(),vb=["mp4a","mp3","vorbis","aac","opus","flac"],Ib=["mp4v","avc1","Sorenson H.283","MPEG-4 Visual","VP8","VP9","H.264"],$d=r=>r.bitrate||0,Ud=r=>Ib.findIndex(e=>r.codecs&&r.codecs.includes(e)),Wd=r=>r.audioBitrate||0,jd=r=>vb.findIndex(e=>r.codecs&&r.codecs.includes(e)),hl=(r,e,t)=>{let n=0;for(let o of t)if(n=o(e)-o(r),n!==0)break;return n},fl=(r,e)=>hl(r,e,[t=>parseInt(t.qualityLabel),$d,Ud]),ml=(r,e)=>hl(r,e,[Wd,jd]);It.sortFormats=(r,e)=>hl(r,e,[t=>+!!t.isHLS,t=>+!!t.isDashMPD,t=>+(t.contentLength>0),t=>+(t.hasVideo&&t.hasAudio),t=>+t.hasVideo,t=>parseInt(t.qualityLabel)||0,$d,Wd,Ud,jd]);It.chooseFormat=(r,e)=>{if(typeof e.format=="object"){if(!e.format.url)throw Error("Invalid format given, did you use `ytdl.getInfo()`?");return e.format}e.filter&&(r=It.filterFormats(r,e.filter)),r.some(o=>o.isHLS)&&(r=r.filter(o=>o.isHLS||!o.isLive));let t,n=e.quality||"highest";switch(n){case"highest":t=r[0];break;case"lowest":t=r[r.length-1];break;case"highestaudio":{r=It.filterFormats(r,"audio"),r.sort(ml);let o=r[0];r=r.filter(u=>ml(o,u)===0);let a=r.map(u=>parseInt(u.qualityLabel)||0).sort((u,d)=>u-d)[0];t=r.find(u=>(parseInt(u.qualityLabel)||0)===a);break}case"lowestaudio":r=It.filterFormats(r,"audio"),r.sort(ml),t=r[r.length-1];break;case"highestvideo":{r=It.filterFormats(r,"video"),r.sort(fl);let o=r[0];r=r.filter(u=>fl(o,u)===0);let a=r.map(u=>u.audioBitrate||0).sort((u,d)=>u-d)[0];t=r.find(u=>(u.audioBitrate||0)===a);break}case"lowestvideo":r=It.filterFormats(r,"video"),r.sort(fl),t=r[r.length-1];break;default:t=Pb(n,r);break}if(!t)throw Error(`No such format found: ${n}`);return t};var Pb=(r,e)=>{let t=n=>e.find(o=>`${o.itag}`==`${n}`);return Array.isArray(r)?t(r.find(n=>t(n))):t(r)};It.filterFormats=(r,e)=>{let t;switch(e){case"videoandaudio":case"audioandvideo":t=n=>n.hasVideo&&n.hasAudio;break;case"video":t=n=>n.hasVideo;break;case"videoonly":t=n=>n.hasVideo&&!n.hasAudio;break;case"audio":t=n=>n.hasAudio;break;case"audioonly":t=n=>!n.hasVideo&&n.hasAudio;break;default:if(typeof e=="function")t=e;else throw TypeError(`Given filter (${e}) is not supported`)}return r.filter(n=>!!n.url&&t(n))};It.addFormatMeta=r=>(r=Object.assign({},Eb[r.itag],r),r.hasVideo=!!r.qualityLabel,r.hasAudio=!!r.audioBitrate,r.container=r.mimeType?r.mimeType.split(";")[0].split("/")[1]:null,r.codecs=r.mimeType?Tb.between(r.mimeType,'codecs="','"'):null,r.videoCodec=r.hasVideo&&r.codecs?r.codecs.split(", ")[0]:null,r.audioCodec=r.hasAudio&&r.codecs?r.codecs.split(", ").slice(-1)[0]:null,r.isLive=/\bsource[/=]yt_live_broadcast\b/.test(r.url),r.isHLS=/\/manifest\/hls_(variant|playlist)\//.test(r.url),r.isDashMPD=/\/manifest\/dash\//.test(r.url),r)});var bl=me(Vt=>{var Cb=new Set(["youtube.com","www.youtube.com","m.youtube.com","music.youtube.com","gaming.youtube.com"]),xb=/^https?:\/\/(youtu\.be\/|(www\.)?youtube\.com\/(embed|v|shorts)\/)/;Vt.getURLVideoID=r=>{let e=new URL(r.trim()),t=e.searchParams.get("v");if(xb.test(r.trim())&&!t){let n=e.pathname.split("/");t=e.host==="youtu.be"?n[1]:n[2]}else if(e.hostname&&!Cb.has(e.hostname))throw Error("Not a YouTube domain");if(!t)throw Error(`No video id found: "${r}"`);if(t=t.substring(0,11),!Vt.validateID(t))throw TypeError(`Video id (${t}) does not match expected format (${Hd.toString()})`);return t};var Ob=/^https?:\/\//;Vt.getVideoID=r=>{if(Vt.validateID(r))return r;if(Ob.test(r.trim()))return Vt.getURLVideoID(r);throw Error(`No video id found: ${r}`)};var Hd=/^[a-zA-Z0-9-_]{11}$/;Vt.validateID=r=>Hd.test(r.trim());Vt.validateURL=r=>{try{return Vt.getURLVideoID(r),!0}catch{return!1}}});var Vd=me(yl=>{"use strict";Object.defineProperty(yl,"__esModule",{value:!0});var Db=require("stream"),gl=class extends Db.Writable{constructor(){super(),this._lastLine="",this._seq=0,this._nextItemDuration=null,this._nextItemRange=null,this._lastItemRangeEnd=0,this.on("finish",()=>{this._parseLine(this._lastLine),this.emit("end")})}_parseAttrList(e){let t={},n=/([A-Z0-9-]+)=(?:"([^"]*?)"|([^,]*?))/g,o;for(;(o=n.exec(e))!==null;)t[o[1]]=o[2]||o[3];return t}_parseRange(e){if(!e)return null;let t=e.split("@"),n=t[1]?parseInt(t[1]):this._lastItemRangeEnd+1,o=n+parseInt(t[0])-1,a={start:n,end:o};return this._lastItemRangeEnd=a.end,a}_parseLine(e){let t=e.match(/^#(EXT[A-Z0-9-]+)(?::(.*))?/);if(t){let n=t[1],o=t[2]||"";switch(n){case"EXT-X-PROGRAM-DATE-TIME":this.emit("starttime",new Date(o).getTime());break;case"EXT-X-MEDIA-SEQUENCE":this._seq=parseInt(o);break;case"EXT-X-MAP":{let a=this._parseAttrList(o);if(!a.URI){this.destroy(new Error("`EXT-X-MAP` found without required attribute `URI`"));return}this.emit("item",{url:a.URI,seq:this._seq,init:!0,duration:0,range:this._parseRange(a.BYTERANGE)});break}case"EXT-X-BYTERANGE":{this._nextItemRange=this._parseRange(o);break}case"EXTINF":this._nextItemDuration=Math.round(parseFloat(o.split(",")[0])*1e3);break;case"EXT-X-ENDLIST":this.emit("endlist");break}}else!/^#/.test(e)&&e.trim()&&(this.emit("item",{url:e.trim(),seq:this._seq++,duration:this._nextItemDuration,range:this._nextItemRange}),this._nextItemRange=null)}_write(e,t,n){let o=e.toString("utf8").split(`
`);this._lastLine&&(o[0]=this._lastLine+o[0]),o.forEach((a,u)=>{this.destroyed||(u<o.length-1?this._parseLine(a):this._lastLine=a)}),n()}};yl.default=gl});var _l=me(cs=>{"use strict";Object.defineProperty(cs,"__esModule",{value:!0});cs.durationStr=cs.humanStr=void 0;var kb=/^\d+$/,Lb=/^(?:(?:(\d+):)?(\d{1,2}):)?(\d{1,2})(?:\.(\d{3}))?$/,to={ms:1,s:1e3,m:6e4,h:36e5};cs.humanStr=r=>{if(typeof r=="number")return r;if(kb.test(r))return+r;let e=Lb.exec(r);if(e)return+(e[1]||0)*to.h+ +(e[2]||0)*to.m+ +e[3]*to.s+ +(e[4]||0);{let t=0,n=/(-?\d+)(ms|s|m|h)/g,o;for(;(o=n.exec(r))!==null;)t+=+o[1]*to[o[2]];return t}};cs.durationStr=r=>{let e=0,t=/(\d+(?:\.\d+)?)(S|M|H)/g,n;for(;(n=t.exec(r))!==null;)e+=+n[1]*to[n[2].toLowerCase()];return e}});var zd=me(ro=>{"use strict";var Fb=ro&&ro.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ro,"__esModule",{value:!0});var Bb=require("stream"),Nb=Fb(ul()),Mb=_l(),wl=class extends Bb.Writable{constructor(e){super(),this._parser=Nb.default.createStream(!1,{lowercase:!0}),this._parser.on("error",this.destroy.bind(this));let t,n=0,o=0,a,u,d,h,f,g=[],S=!1,I=!1,_,A,C,B=E=>{let F={RepresentationID:e,Number:o,Time:n};return E.replace(/\$(\w+)\$/g,(D,M)=>`${F[M]}`)};this._parser.on("opentag",E=>{switch(E.name){case"mpd":n=E.attributes.availabilitystarttime?new Date(E.attributes.availabilitystarttime).getTime():0,_=E.attributes.type!=="dynamic";break;case"period":o=0,u=1e3,h=0,d=0,f=[],A=0,C=Mb.durationStr(E.attributes.start)||0;break;case"segmentlist":o=parseInt(E.attributes.startnumber)||o,u=parseInt(E.attributes.timescale)||u,h=parseInt(E.attributes.duration)||h,d=parseInt(E.attributes.presentationtimeoffset)||d;break;case"segmenttemplate":a=E.attributes,o=parseInt(E.attributes.startnumber)||o,u=parseInt(E.attributes.timescale)||u;break;case"segmenttimeline":case"baseurl":t=E.name;break;case"s":g.push({duration:parseInt(E.attributes.d),repeat:parseInt(E.attributes.r),time:parseInt(E.attributes.t)});break;case"adaptationset":case"representation":A++,e||(e=E.attributes.id),S=E.attributes.id===`${e}`,S&&(C&&(n+=C),d&&(n-=d/u*1e3),this.emit("starttime",n));break;case"initialization":S&&this.emit("item",{url:f.filter(F=>!!F).join("")+E.attributes.sourceurl,seq:o,init:!0,duration:0});break;case"segmenturl":if(S){I=!0;let F=g.shift(),D=(F?.duration||h)/u*1e3;this.emit("item",{url:f.filter(M=>!!M).join("")+E.attributes.media,seq:o++,duration:D}),n+=D}break}});let L=()=>{_&&this.emit("endlist"),S?this.emit("end"):this.destroy(Error(`Representation '${e}' not found`))};this._parser.on("closetag",E=>{switch(E){case"adaptationset":case"representation":if(A--,a&&g.length){I=!0,a.initialization&&this.emit("item",{url:f.filter(F=>!!F).join("")+B(a.initialization),seq:o,init:!0,duration:0});for(let{duration:F,repeat:D,time:M}of g){F=F/u*1e3,D=D||1,n=M||n;for(let W=0;W<D;W++)this.emit("item",{url:f.filter(z=>!!z).join("")+B(a.media),seq:o++,duration:F}),n+=F}}I&&(this.emit("endearly"),L(),this._parser.removeAllListeners(),this.removeAllListeners("finish"));break}}),this._parser.on("text",E=>{t==="baseurl"&&(f[A]=E,t=null)}),this.on("finish",L)}_write(e,t,n){this._parser.write(e),n()}};ro.default=wl});var Qd=me(Ei=>{"use strict";Object.defineProperty(Ei,"__esModule",{value:!0});Ei.Queue=void 0;var Sl=class{constructor(e,t={}){this._worker=e,this._concurrency=t.concurrency||1,this.tasks=[],this.total=0,this.active=0}push(e,t){this.tasks.push({item:e,callback:t}),this.total++,this._next()}_next(){if(this.active>=this._concurrency||!this.tasks.length)return;let{item:e,callback:t}=this.tasks.shift(),n=!1;this.active++,this._worker(e,(o,a)=>{n||(this.active--,n=!0,t?.(o,a),this._next())})}die(){this.tasks=[]}};Ei.Queue=Sl});var vi=me((Rl,Zd)=>{"use strict";var Al=Rl&&Rl.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},Gd=require("stream"),Yd=Al(eo()),qb=Al(Vd()),$b=Al(zd()),Xd=Qd(),Jd=_l(),Ub={m3u8:qb.default,"dash-mpd":$b.default},Kd=((r,e={})=>{let t=new Gd.PassThrough({highWaterMark:e.highWaterMark}),n=e.chunkReadahead||3,o=e.liveBuffer||2e4,a=e.requestOptions,u=Ub[e.parser||(/\.mpd$/.test(r)?"dash-mpd":"m3u8")];if(!u)throw TypeError(`parser '${e.parser}' not supported`);let d=0;typeof e.begin<"u"&&(d=typeof e.begin=="string"?Jd.humanStr(e.begin):Math.max(e.begin-o,0));let h=k=>{for(let ee of["abort","request","response","redirect","retry","reconnect"])k.on(ee,t.emit.bind(t,ee))},f,g=new Xd.Queue((k,ee)=>{f=k;let se=0;k.on("data",oe=>se+=oe.length),k.pipe(t,{end:!1}),k.on("end",()=>ee(null,se))},{concurrency:1}),S=0,I=0,_=new Xd.Queue((k,ee)=>{let se=Object.assign({},a);k.range&&(se.headers=Object.assign({},se.headers,{Range:`bytes=${k.range.start}-${k.range.end}`}));let oe=Yd.default(new URL(k.url,r).toString(),se);oe.on("error",ee),h(oe),g.push(oe,(Ae,Q)=>{I+=+Q,t.emit("progress",{num:++S,size:Q,duration:k.duration,url:k.url},_.total,I),ee(null)})},{concurrency:n}),A=k=>{t.emit("error",k),t.end()},C,B,L,E=!0,F=!1,D=!1,M,W=k=>{if(f=null,k)A(k);else if(!E&&!F&&!D&&_.tasks.length+_.active<=C){let ee=Math.max(0,B-(Date.now()-M));E=!0,L=setTimeout(N,ee)}else(F||D)&&!_.tasks.length&&!_.active&&t.end()},z,y,Z=0,N=()=>{M=Date.now(),z=Yd.default(r,a),z.on("error",A),h(z);let k=z.pipe(new u(e.id));k.on("starttime",Q=>{Z||(Z=Q,typeof e.begin=="string"&&d>=0&&(d+=Z))}),k.on("endlist",()=>{D=!0}),k.on("endearly",z.unpipe.bind(z,k));let ee=[],se=Q=>{if(!Q.init){if(Q.seq<=y)return;y=Q.seq}d=Q.time,_.push(Q,W),ee.push(Q)},oe=[],Ae=0;k.on("item",Q=>{let j=Object.assign({time:Z},Q);if(d<=j.time)se(j);else for(oe.push(j),Ae+=j.duration;oe.length>1&&Ae-oe[0].duration>o;){let ce=oe.shift();Ae-=ce.duration}Z+=j.duration}),k.on("end",()=>{z=null,!ee.length&&oe.length&&oe.forEach(Q=>{se(Q)}),C=Math.max(1,Math.ceil(ee.length*.01)),B=ee.reduce((Q,j)=>j.duration+Q,0),E=!1,W(null)})};return N(),t.end=()=>(F=!0,g.die(),_.die(),clearTimeout(L),z?.destroy(),f?.destroy(),Gd.PassThrough.prototype.end.call(t,null),t),t});Kd.parseTimestamp=Jd.humanStr;Zd.exports=Kd});var rf=me(zt=>{var on=us(),Wb=require("querystring"),{parseTimestamp:jb}=vi(),ds="https://www.youtube.com/watch?v=",Tl={song:{name:"Music",url:"https://music.youtube.com/"}},xe=r=>r?r.runs?r.runs[0].text:r.simpleText:null;zt.getMedia=r=>{let e={},t=[];try{t=r.response.contents.twoColumnWatchNextResults.results.results.contents}catch{}let n=t.find(o=>o.videoSecondaryInfoRenderer);if(!n)return{};try{let o=(n.metadataRowContainer||n.videoSecondaryInfoRenderer.metadataRowContainer).metadataRowContainerRenderer.rows;for(let a of o)if(a.metadataRowRenderer){let u=xe(a.metadataRowRenderer.title).toLowerCase(),d=a.metadataRowRenderer.contents[0];e[u]=xe(d);let h=d.runs;h&&h[0].navigationEndpoint&&(e[`${u}_url`]=new URL(h[0].navigationEndpoint.commandMetadata.webCommandMetadata.url,ds).toString()),u in Tl&&(e.category=Tl[u].name,e.category_url=Tl[u].url)}else if(a.richMetadataRowRenderer){let u=a.richMetadataRowRenderer.contents,d=u.filter(f=>f.richMetadataRenderer.style==="RICH_METADATA_RENDERER_STYLE_BOX_ART");for(let{richMetadataRenderer:f}of d){let g=f;e.year=xe(g.subtitle);let S=xe(g.callToAction).split(" ")[1];e[S]=xe(g.title),e[`${S}_url`]=new URL(g.endpoint.commandMetadata.webCommandMetadata.url,ds).toString(),e.thumbnails=g.thumbnail.thumbnails}let h=u.filter(f=>f.richMetadataRenderer.style==="RICH_METADATA_RENDERER_STYLE_TOPIC");for(let{richMetadataRenderer:f}of h){let g=f;e.category=xe(g.title),e.category_url=new URL(g.endpoint.commandMetadata.webCommandMetadata.url,ds).toString()}}}catch{}return e};var tf=r=>!!(r&&r.find(e=>e.metadataBadgeRenderer.tooltip==="Verified"));zt.getAuthor=r=>{let e,t=[],n,o=!1;try{let d=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(h=>h.videoSecondaryInfoRenderer&&h.videoSecondaryInfoRenderer.owner&&h.videoSecondaryInfoRenderer.owner.videoOwnerRenderer).videoSecondaryInfoRenderer.owner.videoOwnerRenderer;e=d.navigationEndpoint.browseEndpoint.browseId,t=d.thumbnail.thumbnails.map(h=>(h.url=new URL(h.url,ds).toString(),h)),n=on.parseAbbreviatedNumber(xe(d.subscriberCountText)),o=tf(d.badges)}catch{}try{let a=r.player_response.microformat&&r.player_response.microformat.playerMicroformatRenderer,u=a&&a.channelId||e||r.player_response.videoDetails.channelId,d={id:u,name:a?a.ownerChannelName:r.player_response.videoDetails.author,user:a?a.ownerProfileUrl.split("/").slice(-1)[0]:null,channel_url:`https://www.youtube.com/channel/${u}`,external_channel_url:a?`https://www.youtube.com/channel/${a.externalChannelId}`:"",user_url:a?new URL(a.ownerProfileUrl,ds).toString():"",thumbnails:t,verified:o,subscriber_count:n};return t.length&&on.deprecate(d,"avatar",d.thumbnails[0].url,"author.avatar","author.thumbnails[0].url"),d}catch{return{}}};var ef=(r,e)=>{if(r)try{let t=xe(r.viewCountText),n=xe(r.shortViewCountText),o=e.find(g=>g.id===r.videoId);/^\d/.test(n)||(n=o&&o.short_view_count_text||""),t=(/^\d/.test(t)?t:n).split(" ")[0];let a=r.shortBylineText.runs[0].navigationEndpoint.browseEndpoint,u=a.browseId,d=xe(r.shortBylineText),h=(a.canonicalBaseUrl||"").split("/").slice(-1)[0],f={id:r.videoId,title:xe(r.title),published:xe(r.publishedTimeText),author:{id:u,name:d,user:h,channel_url:`https://www.youtube.com/channel/${u}`,user_url:`https://www.youtube.com/user/${h}`,thumbnails:r.channelThumbnail.thumbnails.map(g=>(g.url=new URL(g.url,ds).toString(),g)),verified:tf(r.ownerBadges),[Symbol.toPrimitive](){return console.warn("`relatedVideo.author` will be removed in a near future release, use `relatedVideo.author.name` instead."),f.author.name}},short_view_count_text:n.split(" ")[0],view_count:t.replace(/,/g,""),length_seconds:r.lengthText?Math.floor(jb(xe(r.lengthText))/1e3):e&&`${e.length_seconds}`,thumbnails:r.thumbnail.thumbnails,richThumbnails:r.richThumbnail?r.richThumbnail.movingThumbnailRenderer.movingThumbnailDetails.thumbnails:[],isLive:!!(r.badges&&r.badges.find(g=>g.metadataBadgeRenderer.label==="LIVE NOW"))};return on.deprecate(f,"author_thumbnail",f.author.thumbnails[0].url,"relatedVideo.author_thumbnail","relatedVideo.author.thumbnails[0].url"),on.deprecate(f,"ucid",f.author.id,"relatedVideo.ucid","relatedVideo.author.id"),on.deprecate(f,"video_thumbnail",f.thumbnails[0].url,"relatedVideo.video_thumbnail","relatedVideo.thumbnails[0].url"),f}catch{}};zt.getRelatedVideos=r=>{let e=[],t=[];try{e=r.response.webWatchNextResponseExtensionData.relatedVideoArgs.split(",").map(o=>Wb.parse(o))}catch{}try{t=r.response.contents.twoColumnWatchNextResults.secondaryResults.secondaryResults.results}catch{return[]}let n=[];for(let o of t||[]){let a=o.compactVideoRenderer;if(a){let u=ef(a,e);u&&n.push(u)}else{let u=o.compactAutoplayRenderer||o.itemSectionRenderer;if(!u||!Array.isArray(u.contents))continue;for(let d of u.contents){let h=ef(d.compactVideoRenderer,e);h&&n.push(h)}}}return n};zt.getLikes=r=>{try{let o=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(a=>a.videoPrimaryInfoRenderer).videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons.find(a=>a.toggleButtonRenderer&&a.toggleButtonRenderer.defaultIcon.iconType==="LIKE");return parseInt(o.toggleButtonRenderer.defaultText.accessibility.accessibilityData.label.replace(/\D+/g,""))}catch{return null}};zt.getDislikes=r=>{try{let o=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(a=>a.videoPrimaryInfoRenderer).videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons.find(a=>a.toggleButtonRenderer&&a.toggleButtonRenderer.defaultIcon.iconType==="DISLIKE");return parseInt(o.toggleButtonRenderer.defaultText.accessibility.accessibilityData.label.replace(/\D+/g,""))}catch{return null}};zt.cleanVideoDetails=(r,e)=>(r.thumbnails=r.thumbnail.thumbnails,delete r.thumbnail,on.deprecate(r,"thumbnail",{thumbnails:r.thumbnails},"videoDetails.thumbnail.thumbnails","videoDetails.thumbnails"),r.description=r.shortDescription||xe(r.description),delete r.shortDescription,on.deprecate(r,"shortDescription",r.description,"videoDetails.shortDescription","videoDetails.description"),r.lengthSeconds=e.player_response.microformat&&e.player_response.microformat.playerMicroformatRenderer.lengthSeconds||e.player_response.videoDetails.lengthSeconds,r);zt.getStoryboards=r=>{let e=r.player_response.storyboards&&r.player_response.storyboards.playerStoryboardSpecRenderer&&r.player_response.storyboards.playerStoryboardSpecRenderer.spec&&r.player_response.storyboards.playerStoryboardSpecRenderer.spec.split("|");if(!e)return[];let t=new URL(e.shift());return e.map((n,o)=>{let[a,u,d,h,f,g,S,I]=n.split("#");t.searchParams.set("sigh",I),d=parseInt(d,10),h=parseInt(h,10),f=parseInt(f,10);let _=Math.ceil(d/(h*f));return{templateUrl:t.toString().replace("$L",o).replace("$N",S),thumbnailWidth:parseInt(a,10),thumbnailHeight:parseInt(u,10),thumbnailCount:d,interval:parseInt(g,10),columns:h,rows:f,storyboardCount:_}})};zt.getChapters=r=>{let e=r.response&&r.response.playerOverlays&&r.response.playerOverlays.playerOverlayRenderer,t=e&&e.decoratedPlayerBarRenderer&&e.decoratedPlayerBarRenderer.decoratedPlayerBarRenderer&&e.decoratedPlayerBarRenderer.decoratedPlayerBarRenderer.playerBar,n=t&&t.multiMarkersPlayerBarRenderer&&t.multiMarkersPlayerBarRenderer.markersMap,o=Array.isArray(n)&&n.find(u=>u.value&&Array.isArray(u.value.chapters));return o?o.value.chapters.map(u=>({title:xe(u.chapterRenderer.title),start_time:u.chapterRenderer.timeRangeStartMillis/1e3})):[]}});var El=me((OE,nf)=>{var{setTimeout:Hb}=require("timers");nf.exports=class extends Map{constructor(e=1e3){super(),this.timeout=e}set(e,t){this.has(e)&&clearTimeout(super.get(e).tid),super.set(e,{tid:Hb(this.delete.bind(this,e),this.timeout).unref(),value:t})}get(e){let t=super.get(e);return t?t.value:null}getOrSet(e,t){if(this.has(e))return this.get(e);{let n=t();return this.set(e,n),(async()=>{try{await n}catch{this.delete(e)}})(),n}}delete(e){let t=super.get(e);t&&(clearTimeout(t.tid),super.delete(e))}clear(){for(let e of this.values())clearTimeout(e.tid);super.clear()}}});var vl=me(dt=>{var Vb=require("querystring"),zb=El(),_r=us(),sf=require("vm");dt.cache=new zb;dt.getFunctions=(r,e)=>dt.cache.getOrSet(r,async()=>{let t=await _r.exposedMiniget(r,e).text(),n=dt.extractFunctions(t);if(!n||!n.length)throw Error("Could not extract functions");return dt.cache.set(r,n),n});dt.extractFunctions=r=>{let e=[],t=a=>{let u=_r.between(a,'a=a.split("");',".");if(!u)return"";let d=`var ${u}={`,h=r.indexOf(d);if(h<0)return"";let f=r.slice(h+d.length-1);return`var ${u}=${_r.cutAfterJS(f)}`},n=()=>{let a=_r.between(r,'a.set("alr","yes");c&&(c=',"(decodeURIC");if(a&&a.length){let u=`${a}=function(a)`,d=r.indexOf(u);if(d>=0){let h=r.slice(d+u.length),f=`var ${u}${_r.cutAfterJS(h)}`;f=`${t(f)};${f};${a}(sig);`,e.push(f)}}},o=()=>{let a=_r.between(r,'&&(b=a.get("n"))&&(b=',"(b)");if(a.includes("[")&&(a=_r.between(r,`var ${a.split("[")[0]}=[`,"]")),a&&a.length){let u=`${a}=function(a)`,d=r.indexOf(u);if(d>=0){let h=r.slice(d+u.length),f=`var ${u}${_r.cutAfterJS(h)};${a}(ncode);`;e.push(f)}}};return n(),o(),e};dt.setDownloadURL=(r,e,t)=>{let n=d=>{let h=Vb.parse(d);if(!h.s||!e)return h.url;let f=new URL(decodeURIComponent(h.url));return f.searchParams.set(h.sp?h.sp:"signature",e.runInNewContext({sig:decodeURIComponent(h.s)})),f.toString()},o=d=>{let h=new URL(decodeURIComponent(d)),f=h.searchParams.get("n");return!f||!t?d:(h.searchParams.set("n",t.runInNewContext({ncode:f})),h.toString())},a=!r.url,u=r.url||r.signatureCipher||r.cipher;r.url=o(a?n(u):u),delete r.signatureCipher,delete r.cipher};dt.decipherFormats=async(r,e,t)=>{let n={},o=await dt.getFunctions(e,t),a=o.length?new sf.Script(o[0]):null,u=o.length>1?new sf.Script(o[1]):null;return r.forEach(d=>{dt.setDownloadURL(d,a,u),n[d.url]=d}),n}});var uf=me(Ee=>{var Qb=require("querystring"),Gb=ul(),af=eo(),rt=us(),{setTimeout:Yb}=require("timers"),of=pl(),no=bl(),wr=rf(),Xb=vl(),xl=El(),so="https://www.youtube.com/watch?v=";Ee.cache=new xl;Ee.cookieCache=new xl(1e3*60*60*24);Ee.watchPageCache=new xl;var Ol="2.20210622.10.00",an=class extends Error{},Jb=["support.google.com/youtube/?p=age_restrictions","youtube.com/t/community_guidelines"];Ee.getBasicInfo=async(r,e)=>{e.IPv6Block&&(e.requestOptions=Object.assign({},e.requestOptions,{family:6,localAddress:rt.getRandomIPv6(e.IPv6Block)}));let t=Object.assign({},af.defaultOptions,e.requestOptions);e.requestOptions=Object.assign({},e.requestOptions,{}),e.requestOptions.headers=Object.assign({},{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.101 Safari/537.36"},e.requestOptions.headers);let o=await sg([r,e],d=>{let h=rt.playError(d.player_response,["ERROR"],an),f=Kb(d.player_response);if(h||f)throw h||f;return d&&d.player_response&&(d.player_response.streamingData||Zb(d.player_response)||eg(d.player_response))},t,[ug,lg,mg]);Object.assign(o,{formats:hg(o.player_response),related_videos:wr.getRelatedVideos(o)});let a=wr.getMedia(o),u={author:wr.getAuthor(o),media:a,likes:wr.getLikes(o),dislikes:wr.getDislikes(o),age_restricted:!!(a&&Jb.some(d=>Object.values(a).some(h=>typeof h=="string"&&h.includes(d)))),video_url:so+r,storyboards:wr.getStoryboards(o),chapters:wr.getChapters(o)};return o.videoDetails=wr.cleanVideoDetails(Object.assign({},o.player_response&&o.player_response.microformat&&o.player_response.microformat.playerMicroformatRenderer,o.player_response&&o.player_response.videoDetails,u),o),o};var Kb=r=>{let e=r&&r.playabilityStatus;return e&&e.status==="LOGIN_REQUIRED"&&e.messages&&e.messages.filter(t=>/This is a private video/.test(t)).length?new an(e.reason||e.messages&&e.messages[0]):null},Zb=r=>{let e=r.playabilityStatus;return e&&e.status==="UNPLAYABLE"&&e.errorScreen&&e.errorScreen.playerLegacyDesktopYpcOfferRenderer},eg=r=>{let e=r.playabilityStatus;return e&&e.status==="LIVE_STREAM_OFFLINE"},lf=(r,e)=>`${so+r}&hl=${e.lang||"en"}`,Dl=(r,e)=>{let t=lf(r,e);return Ee.watchPageCache.getOrSet(t,()=>rt.exposedMiniget(t,e).text())},tg="https://www.youtube.com/embed/",rg=(r,e)=>{let t=`${tg+r}?hl=${e.lang||"en"}`;return rt.exposedMiniget(t,e).text()},Cl=r=>{let e=/<script\s+src="([^"]+)"(?:\s+type="text\/javascript")?\s+name="player_ias\/base"\s*>|"jsUrl":"([^"]+)"/.exec(r);return e?e[1]||e[2]:null},ng=(r,e,t,n)=>Ee.cookieCache.getOrSet(t,async()=>{let a=(await Dl(r,e)).match(/(["'])ID_TOKEN\1[:,]\s?"([^"]+)"/);if(!a&&n)throw new an("Cookie header used in request, but unable to find YouTube identity token");return a&&a[2]}),sg=async(r,e,t,n)=>{let o;for(let a of n)try{let u=await og(a,r.concat([o]),t);if(u.player_response&&(u.player_response.videoDetails=Il(o&&o.player_response&&o.player_response.videoDetails,u.player_response.videoDetails),u.player_response=Il(o&&o.player_response,u.player_response)),o=Il(o,u),e(o,!1))break}catch(u){if(u instanceof an||a===n[n.length-1])throw u}return o},Il=(r,e)=>{if(!r||!e)return r||e;for(let[t,n]of Object.entries(e))n!=null&&(r[t]=n);return r},og=async(r,e,t)=>{let n=0,o;for(;n<=t.maxRetries;)try{o=await r(...e);break}catch(a){if(a instanceof an||a instanceof af.MinigetError&&a.statusCode<500||n>=t.maxRetries)throw a;let u=Math.min(++n*t.backoff.inc,t.backoff.max);await new Promise(d=>Yb(d,u))}return o},ig=/^[)\]}'\s]+/,kl=(r,e,t)=>{if(!t||typeof t=="object")return t;try{return t=t.replace(ig,""),JSON.parse(t)}catch(n){throw Error(`Error parsing ${e} in ${r}: ${n.message}`)}},Pl=(r,e,t,n,o,a)=>{let u=rt.between(t,n,o);if(!u)throw Error(`Could not find ${e} in ${r}`);return kl(r,e,rt.cutAfterJS(`${a}${u}`))},Ll=(r,e)=>{let t=e&&(e.args&&e.args.player_response||e.player_response||e.playerResponse||e.embedded_player_response);return kl(r,"player_response",t)},ag=(r,e)=>`${lf(r,e)}&pbj=1`,lg=async(r,e)=>{let t=Object.assign({headers:{}},e.requestOptions),n=t.headers.Cookie||t.headers.cookie;t.headers=Object.assign({"x-youtube-client-name":"1","x-youtube-client-version":Ol,"x-youtube-identity-token":Ee.cookieCache.get(n||"browser")||""},t.headers);let o=async(f,g)=>{t.headers["x-youtube-identity-token"]||(t.headers["x-youtube-identity-token"]=await ng(r,e,f,g))};n&&await o(n,!0);let a=ag(r,e),u=await rt.exposedMiniget(a,e,t).text(),d=kl("watch.json","body",u);if(d.reload==="now"&&await o("browser",!1),d.reload==="now"||!Array.isArray(d))throw Error("Unable to retrieve video metadata in watch.json");let h=d.reduce((f,g)=>Object.assign(g,f),{});return h.player_response=Ll("watch.json",h),h.html5player=h.player&&h.player.assets&&h.player.assets.js,h},ug=async(r,e)=>{let t=await Dl(r,e),n={page:"watch"};try{Ol=rt.between(t,'{"key":"cver","value":"','"}'),n.player_response=Pl("watch.html","player_response",t,/\bytInitialPlayerResponse\s*=\s*\{/i,"</script>","{")}catch{let a=Pl("watch.html","player_response",t,/\bytplayer\.config\s*=\s*{/,"</script>","{");n.player_response=Ll("watch.html",a)}return n.response=Pl("watch.html","response",t,/\bytInitialData("\])?\s*=\s*\{/i,"</script>","{"),n.html5player=Cl(t),n},cg="www.youtube.com",dg="/get_video_info",fg="https://youtube.googleapis.com/v/",mg=async(r,e)=>{let t=new URL(`https://${cg}${dg}`);t.searchParams.set("video_id",r),t.searchParams.set("c","TVHTML5"),t.searchParams.set("cver",`7${Ol.substr(1)}`),t.searchParams.set("eurl",fg+r),t.searchParams.set("ps","default"),t.searchParams.set("gl","US"),t.searchParams.set("hl",e.lang||"en"),t.searchParams.set("html5","1");let n=await rt.exposedMiniget(t.toString(),e).text(),o=Qb.parse(n);return o.player_response=Ll("get_video_info",o),o},hg=r=>{let e=[];return r&&r.streamingData&&(e=e.concat(r.streamingData.formats||[]).concat(r.streamingData.adaptiveFormats||[])),e};Ee.getInfo=async(r,e)=>{let t=await Ee.getBasicInfo(r,e),n=t.player_response&&t.player_response.streamingData&&(t.player_response.streamingData.dashManifestUrl||t.player_response.streamingData.hlsManifestUrl),o=[];if(t.formats.length){if(t.html5player=t.html5player||Cl(await Dl(r,e))||Cl(await rg(r,e)),!t.html5player)throw Error("Unable to find html5player file");let u=new URL(t.html5player,so).toString();o.push(Xb.decipherFormats(t.formats,u,e))}if(n&&t.player_response.streamingData.dashManifestUrl){let u=t.player_response.streamingData.dashManifestUrl;o.push(pg(u,e))}if(n&&t.player_response.streamingData.hlsManifestUrl){let u=t.player_response.streamingData.hlsManifestUrl;o.push(bg(u,e))}let a=await Promise.all(o);return t.formats=Object.values(Object.assign({},...a)),t.formats=t.formats.map(of.addFormatMeta),t.formats.sort(of.sortFormats),t.full=!0,t};var pg=(r,e)=>new Promise((t,n)=>{let o={},a=Gb.parser(!1);a.onerror=n;let u;a.onopentag=h=>{if(h.name==="ADAPTATIONSET")u=h.attributes;else if(h.name==="REPRESENTATION"){let f=parseInt(h.attributes.ID);isNaN(f)||(o[r]=Object.assign({itag:f,url:r,bitrate:parseInt(h.attributes.BANDWIDTH),mimeType:`${u.MIMETYPE}; codecs="${h.attributes.CODECS}"`},h.attributes.HEIGHT?{width:parseInt(h.attributes.WIDTH),height:parseInt(h.attributes.HEIGHT),fps:parseInt(h.attributes.FRAMERATE)}:{audioSampleRate:h.attributes.AUDIOSAMPLINGRATE}))}},a.onend=()=>{t(o)};let d=rt.exposedMiniget(new URL(r,so).toString(),e);d.setEncoding("utf8"),d.on("error",n),d.on("data",h=>{a.write(h)}),d.on("end",a.close.bind(a))}),bg=async(r,e)=>{r=new URL(r,so);let t=await rt.exposedMiniget(r.toString(),e).text(),n={};return t.split(`
`).filter(o=>/^https?:\/\//.test(o)).forEach(o=>{let a=parseInt(o.match(/\/itag\/(\d+)\//)[1]);n[o]={itag:a,url:o}}),n};for(let r of["getBasicInfo","getInfo"]){let e=Ee[r];Ee[r]=async(t,n={})=>{rt.checkForUpdates();let o=await no.getVideoID(t),a=[r,o,n.lang].join("-");return Ee.cache.getOrSet(a,()=>e(o,n))}}Ee.validateID=no.validateID;Ee.validateURL=no.validateURL;Ee.getURLVideoID=no.getURLVideoID;Ee.getVideoID=no.getVideoID});var Nl=me((LE,hf)=>{var gg=require("stream").PassThrough,oo=uf(),cf=us(),Bl=pl(),Ii=bl(),yg=vl(),df=eo(),_g=vi(),{parseTimestamp:wg}=vi(),Ye=(r,e)=>{let t=ff(e);return Ye.getInfo(r,e).then(n=>{mf(t,n,e)},t.emit.bind(t,"error")),t};hf.exports=Ye;Ye.getBasicInfo=oo.getBasicInfo;Ye.getInfo=oo.getInfo;Ye.chooseFormat=Bl.chooseFormat;Ye.filterFormats=Bl.filterFormats;Ye.validateID=Ii.validateID;Ye.validateURL=Ii.validateURL;Ye.getURLVideoID=Ii.getURLVideoID;Ye.getVideoID=Ii.getVideoID;Ye.cache={sig:yg.cache,info:oo.cache,watch:oo.watchPageCache,cookie:oo.cookieCache};Ye.version=dl().version;var ff=r=>{let e=new gg({highWaterMark:r&&r.highWaterMark||524288});return e._destroy=()=>{e.destroyed=!0},e},Fl=(r,e,t)=>{["abort","request","response","error","redirect","retry","reconnect"].forEach(n=>{r.prependListener(n,e.emit.bind(e,n))}),r.pipe(e,{end:t})},mf=(r,e,t)=>{t=t||{};let n=cf.playError(e.player_response,["UNPLAYABLE","LIVE_STREAM_OFFLINE","LOGIN_REQUIRED"]);if(n){r.emit("error",n);return}if(!e.formats.length){r.emit("error",Error("This video is unavailable"));return}let o;try{o=Bl.chooseFormat(e.formats,t)}catch(S){r.emit("error",S);return}if(r.emit("info",e,o),r.destroyed)return;let a,u=0,d=S=>{u+=S.length,r.emit("progress",S.length,u,a)};t.IPv6Block&&(t.requestOptions=Object.assign({},t.requestOptions,{family:6,localAddress:cf.getRandomIPv6(t.IPv6Block)}));let h=t.dlChunkSize||1024*1024*10,f,g=!0;if(o.isHLS||o.isDashMPD)f=_g(o.url,{chunkReadahead:+e.live_chunk_readahead,begin:t.begin||o.isLive&&Date.now(),liveBuffer:t.liveBuffer,requestOptions:t.requestOptions,parser:o.isDashMPD?"dash-mpd":"m3u8",id:o.itag}),f.on("progress",(S,I)=>{r.emit("progress",S.size,S.num,I)}),Fl(f,r,g);else{let S=Object.assign({},t.requestOptions,{maxReconnects:6,maxRetries:3,backoff:{inc:500,max:1e4}});if(h!==0&&(!o.hasAudio||!o.hasVideo)){let _=t.range&&t.range.start||0,A=_+h,C=t.range&&t.range.end;a=t.range?(C?C+1:parseInt(o.contentLength))-_:parseInt(o.contentLength);let B=()=>{!C&&A>=a&&(A=0),C&&A>C&&(A=C),g=!A||A===C,S.headers=Object.assign({},S.headers,{Range:`bytes=${_}-${A||""}`}),f=df(o.url,S),f.on("data",d),f.on("end",()=>{r.destroyed||A&&A!==C&&(_=A+1,A+=h,B())}),Fl(f,r,g)};B()}else t.begin&&(o.url+=`&begin=${wg(t.begin)}`),t.range&&(t.range.start||t.range.end)&&(S.headers=Object.assign({},S.headers,{Range:`bytes=${t.range.start||"0"}-${t.range.end||""}`})),f=df(o.url,S),f.on("response",_=>{r.destroyed||(a=a||parseInt(_.headers["content-length"]))}),f.on("data",d),Fl(f,r,g)}r._destroy=()=>{r.destroyed=!0,f.destroy(),f.end()}};Ye.downloadFromInfo=(r,e)=>{let t=ff(e);if(!r.full)throw Error("Cannot use `ytdl.downloadFromInfo()` when called with info from `ytdl.getBasicInfo()`");return setImmediate(()=>{mf(t,r,e)}),t}});var Xg={};Gu(Xg,{default:()=>Lf});module.exports=Th(Xg);var kf=require("@raycast/api");var Ic=ht(require("node:http"),1),Pc=ht(require("node:https"),1),Lr=ht(require("node:zlib"),1),He=ht(require("node:stream"),1),Ds=require("node:buffer");function Eh(r){if(!/^data:/i.test(r))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');r=r.replace(/\r?\n/g,"");let e=r.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let t=r.substring(5,e).split(";"),n="",o=!1,a=t[0]||"text/plain",u=a;for(let g=1;g<t.length;g++)t[g]==="base64"?o=!0:t[g]&&(u+=`;${t[g]}`,t[g].indexOf("charset=")===0&&(n=t[g].substring(8)));!t[0]&&!n.length&&(u+=";charset=US-ASCII",n="US-ASCII");let d=o?"base64":"ascii",h=unescape(r.substring(e+1)),f=Buffer.from(h,d);return f.type=a,f.typeFull=u,f.charset=n,f}var Xu=Eh;var Ze=ht(require("node:stream"),1),Bt=require("node:util"),We=require("node:buffer");vs();Uo();var Ft=class extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var Fe=class extends Ft{constructor(e,t,n){super(e,t),n&&(this.code=this.errno=n.code,this.erroredSysCall=n.syscall)}};var Wo=Symbol.toStringTag,fa=r=>typeof r=="object"&&typeof r.append=="function"&&typeof r.delete=="function"&&typeof r.get=="function"&&typeof r.getAll=="function"&&typeof r.has=="function"&&typeof r.set=="function"&&typeof r.sort=="function"&&r[Wo]==="URLSearchParams",Ps=r=>r&&typeof r=="object"&&typeof r.arrayBuffer=="function"&&typeof r.type=="string"&&typeof r.stream=="function"&&typeof r.constructor=="function"&&/^(Blob|File)$/.test(r[Wo]),oc=r=>typeof r=="object"&&(r[Wo]==="AbortSignal"||r[Wo]==="EventTarget"),ic=(r,e)=>{let t=new URL(e).hostname,n=new URL(r).hostname;return t===n||t.endsWith(`.${n}`)},ac=(r,e)=>{let t=new URL(e).protocol,n=new URL(r).protocol;return t===n};var $h=(0,Bt.promisify)(Ze.default.pipeline),Be=Symbol("Body internals"),bt=class{constructor(e,{size:t=0}={}){let n=null;e===null?e=null:fa(e)?e=We.Buffer.from(e.toString()):Ps(e)||We.Buffer.isBuffer(e)||(Bt.types.isAnyArrayBuffer(e)?e=We.Buffer.from(e):ArrayBuffer.isView(e)?e=We.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Ze.default||(e instanceof Or?(e=sc(e),n=e.type.split("=")[1]):e=We.Buffer.from(String(e))));let o=e;We.Buffer.isBuffer(e)?o=Ze.default.Readable.from(e):Ps(e)&&(o=Ze.default.Readable.from(e.stream())),this[Be]={body:e,stream:o,boundary:n,disturbed:!1,error:null},this.size=t,e instanceof Ze.default&&e.on("error",a=>{let u=a instanceof Ft?a:new Fe(`Invalid response body while trying to fetch ${this.url}: ${a.message}`,"system",a);this[Be].error=u})}get body(){return this[Be].stream}get bodyUsed(){return this[Be].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:t,byteLength:n}=await pa(this);return e.slice(t,t+n)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let n=new Or,o=new URLSearchParams(await this.text());for(let[a,u]of o)n.append(a,u);return n}let{toFormData:t}=await Promise.resolve().then(()=>(fc(),dc));return t(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[Be].body&&this[Be].body.type||"",t=await this.arrayBuffer();return new Lt([t],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await pa(this);return new TextDecoder().decode(e)}buffer(){return pa(this)}};bt.prototype.buffer=(0,Bt.deprecate)(bt.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(bt.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,Bt.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});async function pa(r){if(r[Be].disturbed)throw new TypeError(`body used already for: ${r.url}`);if(r[Be].disturbed=!0,r[Be].error)throw r[Be].error;let{body:e}=r;if(e===null)return We.Buffer.alloc(0);if(!(e instanceof Ze.default))return We.Buffer.alloc(0);let t=[],n=0;try{for await(let o of e){if(r.size>0&&n+o.length>r.size){let a=new Fe(`content size at ${r.url} over limit: ${r.size}`,"max-size");throw e.destroy(a),a}n+=o.length,t.push(o)}}catch(o){throw o instanceof Ft?o:new Fe(`Invalid response body while trying to fetch ${r.url}: ${o.message}`,"system",o)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return t.every(o=>typeof o=="string")?We.Buffer.from(t.join("")):We.Buffer.concat(t,n)}catch(o){throw new Fe(`Could not create Buffer from response body for ${r.url}: ${o.message}`,"system",o)}else throw new Fe(`Premature close of server response while trying to fetch ${r.url}`)}var Rn=(r,e)=>{let t,n,{body:o}=r[Be];if(r.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof Ze.default&&typeof o.getBoundary!="function"&&(t=new Ze.PassThrough({highWaterMark:e}),n=new Ze.PassThrough({highWaterMark:e}),o.pipe(t),o.pipe(n),r[Be].stream=t,o=n),o},Uh=(0,Bt.deprecate)(r=>r.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),zo=(r,e)=>r===null?null:typeof r=="string"?"text/plain;charset=UTF-8":fa(r)?"application/x-www-form-urlencoded;charset=UTF-8":Ps(r)?r.type||null:We.Buffer.isBuffer(r)||Bt.types.isAnyArrayBuffer(r)||ArrayBuffer.isView(r)?null:r instanceof Or?`multipart/form-data; boundary=${e[Be].boundary}`:r&&typeof r.getBoundary=="function"?`multipart/form-data;boundary=${Uh(r)}`:r instanceof Ze.default?null:"text/plain;charset=UTF-8",mc=r=>{let{body:e}=r[Be];return e===null?0:Ps(e)?e.size:We.Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},hc=async(r,{body:e})=>{e===null?r.end():await $h(e,r)};var ba=require("node:util"),xs=ht(require("node:http"),1),Qo=typeof xs.default.validateHeaderName=="function"?xs.default.validateHeaderName:r=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(r)){let e=new TypeError(`Header name must be a valid HTTP token [${r}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},ga=typeof xs.default.validateHeaderValue=="function"?xs.default.validateHeaderValue:(r,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let t=new TypeError(`Invalid character in header content ["${r}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}},je=class r extends URLSearchParams{constructor(e){let t=[];if(e instanceof r){let n=e.raw();for(let[o,a]of Object.entries(n))t.push(...a.map(u=>[o,u]))}else if(e!=null)if(typeof e=="object"&&!ba.types.isBoxedPrimitive(e)){let n=e[Symbol.iterator];if(n==null)t.push(...Object.entries(e));else{if(typeof n!="function")throw new TypeError("Header pairs must be iterable");t=[...e].map(o=>{if(typeof o!="object"||ba.types.isBoxedPrimitive(o))throw new TypeError("Each header pair must be an iterable object");return[...o]}).map(o=>{if(o.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...o]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return t=t.length>0?t.map(([n,o])=>(Qo(n),ga(n,String(o)),[String(n).toLowerCase(),String(o)])):void 0,super(t),new Proxy(this,{get(n,o,a){switch(o){case"append":case"set":return(u,d)=>(Qo(u),ga(u,String(d)),URLSearchParams.prototype[o].call(n,String(u).toLowerCase(),String(d)));case"delete":case"has":case"getAll":return u=>(Qo(u),URLSearchParams.prototype[o].call(n,String(u).toLowerCase()));case"keys":return()=>(n.sort(),new Set(URLSearchParams.prototype.keys.call(n)).keys());default:return Reflect.get(n,o,a)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let t=this.getAll(e);if(t.length===0)return null;let n=t.join(", ");return/^content-encoding$/i.test(e)&&(n=n.toLowerCase()),n}forEach(e,t=void 0){for(let n of this.keys())Reflect.apply(e,t,[this.get(n),n,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,t)=>(e[t]=this.getAll(t),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,t)=>{let n=this.getAll(t);return t==="host"?e[t]=n[0]:e[t]=n.length>1?n:n[0],e},{})}};Object.defineProperties(je.prototype,["get","entries","forEach","values"].reduce((r,e)=>(r[e]={enumerable:!0},r),{}));function pc(r=[]){return new je(r.reduce((e,t,n,o)=>(n%2===0&&e.push(o.slice(n,n+2)),e),[]).filter(([e,t])=>{try{return Qo(e),ga(e,String(t)),!0}catch{return!1}}))}var Wh=new Set([301,302,303,307,308]),Go=r=>Wh.has(r);var at=Symbol("Response internals"),et=class r extends bt{constructor(e=null,t={}){super(e,t);let n=t.status!=null?t.status:200,o=new je(t.headers);if(e!==null&&!o.has("Content-Type")){let a=zo(e,this);a&&o.append("Content-Type",a)}this[at]={type:"default",url:t.url,status:n,statusText:t.statusText||"",headers:o,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[at].type}get url(){return this[at].url||""}get status(){return this[at].status}get ok(){return this[at].status>=200&&this[at].status<300}get redirected(){return this[at].counter>0}get statusText(){return this[at].statusText}get headers(){return this[at].headers}get highWaterMark(){return this[at].highWaterMark}clone(){return new r(Rn(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!Go(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new r(null,{headers:{location:new URL(e).toString()},status:t})}static error(){let e=new r(null,{status:0,statusText:""});return e[at].type="error",e}static json(e=void 0,t={}){let n=JSON.stringify(e);if(n===void 0)throw new TypeError("data is not JSON serializable");let o=new je(t&&t.headers);return o.has("content-type")||o.set("content-type","application/json"),new r(n,{...t,headers:o})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(et.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var Tc=require("node:url"),Ec=require("node:util");var bc=r=>{if(r.search)return r.search;let e=r.href.length-1,t=r.hash||(r.href[e]==="#"?"#":"");return r.href[e-t.length]==="?"?"?":""};var yc=require("node:net");function gc(r,e=!1){return r==null||(r=new URL(r),/^(about|blob|data):$/.test(r.protocol))?"no-referrer":(r.username="",r.password="",r.hash="",e&&(r.pathname="",r.search=""),r)}var _c=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),wc="strict-origin-when-cross-origin";function Sc(r){if(!_c.has(r))throw new TypeError(`Invalid referrerPolicy: ${r}`);return r}function jh(r){if(/^(http|ws)s:$/.test(r.protocol))return!0;let e=r.host.replace(/(^\[)|(]$)/g,""),t=(0,yc.isIP)(e);return t===4&&/^127\./.test(e)||t===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:r.host==="localhost"||r.host.endsWith(".localhost")?!1:r.protocol==="file:"}function An(r){return/^about:(blank|srcdoc)$/.test(r)||r.protocol==="data:"||/^(blob|filesystem):$/.test(r.protocol)?!0:jh(r)}function Rc(r,{referrerURLCallback:e,referrerOriginCallback:t}={}){if(r.referrer==="no-referrer"||r.referrerPolicy==="")return null;let n=r.referrerPolicy;if(r.referrer==="about:client")return"no-referrer";let o=r.referrer,a=gc(o),u=gc(o,!0);a.toString().length>4096&&(a=u),e&&(a=e(a)),t&&(u=t(u));let d=new URL(r.url);switch(n){case"no-referrer":return"no-referrer";case"origin":return u;case"unsafe-url":return a;case"strict-origin":return An(a)&&!An(d)?"no-referrer":u.toString();case"strict-origin-when-cross-origin":return a.origin===d.origin?a:An(a)&&!An(d)?"no-referrer":u;case"same-origin":return a.origin===d.origin?a:"no-referrer";case"origin-when-cross-origin":return a.origin===d.origin?a:u;case"no-referrer-when-downgrade":return An(a)&&!An(d)?"no-referrer":a;default:throw new TypeError(`Invalid referrerPolicy: ${n}`)}}function Ac(r){let e=(r.get("referrer-policy")||"").split(/[,\s]+/),t="";for(let n of e)n&&_c.has(n)&&(t=n);return t}var Se=Symbol("Request internals"),Os=r=>typeof r=="object"&&typeof r[Se]=="object",Hh=(0,Ec.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),kr=class r extends bt{constructor(e,t={}){let n;if(Os(e)?n=new URL(e.url):(n=new URL(e),e={}),n.username!==""||n.password!=="")throw new TypeError(`${n} is an url with embedded credentials.`);let o=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(o)&&(o=o.toUpperCase()),!Os(t)&&"data"in t&&Hh(),(t.body!=null||Os(e)&&e.body!==null)&&(o==="GET"||o==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let a=t.body?t.body:Os(e)&&e.body!==null?Rn(e):null;super(a,{size:t.size||e.size||0});let u=new je(t.headers||e.headers||{});if(a!==null&&!u.has("Content-Type")){let f=zo(a,this);f&&u.set("Content-Type",f)}let d=Os(e)?e.signal:null;if("signal"in t&&(d=t.signal),d!=null&&!oc(d))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let h=t.referrer==null?e.referrer:t.referrer;if(h==="")h="no-referrer";else if(h){let f=new URL(h);h=/^about:(\/\/)?client$/.test(f)?"client":f}else h=void 0;this[Se]={method:o,redirect:t.redirect||e.redirect||"follow",headers:u,parsedURL:n,signal:d,referrer:h},this.follow=t.follow===void 0?e.follow===void 0?20:e.follow:t.follow,this.compress=t.compress===void 0?e.compress===void 0?!0:e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[Se].method}get url(){return(0,Tc.format)(this[Se].parsedURL)}get headers(){return this[Se].headers}get redirect(){return this[Se].redirect}get signal(){return this[Se].signal}get referrer(){if(this[Se].referrer==="no-referrer")return"";if(this[Se].referrer==="client")return"about:client";if(this[Se].referrer)return this[Se].referrer.toString()}get referrerPolicy(){return this[Se].referrerPolicy}set referrerPolicy(e){this[Se].referrerPolicy=Sc(e)}clone(){return new r(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(kr.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});var vc=r=>{let{parsedURL:e}=r[Se],t=new je(r[Se].headers);t.has("Accept")||t.set("Accept","*/*");let n=null;if(r.body===null&&/^(post|put)$/i.test(r.method)&&(n="0"),r.body!==null){let d=mc(r);typeof d=="number"&&!Number.isNaN(d)&&(n=String(d))}n&&t.set("Content-Length",n),r.referrerPolicy===""&&(r.referrerPolicy=wc),r.referrer&&r.referrer!=="no-referrer"?r[Se].referrer=Rc(r):r[Se].referrer="no-referrer",r[Se].referrer instanceof URL&&t.set("Referer",r.referrer),t.has("User-Agent")||t.set("User-Agent","node-fetch"),r.compress&&!t.has("Accept-Encoding")&&t.set("Accept-Encoding","gzip, deflate, br");let{agent:o}=r;typeof o=="function"&&(o=o(e));let a=bc(e),u={path:e.pathname+a,method:r.method,headers:t[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:r.insecureHTTPParser,agent:o};return{parsedURL:e,options:u}};var Yo=class extends Ft{constructor(e,t="aborted"){super(e,t)}};Uo();ma();var Vh=new Set(["data:","http:","https:"]);async function Xo(r,e){return new Promise((t,n)=>{let o=new kr(r,e),{parsedURL:a,options:u}=vc(o);if(!Vh.has(a.protocol))throw new TypeError(`node-fetch cannot load ${r}. URL scheme "${a.protocol.replace(/:$/,"")}" is not supported.`);if(a.protocol==="data:"){let A=Xu(o.url),C=new et(A,{headers:{"Content-Type":A.typeFull}});t(C);return}let d=(a.protocol==="https:"?Pc.default:Ic.default).request,{signal:h}=o,f=null,g=()=>{let A=new Yo("The operation was aborted.");n(A),o.body&&o.body instanceof He.default.Readable&&o.body.destroy(A),!(!f||!f.body)&&f.body.emit("error",A)};if(h&&h.aborted){g();return}let S=()=>{g(),_()},I=d(a.toString(),u);h&&h.addEventListener("abort",S);let _=()=>{I.abort(),h&&h.removeEventListener("abort",S)};I.on("error",A=>{n(new Fe(`request to ${o.url} failed, reason: ${A.message}`,"system",A)),_()}),zh(I,A=>{f&&f.body&&f.body.destroy(A)}),process.version<"v14"&&I.on("socket",A=>{let C;A.prependListener("end",()=>{C=A._eventsCount}),A.prependListener("close",B=>{if(f&&C<A._eventsCount&&!B){let L=new Error("Premature close");L.code="ERR_STREAM_PREMATURE_CLOSE",f.body.emit("error",L)}})}),I.on("response",A=>{I.setTimeout(0);let C=pc(A.rawHeaders);if(Go(A.statusCode)){let D=C.get("Location"),M=null;try{M=D===null?null:new URL(D,o.url)}catch{if(o.redirect!=="manual"){n(new Fe(`uri requested responds with an invalid redirect URL: ${D}`,"invalid-redirect")),_();return}}switch(o.redirect){case"error":n(new Fe(`uri requested responds with a redirect, redirect mode is set to error: ${o.url}`,"no-redirect")),_();return;case"manual":break;case"follow":{if(M===null)break;if(o.counter>=o.follow){n(new Fe(`maximum redirect reached at: ${o.url}`,"max-redirect")),_();return}let W={headers:new je(o.headers),follow:o.follow,counter:o.counter+1,agent:o.agent,compress:o.compress,method:o.method,body:Rn(o),signal:o.signal,size:o.size,referrer:o.referrer,referrerPolicy:o.referrerPolicy};if(!ic(o.url,M)||!ac(o.url,M))for(let y of["authorization","www-authenticate","cookie","cookie2"])W.headers.delete(y);if(A.statusCode!==303&&o.body&&e.body instanceof He.default.Readable){n(new Fe("Cannot follow redirect with body being a readable stream","unsupported-redirect")),_();return}(A.statusCode===303||(A.statusCode===301||A.statusCode===302)&&o.method==="POST")&&(W.method="GET",W.body=void 0,W.headers.delete("content-length"));let z=Ac(C);z&&(W.referrerPolicy=z),t(Xo(new kr(M,W))),_();return}default:return n(new TypeError(`Redirect option '${o.redirect}' is not a valid value of RequestRedirect`))}}h&&A.once("end",()=>{h.removeEventListener("abort",S)});let B=(0,He.pipeline)(A,new He.PassThrough,D=>{D&&n(D)});process.version<"v12.10"&&A.on("aborted",S);let L={url:o.url,status:A.statusCode,statusText:A.statusMessage,headers:C,size:o.size,counter:o.counter,highWaterMark:o.highWaterMark},E=C.get("Content-Encoding");if(!o.compress||o.method==="HEAD"||E===null||A.statusCode===204||A.statusCode===304){f=new et(B,L),t(f);return}let F={flush:Lr.default.Z_SYNC_FLUSH,finishFlush:Lr.default.Z_SYNC_FLUSH};if(E==="gzip"||E==="x-gzip"){B=(0,He.pipeline)(B,Lr.default.createGunzip(F),D=>{D&&n(D)}),f=new et(B,L),t(f);return}if(E==="deflate"||E==="x-deflate"){let D=(0,He.pipeline)(A,new He.PassThrough,M=>{M&&n(M)});D.once("data",M=>{(M[0]&15)===8?B=(0,He.pipeline)(B,Lr.default.createInflate(),W=>{W&&n(W)}):B=(0,He.pipeline)(B,Lr.default.createInflateRaw(),W=>{W&&n(W)}),f=new et(B,L),t(f)}),D.once("end",()=>{f||(f=new et(B,L),t(f))});return}if(E==="br"){B=(0,He.pipeline)(B,Lr.default.createBrotliDecompress(),D=>{D&&n(D)}),f=new et(B,L),t(f);return}f=new et(B,L),t(f)}),hc(I,o).catch(n)})}function zh(r,e){let t=Ds.Buffer.from(`0\r
\r
`),n=!1,o=!1,a;r.on("response",u=>{let{headers:d}=u;n=d["transfer-encoding"]==="chunked"&&!d["content-length"]}),r.on("socket",u=>{let d=()=>{if(n&&!o){let f=new Error("Premature close");f.code="ERR_STREAM_PREMATURE_CLOSE",e(f)}},h=f=>{o=Ds.Buffer.compare(f.slice(-5),t)===0,!o&&a&&(o=Ds.Buffer.compare(a.slice(-3),t.slice(0,3))===0&&Ds.Buffer.compare(f.slice(-2),t.slice(3))===0),a=f};u.prependListener("close",d),u.on("data",h),r.on("close",()=>{u.removeListener("close",d),u.removeListener("data",h)})})}var Sr=require("react");var sn=require("@raycast/api");function V(r,e,t,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(r,t):o?o.value=t:e.set(r,t),t}function R(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}var ya=function(){let{crypto:r}=globalThis;if(r?.randomUUID)return ya=r.randomUUID.bind(r),r.randomUUID();let e=new Uint8Array(1),t=r?()=>r.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};function ks(r){return typeof r=="object"&&r!==null&&("name"in r&&r.name==="AbortError"||"message"in r&&String(r.message).includes("FetchRequestCanceledException"))}var Ls=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null){try{if(Object.prototype.toString.call(r)==="[object Error]"){let e=new Error(r.message,r.cause?{cause:r.cause}:{});return r.stack&&(e.stack=r.stack),r.cause&&!e.cause&&(e.cause=r.cause),r.name&&(e.name=r.name),e}}catch{}try{return new Error(JSON.stringify(r))}catch{}}return new Error(r)};var U=class extends Error{},pe=class r extends U{constructor(e,t,n,o){super(`${r.makeMessage(e,t,n)}`),this.status=e,this.headers=o,this.requestID=o?.get("x-request-id"),this.error=t;let a=t;this.code=a?.code,this.param=a?.param,this.type=a?.type}static makeMessage(e,t,n){let o=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,t,n,o){if(!e||!o)return new nr({message:n,cause:Ls(t)});let a=t?.error;return e===400?new Tn(e,a,n,o):e===401?new En(e,a,n,o):e===403?new vn(e,a,n,o):e===404?new In(e,a,n,o):e===409?new Pn(e,a,n,o):e===422?new Cn(e,a,n,o):e===429?new xn(e,a,n,o):e>=500?new On(e,a,n,o):new r(e,a,n,o)}},he=class extends pe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},nr=class extends pe{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},sr=class extends nr{constructor({message:e}={}){super({message:e??"Request timed out."})}},Tn=class extends pe{},En=class extends pe{},vn=class extends pe{},In=class extends pe{},Pn=class extends pe{},Cn=class extends pe{},xn=class extends pe{},On=class extends pe{},Dn=class extends U{constructor(){super("Could not parse response content as the length limit was reached")}},kn=class extends U{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};var Gh=/^[a-z][a-z0-9+.-]*:/i,Cc=r=>Gh.test(r);function xc(r){return typeof r!="object"?{}:r??{}}function Oc(r){if(!r)return!0;for(let e in r)return!1;return!0}function Dc(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Fs(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}var kc=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new U(`${r} must be an integer`);if(e<0)throw new U(`${r} must be a positive integer`);return e};var Lc=r=>{try{return JSON.parse(r)}catch{return}};var gt=r=>new Promise(e=>setTimeout(e,r));var Ko={off:0,error:200,warn:300,info:400,debug:500},_a=(r,e,t)=>{if(r){if(Dc(Ko,r))return r;be(t).warn(`${e} was set to ${JSON.stringify(r)}, expected one of ${JSON.stringify(Object.keys(Ko))}`)}};function Bs(){}function Jo(r,e,t){return!e||Ko[r]>Ko[t]?Bs:e[r].bind(e)}var Yh={error:Bs,warn:Bs,info:Bs,debug:Bs},Fc=new WeakMap;function be(r){let e=r.logger,t=r.logLevel??"off";if(!e)return Yh;let n=Fc.get(e);if(n&&n[0]===t)return n[1];let o={error:Jo("error",e,t),warn:Jo("warn",e,t),info:Jo("info",e,t),debug:Jo("debug",e,t)};return Fc.set(e,[t,o]),o}var Nt=r=>(r.options&&(r.options={...r.options},delete r.options.headers),r.headers&&(r.headers=Object.fromEntries((r.headers instanceof Headers?[...r.headers]:Object.entries(r.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in r&&(r.retryOfRequestLogID&&(r.retryOf=r.retryOfRequestLogID),delete r.retryOfRequestLogID),r);var or="5.1.0";var qc=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Xh(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var Jh=()=>{let r=Xh();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":or,"X-Stainless-OS":Nc(Deno.build.os),"X-Stainless-Arch":Bc(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":or,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":or,"X-Stainless-OS":Nc(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Bc(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=Kh();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":or,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":or,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Kh(){if(typeof navigator>"u"||!navigator)return null;let r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of r){let n=t.exec(navigator.userAgent);if(n){let o=n[1]||0,a=n[2]||0,u=n[3]||0;return{browser:e,version:`${o}.${a}.${u}`}}}return null}var Bc=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",Nc=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown"),Mc,$c=()=>Mc??(Mc=Jh());function Uc(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function wa(...r){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...r)}function Zo(r){let e=Symbol.asyncIterator in r?r[Symbol.asyncIterator]():r[Symbol.iterator]();return wa({start(){},async pull(t){let{done:n,value:o}=await e.next();n?t.close():t.enqueue(o)},async cancel(){await e.return?.()}})}function Sa(r){if(r[Symbol.asyncIterator])return r;let e=r.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Wc(r){if(r===null||typeof r!="object")return;if(r[Symbol.asyncIterator]){await r[Symbol.asyncIterator]().return?.();return}let e=r.getReader(),t=e.cancel();e.releaseLock(),await t}var jc=({headers:r,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var Ns="RFC3986",Ms={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:r=>String(r)},Ra="RFC1738";var tp=Array.isArray,yt=(()=>{let r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})();var Aa=1024,Hc=(r,e,t,n,o)=>{if(r.length===0)return r;let a=r;if(typeof r=="symbol"?a=Symbol.prototype.toString.call(r):typeof r!="string"&&(a=String(r)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(d){return"%26%23"+parseInt(d.slice(2),16)+"%3B"});let u="";for(let d=0;d<a.length;d+=Aa){let h=a.length>=Aa?a.slice(d,d+Aa):a,f=[];for(let g=0;g<h.length;++g){let S=h.charCodeAt(g);if(S===45||S===46||S===95||S===126||S>=48&&S<=57||S>=65&&S<=90||S>=97&&S<=122||o===Ra&&(S===40||S===41)){f[f.length]=h.charAt(g);continue}if(S<128){f[f.length]=yt[S];continue}if(S<2048){f[f.length]=yt[192|S>>6]+yt[128|S&63];continue}if(S<55296||S>=57344){f[f.length]=yt[224|S>>12]+yt[128|S>>6&63]+yt[128|S&63];continue}g+=1,S=65536+((S&1023)<<10|h.charCodeAt(g)&1023),f[f.length]=yt[240|S>>18]+yt[128|S>>12&63]+yt[128|S>>6&63]+yt[128|S&63]}u+=f.join("")}return u};function Vc(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function Ta(r,e){if(tp(r)){let t=[];for(let n=0;n<r.length;n+=1)t.push(e(r[n]));return t}return e(r)}var rp=Object.prototype.hasOwnProperty,zc={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},_t=Array.isArray,np=Array.prototype.push,Qc=function(r,e){np.apply(r,_t(e)?e:[e])},sp=Date.prototype.toISOString,ge={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:Hc,encodeValuesOnly:!1,format:Ns,formatter:Ms[Ns],indices:!1,serializeDate(r){return sp.call(r)},skipNulls:!1,strictNullHandling:!1};function op(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}var Ea={};function Gc(r,e,t,n,o,a,u,d,h,f,g,S,I,_,A,C,B,L){let E=r,F=L,D=0,M=!1;for(;(F=F.get(Ea))!==void 0&&!M;){let N=F.get(r);if(D+=1,typeof N<"u"){if(N===D)throw new RangeError("Cyclic object value");M=!0}typeof F.get(Ea)>"u"&&(D=0)}if(typeof f=="function"?E=f(e,E):E instanceof Date?E=I?.(E):t==="comma"&&_t(E)&&(E=Ta(E,function(N){return N instanceof Date?I?.(N):N})),E===null){if(a)return h&&!C?h(e,ge.encoder,B,"key",_):e;E=""}if(op(E)||Vc(E)){if(h){let N=C?e:h(e,ge.encoder,B,"key",_);return[A?.(N)+"="+A?.(h(E,ge.encoder,B,"value",_))]}return[A?.(e)+"="+A?.(String(E))]}let W=[];if(typeof E>"u")return W;let z;if(t==="comma"&&_t(E))C&&h&&(E=Ta(E,h)),z=[{value:E.length>0?E.join(",")||null:void 0}];else if(_t(f))z=f;else{let N=Object.keys(E);z=g?N.sort(g):N}let y=d?String(e).replace(/\./g,"%2E"):String(e),Z=n&&_t(E)&&E.length===1?y+"[]":y;if(o&&_t(E)&&E.length===0)return Z+"[]";for(let N=0;N<z.length;++N){let k=z[N],ee=typeof k=="object"&&typeof k.value<"u"?k.value:E[k];if(u&&ee===null)continue;let se=S&&d?k.replace(/\./g,"%2E"):k,oe=_t(E)?typeof t=="function"?t(Z,se):Z:Z+(S?"."+se:"["+se+"]");L.set(r,D);let Ae=new WeakMap;Ae.set(Ea,L),Qc(W,Gc(ee,oe,t,n,o,a,u,d,t==="comma"&&C&&_t(E)?null:h,f,g,S,I,_,A,C,B,Ae))}return W}function ip(r=ge){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=r.charset||ge.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Ns;if(typeof r.format<"u"){if(!rp.call(Ms,r.format))throw new TypeError("Unknown format option provided.");t=r.format}let n=Ms[t],o=ge.filter;(typeof r.filter=="function"||_t(r.filter))&&(o=r.filter);let a;if(r.arrayFormat&&r.arrayFormat in zc?a=r.arrayFormat:"indices"in r?a=r.indices?"indices":"repeat":a=ge.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let u=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:ge.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:ge.addQueryPrefix,allowDots:u,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:ge.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:ge.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?ge.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:ge.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:ge.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:ge.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:ge.encodeValuesOnly,filter:o,format:t,formatter:n,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:ge.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:ge.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:ge.strictNullHandling}}function va(r,e={}){let t=r,n=ip(e),o,a;typeof n.filter=="function"?(a=n.filter,t=a("",t)):_t(n.filter)&&(a=n.filter,o=a);let u=[];if(typeof t!="object"||t===null)return"";let d=zc[n.arrayFormat],h=d==="comma"&&n.commaRoundTrip;o||(o=Object.keys(t)),n.sort&&o.sort(n.sort);let f=new WeakMap;for(let I=0;I<o.length;++I){let _=o[I];n.skipNulls&&t[_]===null||Qc(u,Gc(t[_],_,d,h,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,f))}let g=u.join(n.delimiter),S=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?S+="utf8=%26%2310003%3B&":S+="utf8=%E2%9C%93&"),g.length>0?S+g:""}function Jc(r){let e=0;for(let o of r)e+=o.length;let t=new Uint8Array(e),n=0;for(let o of r)t.set(o,n),n+=o.length;return t}var Yc;function Ln(r){let e;return(Yc??(e=new globalThis.TextEncoder,Yc=e.encode.bind(e)))(r)}var Xc;function Ia(r){let e;return(Xc??(e=new globalThis.TextDecoder,Xc=e.decode.bind(e)))(r)}var Ve,ze,Fr=class{constructor(){Ve.set(this,void 0),ze.set(this,void 0),V(this,Ve,new Uint8Array,"f"),V(this,ze,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Ln(e):e;V(this,Ve,Jc([R(this,Ve,"f"),t]),"f");let n=[],o;for(;(o=lp(R(this,Ve,"f"),R(this,ze,"f")))!=null;){if(o.carriage&&R(this,ze,"f")==null){V(this,ze,o.index,"f");continue}if(R(this,ze,"f")!=null&&(o.index!==R(this,ze,"f")+1||o.carriage)){n.push(Ia(R(this,Ve,"f").subarray(0,R(this,ze,"f")-1))),V(this,Ve,R(this,Ve,"f").subarray(R(this,ze,"f")),"f"),V(this,ze,null,"f");continue}let a=R(this,ze,"f")!==null?o.preceding-1:o.preceding,u=Ia(R(this,Ve,"f").subarray(0,a));n.push(u),V(this,Ve,R(this,Ve,"f").subarray(o.index),"f"),V(this,ze,null,"f")}return n}flush(){return R(this,Ve,"f").length?this.decode(`
`):[]}};Ve=new WeakMap,ze=new WeakMap;Fr.NEWLINE_CHARS=new Set([`
`,"\r"]);Fr.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function lp(r,e){for(let o=e??0;o<r.length;o++){if(r[o]===10)return{preceding:o,index:o+1,carriage:!1};if(r[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function Kc(r){for(let n=0;n<r.length-1;n++){if(r[n]===10&&r[n+1]===10||r[n]===13&&r[n+1]===13)return n+2;if(r[n]===13&&r[n+1]===10&&n+3<r.length&&r[n+2]===13&&r[n+3]===10)return n+4}return-1}var wt=class r{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;async function*o(){if(n)throw new U("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{for await(let u of up(e,t))if(!a){if(u.data.startsWith("[DONE]")){a=!0;continue}if(u.event===null||u.event.startsWith("response.")||u.event.startsWith("transcript.")){let d;try{d=JSON.parse(u.data)}catch(h){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),h}if(d&&d.error)throw new pe(void 0,d.error,void 0,e.headers);yield d}else{let d;try{d=JSON.parse(u.data)}catch(h){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),h}if(u.event=="error")throw new pe(void 0,d.error,d.message,void 0);yield{event:u.event,data:d}}}a=!0}catch(u){if(ks(u))return;throw u}finally{a||t.abort()}}return new r(o,t)}static fromReadableStream(e,t){let n=!1;async function*o(){let u=new Fr,d=Sa(e);for await(let h of d)for(let f of u.decode(h))yield f;for(let h of u.flush())yield h}async function*a(){if(n)throw new U("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let u=!1;try{for await(let d of o())u||d&&(yield JSON.parse(d));u=!0}catch(d){if(ks(d))return;throw d}finally{u||t.abort()}}return new r(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],n=this.iterator(),o=a=>({next:()=>{if(a.length===0){let u=n.next();e.push(u),t.push(u)}return a.shift()}});return[new r(()=>o(e),this.controller),new r(()=>o(t),this.controller)]}toReadableStream(){let e=this,t;return wa({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{let{value:o,done:a}=await t.next();if(a)return n.close();let u=Ln(JSON.stringify(o)+`
`);n.enqueue(u)}catch(o){n.error(o)}},async cancel(){await t.return?.()}})}};async function*up(r,e){if(!r.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new U("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new U("Attempted to iterate over a response with no body");let t=new Pa,n=new Fr,o=Sa(r.body);for await(let a of cp(o))for(let u of n.decode(a)){let d=t.decode(u);d&&(yield d)}for(let a of n.flush()){let u=t.decode(a);u&&(yield u)}}async function*cp(r){let e=new Uint8Array;for await(let t of r){if(t==null)continue;let n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Ln(t):t,o=new Uint8Array(e.length+n.length);o.set(e),o.set(n,e.length),e=o;let a;for(;(a=Kc(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}var Pa=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,o]=dp(e,":");return o.startsWith(" ")&&(o=o.substring(1)),t==="event"?this.event=o:t==="data"&&this.data.push(o),null}};function dp(r,e){let t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}async function ei(r,e){let{response:t,requestLogID:n,retryOfRequestLogID:o,startTime:a}=e,u=await(async()=>{if(e.options.stream)return be(r).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):wt.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let h=t.headers.get("content-type")?.split(";")[0]?.trim();if(h?.includes("application/json")||h?.endsWith("+json")){let S=await t.json();return Ca(S,t)}return await t.text()})();return be(r).debug(`[${n}] response parsed`,Nt({retryOfRequestLogID:o,url:t.url,status:t.status,body:u,durationMs:Date.now()-a})),u}function Ca(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var qs,Br=class r extends Promise{constructor(e,t,n=ei){super(o=>{o(null)}),this.responsePromise=t,this.parseResponse=n,qs.set(this,void 0),V(this,qs,e,"f")}_thenUnwrap(e){return new r(R(this,qs,"f"),this.responsePromise,async(t,n)=>Ca(e(await this.parseResponse(t,n),n),n.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(R(this,qs,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};qs=new WeakMap;var ti,ri=class{constructor(e,t,n,o){ti.set(this,void 0),V(this,ti,e,"f"),this.options=o,this.response=t,this.body=n}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new U("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await R(this,ti,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ti=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},$s=class extends Br{constructor(e,t,n){super(e,t,async(o,a)=>new n(o,a.response,await ei(o,a),a.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},St=class extends ri{constructor(e,t,n,o){super(e,t,n,o),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}},K=class extends ri{constructor(e,t,n,o){super(e,t,n,o),this.data=n.data||[],this.has_more=n.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...xc(this.options.query),after:t}}:null}};var Oa=()=>{if(typeof File>"u"){let{process:r}=globalThis,e=typeof r?.versions?.node=="string"&&parseInt(r.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Fn(r,e,t){return Oa(),new File(r,e??"unknown_file",t)}function Us(r){return(typeof r=="object"&&r!==null&&("name"in r&&r.name&&String(r.name)||"url"in r&&r.url&&String(r.url)||"filename"in r&&r.filename&&String(r.filename)||"path"in r&&r.path&&String(r.path))||"").split(/[\\/]/).pop()||void 0}var Da=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function";var Qe=async(r,e)=>({...r,body:await hp(r.body,e)}),Zc=new WeakMap;function mp(r){let e=typeof r=="function"?r:r.fetch,t=Zc.get(e);if(t)return t;let n=(async()=>{try{let o="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new o(a).text()}catch{return!0}})();return Zc.set(e,n),n}var hp=async(r,e)=>{if(!await mp(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return await Promise.all(Object.entries(r||{}).map(([n,o])=>xa(t,n,o))),t},pp=r=>r instanceof Blob&&"name"in r;var xa=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(t instanceof Response)r.append(e,Fn([await t.blob()],Us(t)));else if(Da(t))r.append(e,Fn([await new Response(Zo(t)).blob()],Us(t)));else if(pp(t))r.append(e,t,Us(t));else if(Array.isArray(t))await Promise.all(t.map(n=>xa(r,e+"[]",n)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([n,o])=>xa(r,`${e}[${n}]`,o)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var ed=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",bp=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&ed(r),gp=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function";async function ni(r,e,t){if(Oa(),r=await r,bp(r))return r instanceof File?r:Fn([await r.arrayBuffer()],r.name);if(gp(r)){let o=await r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()),Fn(await ka(o),e,t)}let n=await ka(r);if(e||(e=Us(r)),!t?.type){let o=n.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof o=="string"&&(t={...t,type:o})}return Fn(n,e,t)}async function ka(r){let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(ed(r))e.push(r instanceof Blob?r:await r.arrayBuffer());else if(Da(r))for await(let t of r)e.push(...await ka(t));else{let t=r?.constructor?.name;throw new Error(`Unexpected data type: ${typeof r}${t?`; constructor: ${t}`:""}${yp(r)}`)}return e}function yp(r){return typeof r!="object"||r===null?"":`; props: [${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}var O=class{constructor(e){this._client=e}};function td(r){return r.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var wp=(r=td)=>function(t,...n){if(t.length===1)return t[0];let o=!1,a=t.reduce((g,S,I)=>(/[?#]/.test(S)&&(o=!0),g+S+(I===n.length?"":(o?encodeURIComponent:r)(String(n[I])))),""),u=a.split(/[?#]/,1)[0],d=[],h=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,f;for(;(f=h.exec(u))!==null;)d.push({start:f.index,length:f[0].length});if(d.length>0){let g=0,S=d.reduce((I,_)=>{let A=" ".repeat(_.start-g),C="^".repeat(_.length);return g=_.start+_.length,I+A+C},"");throw new U(`Path parameters result in path with invalid segments:
${a}
${S}`)}return a},x=wp(td);var Nr=class extends O{list(e,t={},n){return this._client.getAPIList(x`/chat/completions/${e}/messages`,K,{query:t,...n})}};function rd(r){return typeof r.parse=="function"}var Bn=r=>r?.role==="assistant",La=r=>r?.role==="tool";var Fa,si,oi,Ws,js,ii,Hs,Mt,Vs,ai,li,Nn,nd,ir=class{constructor(){Fa.add(this),this.controller=new AbortController,si.set(this,void 0),oi.set(this,()=>{}),Ws.set(this,()=>{}),js.set(this,void 0),ii.set(this,()=>{}),Hs.set(this,()=>{}),Mt.set(this,{}),Vs.set(this,!1),ai.set(this,!1),li.set(this,!1),Nn.set(this,!1),V(this,si,new Promise((e,t)=>{V(this,oi,e,"f"),V(this,Ws,t,"f")}),"f"),V(this,js,new Promise((e,t)=>{V(this,ii,e,"f"),V(this,Hs,t,"f")}),"f"),R(this,si,"f").catch(()=>{}),R(this,js,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},R(this,Fa,"m",nd).bind(this))},0)}_connected(){this.ended||(R(this,oi,"f").call(this),this._emit("connect"))}get ended(){return R(this,Vs,"f")}get errored(){return R(this,ai,"f")}get aborted(){return R(this,li,"f")}abort(){this.controller.abort()}on(e,t){return(R(this,Mt,"f")[e]||(R(this,Mt,"f")[e]=[])).push({listener:t}),this}off(e,t){let n=R(this,Mt,"f")[e];if(!n)return this;let o=n.findIndex(a=>a.listener===t);return o>=0&&n.splice(o,1),this}once(e,t){return(R(this,Mt,"f")[e]||(R(this,Mt,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{V(this,Nn,!0,"f"),e!=="error"&&this.once("error",n),this.once(e,t)})}async done(){V(this,Nn,!0,"f"),await R(this,js,"f")}_emit(e,...t){if(R(this,Vs,"f"))return;e==="end"&&(V(this,Vs,!0,"f"),R(this,ii,"f").call(this));let n=R(this,Mt,"f")[e];if(n&&(R(this,Mt,"f")[e]=n.filter(o=>!o.once),n.forEach(({listener:o})=>o(...t))),e==="abort"){let o=t[0];!R(this,Nn,"f")&&!n?.length&&Promise.reject(o),R(this,Ws,"f").call(this,o),R(this,Hs,"f").call(this,o),this._emit("end");return}if(e==="error"){let o=t[0];!R(this,Nn,"f")&&!n?.length&&Promise.reject(o),R(this,Ws,"f").call(this,o),R(this,Hs,"f").call(this,o),this._emit("end")}}_emitFinal(){}};si=new WeakMap,oi=new WeakMap,Ws=new WeakMap,js=new WeakMap,ii=new WeakMap,Hs=new WeakMap,Mt=new WeakMap,Vs=new WeakMap,ai=new WeakMap,li=new WeakMap,Nn=new WeakMap,Fa=new WeakSet,nd=function(e){if(V(this,ai,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new he),e instanceof he)return V(this,li,!0,"f"),this._emit("abort",e);if(e instanceof U)return this._emit("error",e);if(e instanceof Error){let t=new U(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new U(String(e)))};function zs(r){return r?.$brand==="auto-parseable-response-format"}function Mr(r){return r?.$brand==="auto-parseable-tool"}function sd(r,e){return!e||!Ba(e)?{...r,choices:r.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Qs(r,e)}function Qs(r,e){let t=r.choices.map(n=>{if(n.finish_reason==="length")throw new Dn;if(n.finish_reason==="content_filter")throw new kn;return{...n,message:{...n.message,...n.message.tool_calls?{tool_calls:n.message.tool_calls?.map(o=>Tp(e,o))??void 0}:void 0,parsed:n.message.content&&!n.message.refusal?Ap(e,n.message.content):null}}});return{...r,choices:t}}function Ap(r,e){return r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function Tp(r,e){let t=r.tools?.find(n=>n.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:Mr(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function od(r,e){if(!r)return!1;let t=r.tools?.find(n=>n.function?.name===e.function.name);return Mr(t)||t?.function.strict||!1}function Ba(r){return zs(r.response_format)?!0:r.tools?.some(e=>Mr(e)||e.type==="function"&&e.function.strict===!0)??!1}function id(r){for(let e of r??[]){if(e.type!=="function")throw new U(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new U(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var Ce,Na,ui,Ma,qa,$a,ad,ld,Ep=10,Mn=class extends ir{constructor(){super(...arguments),Ce.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),La(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Bn(e)&&e.tool_calls)for(let n of e.tool_calls)n.type==="function"&&this._emit("functionToolCall",n.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new U("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),R(this,Ce,"m",Na).call(this)}async finalMessage(){return await this.done(),R(this,Ce,"m",ui).call(this)}async finalFunctionToolCall(){return await this.done(),R(this,Ce,"m",Ma).call(this)}async finalFunctionToolCallResult(){return await this.done(),R(this,Ce,"m",qa).call(this)}async totalUsage(){return await this.done(),R(this,Ce,"m",$a).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=R(this,Ce,"m",ui).call(this);t&&this._emit("finalMessage",t);let n=R(this,Ce,"m",Na).call(this);n&&this._emit("finalContent",n);let o=R(this,Ce,"m",Ma).call(this);o&&this._emit("finalFunctionToolCall",o);let a=R(this,Ce,"m",qa).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(u=>u.usage)&&this._emit("totalUsage",R(this,Ce,"m",$a).call(this))}async _createChatCompletion(e,t,n){let o=n?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),R(this,Ce,"m",ad).call(this,t);let a=await e.chat.completions.create({...t,stream:!1},{...n,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Qs(a,t))}async _runChatCompletion(e,t,n){for(let o of t.messages)this._addMessage(o,!1);return await this._createChatCompletion(e,t,n)}async _runTools(e,t,n){let o="tool",{tool_choice:a="auto",stream:u,...d}=t,h=typeof a!="string"&&a?.function?.name,{maxChatCompletions:f=Ep}=n||{},g=t.tools.map(_=>{if(Mr(_)){if(!_.$callback)throw new U("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:_.$callback,name:_.function.name,description:_.function.description||"",parameters:_.function.parameters,parse:_.$parseRaw,strict:!0}}}return _}),S={};for(let _ of g)_.type==="function"&&(S[_.function.name||_.function.function.name]=_.function);let I="tools"in t?g.map(_=>_.type==="function"?{type:"function",function:{name:_.function.name||_.function.function.name,parameters:_.function.parameters,description:_.function.description,strict:_.function.strict}}:_):void 0;for(let _ of t.messages)this._addMessage(_,!1);for(let _=0;_<f;++_){let C=(await this._createChatCompletion(e,{...d,tool_choice:a,tools:I,messages:[...this.messages]},n)).choices[0]?.message;if(!C)throw new U("missing message in ChatCompletion response");if(!C.tool_calls?.length)return;for(let B of C.tool_calls){if(B.type!=="function")continue;let L=B.id,{name:E,arguments:F}=B.function,D=S[E];if(D){if(h&&h!==E){let y=`Invalid tool_call: ${JSON.stringify(E)}. ${JSON.stringify(h)} requested. Please try again`;this._addMessage({role:o,tool_call_id:L,content:y});continue}}else{let y=`Invalid tool_call: ${JSON.stringify(E)}. Available options are: ${Object.keys(S).map(Z=>JSON.stringify(Z)).join(", ")}. Please try again`;this._addMessage({role:o,tool_call_id:L,content:y});continue}let M;try{M=rd(D)?await D.parse(F):F}catch(y){let Z=y instanceof Error?y.message:String(y);this._addMessage({role:o,tool_call_id:L,content:Z});continue}let W=await D.function(M,this),z=R(this,Ce,"m",ld).call(this,W);if(this._addMessage({role:o,tool_call_id:L,content:z}),h)return}}}};Ce=new WeakSet,Na=function(){return R(this,Ce,"m",ui).call(this).content??null},ui=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(Bn(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new U("stream ended without producing a ChatCompletionMessage with role=assistant")},Ma=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(Bn(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},qa=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(La(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(n=>n.role==="assistant"&&n.tool_calls?.some(o=>o.type==="function"&&o.id===t.tool_call_id)))return t.content}},$a=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},ad=function(e){if(e.n!=null&&e.n>1)throw new U("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ld=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};var Gs=class r extends Mn{static runTools(e,t,n){let o=new r,a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return o._run(()=>o._runTools(e,t,a)),o}_addMessage(e,t=!0){super._addMessage(e,t),Bn(e)&&e.content&&this._emit("content",e.content)}};var Re={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,INF:384,SPECIAL:496,ATOM:499,COLLECTION:12,ALL:511},Ua=class extends Error{},Wa=class extends Error{};function vp(r,e=Re.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return Ip(r.trim(),e)}var Ip=(r,e)=>{let t=r.length,n=0,o=I=>{throw new Ua(`${I} at position ${n}`)},a=I=>{throw new Wa(`${I} at position ${n}`)},u=()=>(S(),n>=t&&o("Unexpected end of input"),r[n]==='"'?d():r[n]==="{"?h():r[n]==="["?f():r.substring(n,n+4)==="null"||Re.NULL&e&&t-n<4&&"null".startsWith(r.substring(n))?(n+=4,null):r.substring(n,n+4)==="true"||Re.BOOL&e&&t-n<4&&"true".startsWith(r.substring(n))?(n+=4,!0):r.substring(n,n+5)==="false"||Re.BOOL&e&&t-n<5&&"false".startsWith(r.substring(n))?(n+=5,!1):r.substring(n,n+8)==="Infinity"||Re.INFINITY&e&&t-n<8&&"Infinity".startsWith(r.substring(n))?(n+=8,1/0):r.substring(n,n+9)==="-Infinity"||Re.MINUS_INFINITY&e&&1<t-n&&t-n<9&&"-Infinity".startsWith(r.substring(n))?(n+=9,-1/0):r.substring(n,n+3)==="NaN"||Re.NAN&e&&t-n<3&&"NaN".startsWith(r.substring(n))?(n+=3,NaN):g()),d=()=>{let I=n,_=!1;for(n++;n<t&&(r[n]!=='"'||_&&r[n-1]==="\\");)_=r[n]==="\\"?!_:!1,n++;if(r.charAt(n)=='"')try{return JSON.parse(r.substring(I,++n-Number(_)))}catch(A){a(String(A))}else if(Re.STR&e)try{return JSON.parse(r.substring(I,n-Number(_))+'"')}catch{return JSON.parse(r.substring(I,r.lastIndexOf("\\"))+'"')}o("Unterminated string literal")},h=()=>{n++,S();let I={};try{for(;r[n]!=="}";){if(S(),n>=t&&Re.OBJ&e)return I;let _=d();S(),n++;try{let A=u();Object.defineProperty(I,_,{value:A,writable:!0,enumerable:!0,configurable:!0})}catch(A){if(Re.OBJ&e)return I;throw A}S(),r[n]===","&&n++}}catch{if(Re.OBJ&e)return I;o("Expected '}' at end of object")}return n++,I},f=()=>{n++;let I=[];try{for(;r[n]!=="]";)I.push(u()),S(),r[n]===","&&n++}catch{if(Re.ARR&e)return I;o("Expected ']' at end of array")}return n++,I},g=()=>{if(n===0){r==="-"&&Re.NUM&e&&o("Not sure what '-' is");try{return JSON.parse(r)}catch(_){if(Re.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}a(String(_))}}let I=n;for(r[n]==="-"&&n++;r[n]&&!",]}".includes(r[n]);)n++;n==t&&!(Re.NUM&e)&&o("Unterminated number literal");try{return JSON.parse(r.substring(I,n))}catch{r.substring(I,n)==="-"&&Re.NUM&e&&o("Not sure what '-' is");try{return JSON.parse(r.substring(I,r.lastIndexOf("e")))}catch(A){a(String(A))}}},S=()=>{for(;n<t&&` 
\r	`.includes(r[n]);)n++};return u()},ja=r=>vp(r,Re.ALL^Re.NUM);var ye,qt,qn,ar,Ha,ci,Va,za,Qa,di,Ga,ud,qr=class r extends Mn{constructor(e){super(),ye.add(this),qt.set(this,void 0),qn.set(this,void 0),ar.set(this,void 0),V(this,qt,e,"f"),V(this,qn,[],"f")}get currentChatCompletionSnapshot(){return R(this,ar,"f")}static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){let o=new r(t);return o._run(()=>o._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createChatCompletion(e,t,n){super._createChatCompletion;let o=n?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),R(this,ye,"m",Ha).call(this);let a=await e.chat.completions.create({...t,stream:!0},{...n,signal:this.controller.signal});this._connected();for await(let u of a)R(this,ye,"m",Va).call(this,u);if(a.controller.signal?.aborted)throw new he;return this._addChatCompletion(R(this,ye,"m",di).call(this))}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),R(this,ye,"m",Ha).call(this),this._connected();let o=wt.fromReadableStream(e,this.controller),a;for await(let u of o)a&&a!==u.id&&this._addChatCompletion(R(this,ye,"m",di).call(this)),R(this,ye,"m",Va).call(this,u),a=u.id;if(o.controller.signal?.aborted)throw new he;return this._addChatCompletion(R(this,ye,"m",di).call(this))}[(qt=new WeakMap,qn=new WeakMap,ar=new WeakMap,ye=new WeakSet,Ha=function(){this.ended||V(this,ar,void 0,"f")},ci=function(t){let n=R(this,qn,"f")[t.index];return n||(n={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},R(this,qn,"f")[t.index]=n,n)},Va=function(t){if(this.ended)return;let n=R(this,ye,"m",ud).call(this,t);this._emit("chunk",t,n);for(let o of t.choices){let a=n.choices[o.index];o.delta.content!=null&&a.message?.role==="assistant"&&a.message?.content&&(this._emit("content",o.delta.content,a.message.content),this._emit("content.delta",{delta:o.delta.content,snapshot:a.message.content,parsed:a.message.parsed})),o.delta.refusal!=null&&a.message?.role==="assistant"&&a.message?.refusal&&this._emit("refusal.delta",{delta:o.delta.refusal,snapshot:a.message.refusal}),o.logprobs?.content!=null&&a.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:o.logprobs?.content,snapshot:a.logprobs?.content??[]}),o.logprobs?.refusal!=null&&a.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:o.logprobs?.refusal,snapshot:a.logprobs?.refusal??[]});let u=R(this,ye,"m",ci).call(this,a);a.finish_reason&&(R(this,ye,"m",Qa).call(this,a),u.current_tool_call_index!=null&&R(this,ye,"m",za).call(this,a,u.current_tool_call_index));for(let d of o.delta.tool_calls??[])u.current_tool_call_index!==d.index&&(R(this,ye,"m",Qa).call(this,a),u.current_tool_call_index!=null&&R(this,ye,"m",za).call(this,a,u.current_tool_call_index)),u.current_tool_call_index=d.index;for(let d of o.delta.tool_calls??[]){let h=a.message.tool_calls?.[d.index];h?.type&&(h?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:h.function?.name,index:d.index,arguments:h.function.arguments,parsed_arguments:h.function.parsed_arguments,arguments_delta:d.function?.arguments??""}):(h?.type,void 0))}}},za=function(t,n){if(R(this,ye,"m",ci).call(this,t).done_tool_calls.has(n))return;let a=t.message.tool_calls?.[n];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){let u=R(this,qt,"f")?.tools?.find(d=>d.type==="function"&&d.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:n,arguments:a.function.arguments,parsed_arguments:Mr(u)?u.$parseRaw(a.function.arguments):u?.function.strict?JSON.parse(a.function.arguments):null})}else a.type},Qa=function(t){let n=R(this,ye,"m",ci).call(this,t);if(t.message.content&&!n.content_done){n.content_done=!0;let o=R(this,ye,"m",Ga).call(this);this._emit("content.done",{content:t.message.content,parsed:o?o.$parseRaw(t.message.content):null})}t.message.refusal&&!n.refusal_done&&(n.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!n.logprobs_content_done&&(n.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!n.logprobs_refusal_done&&(n.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},di=function(){if(this.ended)throw new U("stream has ended, this shouldn't happen");let t=R(this,ar,"f");if(!t)throw new U("request ended without sending any chunks");return V(this,ar,void 0,"f"),V(this,qn,[],"f"),Pp(t,R(this,qt,"f"))},Ga=function(){let t=R(this,qt,"f")?.response_format;return zs(t)?t:null},ud=function(t){var n,o,a,u;let d=R(this,ar,"f"),{choices:h,...f}=t;d?Object.assign(d,f):d=V(this,ar,{...f,choices:[]},"f");for(let{delta:g,finish_reason:S,index:I,logprobs:_=null,...A}of t.choices){let C=d.choices[I];if(C||(C=d.choices[I]={finish_reason:S,index:I,message:{},logprobs:_,...A}),_)if(!C.logprobs)C.logprobs=Object.assign({},_);else{let{content:W,refusal:z,...y}=_;Object.assign(C.logprobs,y),W&&((n=C.logprobs).content??(n.content=[]),C.logprobs.content.push(...W)),z&&((o=C.logprobs).refusal??(o.refusal=[]),C.logprobs.refusal.push(...z))}if(S&&(C.finish_reason=S,R(this,qt,"f")&&Ba(R(this,qt,"f")))){if(S==="length")throw new Dn;if(S==="content_filter")throw new kn}if(Object.assign(C,A),!g)continue;let{content:B,refusal:L,function_call:E,role:F,tool_calls:D,...M}=g;if(Object.assign(C.message,M),L&&(C.message.refusal=(C.message.refusal||"")+L),F&&(C.message.role=F),E&&(C.message.function_call?(E.name&&(C.message.function_call.name=E.name),E.arguments&&((a=C.message.function_call).arguments??(a.arguments=""),C.message.function_call.arguments+=E.arguments)):C.message.function_call=E),B&&(C.message.content=(C.message.content||"")+B,!C.message.refusal&&R(this,ye,"m",Ga).call(this)&&(C.message.parsed=ja(C.message.content))),D){C.message.tool_calls||(C.message.tool_calls=[]);for(let{index:W,id:z,type:y,function:Z,...N}of D){let k=(u=C.message.tool_calls)[W]??(u[W]={});Object.assign(k,N),z&&(k.id=z),y&&(k.type=y),Z&&(k.function??(k.function={name:Z.name??"",arguments:""})),Z?.name&&(k.function.name=Z.name),Z?.arguments&&(k.function.arguments+=Z.arguments,od(R(this,qt,"f"),k)&&(k.function.parsed_arguments=ja(k.function.arguments)))}}}return d},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("chunk",o=>{let a=t.shift();a?a.resolve(o):e.push(o)}),this.on("end",()=>{n=!0;for(let o of t)o.resolve(void 0);t.length=0}),this.on("abort",o=>{n=!0;for(let a of t)a.reject(o);t.length=0}),this.on("error",o=>{n=!0;for(let a of t)a.reject(o);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,u)=>t.push({resolve:a,reject:u})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new wt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};function Pp(r,e){let{id:t,choices:n,created:o,model:a,system_fingerprint:u,...d}=r,h={...d,id:t,choices:n.map(({message:f,finish_reason:g,index:S,logprobs:I,..._})=>{if(!g)throw new U(`missing finish_reason for choice ${S}`);let{content:A=null,function_call:C,tool_calls:B,...L}=f,E=f.role;if(!E)throw new U(`missing role for choice ${S}`);if(C){let{arguments:F,name:D}=C;if(F==null)throw new U(`missing function_call.arguments for choice ${S}`);if(!D)throw new U(`missing function_call.name for choice ${S}`);return{..._,message:{content:A,function_call:{arguments:F,name:D},role:E,refusal:f.refusal??null},finish_reason:g,index:S,logprobs:I}}return B?{..._,index:S,finish_reason:g,logprobs:I,message:{...L,role:E,content:A,refusal:f.refusal??null,tool_calls:B.map((F,D)=>{let{function:M,type:W,id:z,...y}=F,{arguments:Z,name:N,...k}=M||{};if(z==null)throw new U(`missing choices[${S}].tool_calls[${D}].id
${fi(r)}`);if(W==null)throw new U(`missing choices[${S}].tool_calls[${D}].type
${fi(r)}`);if(N==null)throw new U(`missing choices[${S}].tool_calls[${D}].function.name
${fi(r)}`);if(Z==null)throw new U(`missing choices[${S}].tool_calls[${D}].function.arguments
${fi(r)}`);return{...y,id:z,type:W,function:{...k,name:N,arguments:Z}}})}}:{..._,message:{...L,content:A,role:E,refusal:f.refusal??null},finish_reason:g,index:S,logprobs:I}}),created:o,model:a,object:"chat.completion",...u?{system_fingerprint:u}:{}};return sd(h,e)}function fi(r){return JSON.stringify(r)}var Ys=class r extends qr{static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,n){let o=new r(t),a={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return o._run(()=>o._runTools(e,t,a)),o}};var $t=class extends O{constructor(){super(...arguments),this.messages=new Nr(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(x`/chat/completions/${e}`,t)}update(e,t,n){return this._client.post(x`/chat/completions/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/chat/completions",K,{query:e,...t})}delete(e,t){return this._client.delete(x`/chat/completions/${e}`,t)}parse(e,t){return id(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(n=>Qs(n,e))}runTools(e,t){return e.stream?Ys.runTools(this._client,e,t):Gs.runTools(this._client,e,t)}stream(e,t){return qr.createChatCompletion(this._client,e,t)}};$t.Messages=Nr;var lr=class extends O{constructor(){super(...arguments),this.completions=new $t(this._client)}};lr.Completions=$t;var dd=Symbol("brand.privateNullableHeaders"),cd=Array.isArray;function*xp(r){if(!r)return;if(dd in r){let{values:n,nulls:o}=r;yield*n.entries();for(let a of o)yield[a,null];return}let e=!1,t;r instanceof Headers?t=r.entries():cd(r)?t=r:(e=!0,t=Object.entries(r??{}));for(let n of t){let o=n[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");let a=cd(n[1])?n[1]:[n[1]],u=!1;for(let d of a)d!==void 0&&(e&&!u&&(u=!0,yield[o,null]),yield[o,d])}}var $=r=>{let e=new Headers,t=new Set;for(let n of r){let o=new Set;for(let[a,u]of xp(n)){let d=a.toLowerCase();o.has(d)||(e.delete(a),o.add(d)),u===null?(e.delete(a),t.add(d)):(e.append(a,u),t.delete(d))}}return{[dd]:!0,values:e,nulls:t}};var $n=class extends O{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:$([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}};var Un=class extends O{create(e,t){return this._client.post("/audio/transcriptions",Qe({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};var Wn=class extends O{create(e,t){return this._client.post("/audio/translations",Qe({body:e,...t,__metadata:{model:e.model}},this._client))}};var Rt=class extends O{constructor(){super(...arguments),this.transcriptions=new Un(this._client),this.translations=new Wn(this._client),this.speech=new $n(this._client)}};Rt.Transcriptions=Un;Rt.Translations=Wn;Rt.Speech=$n;var $r=class extends O{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(x`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",K,{query:e,...t})}cancel(e,t){return this._client.post(x`/batches/${e}/cancel`,t)}};var jn=class extends O{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(x`/assistants/${e}`,{...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(x`/assistants/${e}`,{body:t,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",K,{query:e,...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(x`/assistants/${e}`,{...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var Hn=class extends O{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var Vn=class extends O{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var ur=class extends O{constructor(){super(...arguments),this.sessions=new Hn(this._client),this.transcriptionSessions=new Vn(this._client)}};ur.Sessions=Hn;ur.TranscriptionSessions=Vn;var zn=class extends O{create(e,t,n){return this._client.post(x`/threads/${e}/messages`,{body:t,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{thread_id:o}=t;return this._client.get(x`/threads/${o}/messages/${e}`,{...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{thread_id:o,...a}=t;return this._client.post(x`/threads/${o}/messages/${e}`,{body:a,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(x`/threads/${e}/messages`,K,{query:t,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){let{thread_id:o}=t;return this._client.delete(x`/threads/${o}/messages/${e}`,{...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var Qn=class extends O{retrieve(e,t,n){let{thread_id:o,run_id:a,...u}=t;return this._client.get(x`/threads/${o}/runs/${a}/steps/${e}`,{query:u,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t,n){let{thread_id:o,...a}=t;return this._client.getAPIList(x`/threads/${o}/runs/${e}/steps`,K,{query:a,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var fd=r=>{if(typeof Buffer<"u"){let e=Buffer.from(r,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(r),t=e.length,n=new Uint8Array(t);for(let o=0;o<t;o++)n[o]=e.charCodeAt(o);return Array.from(new Float32Array(n.buffer))}};var Ur=r=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[r]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(r)?.trim()};var Te,jr,Ya,At,mi,lt,Hr,Gn,Wr,bi,Ge,hi,pi,Ks,Xs,Js,md,hd,pd,bd,gd,yd,_d,Ut=class extends ir{constructor(){super(...arguments),Te.add(this),Ya.set(this,[]),At.set(this,{}),mi.set(this,{}),lt.set(this,void 0),Hr.set(this,void 0),Gn.set(this,void 0),Wr.set(this,void 0),bi.set(this,void 0),Ge.set(this,void 0),hi.set(this,void 0),pi.set(this,void 0),Ks.set(this,void 0)}[(Ya=new WeakMap,At=new WeakMap,mi=new WeakMap,lt=new WeakMap,Hr=new WeakMap,Gn=new WeakMap,Wr=new WeakMap,bi=new WeakMap,Ge=new WeakMap,hi=new WeakMap,pi=new WeakMap,Ks=new WeakMap,Te=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",o=>{let a=t.shift();a?a.resolve(o):e.push(o)}),this.on("end",()=>{n=!0;for(let o of t)o.resolve(void 0);t.length=0}),this.on("abort",o=>{n=!0;for(let a of t)a.reject(o);t.length=0}),this.on("error",o=>{n=!0;for(let a of t)a.reject(o);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,u)=>t.push({resolve:a,reject:u})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new jr;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),this._connected();let o=wt.fromReadableStream(e,this.controller);for await(let a of o)R(this,Te,"m",Xs).call(this,a);if(o.controller.signal?.aborted)throw new he;return this._addRun(R(this,Te,"m",Js).call(this))}toReadableStream(){return new wt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,o){let a=new jr;return a._run(()=>a._runToolAssistantStream(e,t,n,{...o,headers:{...o?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,n,o){let a=o?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let u={...n,stream:!0},d=await e.submitToolOutputs(t,u,{...o,signal:this.controller.signal});this._connected();for await(let h of d)R(this,Te,"m",Xs).call(this,h);if(d.controller.signal?.aborted)throw new he;return this._addRun(R(this,Te,"m",Js).call(this))}static createThreadAssistantStream(e,t,n){let o=new jr;return o._run(()=>o._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),o}static createAssistantStream(e,t,n,o){let a=new jr;return a._run(()=>a._runAssistantStream(e,t,n,{...o,headers:{...o?.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return R(this,hi,"f")}currentRun(){return R(this,pi,"f")}currentMessageSnapshot(){return R(this,lt,"f")}currentRunStepSnapshot(){return R(this,Ks,"f")}async finalRunSteps(){return await this.done(),Object.values(R(this,At,"f"))}async finalMessages(){return await this.done(),Object.values(R(this,mi,"f"))}async finalRun(){if(await this.done(),!R(this,Hr,"f"))throw Error("Final run was not received.");return R(this,Hr,"f")}async _createThreadAssistantStream(e,t,n){let o=n?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let a={...t,stream:!0},u=await e.createAndRun(a,{...n,signal:this.controller.signal});this._connected();for await(let d of u)R(this,Te,"m",Xs).call(this,d);if(u.controller.signal?.aborted)throw new he;return this._addRun(R(this,Te,"m",Js).call(this))}async _createAssistantStream(e,t,n,o){let a=o?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let u={...n,stream:!0},d=await e.create(t,u,{...o,signal:this.controller.signal});this._connected();for await(let h of d)R(this,Te,"m",Xs).call(this,h);if(d.controller.signal?.aborted)throw new he;return this._addRun(R(this,Te,"m",Js).call(this))}static accumulateDelta(e,t){for(let[n,o]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=o;continue}let a=e[n];if(a==null){e[n]=o;continue}if(n==="index"||n==="type"){e[n]=o;continue}if(typeof a=="string"&&typeof o=="string")a+=o;else if(typeof a=="number"&&typeof o=="number")a+=o;else if(Fs(a)&&Fs(o))a=this.accumulateDelta(a,o);else if(Array.isArray(a)&&Array.isArray(o)){if(a.every(u=>typeof u=="string"||typeof u=="number")){a.push(...o);continue}for(let u of o){if(!Fs(u))throw new Error(`Expected array delta entry to be an object but got: ${u}`);let d=u.index;if(d==null)throw console.error(u),new Error("Expected array delta entry to have an `index` property");if(typeof d!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${d}`);let h=a[d];h==null?a.push(u):a[d]=this.accumulateDelta(h,u)}continue}else throw Error(`Unhandled record type: ${n}, deltaValue: ${o}, accValue: ${a}`);e[n]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,n){return await this._createThreadAssistantStream(t,e,n)}async _runAssistantStream(e,t,n,o){return await this._createAssistantStream(t,e,n,o)}async _runToolAssistantStream(e,t,n,o){return await this._createToolAssistantStream(t,e,n,o)}};jr=Ut,Xs=function(e){if(!this.ended)switch(V(this,hi,e,"f"),R(this,Te,"m",pd).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":R(this,Te,"m",_d).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":R(this,Te,"m",hd).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":R(this,Te,"m",md).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Js=function(){if(this.ended)throw new U("stream has ended, this shouldn't happen");if(!R(this,Hr,"f"))throw Error("Final run has not been received");return R(this,Hr,"f")},md=function(e){let[t,n]=R(this,Te,"m",gd).call(this,e,R(this,lt,"f"));V(this,lt,t,"f"),R(this,mi,"f")[t.id]=t;for(let o of n){let a=t.content[o.index];a?.type=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let o of e.data.delta.content){if(o.type=="text"&&o.text){let a=o.text,u=t.content[o.index];if(u&&u.type=="text")this._emit("textDelta",a,u.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(o.index!=R(this,Gn,"f")){if(R(this,Wr,"f"))switch(R(this,Wr,"f").type){case"text":this._emit("textDone",R(this,Wr,"f").text,R(this,lt,"f"));break;case"image_file":this._emit("imageFileDone",R(this,Wr,"f").image_file,R(this,lt,"f"));break}V(this,Gn,o.index,"f")}V(this,Wr,t.content[o.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(R(this,Gn,"f")!==void 0){let o=e.data.content[R(this,Gn,"f")];if(o)switch(o.type){case"image_file":this._emit("imageFileDone",o.image_file,R(this,lt,"f"));break;case"text":this._emit("textDone",o.text,R(this,lt,"f"));break}}R(this,lt,"f")&&this._emit("messageDone",e.data),V(this,lt,void 0,"f")}},hd=function(e){let t=R(this,Te,"m",bd).call(this,e);switch(V(this,Ks,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let n=e.data.delta;if(n.step_details&&n.step_details.type=="tool_calls"&&n.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let a of n.step_details.tool_calls)a.index==R(this,bi,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(R(this,Ge,"f")&&this._emit("toolCallDone",R(this,Ge,"f")),V(this,bi,a.index,"f"),V(this,Ge,t.step_details.tool_calls[a.index],"f"),R(this,Ge,"f")&&this._emit("toolCallCreated",R(this,Ge,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":V(this,Ks,void 0,"f"),e.data.step_details.type=="tool_calls"&&R(this,Ge,"f")&&(this._emit("toolCallDone",R(this,Ge,"f")),V(this,Ge,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},pd=function(e){R(this,Ya,"f").push(e),this._emit("event",e)},bd=function(e){switch(e.event){case"thread.run.step.created":return R(this,At,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=R(this,At,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){let o=jr.accumulateDelta(t,n.delta);R(this,At,"f")[e.data.id]=o}return R(this,At,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":R(this,At,"f")[e.data.id]=e.data;break}if(R(this,At,"f")[e.data.id])return R(this,At,"f")[e.data.id];throw new Error("No snapshot available")},gd=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let o=e.data;if(o.delta.content)for(let a of o.delta.content)if(a.index in t.content){let u=t.content[a.index];t.content[a.index]=R(this,Te,"m",yd).call(this,a,u)}else t.content[a.index]=a,n.push(a);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},yd=function(e,t){return jr.accumulateDelta(t,e)},_d=function(e){switch(V(this,pi,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":V(this,Hr,e.data,"f"),R(this,Ge,"f")&&(this._emit("toolCallDone",R(this,Ge,"f")),V(this,Ge,void 0,"f"));break;case"thread.run.cancelling":break}};var Vr=class extends O{constructor(){super(...arguments),this.steps=new Qn(this._client)}create(e,t,n){let{include:o,...a}=t;return this._client.post(x`/threads/${e}/runs`,{query:{include:o},body:a,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}retrieve(e,t,n){let{thread_id:o}=t;return this._client.get(x`/threads/${o}/runs/${e}`,{...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{thread_id:o,...a}=t;return this._client.post(x`/threads/${o}/runs/${e}`,{body:a,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(x`/threads/${e}/runs`,K,{query:t,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){let{thread_id:o}=t;return this._client.post(x`/threads/${o}/runs/${e}/cancel`,{...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let o=await this.create(e,t,n);return await this.poll(o.id,{thread_id:e},n)}createAndStream(e,t,n){return Ut.createAssistantStream(e,this._client.beta.threads.runs,t,n)}async poll(e,t,n){let o=$([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:a,response:u}=await this.retrieve(e,t,{...n,headers:{...n?.headers,...o}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let d=5e3;if(n?.pollIntervalMs)d=n.pollIntervalMs;else{let h=u.headers.get("openai-poll-after-ms");if(h){let f=parseInt(h);isNaN(f)||(d=f)}}await gt(d);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}}stream(e,t,n){return Ut.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n){let{thread_id:o,...a}=t;return this._client.post(x`/threads/${o}/runs/${e}/submit_tool_outputs`,{body:a,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,n){let o=await this.submitToolOutputs(e,t,n);return await this.poll(o.id,t,n)}submitToolOutputsStream(e,t,n){return Ut.createToolAssistantStream(e,this._client.beta.threads.runs,t,n)}};Vr.Steps=Qn;var cr=class extends O{constructor(){super(...arguments),this.runs=new Vr(this._client),this.messages=new zn(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(x`/threads/${e}`,{...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(x`/threads/${e}`,{body:t,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t){return this._client.delete(x`/threads/${e}`,{...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let n=await this.createAndRun(e,t);return await this.runs.poll(n.id,{thread_id:n.thread_id},t)}createAndRunStream(e,t){return Ut.createThreadAssistantStream(e,this._client.beta.threads,t)}};cr.Runs=Vr;cr.Messages=zn;var Tt=class extends O{constructor(){super(...arguments),this.realtime=new ur(this._client),this.assistants=new jn(this._client),this.threads=new cr(this._client)}};Tt.Realtime=ur;Tt.Assistants=jn;Tt.Threads=cr;var zr=class extends O{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};var Yn=class extends O{retrieve(e,t,n){let{container_id:o}=t;return this._client.get(x`/containers/${o}/files/${e}/content`,{...n,headers:$([{Accept:"application/binary"},n?.headers]),__binaryResponse:!0})}};var Qr=class extends O{constructor(){super(...arguments),this.content=new Yn(this._client)}create(e,t,n){return this._client.post(x`/containers/${e}/files`,Qe({body:t,...n},this._client))}retrieve(e,t,n){let{container_id:o}=t;return this._client.get(x`/containers/${o}/files/${e}`,n)}list(e,t={},n){return this._client.getAPIList(x`/containers/${e}/files`,K,{query:t,...n})}delete(e,t,n){let{container_id:o}=t;return this._client.delete(x`/containers/${o}/files/${e}`,{...n,headers:$([{Accept:"*/*"},n?.headers])})}};Qr.Content=Yn;var dr=class extends O{constructor(){super(...arguments),this.files=new Qr(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(x`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",K,{query:e,...t})}delete(e,t){return this._client.delete(x`/containers/${e}`,{...t,headers:$([{Accept:"*/*"},t?.headers])})}};dr.Files=Qr;var Gr=class extends O{create(e,t){let n=!!e.encoding_format,o=n?e.encoding_format:"base64";n&&be(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let a=this._client.post("/embeddings",{body:{...e,encoding_format:o},...t});return n?a:(be(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(u=>(u&&u.data&&u.data.forEach(d=>{let h=d.embedding;d.embedding=fd(h)}),u)))}};var Xn=class extends O{retrieve(e,t,n){let{eval_id:o,run_id:a}=t;return this._client.get(x`/evals/${o}/runs/${a}/output_items/${e}`,n)}list(e,t,n){let{eval_id:o,...a}=t;return this._client.getAPIList(x`/evals/${o}/runs/${e}/output_items`,K,{query:a,...n})}};var Yr=class extends O{constructor(){super(...arguments),this.outputItems=new Xn(this._client)}create(e,t,n){return this._client.post(x`/evals/${e}/runs`,{body:t,...n})}retrieve(e,t,n){let{eval_id:o}=t;return this._client.get(x`/evals/${o}/runs/${e}`,n)}list(e,t={},n){return this._client.getAPIList(x`/evals/${e}/runs`,K,{query:t,...n})}delete(e,t,n){let{eval_id:o}=t;return this._client.delete(x`/evals/${o}/runs/${e}`,n)}cancel(e,t,n){let{eval_id:o}=t;return this._client.post(x`/evals/${o}/runs/${e}`,n)}};Yr.OutputItems=Xn;var fr=class extends O{constructor(){super(...arguments),this.runs=new Yr(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(x`/evals/${e}`,t)}update(e,t,n){return this._client.post(x`/evals/${e}`,{body:t,...n})}list(e={},t){return this._client.getAPIList("/evals",K,{query:e,...t})}delete(e,t){return this._client.delete(x`/evals/${e}`,t)}};fr.Runs=Yr;var Xr=class extends O{create(e,t){return this._client.post("/files",Qe({body:e,...t},this._client))}retrieve(e,t){return this._client.get(x`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",K,{query:e,...t})}delete(e,t){return this._client.delete(x`/files/${e}`,t)}content(e,t){return this._client.get(x`/files/${e}/content`,{...t,headers:$([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=1800*1e3}={}){let o=new Set(["processed","error","deleted"]),a=Date.now(),u=await this.retrieve(e);for(;!u.status||!o.has(u.status);)if(await gt(t),u=await this.retrieve(e),Date.now()-a>n)throw new sr({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return u}};var Jn=class extends O{};var Kn=class extends O{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};var Jr=class extends O{constructor(){super(...arguments),this.graders=new Kn(this._client)}};Jr.Graders=Kn;var Zn=class extends O{create(e,t,n){return this._client.getAPIList(x`/fine_tuning/checkpoints/${e}/permissions`,St,{body:t,method:"post",...n})}retrieve(e,t={},n){return this._client.get(x`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...n})}delete(e,t,n){let{fine_tuned_model_checkpoint:o}=t;return this._client.delete(x`/fine_tuning/checkpoints/${o}/permissions/${e}`,n)}};var Kr=class extends O{constructor(){super(...arguments),this.permissions=new Zn(this._client)}};Kr.Permissions=Zn;var es=class extends O{list(e,t={},n){return this._client.getAPIList(x`/fine_tuning/jobs/${e}/checkpoints`,K,{query:t,...n})}};var Zr=class extends O{constructor(){super(...arguments),this.checkpoints=new es(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(x`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",K,{query:e,...t})}cancel(e,t){return this._client.post(x`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return this._client.getAPIList(x`/fine_tuning/jobs/${e}/events`,K,{query:t,...n})}pause(e,t){return this._client.post(x`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(x`/fine_tuning/jobs/${e}/resume`,t)}};Zr.Checkpoints=es;var ut=class extends O{constructor(){super(...arguments),this.methods=new Jn(this._client),this.jobs=new Zr(this._client),this.checkpoints=new Kr(this._client),this.alpha=new Jr(this._client)}};ut.Methods=Jn;ut.Jobs=Zr;ut.Checkpoints=Kr;ut.Alpha=Jr;var ts=class extends O{};var mr=class extends O{constructor(){super(...arguments),this.graderModels=new ts(this._client)}};mr.GraderModels=ts;var en=class extends O{createVariation(e,t){return this._client.post("/images/variations",Qe({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Qe({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}};var tn=class extends O{retrieve(e,t){return this._client.get(x`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",St,e)}delete(e,t){return this._client.delete(x`/models/${e}`,t)}};var rn=class extends O{create(e,t){return this._client.post("/moderations",{body:e,...t})}};function wd(r,e){return!e||!tb(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(n=>({...n,parsed:null}))}:t)}:Xa(r,e)}function Xa(r,e){let t=r.output.map(o=>{if(o.type==="function_call")return{...o,parsed_arguments:sb(e,o)};if(o.type==="message"){let a=o.content.map(u=>u.type==="output_text"?{...u,parsed:eb(e,u.text)}:u);return{...o,content:a}}return o}),n=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||Ja(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let o of n.output)if(o.type==="message"){for(let a of o.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),n}function eb(r,e){return r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(e):JSON.parse(e)}function tb(r){return!!zs(r.text?.format)}function rb(r){return r?.$brand==="auto-parseable-tool"}function nb(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function sb(r,e){let t=nb(r.tools??[],e.name);return{...e,...e,parsed_arguments:rb(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function Ja(r){let e=[];for(let t of r.output)if(t.type==="message")for(let n of t.content)n.type==="output_text"&&e.push(n.text);r.output_text=e.join("")}var rs,gi,hr,yi,Sd,Rd,Ad,Td,_i=class r extends ir{constructor(e){super(),rs.add(this),gi.set(this,void 0),hr.set(this,void 0),yi.set(this,void 0),V(this,gi,e,"f")}static createResponse(e,t,n){let o=new r(t);return o._run(()=>o._createOrRetrieveResponse(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createOrRetrieveResponse(e,t,n){let o=n?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),R(this,rs,"m",Sd).call(this);let a,u=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...n,signal:this.controller.signal,stream:!0}),u=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...n,signal:this.controller.signal}),this._connected();for await(let d of a)R(this,rs,"m",Rd).call(this,d,u);if(a.controller.signal?.aborted)throw new he;return R(this,rs,"m",Ad).call(this)}[(gi=new WeakMap,hr=new WeakMap,yi=new WeakMap,rs=new WeakSet,Sd=function(){this.ended||V(this,hr,void 0,"f")},Rd=function(t,n){if(this.ended)return;let o=(u,d)=>{(n==null||d.sequence_number>n)&&this._emit(u,d)},a=R(this,rs,"m",Td).call(this,t);switch(o("event",t),t.type){case"response.output_text.delta":{let u=a.output[t.output_index];if(!u)throw new U(`missing output at index ${t.output_index}`);if(u.type==="message"){let d=u.content[t.content_index];if(!d)throw new U(`missing content at index ${t.content_index}`);if(d.type!=="output_text")throw new U(`expected content to be 'output_text', got ${d.type}`);o("response.output_text.delta",{...t,snapshot:d.text})}break}case"response.function_call_arguments.delta":{let u=a.output[t.output_index];if(!u)throw new U(`missing output at index ${t.output_index}`);u.type==="function_call"&&o("response.function_call_arguments.delta",{...t,snapshot:u.arguments});break}default:o(t.type,t);break}},Ad=function(){if(this.ended)throw new U("stream has ended, this shouldn't happen");let t=R(this,hr,"f");if(!t)throw new U("request ended without sending any events");V(this,hr,void 0,"f");let n=ob(t,R(this,gi,"f"));return V(this,yi,n,"f"),n},Td=function(t){let n=R(this,hr,"f");if(!n){if(t.type!=="response.created")throw new U(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return n=V(this,hr,t.response,"f"),n}switch(t.type){case"response.output_item.added":{n.output.push(t.item);break}case"response.content_part.added":{let o=n.output[t.output_index];if(!o)throw new U(`missing output at index ${t.output_index}`);o.type==="message"&&o.content.push(t.part);break}case"response.output_text.delta":{let o=n.output[t.output_index];if(!o)throw new U(`missing output at index ${t.output_index}`);if(o.type==="message"){let a=o.content[t.content_index];if(!a)throw new U(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new U(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{let o=n.output[t.output_index];if(!o)throw new U(`missing output at index ${t.output_index}`);o.type==="function_call"&&(o.arguments+=t.delta);break}case"response.completed":{V(this,hr,t.response,"f");break}}return n},Symbol.asyncIterator)](){let e=[],t=[],n=!1;return this.on("event",o=>{let a=t.shift();a?a.resolve(o):e.push(o)}),this.on("end",()=>{n=!0;for(let o of t)o.resolve(void 0);t.length=0}),this.on("abort",o=>{n=!0;for(let a of t)a.reject(o);t.length=0}),this.on("error",o=>{n=!0;for(let a of t)a.reject(o);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:n?{value:void 0,done:!0}:new Promise((a,u)=>t.push({resolve:a,reject:u})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=R(this,yi,"f");if(!e)throw new U("stream ended without producing a ChatCompletion");return e}};function ob(r,e){return wd(r,e)}var ns=class extends O{list(e,t={},n){return this._client.getAPIList(x`/responses/${e}/input_items`,K,{query:t,...n})}};var pr=class extends O{constructor(){super(...arguments),this.inputItems=new ns(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&Ja(n),n))}retrieve(e,t={},n){return this._client.get(x`/responses/${e}`,{query:t,...n,stream:t?.stream??!1})}delete(e,t){return this._client.delete(x`/responses/${e}`,{...t,headers:$([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(n=>Xa(n,e))}stream(e,t){return _i.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(x`/responses/${e}/cancel`,t)}};pr.InputItems=ns;var ss=class extends O{create(e,t,n){return this._client.post(x`/uploads/${e}/parts`,Qe({body:t,...n},this._client))}};var br=class extends O{constructor(){super(...arguments),this.parts=new ss(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(x`/uploads/${e}/cancel`,t)}complete(e,t,n){return this._client.post(x`/uploads/${e}/complete`,{body:t,...n})}};br.Parts=ss;var Ed=async r=>{let e=await Promise.allSettled(r),t=e.filter(o=>o.status==="rejected");if(t.length){for(let o of t)console.error(o.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let n=[];for(let o of e)o.status==="fulfilled"&&n.push(o.value);return n};var os=class extends O{create(e,t,n){return this._client.post(x`/vector_stores/${e}/file_batches`,{body:t,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{vector_store_id:o}=t;return this._client.get(x`/vector_stores/${o}/file_batches/${e}`,{...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}cancel(e,t,n){let{vector_store_id:o}=t;return this._client.post(x`/vector_stores/${o}/file_batches/${e}/cancel`,{...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let o=await this.create(e,t);return await this.poll(e,o.id,n)}listFiles(e,t,n){let{vector_store_id:o,...a}=t;return this._client.getAPIList(x`/vector_stores/${o}/file_batches/${e}/files`,K,{query:a,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async poll(e,t,n){let o=$([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:a,response:u}=await this.retrieve(t,{vector_store_id:e},{...n,headers:o}).withResponse();switch(a.status){case"in_progress":let d=5e3;if(n?.pollIntervalMs)d=n.pollIntervalMs;else{let h=u.headers.get("openai-poll-after-ms");if(h){let f=parseInt(h);isNaN(f)||(d=f)}}await gt(d);break;case"failed":case"cancelled":case"completed":return a}}}async uploadAndPoll(e,{files:t,fileIds:n=[]},o){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let a=o?.maxConcurrency??5,u=Math.min(a,t.length),d=this._client,h=t.values(),f=[...n];async function g(I){for(let _ of I){let A=await d.files.create({file:_,purpose:"assistants"},o);f.push(A.id)}}let S=Array(u).fill(h).map(g);return await Ed(S),await this.createAndPoll(e,{file_ids:f})}};var is=class extends O{create(e,t,n){return this._client.post(x`/vector_stores/${e}/files`,{body:t,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}retrieve(e,t,n){let{vector_store_id:o}=t;return this._client.get(x`/vector_stores/${o}/files/${e}`,{...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}update(e,t,n){let{vector_store_id:o,...a}=t;return this._client.post(x`/vector_stores/${o}/files/${e}`,{body:a,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e,t={},n){return this._client.getAPIList(x`/vector_stores/${e}/files`,K,{query:t,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}delete(e,t,n){let{vector_store_id:o}=t;return this._client.delete(x`/vector_stores/${o}/files/${e}`,{...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}async createAndPoll(e,t,n){let o=await this.create(e,t,n);return await this.poll(e,o.id,n)}async poll(e,t,n){let o=$([n?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":n?.pollIntervalMs?.toString()??void 0}]);for(;;){let a=await this.retrieve(t,{vector_store_id:e},{...n,headers:o}).withResponse(),u=a.data;switch(u.status){case"in_progress":let d=5e3;if(n?.pollIntervalMs)d=n.pollIntervalMs;else{let h=a.response.headers.get("openai-poll-after-ms");if(h){let f=parseInt(h);isNaN(f)||(d=f)}}await gt(d);break;case"failed":case"completed":return u}}}async upload(e,t,n){let o=await this._client.files.create({file:t,purpose:"assistants"},n);return this.create(e,{file_id:o.id},n)}async uploadAndPoll(e,t,n){let o=await this.upload(e,t,n);return await this.poll(e,o.id,n)}content(e,t,n){let{vector_store_id:o}=t;return this._client.getAPIList(x`/vector_stores/${o}/files/${e}/content`,St,{...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};var Wt=class extends O{constructor(){super(...arguments),this.files=new is(this._client),this.fileBatches=new os(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(x`/vector_stores/${e}`,{...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,n){return this._client.post(x`/vector_stores/${e}`,{body:t,...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",K,{query:e,...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(x`/vector_stores/${e}`,{...t,headers:$([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,n){return this._client.getAPIList(x`/vector_stores/${e}/search`,St,{body:t,method:"post",...n,headers:$([{"OpenAI-Beta":"assistants=v2"},n?.headers])})}};Wt.Files=is;Wt.FileBatches=os;var Ka,wi,J=class{constructor({baseURL:e=Ur("OPENAI_BASE_URL"),apiKey:t=Ur("OPENAI_API_KEY"),organization:n=Ur("OPENAI_ORG_ID")??null,project:o=Ur("OPENAI_PROJECT_ID")??null,...a}={}){if(wi.set(this,void 0),this.completions=new zr(this),this.chat=new lr(this),this.embeddings=new Gr(this),this.files=new Xr(this),this.images=new en(this),this.audio=new Rt(this),this.moderations=new rn(this),this.models=new tn(this),this.fineTuning=new ut(this),this.graders=new mr(this),this.vectorStores=new Wt(this),this.beta=new Tt(this),this.batches=new $r(this),this.uploads=new br(this),this.responses=new pr(this),this.evals=new fr(this),this.containers=new dr(this),t===void 0)throw new U("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let u={apiKey:t,organization:n,project:o,...a,baseURL:e||"https://api.openai.com/v1"};if(!u.dangerouslyAllowBrowser&&qc())throw new U(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=u.baseURL,this.timeout=u.timeout??Ka.DEFAULT_TIMEOUT,this.logger=u.logger??console;let d="warn";this.logLevel=d,this.logLevel=_a(u.logLevel,"ClientOptions.logLevel",this)??_a(Ur("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??d,this.fetchOptions=u.fetchOptions,this.maxRetries=u.maxRetries??2,this.fetch=u.fetch??Uc(),V(this,wi,jc,"f"),this._options=u,this.apiKey=t,this.organization=n,this.project=o}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return $([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return va(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${or}`}defaultIdempotencyKey(){return`stainless-node-retry-${ya()}`}makeStatusError(e,t,n,o){return pe.generate(e,t,n,o)}buildURL(e,t){let n=Cc(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return Oc(o)||(t={...o,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(o=>({method:e,path:t,...o})))}request(e,t=null){return new Br(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){let o=await e,a=o.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(o);let{req:u,url:d,timeout:h}=this.buildRequest(o,{retryCount:a-t});await this.prepareRequest(u,{url:d,options:o});let f="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),g=n===void 0?"":`, retryOf: ${n}`,S=Date.now();if(be(this).debug(`[${f}] sending request`,Nt({retryOfRequestLogID:n,method:o.method,url:d,options:o,headers:u.headers})),o.signal?.aborted)throw new he;let I=new AbortController,_=await this.fetchWithTimeout(d,u,h,I).catch(Ls),A=Date.now();if(_ instanceof Error){let L=`retrying, ${t} attempts remaining`;if(o.signal?.aborted)throw new he;let E=ks(_)||/timed? ?out/i.test(String(_)+("cause"in _?String(_.cause):""));if(t)return be(this).info(`[${f}] connection ${E?"timed out":"failed"} - ${L}`),be(this).debug(`[${f}] connection ${E?"timed out":"failed"} (${L})`,Nt({retryOfRequestLogID:n,url:d,durationMs:A-S,message:_.message})),this.retryRequest(o,t,n??f);throw be(this).info(`[${f}] connection ${E?"timed out":"failed"} - error; no more retries left`),be(this).debug(`[${f}] connection ${E?"timed out":"failed"} (error; no more retries left)`,Nt({retryOfRequestLogID:n,url:d,durationMs:A-S,message:_.message})),E?new sr:new nr({cause:_})}let C=[..._.headers.entries()].filter(([L])=>L==="x-request-id").map(([L,E])=>", "+L+": "+JSON.stringify(E)).join(""),B=`[${f}${g}${C}] ${u.method} ${d} ${_.ok?"succeeded":"failed"} with status ${_.status} in ${A-S}ms`;if(!_.ok){let L=this.shouldRetry(_);if(t&&L){let z=`retrying, ${t} attempts remaining`;return await Wc(_.body),be(this).info(`${B} - ${z}`),be(this).debug(`[${f}] response error (${z})`,Nt({retryOfRequestLogID:n,url:_.url,status:_.status,headers:_.headers,durationMs:A-S})),this.retryRequest(o,t,n??f,_.headers)}let E=L?"error; no more retries left":"error; not retryable";be(this).info(`${B} - ${E}`);let F=await _.text().catch(z=>Ls(z).message),D=Lc(F),M=D?void 0:F;throw be(this).debug(`[${f}] response error (${E})`,Nt({retryOfRequestLogID:n,url:_.url,status:_.status,headers:_.headers,message:M,durationMs:Date.now()-S})),this.makeStatusError(_.status,D,M,_.headers)}return be(this).info(B),be(this).debug(`[${f}] response start`,Nt({retryOfRequestLogID:n,url:_.url,status:_.status,headers:_.headers,durationMs:A-S})),{response:_,options:o,controller:I,requestLogID:f,retryOfRequestLogID:n,startTime:S}}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}requestAPIList(e,t){let n=this.makeRequest(t,null,void 0);return new $s(this,n,e)}async fetchWithTimeout(e,t,n,o){let{signal:a,method:u,...d}=t||{};a&&a.addEventListener("abort",()=>o.abort());let h=setTimeout(()=>o.abort(),n),f=globalThis.ReadableStream&&d.body instanceof globalThis.ReadableStream||typeof d.body=="object"&&d.body!==null&&Symbol.asyncIterator in d.body,g={signal:o.signal,...f?{duplex:"half"}:{},method:"GET",...d};u&&(g.method=u.toUpperCase());try{return await this.fetch.call(void 0,e,g)}finally{clearTimeout(h)}}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,o){let a,u=o?.get("retry-after-ms");if(u){let h=parseFloat(u);Number.isNaN(h)||(a=h)}let d=o?.get("retry-after");if(d&&!a){let h=parseFloat(d);Number.isNaN(h)?a=Date.parse(d)-Date.now():a=h*1e3}if(!(a&&0<=a&&a<60*1e3)){let h=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,h)}return await gt(a),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){let a=t-e,u=Math.min(.5*Math.pow(2,a),8),d=1-Math.random()*.25;return u*d*1e3}buildRequest(e,{retryCount:t=0}={}){let n={...e},{method:o,path:a,query:u}=n,d=this.buildURL(a,u);"timeout"in n&&kc("timeout",n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:h,body:f}=this.buildBody({options:n}),g=this.buildHeaders({options:e,method:o,bodyHeaders:h,retryCount:t});return{req:{method:o,headers:g,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"},...f&&{body:f},...this.fetchOptions??{},...n.fetchOptions??{}},url:d,timeout:n.timeout}}buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:o}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);let u=$([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(o),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...$c(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,n,e.headers]);return this.validateHeaders(u),u.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let n=$([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Zo(e)}:R(this,wi,"f").call(this,{body:e,headers:n})}};Ka=J,wi=new WeakMap;J.OpenAI=Ka;J.DEFAULT_TIMEOUT=6e5;J.OpenAIError=U;J.APIError=pe;J.APIConnectionError=nr;J.APIConnectionTimeoutError=sr;J.APIUserAbortError=he;J.NotFoundError=In;J.ConflictError=Pn;J.RateLimitError=xn;J.BadRequestError=Tn;J.AuthenticationError=En;J.InternalServerError=On;J.PermissionDeniedError=vn;J.UnprocessableEntityError=Cn;J.toFile=ni;J.Completions=zr;J.Chat=lr;J.Embeddings=Gr;J.Files=Xr;J.Images=en;J.Audio=Rt;J.Moderations=rn;J.Models=tn;J.FineTuning=ut;J.Graders=mr;J.VectorStores=Wt;J.Beta=Tt;J.Batches=$r;J.Uploads=br;J.Responses=pr;J.Evals=fr;J.Containers=dr;var Id=require("react");var Si="gpt-4o-mini";var Za={title:"\u{1F4A1}",message:"Summarizing video"},el={title:"\u{1F4DD}",message:"Video summarized!"},nn={title:"\u{1F6A8}"},as={title:"\u{1F50D}",message:"Answering your question"};var tl={title:"\u{1F517}",message:"Checking video URL"},rl={title:"\u{1F517}",message:"Checking Browser Extension"},nl={title:"\u{1F517}",message:"Checking Clipboard"};function ls(){return`q-${Date.now()}`}function vd(r,e,t){return`Summarize the following transcription of a youtube video as a list of the most important points each starting with a fitting emoji. Ignore Sponsor Segments and Video Sponsors. Answer in ${r}.
  
  Format:

  [Emoji] [List Item] &nbsp;&nbsp;
  
  Here is the transcript: ${e.length>0?e:t}`}function Ri(r,e){return`The following text is the content of a video. Refer to it as video. You already summarized it for the person asking a question. Answer with a list starting with a fitting emoji. Ignore Sponsor Segments and Video Sponsors.
  
  Format:

  [Emoji] [List Item] &nbsp;&nbsp;
  
  Here is the transcript: ${e}. This is the question: ${r}`}function Pd({setQuestions:r,setQuestion:e,transcript:t,question:n}){let o=(0,sn.getPreferenceValues)(),{openaiApiToken:a,openaiEndpoint:u,openaiModel:d,creativity:h}=o;(0,Id.useEffect)(()=>{let f=new AbortController;return(async()=>{if(!n||!t)return;let S=ls(),I=await(0,sn.showToast)({style:sn.Toast.Style.Animated,title:as.title,message:as.message}),_=new J({apiKey:a});u!==""&&(_.baseURL=u),r(C=>[{id:S,question:n,answer:""},...C]);let A=_.chat.completions.stream({model:d||Si,messages:[{role:"user",content:Ri(n,t)}],stream:!0,creativity:Number.parseInt(h,10)},{signal:f.signal});A.on("content",C=>{I.show(),r(B=>B.map(L=>L.id===S?{...L,answer:L.answer+C}:L))}),A.finalChatCompletion().then(()=>{I.hide(),e("")}),!f.signal.aborted&&A.on("error",C=>{f.signal.aborted||(I.style=sn.Toast.Style.Failure,I.title=nn.title,I.message=C.message)})})(),()=>{f.abort()}},[n,t,h,a,u,d,e,r])}var tt=require("@raycast/api");var Cd=require("react");var xd=({transcript:r,setSummaryIsLoading:e,setSummary:t})=>{let n=new AbortController,o=(0,tt.getPreferenceValues)(),{creativity:a,openaiApiToken:u,language:d,openaiEndpoint:h,openaiModel:f}=o;if(u===""){(0,tt.showToast)({title:nn.title,message:"OpenAI API key is empty. You need to add your API key in preferences.",style:tt.Toast.Style.Failure});return}(0,Cd.useEffect)(()=>{if(!r)return;let g=vd(d,r,r),S=new J({apiKey:u});h!==""&&(S.baseURL=h),e(!0),(0,tt.showToast)({style:tt.Toast.Style.Animated,title:Za.title,message:Za.message});let I=S.chat.completions.stream({model:f||Si,temperature:Number.parseInt(a),messages:[{role:"user",content:g}],stream:!0});return I.on("content",_=>{t(A=>A===void 0?_||void 0:A+_||A)}),I.finalChatCompletion().then(()=>{e(!1),(0,tt.showToast)({style:tt.Toast.Style.Success,title:el.title,message:el.message})}),I.on("error",_=>{n.signal.aborted||(e(!1),(0,tt.showToast)({style:tt.Toast.Style.Failure,title:nn.title,message:_.message}))}),()=>{n.abort()}},[a,d,u,h,f,t,e,r])};var Dd=require("@raycast/api");var Ht=require("@raycast/api");var Ie=require("@raycast/api"),gr=require("react");var jt=require("react/jsx-runtime");function sl({transcript:r,questions:e,onQuestionsUpdate:t}){let[n,o]=(0,gr.useState)(""),[a,u]=(0,gr.useState)(e[0]?.id??""),[d,h]=(0,gr.useState)(e);(0,gr.useEffect)(()=>{t&&t(d)},[d,t]);let f=(0,gr.useCallback)(_=>{h(_)},[]),g=async()=>{if(!n)return;let _=ls(),A=n,C=await(0,Ie.showToast)({style:Ie.Toast.Style.Animated,title:as.title,message:as.message}),B=Ie.AI.ask(Ri(A,r)),L=[{id:_,question:A,answer:""},...d];f(L),o("");let E=!0;B.on("data",F=>{E&&(C.show(),E=!1),h(D=>D.map(M=>M.id===_?{...M,answer:M.answer+F}:M))}),B.finally(()=>{C.hide(),u(_)})},S=()=>`${d.length?`Questions:
${d.map(A=>`Q: ${A.question}
A: ${A.answer}`).join(`

`)}`:""}`,I=()=>{let _=d.find(A=>A.id===a);return _?_.id===d[0]?.id?_.answer:`Q: ${_.question}
A: ${_.answer}`:""};return(0,jt.jsx)(Ie.List,{filtering:!1,isShowingDetail:!0,navigationTitle:"Additional Questions",onSearchTextChange:o,searchText:n,searchBarPlaceholder:"Ask another question",selectedItemId:a,searchBarAccessory:(0,jt.jsxs)(Ie.ActionPanel,{children:[(0,jt.jsx)(Ie.Action.SubmitForm,{onSubmit:g}),(0,jt.jsx)(Ie.Action.CopyToClipboard,{title:"Copy Selected Answer",content:I()}),(0,jt.jsx)(Ie.Action.CopyToClipboard,{title:"Copy All Q&A",content:S()})]}),children:d.map(_=>(0,jt.jsx)(Ie.List.Item,{title:_.question,detail:(0,jt.jsx)(Ie.List.Item.Detail,{markdown:_.answer}),id:_.id},_.id))})}var yr=require("react/jsx-runtime");function ol({transcript:r,summary:e,video_url:t,ownerProfileUrl:n,questions:o,onQuestionsUpdate:a}){return(0,yr.jsxs)(Ht.ActionPanel,{title:"Video Actions",children:[(0,yr.jsx)(Ht.Action.Push,{icon:Ht.Icon.QuestionMark,title:"Ask Follow-Up Question",target:(0,yr.jsx)(sl,{transcript:r,questions:o,onQuestionsUpdate:a})}),(0,yr.jsx)(Ht.Action.CopyToClipboard,{title:"Copy Summary",content:e??""}),(0,yr.jsx)(Ht.Action.OpenInBrowser,{title:"Go to Video",url:t}),(0,yr.jsx)(Ht.Action.OpenInBrowser,{title:"Go to Channel",url:n})]})}var Et=require("@raycast/api");var Od=require("@raycast/api");var il=(o=>(o.summarizeVideoWithRaycast="Ray1",o.summarizeVideoWithAnthropic="Anthropic",o.summarizeVideoWithOpenAI="OpenAI",o.summarizeVideoWithOllama="Ollama",o))(il||{});var Zs=il[Od.environment.commandName];var ct=require("react/jsx-runtime");function al({duration:r,ownerChannelName:e,ownerProfileUrl:t,publishDate:n,title:o,viewCount:a}){return(0,ct.jsxs)(Et.Detail.Metadata,{children:[(0,ct.jsx)(Et.Detail.Metadata.Label,{title:"Title",text:o}),(0,ct.jsx)(Et.Detail.Metadata.Link,{title:"Channel",target:t,text:e}),(0,ct.jsx)(Et.Detail.Metadata.Separator,{}),(0,ct.jsx)(Et.Detail.Metadata.Label,{title:"Published",text:n}),(0,ct.jsx)(Et.Detail.Metadata.Label,{title:"Duration",text:r}),(0,ct.jsx)(Et.Detail.Metadata.Label,{title:"Views",text:a}),(0,ct.jsx)(Et.Detail.Metadata.Separator,{}),(0,ct.jsx)(Et.Detail.Metadata.Label,{title:"AI Model",text:Zs})]})}var Ai=require("react/jsx-runtime");function ll({summary:r,summaryIsLoading:e,transcript:t,videoData:n,questions:o,onQuestionsUpdate:a}){if(!r)return null;let{duration:u,ownerChannelName:d,ownerProfileUrl:h,publishDate:f,title:g,video_url:S,viewCount:I}=n;return(0,Ai.jsx)(Dd.Detail,{actions:(0,Ai.jsx)(ol,{transcript:t,summary:r,video_url:S,ownerProfileUrl:h,questions:o,onQuestionsUpdate:a}),isLoading:e,markdown:r,metadata:(0,Ai.jsx)(al,{title:g,ownerChannelName:d,ownerProfileUrl:h,publishDate:f,duration:u,viewCount:I}),navigationTitle:n&&`${g} by ${d}`})}var _e=require("@raycast/api"),pf=require("react"),Pi=ht(Nl());var bf=({input:r,setVideoURL:e})=>{(0,pf.useEffect)(()=>{(async()=>{if((0,_e.showToast)({style:_e.Toast.Style.Animated,title:tl.title,message:tl.message}),r&&Pi.default.validateURL(r)){e(r);return}let n=await _e.Clipboard.readText(),o=n&&Pi.default.validateURL(n);if(!r&&o){(0,_e.showToast)({style:_e.Toast.Style.Animated,title:nl.title,message:nl.message}),e(n);return}if(!r&&_e.environment.canAccess(_e.BrowserExtension)){let u=(await _e.BrowserExtension.getTabs()).find(d=>d.active&&Pi.default.validateURL(d.url));if(u){(0,_e.showToast)({style:_e.Toast.Style.Animated,title:rl.title,message:rl.message}),e(u.url);return}}(0,_e.showToast)({style:_e.Toast.Style.Failure,title:"No video URL found",message:"Please provide a valid YouTube video URL or ID."}),(0,_e.popToRoot)()})()},[r,e])};var io=require("@raycast/api"),gf="youtube-summary-",yf="youtube-summary-keys",_f=()=>{let r=async n=>{let o=`${n.id}-${n.aiService}`;await io.LocalStorage.setItem(`${gf}${o}`,JSON.stringify(n));let a=await t();a.includes(o)||(a.unshift(o),await io.LocalStorage.setItem(yf,JSON.stringify(a)))},e=async()=>{let n=await t();return(await Promise.all(n.map(async a=>{let u=await io.LocalStorage.getItem(`${gf}${a}`);if(!u)return null;let d=JSON.parse(u);return d.createdAt=new Date(d.createdAt),d}))).filter(a=>a!==null)},t=async()=>{let n=await io.LocalStorage.getItem(yf);return n?JSON.parse(n):[]};return{addToHistory:r,getHistory:e}};var ao=require("react");function wf(r){let[e,t]=(0,ao.useState)(""),[n,o]=(0,ao.useState)([{id:ls(),question:"Initial Summary of the video",answer:r??""}]);return(0,ao.useEffect)(()=>{r&&o(a=>[{...a[0],answer:r},...a.slice(1)])},[r]),{questions:n,setQuestions:o,question:e,setQuestion:t}}var xi=require("@raycast/api"),lo=require("react");var Sg={};function Sf(){return Sg}var Rg={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Rf=(r,e,t)=>{let n,o=Rg[r];return typeof o=="string"?n=o:e===1?n=o.one:n=o.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n};function Ci(r){return(e={})=>{let t=e.width?String(e.width):r.defaultWidth;return r.formats[t]||r.formats[r.defaultWidth]}}var Ag={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Tg={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Eg={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Af={date:Ci({formats:Ag,defaultWidth:"full"}),time:Ci({formats:Tg,defaultWidth:"full"}),dateTime:Ci({formats:Eg,defaultWidth:"full"})};var vg={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Tf=(r,e,t,n)=>vg[r];function fs(r){return(e,t)=>{let n=t?.context?String(t.context):"standalone",o;if(n==="formatting"&&r.formattingValues){let u=r.defaultFormattingWidth||r.defaultWidth,d=t?.width?String(t.width):u;o=r.formattingValues[d]||r.formattingValues[u]}else{let u=r.defaultWidth,d=t?.width?String(t.width):r.defaultWidth;o=r.values[d]||r.values[u]}let a=r.argumentCallback?r.argumentCallback(e):e;return o[a]}}var Ig={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Pg={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Cg={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},xg={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Og={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Dg={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},kg=(r,e)=>{let t=Number(r),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Ef={ordinalNumber:kg,era:fs({values:Ig,defaultWidth:"wide"}),quarter:fs({values:Pg,defaultWidth:"wide",argumentCallback:r=>r-1}),month:fs({values:Cg,defaultWidth:"wide"}),day:fs({values:xg,defaultWidth:"wide"}),dayPeriod:fs({values:Og,defaultWidth:"wide",formattingValues:Dg,defaultFormattingWidth:"wide"})};function ms(r){return(e,t={})=>{let n=t.width,o=n&&r.matchPatterns[n]||r.matchPatterns[r.defaultMatchWidth],a=e.match(o);if(!a)return null;let u=a[0],d=n&&r.parsePatterns[n]||r.parsePatterns[r.defaultParseWidth],h=Array.isArray(d)?Fg(d,S=>S.test(u)):Lg(d,S=>S.test(u)),f;f=r.valueCallback?r.valueCallback(h):h,f=t.valueCallback?t.valueCallback(f):f;let g=e.slice(u.length);return{value:f,rest:g}}}function Lg(r,e){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&e(r[t]))return t}function Fg(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return t}function vf(r){return(e,t={})=>{let n=e.match(r.matchPattern);if(!n)return null;let o=n[0],a=e.match(r.parsePattern);if(!a)return null;let u=r.valueCallback?r.valueCallback(a[0]):a[0];u=t.valueCallback?t.valueCallback(u):u;let d=e.slice(o.length);return{value:u,rest:d}}}var Bg=/^(\d+)(th|st|nd|rd)?/i,Ng=/\d+/i,Mg={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},qg={any:[/^b/i,/^(a|c)/i]},$g={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Ug={any:[/1/i,/2/i,/3/i,/4/i]},Wg={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},jg={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Hg={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Vg={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},zg={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Qg={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},If={ordinalNumber:vf({matchPattern:Bg,parsePattern:Ng,valueCallback:r=>parseInt(r,10)}),era:ms({matchPatterns:Mg,defaultMatchWidth:"wide",parsePatterns:qg,defaultParseWidth:"any"}),quarter:ms({matchPatterns:$g,defaultMatchWidth:"wide",parsePatterns:Ug,defaultParseWidth:"any",valueCallback:r=>r+1}),month:ms({matchPatterns:Wg,defaultMatchWidth:"wide",parsePatterns:jg,defaultParseWidth:"any"}),day:ms({matchPatterns:Hg,defaultMatchWidth:"wide",parsePatterns:Vg,defaultParseWidth:"any"}),dayPeriod:ms({matchPatterns:zg,defaultMatchWidth:"any",parsePatterns:Qg,defaultParseWidth:"any"})};var Ml={code:"en-US",formatDistance:Rf,formatLong:Af,formatRelative:Tf,localize:Ef,match:If,options:{weekStartsOn:0,firstWeekContainsDate:1}};var Gg=["years","months","weeks","days","hours","minutes","seconds"];function Pf(r,e){let t=Sf(),n=e?.locale??t.locale??Ml,o=e?.format??Gg,a=e?.zero??!1,u=e?.delimiter??" ";return n.formatDistance?o.reduce((h,f)=>{let g=`x${f.replace(/(^.)/,I=>I.toUpperCase())}`,S=r[f];return S!==void 0&&(a||r[f])?h.concat(n.formatDistance(g,S)):h},[]).join(u):""}var Cf=ht(Nl());async function xf(r){let e=await Cf.default.getBasicInfo(r),t=new Date(e.videoDetails.publishDate).toLocaleDateString(),n=Number(e.videoDetails.viewCount).toLocaleString(),o=Math.floor(Number(e.videoDetails.lengthSeconds)/3600),a=Math.floor(Number(e.videoDetails.lengthSeconds)%3600/60);return{duration:Pf({hours:o,minutes:a},{format:["hours","minutes","seconds"]}),ownerChannelName:e.videoDetails.ownerChannelName,ownerProfileUrl:e.videoDetails.ownerProfileUrl,publishDate:t,thumbnail:e.videoDetails.thumbnails[4],title:e.videoDetails.title,video_url:e.videoDetails.video_url,viewCount:n,videoId:e.videoDetails.videoId}}var Oe=require("@raycast/api");function Yg(r){return r.includes("youtube.com/watch?v=")?r.split("v=")[1].split("&")[0]:r.includes("youtu.be/")?r.split("youtu.be/")[1].split("?")[0]:r}async function Of(r){try{let e=Yg(r),t=`https://www.youtube.com/watch?v=${e}`,o=await(await fetch(t,{headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}})).text(),a=o.match(/"transcriptEndpoint":\{"getTranscriptEndpoint":\{"videoId":"[^"]+","params":"([^"]+)"/);if(a||(a=o.match(/"getTranscriptEndpoint":[^}]*"params":"([^"]+)"/)),!a){let D=o.match(/"params":"([A-Za-z0-9+/=%]{20,})"/g);if(D&&D.length>0){for(let M of D){let W=M.match(/"params":"([^"]+)"/);if(W){let z=W[1],y=o.indexOf(M),Z=o.substring(Math.max(0,y-200),y),N=o.substring(y,Math.min(o.length,y+200));if(Z.includes("transcript")||N.includes("transcript")||Z.includes("caption")||N.includes("caption")){a=[M,z];break}}}if(!a){let M=D[0].match(/"params":"([^"]+)"/);M&&(a=[D[0],M[1]])}}}if(!a){(0,Oe.showToast)({style:Oe.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,Oe.popToRoot)();return}let u=o.match(/"INNERTUBE_API_KEY":"([^"]+)"/),d=u?u[1]:"AIzaSyAO_FJ2SlqU8Q4STEHLGCilw_Y9_11qcW8",h=a[1],f=`https://www.youtube.com/youtubei/v1/get_transcript?key=${d}`,g={context:{client:{clientName:"WEB",clientVersion:"2.20240101.00.00"}},params:h},S=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Origin:"https://www.youtube.com",Referer:`https://www.youtube.com/watch?v=${e}`},body:JSON.stringify(g)});if(!S.ok)throw new Error(`Transcript API returned ${S.status}`);let L=(await S.json())?.actions?.[0]?.updateEngagementPanelAction?.content?.transcriptRenderer?.content,E=L?.transcriptBodyRenderer;if(!E){let D=L?.transcriptSearchPanelRenderer;E=D?.body?.transcriptSegmentListRenderer,E||(E=D?.footer)}if(!E?.cueGroups&&!E?.initialSegments){(0,Oe.showToast)({style:Oe.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,Oe.popToRoot)();return}let F="";if(E.initialSegments?F=E.initialSegments.map(M=>M.transcriptSegmentRenderer?.snippet?.runs?.map(Z=>Z.text||"").join("")||"").join(" ").replace(/\s+/g," ").trim():E.cueGroups&&(F=E.cueGroups.map(M=>M.transcriptCueGroupRenderer?.cues?.map(y=>y.transcriptCueRenderer?.cue?.simpleText||"").join(" ")||"").join(" ").replace(/\s+/g," ").trim()),!F){(0,Oe.showToast)({style:Oe.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,Oe.popToRoot)();return}return F}catch{(0,Oe.showToast)({style:Oe.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,Oe.popToRoot)();return}}function Df(r){let[e,t]=(0,lo.useState)(),[n,o]=(0,lo.useState)();return(0,lo.useEffect)(()=>{r&&xf(r).then(a=>(t(a),Of(r))).then(o).catch(a=>{(0,xi.showToast)({style:xi.Toast.Style.Failure,title:nn.title,message:`Error fetching video data or transcript: ${a.message}`})})},[r]),{videoData:e,transcript:n}}var ql=require("react/jsx-runtime");globalThis.fetch=Xo;function Lf(r){let[e,t]=(0,Sr.useState)(),[n,o]=(0,Sr.useState)(!1),[a,u]=(0,Sr.useState)(r.arguments.video),{addToHistory:d}=_f();bf({input:r.arguments.video||r.launchContext?.video,setVideoURL:u});let{videoData:h,transcript:f}=Df(a),{questions:g,setQuestions:S,question:I,setQuestion:_}=wf(e);xd({transcript:f,setSummaryIsLoading:o,setSummary:t}),Pd({setQuestions:S,setQuestion:_,transcript:f,question:I});let[A,C]=(0,Sr.useState)(null);if((0,Sr.useEffect)(()=>{if(e&&h&&f&&!A){let D={aiService:Zs,createdAt:new Date,id:h.videoId,questions:g,summary:e,title:h.title,videoUrl:a??""};d(D),C(h.videoId)}},[e,h,f,d,a,A,g]),(0,Sr.useEffect)(()=>{A&&g.length>0&&d({aiService:Zs,createdAt:new Date,id:A,questions:g,summary:e||"",title:h?.title||"",videoUrl:a??""})},[g,A,d,e,h,a]),!h||!f)return(0,ql.jsx)(kf.List,{isLoading:!0});let{thumbnail:B,title:L}=h,E=e?`${e}

![${L}](${B?.url})
  `:void 0;return(0,ql.jsx)(ll,{questions:g,summary:E,summaryIsLoading:n,transcript:f,videoData:h,onQuestionsUpdate:D=>{S(D)}})}
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

sax/lib/sax.js:
  (*! http://mths.be/fromcodepoint v0.1.0 by @mathias *)
*/
