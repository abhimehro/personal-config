"use strict";var Gu=Object.create;var bn=Object.defineProperty;var Yu=Object.getOwnPropertyDescriptor;var Xu=Object.getOwnPropertyNames;var Ku=Object.getPrototypeOf,Ju=Object.prototype.hasOwnProperty;var Tr=(r,n)=>()=>(r&&(n=r(r=0)),n);var ie=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports),So=(r,n)=>{for(var a in n)bn(r,a,{get:n[a],enumerable:!0})},To=(r,n,a,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of Xu(n))!Ju.call(r,i)&&i!==a&&bn(r,i,{get:()=>n[i],enumerable:!(o=Yu(n,i))||o.enumerable});return r};var He=(r,n,a)=>(a=r!=null?Gu(Ku(r)):{},To(n||!r||!r.__esModule?bn(a,"default",{value:r,enumerable:!0}):a,r)),Zu=r=>To(bn({},"__esModule",{value:!0}),r);var vo=ie((yn,Eo)=>{(function(r,n){typeof yn=="object"&&typeof Eo<"u"?n(yn):typeof define=="function"&&define.amd?define(["exports"],n):(r=typeof globalThis<"u"?globalThis:r||self,n(r.WebStreamsPolyfill={}))})(yn,(function(r){"use strict";function n(){}function a(e){return typeof e=="object"&&e!==null||typeof e=="function"}let o=n;function i(e,t){try{Object.defineProperty(e,"name",{value:t,configurable:!0})}catch{}}let u=Promise,f=Promise.prototype.then,b=Promise.reject.bind(u);function h(e){return new u(e)}function m(e){return h(t=>t(e))}function _(e){return b(e)}function E(e,t,s){return f.call(e,t,s)}function I(e,t,s){E(E(e,t,s),void 0,o)}function A(e,t){I(e,t)}function R(e,t){I(e,void 0,t)}function q(e,t,s){return E(e,t,s)}function O(e){E(e,void 0,o)}let M=e=>{if(typeof queueMicrotask=="function")M=queueMicrotask;else{let t=m(void 0);M=s=>E(t,s)}return M(e)};function v(e,t,s){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,s)}function B(e,t,s){try{return m(v(e,t,s))}catch(d){return _(d)}}let P=16384;class L{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(t){let s=this._back,d=s;s._elements.length===P-1&&(d={_elements:[],_next:void 0}),s._elements.push(t),d!==s&&(this._back=d,s._next=d),++this._size}shift(){let t=this._front,s=t,d=this._cursor,p=d+1,w=t._elements,S=w[d];return p===P&&(s=t._next,p=0),--this._size,this._cursor=p,t!==s&&(this._front=s),w[d]=void 0,S}forEach(t){let s=this._cursor,d=this._front,p=d._elements;for(;(s!==p.length||d._next!==void 0)&&!(s===p.length&&(d=d._next,p=d._elements,s=0,p.length===0));)t(p[s]),++s}peek(){let t=this._front,s=this._cursor;return t._elements[s]}}let U=Symbol("[[AbortSteps]]"),G=Symbol("[[ErrorSteps]]"),y=Symbol("[[CancelSteps]]"),te=Symbol("[[PullSteps]]"),F=Symbol("[[ReleaseSteps]]");function D(e,t){e._ownerReadableStream=t,t._reader=e,t._state==="readable"?be(e):t._state==="closed"?k(e):x(e,t._storedError)}function j(e,t){let s=e._ownerReadableStream;return xe(s,t)}function X(e){let t=e._ownerReadableStream;t._state==="readable"?re(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):dt(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),t._readableStreamController[F](),t._reader=void 0,e._ownerReadableStream=void 0}function Y(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function be(e){e._closedPromise=h((t,s)=>{e._closedPromise_resolve=t,e._closedPromise_reject=s})}function x(e,t){be(e),re(e,t)}function k(e){be(e),ze(e)}function re(e,t){e._closedPromise_reject!==void 0&&(O(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function dt(e,t){x(e,t)}function ze(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}let Vt=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},Mn=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function Wr(e){return typeof e=="object"||typeof e=="function"}function Re(e,t){if(e!==void 0&&!Wr(e))throw new TypeError(`${t} is not an object.`)}function ye(e,t){if(typeof e!="function")throw new TypeError(`${t} is not a function.`)}function c(e){return typeof e=="object"&&e!==null||typeof e=="function"}function l(e,t){if(!c(e))throw new TypeError(`${t} is not an object.`)}function T(e,t,s){if(e===void 0)throw new TypeError(`Parameter ${t} is required in '${s}'.`)}function g(e,t,s){if(e===void 0)throw new TypeError(`${t} is required in '${s}'.`)}function Q(e){return Number(e)}function ee(e){return e===0?0:e}function ne(e){return ee(Mn(e))}function le(e,t){let d=Number.MAX_SAFE_INTEGER,p=Number(e);if(p=ee(p),!Vt(p))throw new TypeError(`${t} is not a finite number`);if(p=ne(p),p<0||p>d)throw new TypeError(`${t} is outside the accepted range of 0 to ${d}, inclusive`);return!Vt(p)||p===0?0:p}function ge(e,t){if(!bt(e))throw new TypeError(`${t} is not a ReadableStream.`)}function Ee(e){return new Be(e)}function ae(e,t){e._reader._readRequests.push(t)}function ve(e,t,s){let p=e._reader._readRequests.shift();s?p._closeSteps():p._chunkSteps(t)}function $t(e){return e._reader._readRequests.length}function dr(e){let t=e._reader;return!(t===void 0||!Ne(t))}class Be{constructor(t){if(T(t,1,"ReadableStreamDefaultReader"),ge(t,"First parameter"),yt(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");D(this,t),this._readRequests=new L}get closed(){return Ne(this)?this._closedPromise:_(Ur("closed"))}cancel(t=void 0){return Ne(this)?this._ownerReadableStream===void 0?_(Y("cancel")):j(this,t):_(Ur("cancel"))}read(){if(!Ne(this))return _(Ur("read"));if(this._ownerReadableStream===void 0)return _(Y("read from"));let t,s,d=h((w,S)=>{t=w,s=S});return fr(this,{_chunkSteps:w=>t({value:w,done:!1}),_closeSteps:()=>t({value:void 0,done:!0}),_errorSteps:w=>s(w)}),d}releaseLock(){if(!Ne(this))throw Ur("releaseLock");this._ownerReadableStream!==void 0&&cl(this)}}Object.defineProperties(Be.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(Be.prototype.cancel,"cancel"),i(Be.prototype.read,"read"),i(Be.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Be.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Ne(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_readRequests")?!1:e instanceof Be}function fr(e,t){let s=e._ownerReadableStream;s._disturbed=!0,s._state==="closed"?t._closeSteps():s._state==="errored"?t._errorSteps(s._storedError):s._readableStreamController[te](t)}function cl(e){X(e);let t=new TypeError("Reader was released");fi(e,t)}function fi(e,t){let s=e._readRequests;e._readRequests=new L,s.forEach(d=>{d._errorSteps(t)})}function Ur(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}let dl=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class mi{constructor(t,s){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=t,this._preventCancel=s}next(){let t=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?q(this._ongoingPromise,t,t):t(),this._ongoingPromise}return(t){let s=()=>this._returnSteps(t);return this._ongoingPromise?q(this._ongoingPromise,s,s):s()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let t=this._reader,s,d,p=h((S,C)=>{s=S,d=C});return fr(t,{_chunkSteps:S=>{this._ongoingPromise=void 0,M(()=>s({value:S,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,X(t),s({value:void 0,done:!0})},_errorSteps:S=>{this._ongoingPromise=void 0,this._isFinished=!0,X(t),d(S)}}),p}_returnSteps(t){if(this._isFinished)return Promise.resolve({value:t,done:!0});this._isFinished=!0;let s=this._reader;if(!this._preventCancel){let d=j(s,t);return X(s),q(d,()=>({value:t,done:!0}))}return X(s),m({value:t,done:!0})}}let hi={next(){return pi(this)?this._asyncIteratorImpl.next():_(bi("next"))},return(e){return pi(this)?this._asyncIteratorImpl.return(e):_(bi("return"))}};Object.setPrototypeOf(hi,dl);function fl(e,t){let s=Ee(e),d=new mi(s,t),p=Object.create(hi);return p._asyncIteratorImpl=d,p}function pi(e){if(!a(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof mi}catch{return!1}}function bi(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}let yi=Number.isNaN||function(e){return e!==e};var xn,Wn,Un;function mr(e){return e.slice()}function gi(e,t,s,d,p){new Uint8Array(e).set(new Uint8Array(s,d,p),t)}let Je=e=>(typeof e.transfer=="function"?Je=t=>t.transfer():typeof structuredClone=="function"?Je=t=>structuredClone(t,{transfer:[t]}):Je=t=>t,Je(e)),ft=e=>(typeof e.detached=="boolean"?ft=t=>t.detached:ft=t=>t.byteLength===0,ft(e));function _i(e,t,s){if(e.slice)return e.slice(t,s);let d=s-t,p=new ArrayBuffer(d);return gi(p,0,e,t,d),p}function Vr(e,t){let s=e[t];if(s!=null){if(typeof s!="function")throw new TypeError(`${String(t)} is not a function`);return s}}function ml(e){let t={[Symbol.iterator]:()=>e.iterator},s=(async function*(){return yield*t})(),d=s.next;return{iterator:s,nextMethod:d,done:!1}}let Vn=(Un=(xn=Symbol.asyncIterator)!==null&&xn!==void 0?xn:(Wn=Symbol.for)===null||Wn===void 0?void 0:Wn.call(Symbol,"Symbol.asyncIterator"))!==null&&Un!==void 0?Un:"@@asyncIterator";function wi(e,t="sync",s){if(s===void 0)if(t==="async"){if(s=Vr(e,Vn),s===void 0){let w=Vr(e,Symbol.iterator),S=wi(e,"sync",w);return ml(S)}}else s=Vr(e,Symbol.iterator);if(s===void 0)throw new TypeError("The object is not iterable");let d=v(s,e,[]);if(!a(d))throw new TypeError("The iterator method must return an object");let p=d.next;return{iterator:d,nextMethod:p,done:!1}}function hl(e){let t=v(e.nextMethod,e.iterator,[]);if(!a(t))throw new TypeError("The iterator.next() method must return an object");return t}function pl(e){return!!e.done}function bl(e){return e.value}function yl(e){return!(typeof e!="number"||yi(e)||e<0)}function Si(e){let t=_i(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function $n(e){let t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function zn(e,t,s){if(!yl(s)||s===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:s}),e._queueTotalSize+=s}function gl(e){return e._queue.peek().value}function mt(e){e._queue=new L,e._queueTotalSize=0}function Ti(e){return e===DataView}function _l(e){return Ti(e.constructor)}function wl(e){return Ti(e)?1:e.BYTES_PER_ELEMENT}class Ct{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!jn(this))throw Xn("view");return this._view}respond(t){if(!jn(this))throw Xn("respond");if(T(t,1,"respond"),t=le(t,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(ft(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");Hr(this._associatedReadableByteStreamController,t)}respondWithNewView(t){if(!jn(this))throw Xn("respondWithNewView");if(T(t,1,"respondWithNewView"),!ArrayBuffer.isView(t))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(ft(t.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");Qr(this._associatedReadableByteStreamController,t)}}Object.defineProperties(Ct.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),i(Ct.prototype.respond,"respond"),i(Ct.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ct.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Ze{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Pt(this))throw pr("byobRequest");return Yn(this)}get desiredSize(){if(!Pt(this))throw pr("desiredSize");return Li(this)}close(){if(!Pt(this))throw pr("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let t=this._controlledReadableByteStream._state;if(t!=="readable")throw new TypeError(`The stream (in ${t} state) is not in the readable state and cannot be closed`);hr(this)}enqueue(t){if(!Pt(this))throw pr("enqueue");if(T(t,1,"enqueue"),!ArrayBuffer.isView(t))throw new TypeError("chunk must be an array buffer view");if(t.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(t.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let s=this._controlledReadableByteStream._state;if(s!=="readable")throw new TypeError(`The stream (in ${s} state) is not in the readable state and cannot be enqueued to`);jr(this,t)}error(t=void 0){if(!Pt(this))throw pr("error");Le(this,t)}[y](t){Ri(this),mt(this);let s=this._cancelAlgorithm(t);return zr(this),s}[te](t){let s=this._controlledReadableByteStream;if(this._queueTotalSize>0){Bi(this,t);return}let d=this._autoAllocateChunkSize;if(d!==void 0){let p;try{p=new ArrayBuffer(d)}catch(S){t._errorSteps(S);return}let w={buffer:p,bufferByteLength:d,byteOffset:0,byteLength:d,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(w)}ae(s,t),It(this)}[F](){if(this._pendingPullIntos.length>0){let t=this._pendingPullIntos.peek();t.readerType="none",this._pendingPullIntos=new L,this._pendingPullIntos.push(t)}}}Object.defineProperties(Ze.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),i(Ze.prototype.close,"close"),i(Ze.prototype.enqueue,"enqueue"),i(Ze.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ze.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function Pt(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")?!1:e instanceof Ze}function jn(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")?!1:e instanceof Ct}function It(e){if(!vl(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let s=e._pullAlgorithm();I(s,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,It(e)),null),d=>(Le(e,d),null))}function Ri(e){Qn(e),e._pendingPullIntos=new L}function Hn(e,t){let s=!1;e._state==="closed"&&(s=!0);let d=Ei(t);t.readerType==="default"?ve(e,d,s):Bl(e,d,s)}function Ei(e){let t=e.bytesFilled,s=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/s)}function $r(e,t,s,d){e._queue.push({buffer:t,byteOffset:s,byteLength:d}),e._queueTotalSize+=d}function vi(e,t,s,d){let p;try{p=_i(t,s,s+d)}catch(w){throw Le(e,w),w}$r(e,p,0,d)}function Ai(e,t){t.bytesFilled>0&&vi(e,t.buffer,t.byteOffset,t.bytesFilled),zt(e)}function Ci(e,t){let s=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),d=t.bytesFilled+s,p=s,w=!1,S=d%t.elementSize,C=d-S;C>=t.minimumFill&&(p=C-t.bytesFilled,w=!0);let V=e._queue;for(;p>0;){let N=V.peek(),$=Math.min(p,N.byteLength),z=t.byteOffset+t.bytesFilled;gi(t.buffer,z,N.buffer,N.byteOffset,$),N.byteLength===$?V.shift():(N.byteOffset+=$,N.byteLength-=$),e._queueTotalSize-=$,Pi(e,$,t),p-=$}return w}function Pi(e,t,s){s.bytesFilled+=t}function Ii(e){e._queueTotalSize===0&&e._closeRequested?(zr(e),Sr(e._controlledReadableByteStream)):It(e)}function Qn(e){e._byobRequest!==null&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function Gn(e){for(;e._pendingPullIntos.length>0;){if(e._queueTotalSize===0)return;let t=e._pendingPullIntos.peek();Ci(e,t)&&(zt(e),Hn(e._controlledReadableByteStream,t))}}function Sl(e){let t=e._controlledReadableByteStream._reader;for(;t._readRequests.length>0;){if(e._queueTotalSize===0)return;let s=t._readRequests.shift();Bi(e,s)}}function Tl(e,t,s,d){let p=e._controlledReadableByteStream,w=t.constructor,S=wl(w),{byteOffset:C,byteLength:V}=t,N=s*S,$;try{$=Je(t.buffer)}catch(K){d._errorSteps(K);return}let z={buffer:$,bufferByteLength:$.byteLength,byteOffset:C,byteLength:V,bytesFilled:0,minimumFill:N,elementSize:S,viewConstructor:w,readerType:"byob"};if(e._pendingPullIntos.length>0){e._pendingPullIntos.push(z),qi(p,d);return}if(p._state==="closed"){let K=new w(z.buffer,z.byteOffset,0);d._closeSteps(K);return}if(e._queueTotalSize>0){if(Ci(e,z)){let K=Ei(z);Ii(e),d._chunkSteps(K);return}if(e._closeRequested){let K=new TypeError("Insufficient bytes to fill elements in the given buffer");Le(e,K),d._errorSteps(K);return}}e._pendingPullIntos.push(z),qi(p,d),It(e)}function Rl(e,t){t.readerType==="none"&&zt(e);let s=e._controlledReadableByteStream;if(Kn(s))for(;Fi(s)>0;){let d=zt(e);Hn(s,d)}}function El(e,t,s){if(Pi(e,t,s),s.readerType==="none"){Ai(e,s),Gn(e);return}if(s.bytesFilled<s.minimumFill)return;zt(e);let d=s.bytesFilled%s.elementSize;if(d>0){let p=s.byteOffset+s.bytesFilled;vi(e,s.buffer,p-d,d)}s.bytesFilled-=d,Hn(e._controlledReadableByteStream,s),Gn(e)}function Di(e,t){let s=e._pendingPullIntos.peek();Qn(e),e._controlledReadableByteStream._state==="closed"?Rl(e,s):El(e,t,s),It(e)}function zt(e){return e._pendingPullIntos.shift()}function vl(e){let t=e._controlledReadableByteStream;return t._state!=="readable"||e._closeRequested||!e._started?!1:!!(dr(t)&&$t(t)>0||Kn(t)&&Fi(t)>0||Li(e)>0)}function zr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function hr(e){let t=e._controlledReadableByteStream;if(!(e._closeRequested||t._state!=="readable")){if(e._queueTotalSize>0){e._closeRequested=!0;return}if(e._pendingPullIntos.length>0){let s=e._pendingPullIntos.peek();if(s.bytesFilled%s.elementSize!==0){let d=new TypeError("Insufficient bytes to fill elements in the given buffer");throw Le(e,d),d}}zr(e),Sr(t)}}function jr(e,t){let s=e._controlledReadableByteStream;if(e._closeRequested||s._state!=="readable")return;let{buffer:d,byteOffset:p,byteLength:w}=t;if(ft(d))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let S=Je(d);if(e._pendingPullIntos.length>0){let C=e._pendingPullIntos.peek();if(ft(C.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Qn(e),C.buffer=Je(C.buffer),C.readerType==="none"&&Ai(e,C)}if(dr(s))if(Sl(e),$t(s)===0)$r(e,S,p,w);else{e._pendingPullIntos.length>0&&zt(e);let C=new Uint8Array(S,p,w);ve(s,C,!1)}else Kn(s)?($r(e,S,p,w),Gn(e)):$r(e,S,p,w);It(e)}function Le(e,t){let s=e._controlledReadableByteStream;s._state==="readable"&&(Ri(e),mt(e),zr(e),oo(s,t))}function Bi(e,t){let s=e._queue.shift();e._queueTotalSize-=s.byteLength,Ii(e);let d=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);t._chunkSteps(d)}function Yn(e){if(e._byobRequest===null&&e._pendingPullIntos.length>0){let t=e._pendingPullIntos.peek(),s=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),d=Object.create(Ct.prototype);Cl(d,e,s),e._byobRequest=d}return e._byobRequest}function Li(e){let t=e._controlledReadableByteStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function Hr(e,t){let s=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(t===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(s.bytesFilled+t>s.byteLength)throw new RangeError("bytesWritten out of range")}s.buffer=Je(s.buffer),Di(e,t)}function Qr(e,t){let s=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(t.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(s.byteOffset+s.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(s.bufferByteLength!==t.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(s.bytesFilled+t.byteLength>s.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let p=t.byteLength;s.buffer=Je(t.buffer),Di(e,p)}function Oi(e,t,s,d,p,w,S){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,mt(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=w,t._pullAlgorithm=d,t._cancelAlgorithm=p,t._autoAllocateChunkSize=S,t._pendingPullIntos=new L,e._readableStreamController=t;let C=s();I(m(C),()=>(t._started=!0,It(t),null),V=>(Le(t,V),null))}function Al(e,t,s){let d=Object.create(Ze.prototype),p,w,S;t.start!==void 0?p=()=>t.start(d):p=()=>{},t.pull!==void 0?w=()=>t.pull(d):w=()=>m(void 0),t.cancel!==void 0?S=V=>t.cancel(V):S=()=>m(void 0);let C=t.autoAllocateChunkSize;if(C===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Oi(e,d,p,w,S,s,C)}function Cl(e,t,s){e._associatedReadableByteStreamController=t,e._view=s}function Xn(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function pr(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function Pl(e,t){Re(e,t);let s=e?.mode;return{mode:s===void 0?void 0:Il(s,`${t} has member 'mode' that`)}}function Il(e,t){if(e=`${e}`,e!=="byob")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function Dl(e,t){var s;Re(e,t);let d=(s=e?.min)!==null&&s!==void 0?s:1;return{min:le(d,`${t} has member 'min' that`)}}function ki(e){return new ht(e)}function qi(e,t){e._reader._readIntoRequests.push(t)}function Bl(e,t,s){let p=e._reader._readIntoRequests.shift();s?p._closeSteps(t):p._chunkSteps(t)}function Fi(e){return e._reader._readIntoRequests.length}function Kn(e){let t=e._reader;return!(t===void 0||!Dt(t))}class ht{constructor(t){if(T(t,1,"ReadableStreamBYOBReader"),ge(t,"First parameter"),yt(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Pt(t._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");D(this,t),this._readIntoRequests=new L}get closed(){return Dt(this)?this._closedPromise:_(Gr("closed"))}cancel(t=void 0){return Dt(this)?this._ownerReadableStream===void 0?_(Y("cancel")):j(this,t):_(Gr("cancel"))}read(t,s={}){if(!Dt(this))return _(Gr("read"));if(!ArrayBuffer.isView(t))return _(new TypeError("view must be an array buffer view"));if(t.byteLength===0)return _(new TypeError("view must have non-zero byteLength"));if(t.buffer.byteLength===0)return _(new TypeError("view's buffer must have non-zero byteLength"));if(ft(t.buffer))return _(new TypeError("view's buffer has been detached"));let d;try{d=Dl(s,"options")}catch(N){return _(N)}let p=d.min;if(p===0)return _(new TypeError("options.min must be greater than 0"));if(_l(t)){if(p>t.byteLength)return _(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(p>t.length)return _(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return _(Y("read from"));let w,S,C=h((N,$)=>{w=N,S=$});return Ni(this,t,p,{_chunkSteps:N=>w({value:N,done:!1}),_closeSteps:N=>w({value:N,done:!0}),_errorSteps:N=>S(N)}),C}releaseLock(){if(!Dt(this))throw Gr("releaseLock");this._ownerReadableStream!==void 0&&Ll(this)}}Object.defineProperties(ht.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),i(ht.prototype.cancel,"cancel"),i(ht.prototype.read,"read"),i(ht.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ht.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function Dt(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")?!1:e instanceof ht}function Ni(e,t,s,d){let p=e._ownerReadableStream;p._disturbed=!0,p._state==="errored"?d._errorSteps(p._storedError):Tl(p._readableStreamController,t,s,d)}function Ll(e){X(e);let t=new TypeError("Reader was released");Mi(e,t)}function Mi(e,t){let s=e._readIntoRequests;e._readIntoRequests=new L,s.forEach(d=>{d._errorSteps(t)})}function Gr(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function br(e,t){let{highWaterMark:s}=e;if(s===void 0)return t;if(yi(s)||s<0)throw new RangeError("Invalid highWaterMark");return s}function Yr(e){let{size:t}=e;return t||(()=>1)}function Xr(e,t){Re(e,t);let s=e?.highWaterMark,d=e?.size;return{highWaterMark:s===void 0?void 0:Q(s),size:d===void 0?void 0:Ol(d,`${t} has member 'size' that`)}}function Ol(e,t){return ye(e,t),s=>Q(e(s))}function kl(e,t){Re(e,t);let s=e?.abort,d=e?.close,p=e?.start,w=e?.type,S=e?.write;return{abort:s===void 0?void 0:ql(s,e,`${t} has member 'abort' that`),close:d===void 0?void 0:Fl(d,e,`${t} has member 'close' that`),start:p===void 0?void 0:Nl(p,e,`${t} has member 'start' that`),write:S===void 0?void 0:Ml(S,e,`${t} has member 'write' that`),type:w}}function ql(e,t,s){return ye(e,s),d=>B(e,t,[d])}function Fl(e,t,s){return ye(e,s),()=>B(e,t,[])}function Nl(e,t,s){return ye(e,s),d=>v(e,t,[d])}function Ml(e,t,s){return ye(e,s),(d,p)=>B(e,t,[d,p])}function xi(e,t){if(!jt(e))throw new TypeError(`${t} is not a WritableStream.`)}function xl(e){if(typeof e!="object"||e===null)return!1;try{return typeof e.aborted=="boolean"}catch{return!1}}let Wl=typeof AbortController=="function";function Ul(){if(Wl)return new AbortController}class pt{constructor(t={},s={}){t===void 0?t=null:l(t,"First parameter");let d=Xr(s,"Second parameter"),p=kl(t,"First parameter");if(Ui(this),p.type!==void 0)throw new RangeError("Invalid type is specified");let S=Yr(d),C=br(d,1);tu(this,p,C,S)}get locked(){if(!jt(this))throw tn("locked");return Ht(this)}abort(t=void 0){return jt(this)?Ht(this)?_(new TypeError("Cannot abort a stream that already has a writer")):Kr(this,t):_(tn("abort"))}close(){return jt(this)?Ht(this)?_(new TypeError("Cannot close a stream that already has a writer")):je(this)?_(new TypeError("Cannot close an already-closing stream")):Vi(this):_(tn("close"))}getWriter(){if(!jt(this))throw tn("getWriter");return Wi(this)}}Object.defineProperties(pt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),i(pt.prototype.abort,"abort"),i(pt.prototype.close,"close"),i(pt.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(pt.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function Wi(e){return new et(e)}function Vl(e,t,s,d,p=1,w=()=>1){let S=Object.create(pt.prototype);Ui(S);let C=Object.create(Qt.prototype);return Gi(S,C,e,t,s,d,p,w),S}function Ui(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new L,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function jt(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")?!1:e instanceof pt}function Ht(e){return e._writer!==void 0}function Kr(e,t){var s;if(e._state==="closed"||e._state==="errored")return m(void 0);e._writableStreamController._abortReason=t,(s=e._writableStreamController._abortController)===null||s===void 0||s.abort(t);let d=e._state;if(d==="closed"||d==="errored")return m(void 0);if(e._pendingAbortRequest!==void 0)return e._pendingAbortRequest._promise;let p=!1;d==="erroring"&&(p=!0,t=void 0);let w=h((S,C)=>{e._pendingAbortRequest={_promise:void 0,_resolve:S,_reject:C,_reason:t,_wasAlreadyErroring:p}});return e._pendingAbortRequest._promise=w,p||Zn(e,t),w}function Vi(e){let t=e._state;if(t==="closed"||t==="errored")return _(new TypeError(`The stream (in ${t} state) is not in the writable state and cannot be closed`));let s=h((p,w)=>{let S={_resolve:p,_reject:w};e._closeRequest=S}),d=e._writer;return d!==void 0&&e._backpressure&&t==="writable"&&sa(d),ru(e._writableStreamController),s}function $l(e){return h((s,d)=>{let p={_resolve:s,_reject:d};e._writeRequests.push(p)})}function Jn(e,t){if(e._state==="writable"){Zn(e,t);return}ea(e)}function Zn(e,t){let s=e._writableStreamController;e._state="erroring",e._storedError=t;let d=e._writer;d!==void 0&&zi(d,t),!Gl(e)&&s._started&&ea(e)}function ea(e){e._state="errored",e._writableStreamController[G]();let t=e._storedError;if(e._writeRequests.forEach(p=>{p._reject(t)}),e._writeRequests=new L,e._pendingAbortRequest===void 0){Jr(e);return}let s=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,s._wasAlreadyErroring){s._reject(t),Jr(e);return}let d=e._writableStreamController[U](s._reason);I(d,()=>(s._resolve(),Jr(e),null),p=>(s._reject(p),Jr(e),null))}function zl(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function jl(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,Jn(e,t)}function Hl(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,e._state==="erroring"&&(e._storedError=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";let s=e._writer;s!==void 0&&Ji(s)}function Ql(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),Jn(e,t)}function je(e){return!(e._closeRequest===void 0&&e._inFlightCloseRequest===void 0)}function Gl(e){return!(e._inFlightWriteRequest===void 0&&e._inFlightCloseRequest===void 0)}function Yl(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function Xl(e){e._inFlightWriteRequest=e._writeRequests.shift()}function Jr(e){e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);let t=e._writer;t!==void 0&&ia(t,e._storedError)}function ta(e,t){let s=e._writer;s!==void 0&&t!==e._backpressure&&(t?uu(s):sa(s)),e._backpressure=t}class et{constructor(t){if(T(t,1,"WritableStreamDefaultWriter"),xi(t,"First parameter"),Ht(t))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=t,t._writer=this;let s=t._state;if(s==="writable")!je(t)&&t._backpressure?nn(this):Zi(this),rn(this);else if(s==="erroring")oa(this,t._storedError),rn(this);else if(s==="closed")Zi(this),su(this);else{let d=t._storedError;oa(this,d),Ki(this,d)}}get closed(){return Bt(this)?this._closedPromise:_(Lt("closed"))}get desiredSize(){if(!Bt(this))throw Lt("desiredSize");if(this._ownerWritableStream===void 0)throw gr("desiredSize");return eu(this)}get ready(){return Bt(this)?this._readyPromise:_(Lt("ready"))}abort(t=void 0){return Bt(this)?this._ownerWritableStream===void 0?_(gr("abort")):Kl(this,t):_(Lt("abort"))}close(){if(!Bt(this))return _(Lt("close"));let t=this._ownerWritableStream;return t===void 0?_(gr("close")):je(t)?_(new TypeError("Cannot close an already-closing stream")):$i(this)}releaseLock(){if(!Bt(this))throw Lt("releaseLock");this._ownerWritableStream!==void 0&&ji(this)}write(t=void 0){return Bt(this)?this._ownerWritableStream===void 0?_(gr("write to")):Hi(this,t):_(Lt("write"))}}Object.defineProperties(et.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),i(et.prototype.abort,"abort"),i(et.prototype.close,"close"),i(et.prototype.releaseLock,"releaseLock"),i(et.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(et.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Bt(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")?!1:e instanceof et}function Kl(e,t){let s=e._ownerWritableStream;return Kr(s,t)}function $i(e){let t=e._ownerWritableStream;return Vi(t)}function Jl(e){let t=e._ownerWritableStream,s=t._state;return je(t)||s==="closed"?m(void 0):s==="errored"?_(t._storedError):$i(e)}function Zl(e,t){e._closedPromiseState==="pending"?ia(e,t):lu(e,t)}function zi(e,t){e._readyPromiseState==="pending"?eo(e,t):cu(e,t)}function eu(e){let t=e._ownerWritableStream,s=t._state;return s==="errored"||s==="erroring"?null:s==="closed"?0:Yi(t._writableStreamController)}function ji(e){let t=e._ownerWritableStream,s=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");zi(e,s),Zl(e,s),t._writer=void 0,e._ownerWritableStream=void 0}function Hi(e,t){let s=e._ownerWritableStream,d=s._writableStreamController,p=nu(d,t);if(s!==e._ownerWritableStream)return _(gr("write to"));let w=s._state;if(w==="errored")return _(s._storedError);if(je(s)||w==="closed")return _(new TypeError("The stream is closing or closed and cannot be written to"));if(w==="erroring")return _(s._storedError);let S=$l(s);return au(d,t,p),S}let Qi={};class Qt{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!ra(this))throw aa("abortReason");return this._abortReason}get signal(){if(!ra(this))throw aa("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(t=void 0){if(!ra(this))throw aa("error");this._controlledWritableStream._state==="writable"&&Xi(this,t)}[U](t){let s=this._abortAlgorithm(t);return Zr(this),s}[G](){mt(this)}}Object.defineProperties(Qt.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Qt.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function ra(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")?!1:e instanceof Qt}function Gi(e,t,s,d,p,w,S,C){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,mt(t),t._abortReason=void 0,t._abortController=Ul(),t._started=!1,t._strategySizeAlgorithm=C,t._strategyHWM=S,t._writeAlgorithm=d,t._closeAlgorithm=p,t._abortAlgorithm=w;let V=na(t);ta(e,V);let N=s(),$=m(N);I($,()=>(t._started=!0,en(t),null),z=>(t._started=!0,Jn(e,z),null))}function tu(e,t,s,d){let p=Object.create(Qt.prototype),w,S,C,V;t.start!==void 0?w=()=>t.start(p):w=()=>{},t.write!==void 0?S=N=>t.write(N,p):S=()=>m(void 0),t.close!==void 0?C=()=>t.close():C=()=>m(void 0),t.abort!==void 0?V=N=>t.abort(N):V=()=>m(void 0),Gi(e,p,w,S,C,V,s,d)}function Zr(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function ru(e){zn(e,Qi,0),en(e)}function nu(e,t){try{return e._strategySizeAlgorithm(t)}catch(s){return yr(e,s),1}}function Yi(e){return e._strategyHWM-e._queueTotalSize}function au(e,t,s){try{zn(e,t,s)}catch(p){yr(e,p);return}let d=e._controlledWritableStream;if(!je(d)&&d._state==="writable"){let p=na(e);ta(d,p)}en(e)}function en(e){let t=e._controlledWritableStream;if(!e._started||t._inFlightWriteRequest!==void 0)return;if(t._state==="erroring"){ea(t);return}if(e._queue.length===0)return;let d=gl(e);d===Qi?iu(e):ou(e,d)}function yr(e,t){e._controlledWritableStream._state==="writable"&&Xi(e,t)}function iu(e){let t=e._controlledWritableStream;Yl(t),$n(e);let s=e._closeAlgorithm();Zr(e),I(s,()=>(Hl(t),null),d=>(Ql(t,d),null))}function ou(e,t){let s=e._controlledWritableStream;Xl(s);let d=e._writeAlgorithm(t);I(d,()=>{zl(s);let p=s._state;if($n(e),!je(s)&&p==="writable"){let w=na(e);ta(s,w)}return en(e),null},p=>(s._state==="writable"&&Zr(e),jl(s,p),null))}function na(e){return Yi(e)<=0}function Xi(e,t){let s=e._controlledWritableStream;Zr(e),Zn(s,t)}function tn(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function aa(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function Lt(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function gr(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function rn(e){e._closedPromise=h((t,s)=>{e._closedPromise_resolve=t,e._closedPromise_reject=s,e._closedPromiseState="pending"})}function Ki(e,t){rn(e),ia(e,t)}function su(e){rn(e),Ji(e)}function ia(e,t){e._closedPromise_reject!==void 0&&(O(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function lu(e,t){Ki(e,t)}function Ji(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function nn(e){e._readyPromise=h((t,s)=>{e._readyPromise_resolve=t,e._readyPromise_reject=s}),e._readyPromiseState="pending"}function oa(e,t){nn(e),eo(e,t)}function Zi(e){nn(e),sa(e)}function eo(e,t){e._readyPromise_reject!==void 0&&(O(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function uu(e){nn(e)}function cu(e,t){oa(e,t)}function sa(e){e._readyPromise_resolve!==void 0&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}function du(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let la=du();function fu(e){if(!(typeof e=="function"||typeof e=="object")||e.name!=="DOMException")return!1;try{return new e,!0}catch{return!1}}function mu(){let e=la?.DOMException;return fu(e)?e:void 0}function hu(){let e=function(s,d){this.message=s||"",this.name=d||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return i(e,"DOMException"),e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}let pu=mu()||hu();function to(e,t,s,d,p,w){let S=Ee(e),C=Wi(t);e._disturbed=!0;let V=!1,N=m(void 0);return h(($,z)=>{let K;if(w!==void 0){if(K=()=>{let W=w.reason!==void 0?w.reason:new pu("Aborted","AbortError"),H=[];d||H.push(()=>t._state==="writable"?Kr(t,W):m(void 0)),p||H.push(()=>e._state==="readable"?xe(e,W):m(void 0)),_e(()=>Promise.all(H.map(J=>J())),!0,W)},w.aborted){K();return}w.addEventListener("abort",K)}function We(){return h((W,H)=>{function J(Ae){Ae?W():E(Kt(),J,H)}J(!1)})}function Kt(){return V?m(!0):E(C._readyPromise,()=>h((W,H)=>{fr(S,{_chunkSteps:J=>{N=E(Hi(C,J),void 0,n),W(!1)},_closeSteps:()=>W(!0),_errorSteps:H})}))}if(rt(e,S._closedPromise,W=>(d?Oe(!0,W):_e(()=>Kr(t,W),!0,W),null)),rt(t,C._closedPromise,W=>(p?Oe(!0,W):_e(()=>xe(e,W),!0,W),null)),me(e,S._closedPromise,()=>(s?Oe():_e(()=>Jl(C)),null)),je(t)||t._state==="closed"){let W=new TypeError("the destination writable stream closed before all data could be piped to it");p?Oe(!0,W):_e(()=>xe(e,W),!0,W)}O(We());function _t(){let W=N;return E(N,()=>W!==N?_t():void 0)}function rt(W,H,J){W._state==="errored"?J(W._storedError):R(H,J)}function me(W,H,J){W._state==="closed"?J():A(H,J)}function _e(W,H,J){if(V)return;V=!0,t._state==="writable"&&!je(t)?A(_t(),Ae):Ae();function Ae(){return I(W(),()=>nt(H,J),Jt=>nt(!0,Jt)),null}}function Oe(W,H){V||(V=!0,t._state==="writable"&&!je(t)?A(_t(),()=>nt(W,H)):nt(W,H))}function nt(W,H){return ji(C),X(S),w!==void 0&&w.removeEventListener("abort",K),W?z(H):$(void 0),null}})}class tt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!an(this))throw sn("desiredSize");return ua(this)}close(){if(!an(this))throw sn("close");if(!Yt(this))throw new TypeError("The stream is not in a state that permits close");Ot(this)}enqueue(t=void 0){if(!an(this))throw sn("enqueue");if(!Yt(this))throw new TypeError("The stream is not in a state that permits enqueue");return Gt(this,t)}error(t=void 0){if(!an(this))throw sn("error");Me(this,t)}[y](t){mt(this);let s=this._cancelAlgorithm(t);return on(this),s}[te](t){let s=this._controlledReadableStream;if(this._queue.length>0){let d=$n(this);this._closeRequested&&this._queue.length===0?(on(this),Sr(s)):_r(this),t._chunkSteps(d)}else ae(s,t),_r(this)}[F](){}}Object.defineProperties(tt.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),i(tt.prototype.close,"close"),i(tt.prototype.enqueue,"enqueue"),i(tt.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(tt.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function an(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")?!1:e instanceof tt}function _r(e){if(!ro(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;let s=e._pullAlgorithm();I(s,()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,_r(e)),null),d=>(Me(e,d),null))}function ro(e){let t=e._controlledReadableStream;return!Yt(e)||!e._started?!1:!!(yt(t)&&$t(t)>0||ua(e)>0)}function on(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Ot(e){if(!Yt(e))return;let t=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&(on(e),Sr(t))}function Gt(e,t){if(!Yt(e))return;let s=e._controlledReadableStream;if(yt(s)&&$t(s)>0)ve(s,t,!1);else{let d;try{d=e._strategySizeAlgorithm(t)}catch(p){throw Me(e,p),p}try{zn(e,t,d)}catch(p){throw Me(e,p),p}}_r(e)}function Me(e,t){let s=e._controlledReadableStream;s._state==="readable"&&(mt(e),on(e),oo(s,t))}function ua(e){let t=e._controlledReadableStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function bu(e){return!ro(e)}function Yt(e){let t=e._controlledReadableStream._state;return!e._closeRequested&&t==="readable"}function no(e,t,s,d,p,w,S){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,mt(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=S,t._strategyHWM=w,t._pullAlgorithm=d,t._cancelAlgorithm=p,e._readableStreamController=t;let C=s();I(m(C),()=>(t._started=!0,_r(t),null),V=>(Me(t,V),null))}function yu(e,t,s,d){let p=Object.create(tt.prototype),w,S,C;t.start!==void 0?w=()=>t.start(p):w=()=>{},t.pull!==void 0?S=()=>t.pull(p):S=()=>m(void 0),t.cancel!==void 0?C=V=>t.cancel(V):C=()=>m(void 0),no(e,p,w,S,C,s,d)}function sn(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function gu(e,t){return Pt(e._readableStreamController)?wu(e):_u(e)}function _u(e,t){let s=Ee(e),d=!1,p=!1,w=!1,S=!1,C,V,N,$,z,K=h(me=>{z=me});function We(){return d?(p=!0,m(void 0)):(d=!0,fr(s,{_chunkSteps:_e=>{M(()=>{p=!1;let Oe=_e,nt=_e;w||Gt(N._readableStreamController,Oe),S||Gt($._readableStreamController,nt),d=!1,p&&We()})},_closeSteps:()=>{d=!1,w||Ot(N._readableStreamController),S||Ot($._readableStreamController),(!w||!S)&&z(void 0)},_errorSteps:()=>{d=!1}}),m(void 0))}function Kt(me){if(w=!0,C=me,S){let _e=mr([C,V]),Oe=xe(e,_e);z(Oe)}return K}function _t(me){if(S=!0,V=me,w){let _e=mr([C,V]),Oe=xe(e,_e);z(Oe)}return K}function rt(){}return N=wr(rt,We,Kt),$=wr(rt,We,_t),R(s._closedPromise,me=>(Me(N._readableStreamController,me),Me($._readableStreamController,me),(!w||!S)&&z(void 0),null)),[N,$]}function wu(e){let t=Ee(e),s=!1,d=!1,p=!1,w=!1,S=!1,C,V,N,$,z,K=h(W=>{z=W});function We(W){R(W._closedPromise,H=>(W!==t||(Le(N._readableStreamController,H),Le($._readableStreamController,H),(!w||!S)&&z(void 0)),null))}function Kt(){Dt(t)&&(X(t),t=Ee(e),We(t)),fr(t,{_chunkSteps:H=>{M(()=>{d=!1,p=!1;let J=H,Ae=H;if(!w&&!S)try{Ae=Si(H)}catch(Jt){Le(N._readableStreamController,Jt),Le($._readableStreamController,Jt),z(xe(e,Jt));return}w||jr(N._readableStreamController,J),S||jr($._readableStreamController,Ae),s=!1,d?rt():p&&me()})},_closeSteps:()=>{s=!1,w||hr(N._readableStreamController),S||hr($._readableStreamController),N._readableStreamController._pendingPullIntos.length>0&&Hr(N._readableStreamController,0),$._readableStreamController._pendingPullIntos.length>0&&Hr($._readableStreamController,0),(!w||!S)&&z(void 0)},_errorSteps:()=>{s=!1}})}function _t(W,H){Ne(t)&&(X(t),t=ki(e),We(t));let J=H?$:N,Ae=H?N:$;Ni(t,W,1,{_chunkSteps:Zt=>{M(()=>{d=!1,p=!1;let er=H?S:w;if(H?w:S)er||Qr(J._readableStreamController,Zt);else{let wo;try{wo=Si(Zt)}catch(ha){Le(J._readableStreamController,ha),Le(Ae._readableStreamController,ha),z(xe(e,ha));return}er||Qr(J._readableStreamController,Zt),jr(Ae._readableStreamController,wo)}s=!1,d?rt():p&&me()})},_closeSteps:Zt=>{s=!1;let er=H?S:w,pn=H?w:S;er||hr(J._readableStreamController),pn||hr(Ae._readableStreamController),Zt!==void 0&&(er||Qr(J._readableStreamController,Zt),!pn&&Ae._readableStreamController._pendingPullIntos.length>0&&Hr(Ae._readableStreamController,0)),(!er||!pn)&&z(void 0)},_errorSteps:()=>{s=!1}})}function rt(){if(s)return d=!0,m(void 0);s=!0;let W=Yn(N._readableStreamController);return W===null?Kt():_t(W._view,!1),m(void 0)}function me(){if(s)return p=!0,m(void 0);s=!0;let W=Yn($._readableStreamController);return W===null?Kt():_t(W._view,!0),m(void 0)}function _e(W){if(w=!0,C=W,S){let H=mr([C,V]),J=xe(e,H);z(J)}return K}function Oe(W){if(S=!0,V=W,w){let H=mr([C,V]),J=xe(e,H);z(J)}return K}function nt(){}return N=io(nt,rt,_e),$=io(nt,me,Oe),We(t),[N,$]}function Su(e){return a(e)&&typeof e.getReader<"u"}function Tu(e){return Su(e)?Eu(e.getReader()):Ru(e)}function Ru(e){let t,s=wi(e,"async"),d=n;function p(){let S;try{S=hl(s)}catch(V){return _(V)}let C=m(S);return q(C,V=>{if(!a(V))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(pl(V))Ot(t._readableStreamController);else{let $=bl(V);Gt(t._readableStreamController,$)}})}function w(S){let C=s.iterator,V;try{V=Vr(C,"return")}catch(z){return _(z)}if(V===void 0)return m(void 0);let N;try{N=v(V,C,[S])}catch(z){return _(z)}let $=m(N);return q($,z=>{if(!a(z))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return t=wr(d,p,w,0),t}function Eu(e){let t,s=n;function d(){let w;try{w=e.read()}catch(S){return _(S)}return q(w,S=>{if(!a(S))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(S.done)Ot(t._readableStreamController);else{let C=S.value;Gt(t._readableStreamController,C)}})}function p(w){try{return m(e.cancel(w))}catch(S){return _(S)}}return t=wr(s,d,p,0),t}function vu(e,t){Re(e,t);let s=e,d=s?.autoAllocateChunkSize,p=s?.cancel,w=s?.pull,S=s?.start,C=s?.type;return{autoAllocateChunkSize:d===void 0?void 0:le(d,`${t} has member 'autoAllocateChunkSize' that`),cancel:p===void 0?void 0:Au(p,s,`${t} has member 'cancel' that`),pull:w===void 0?void 0:Cu(w,s,`${t} has member 'pull' that`),start:S===void 0?void 0:Pu(S,s,`${t} has member 'start' that`),type:C===void 0?void 0:Iu(C,`${t} has member 'type' that`)}}function Au(e,t,s){return ye(e,s),d=>B(e,t,[d])}function Cu(e,t,s){return ye(e,s),d=>B(e,t,[d])}function Pu(e,t,s){return ye(e,s),d=>v(e,t,[d])}function Iu(e,t){if(e=`${e}`,e!=="bytes")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function Du(e,t){return Re(e,t),{preventCancel:!!e?.preventCancel}}function ao(e,t){Re(e,t);let s=e?.preventAbort,d=e?.preventCancel,p=e?.preventClose,w=e?.signal;return w!==void 0&&Bu(w,`${t} has member 'signal' that`),{preventAbort:!!s,preventCancel:!!d,preventClose:!!p,signal:w}}function Bu(e,t){if(!xl(e))throw new TypeError(`${t} is not an AbortSignal.`)}function Lu(e,t){Re(e,t);let s=e?.readable;g(s,"readable","ReadableWritablePair"),ge(s,`${t} has member 'readable' that`);let d=e?.writable;return g(d,"writable","ReadableWritablePair"),xi(d,`${t} has member 'writable' that`),{readable:s,writable:d}}class de{constructor(t={},s={}){t===void 0?t=null:l(t,"First parameter");let d=Xr(s,"Second parameter"),p=vu(t,"First parameter");if(ca(this),p.type==="bytes"){if(d.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let w=br(d,0);Al(this,p,w)}else{let w=Yr(d),S=br(d,1);yu(this,p,S,w)}}get locked(){if(!bt(this))throw kt("locked");return yt(this)}cancel(t=void 0){return bt(this)?yt(this)?_(new TypeError("Cannot cancel a stream that already has a reader")):xe(this,t):_(kt("cancel"))}getReader(t=void 0){if(!bt(this))throw kt("getReader");return Pl(t,"First parameter").mode===void 0?Ee(this):ki(this)}pipeThrough(t,s={}){if(!bt(this))throw kt("pipeThrough");T(t,1,"pipeThrough");let d=Lu(t,"First parameter"),p=ao(s,"Second parameter");if(yt(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Ht(d.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let w=to(this,d.writable,p.preventClose,p.preventAbort,p.preventCancel,p.signal);return O(w),d.readable}pipeTo(t,s={}){if(!bt(this))return _(kt("pipeTo"));if(t===void 0)return _("Parameter 1 is required in 'pipeTo'.");if(!jt(t))return _(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let d;try{d=ao(s,"Second parameter")}catch(p){return _(p)}return yt(this)?_(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Ht(t)?_(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):to(this,t,d.preventClose,d.preventAbort,d.preventCancel,d.signal)}tee(){if(!bt(this))throw kt("tee");let t=gu(this);return mr(t)}values(t=void 0){if(!bt(this))throw kt("values");let s=Du(t,"First parameter");return fl(this,s.preventCancel)}[Vn](t){return this.values(t)}static from(t){return Tu(t)}}Object.defineProperties(de,{from:{enumerable:!0}}),Object.defineProperties(de.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),i(de.from,"from"),i(de.prototype.cancel,"cancel"),i(de.prototype.getReader,"getReader"),i(de.prototype.pipeThrough,"pipeThrough"),i(de.prototype.pipeTo,"pipeTo"),i(de.prototype.tee,"tee"),i(de.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(de.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(de.prototype,Vn,{value:de.prototype.values,writable:!0,configurable:!0});function wr(e,t,s,d=1,p=()=>1){let w=Object.create(de.prototype);ca(w);let S=Object.create(tt.prototype);return no(w,S,e,t,s,d,p),w}function io(e,t,s){let d=Object.create(de.prototype);ca(d);let p=Object.create(Ze.prototype);return Oi(d,p,e,t,s,0,void 0),d}function ca(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function bt(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")?!1:e instanceof de}function yt(e){return e._reader!==void 0}function xe(e,t){if(e._disturbed=!0,e._state==="closed")return m(void 0);if(e._state==="errored")return _(e._storedError);Sr(e);let s=e._reader;if(s!==void 0&&Dt(s)){let p=s._readIntoRequests;s._readIntoRequests=new L,p.forEach(w=>{w._closeSteps(void 0)})}let d=e._readableStreamController[y](t);return q(d,n)}function Sr(e){e._state="closed";let t=e._reader;if(t!==void 0&&(ze(t),Ne(t))){let s=t._readRequests;t._readRequests=new L,s.forEach(d=>{d._closeSteps()})}}function oo(e,t){e._state="errored",e._storedError=t;let s=e._reader;s!==void 0&&(re(s,t),Ne(s)?fi(s,t):Mi(s,t))}function kt(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function so(e,t){Re(e,t);let s=e?.highWaterMark;return g(s,"highWaterMark","QueuingStrategyInit"),{highWaterMark:Q(s)}}let lo=e=>e.byteLength;i(lo,"size");class ln{constructor(t){T(t,1,"ByteLengthQueuingStrategy"),t=so(t,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!co(this))throw uo("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!co(this))throw uo("size");return lo}}Object.defineProperties(ln.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ln.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function uo(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function co(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")?!1:e instanceof ln}let fo=()=>1;i(fo,"size");class un{constructor(t){T(t,1,"CountQueuingStrategy"),t=so(t,"First parameter"),this._countQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!ho(this))throw mo("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!ho(this))throw mo("size");return fo}}Object.defineProperties(un.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(un.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function mo(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function ho(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")?!1:e instanceof un}function Ou(e,t){Re(e,t);let s=e?.cancel,d=e?.flush,p=e?.readableType,w=e?.start,S=e?.transform,C=e?.writableType;return{cancel:s===void 0?void 0:Nu(s,e,`${t} has member 'cancel' that`),flush:d===void 0?void 0:ku(d,e,`${t} has member 'flush' that`),readableType:p,start:w===void 0?void 0:qu(w,e,`${t} has member 'start' that`),transform:S===void 0?void 0:Fu(S,e,`${t} has member 'transform' that`),writableType:C}}function ku(e,t,s){return ye(e,s),d=>B(e,t,[d])}function qu(e,t,s){return ye(e,s),d=>v(e,t,[d])}function Fu(e,t,s){return ye(e,s),(d,p)=>B(e,t,[d,p])}function Nu(e,t,s){return ye(e,s),d=>B(e,t,[d])}class cn{constructor(t={},s={},d={}){t===void 0&&(t=null);let p=Xr(s,"Second parameter"),w=Xr(d,"Third parameter"),S=Ou(t,"First parameter");if(S.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(S.writableType!==void 0)throw new RangeError("Invalid writableType specified");let C=br(w,0),V=Yr(w),N=br(p,1),$=Yr(p),z,K=h(We=>{z=We});Mu(this,K,N,$,C,V),Wu(this,S),S.start!==void 0?z(S.start(this._transformStreamController)):z(void 0)}get readable(){if(!po(this))throw _o("readable");return this._readable}get writable(){if(!po(this))throw _o("writable");return this._writable}}Object.defineProperties(cn.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(cn.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function Mu(e,t,s,d,p,w){function S(){return t}function C(K){return $u(e,K)}function V(K){return zu(e,K)}function N(){return ju(e)}e._writable=Vl(S,C,N,V,s,d);function $(){return Hu(e)}function z(K){return Qu(e,K)}e._readable=wr(S,$,z,p,w),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,dn(e,!0),e._transformStreamController=void 0}function po(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")?!1:e instanceof cn}function bo(e,t){Me(e._readable._readableStreamController,t),da(e,t)}function da(e,t){mn(e._transformStreamController),yr(e._writable._writableStreamController,t),fa(e)}function fa(e){e._backpressure&&dn(e,!1)}function dn(e,t){e._backpressureChangePromise!==void 0&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=h(s=>{e._backpressureChangePromise_resolve=s}),e._backpressure=t}class gt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!fn(this))throw hn("desiredSize");let t=this._controlledTransformStream._readable._readableStreamController;return ua(t)}enqueue(t=void 0){if(!fn(this))throw hn("enqueue");yo(this,t)}error(t=void 0){if(!fn(this))throw hn("error");Uu(this,t)}terminate(){if(!fn(this))throw hn("terminate");Vu(this)}}Object.defineProperties(gt.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),i(gt.prototype.enqueue,"enqueue"),i(gt.prototype.error,"error"),i(gt.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(gt.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function fn(e){return!a(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")?!1:e instanceof gt}function xu(e,t,s,d,p){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=s,t._flushAlgorithm=d,t._cancelAlgorithm=p,t._finishPromise=void 0,t._finishPromise_resolve=void 0,t._finishPromise_reject=void 0}function Wu(e,t){let s=Object.create(gt.prototype),d,p,w;t.transform!==void 0?d=S=>t.transform(S,s):d=S=>{try{return yo(s,S),m(void 0)}catch(C){return _(C)}},t.flush!==void 0?p=()=>t.flush(s):p=()=>m(void 0),t.cancel!==void 0?w=S=>t.cancel(S):w=()=>m(void 0),xu(e,s,d,p,w)}function mn(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0,e._cancelAlgorithm=void 0}function yo(e,t){let s=e._controlledTransformStream,d=s._readable._readableStreamController;if(!Yt(d))throw new TypeError("Readable side is not in a state that permits enqueue");try{Gt(d,t)}catch(w){throw da(s,w),s._readable._storedError}bu(d)!==s._backpressure&&dn(s,!0)}function Uu(e,t){bo(e._controlledTransformStream,t)}function go(e,t){let s=e._transformAlgorithm(t);return q(s,void 0,d=>{throw bo(e._controlledTransformStream,d),d})}function Vu(e){let t=e._controlledTransformStream,s=t._readable._readableStreamController;Ot(s);let d=new TypeError("TransformStream terminated");da(t,d)}function $u(e,t){let s=e._transformStreamController;if(e._backpressure){let d=e._backpressureChangePromise;return q(d,()=>{let p=e._writable;if(p._state==="erroring")throw p._storedError;return go(s,t)})}return go(s,t)}function zu(e,t){let s=e._transformStreamController;if(s._finishPromise!==void 0)return s._finishPromise;let d=e._readable;s._finishPromise=h((w,S)=>{s._finishPromise_resolve=w,s._finishPromise_reject=S});let p=s._cancelAlgorithm(t);return mn(s),I(p,()=>(d._state==="errored"?Xt(s,d._storedError):(Me(d._readableStreamController,t),ma(s)),null),w=>(Me(d._readableStreamController,w),Xt(s,w),null)),s._finishPromise}function ju(e){let t=e._transformStreamController;if(t._finishPromise!==void 0)return t._finishPromise;let s=e._readable;t._finishPromise=h((p,w)=>{t._finishPromise_resolve=p,t._finishPromise_reject=w});let d=t._flushAlgorithm();return mn(t),I(d,()=>(s._state==="errored"?Xt(t,s._storedError):(Ot(s._readableStreamController),ma(t)),null),p=>(Me(s._readableStreamController,p),Xt(t,p),null)),t._finishPromise}function Hu(e){return dn(e,!1),e._backpressureChangePromise}function Qu(e,t){let s=e._transformStreamController;if(s._finishPromise!==void 0)return s._finishPromise;let d=e._writable;s._finishPromise=h((w,S)=>{s._finishPromise_resolve=w,s._finishPromise_reject=S});let p=s._cancelAlgorithm(t);return mn(s),I(p,()=>(d._state==="errored"?Xt(s,d._storedError):(yr(d._writableStreamController,t),fa(e),ma(s)),null),w=>(yr(d._writableStreamController,w),fa(e),Xt(s,w),null)),s._finishPromise}function hn(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function ma(e){e._finishPromise_resolve!==void 0&&(e._finishPromise_resolve(),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function Xt(e,t){e._finishPromise_reject!==void 0&&(O(e._finishPromise),e._finishPromise_reject(t),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function _o(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}r.ByteLengthQueuingStrategy=ln,r.CountQueuingStrategy=un,r.ReadableByteStreamController=Ze,r.ReadableStream=de,r.ReadableStreamBYOBReader=ht,r.ReadableStreamBYOBRequest=Ct,r.ReadableStreamDefaultController=tt,r.ReadableStreamDefaultReader=Be,r.TransformStream=cn,r.TransformStreamDefaultController=gt,r.WritableStream=pt,r.WritableStreamDefaultController=Qt,r.WritableStreamDefaultWriter=et}))});var Ao=ie(()=>{if(!globalThis.ReadableStream)try{let r=require("node:process"),{emitWarning:n}=r;try{r.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),r.emitWarning=n}catch(a){throw r.emitWarning=n,a}}catch{Object.assign(globalThis,vo())}try{let{Blob:r}=require("buffer");r&&!r.prototype.stream&&(r.prototype.stream=function(a){let o=0,i=this;return new ReadableStream({type:"bytes",async pull(u){let b=await i.slice(o,Math.min(i.size,o+65536)).arrayBuffer();o+=b.byteLength,u.enqueue(new Uint8Array(b)),o===i.size&&u.close()}})})}catch{}});async function*pa(r,n=!0){for(let a of r)if("stream"in a)yield*a.stream();else if(ArrayBuffer.isView(a))if(n){let o=a.byteOffset,i=a.byteOffset+a.byteLength;for(;o!==i;){let u=Math.min(i-o,Co),f=a.buffer.slice(o,o+u);o+=f.byteLength,yield new Uint8Array(f)}}else yield a;else{let o=0,i=a;for(;o!==i.size;){let f=await i.slice(o,Math.min(i.size,o+Co)).arrayBuffer();o+=f.byteLength,yield new Uint8Array(f)}}}var mf,Co,Po,tc,at,Rr=Tr(()=>{mf=He(Ao(),1);Co=65536;Po=class ba{#e=[];#t="";#r=0;#n="transparent";constructor(n=[],a={}){if(typeof n!="object"||n===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof n[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof a!="object"&&typeof a!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");a===null&&(a={});let o=new TextEncoder;for(let u of n){let f;ArrayBuffer.isView(u)?f=new Uint8Array(u.buffer.slice(u.byteOffset,u.byteOffset+u.byteLength)):u instanceof ArrayBuffer?f=new Uint8Array(u.slice(0)):u instanceof ba?f=u:f=o.encode(`${u}`),this.#r+=ArrayBuffer.isView(f)?f.byteLength:f.size,this.#e.push(f)}this.#n=`${a.endings===void 0?"transparent":a.endings}`;let i=a.type===void 0?"":String(a.type);this.#t=/^[\x20-\x7E]*$/.test(i)?i:""}get size(){return this.#r}get type(){return this.#t}async text(){let n=new TextDecoder,a="";for await(let o of pa(this.#e,!1))a+=n.decode(o,{stream:!0});return a+=n.decode(),a}async arrayBuffer(){let n=new Uint8Array(this.size),a=0;for await(let o of pa(this.#e,!1))n.set(o,a),a+=o.length;return n.buffer}stream(){let n=pa(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(a){let o=await n.next();o.done?a.close():a.enqueue(o.value)},async cancel(){await n.return()}})}slice(n=0,a=this.size,o=""){let{size:i}=this,u=n<0?Math.max(i+n,0):Math.min(n,i),f=a<0?Math.max(i+a,0):Math.min(a,i),b=Math.max(f-u,0),h=this.#e,m=[],_=0;for(let I of h){if(_>=b)break;let A=ArrayBuffer.isView(I)?I.byteLength:I.size;if(u&&A<=u)u-=A,f-=A;else{let R;ArrayBuffer.isView(I)?(R=I.subarray(u,Math.min(A,f)),_+=R.byteLength):(R=I.slice(u,Math.min(A,f)),_+=R.size),f-=A,m.push(R),u=0}}let E=new ba([],{type:String(o).toLowerCase()});return E.#r=b,E.#e=m,E}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](n){return n&&typeof n=="object"&&typeof n.constructor=="function"&&(typeof n.stream=="function"||typeof n.arrayBuffer=="function")&&/^(Blob|File)$/.test(n[Symbol.toStringTag])}};Object.defineProperties(Po.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});tc=Po,at=tc});var rc,nc,tr,ya=Tr(()=>{Rr();rc=class extends at{#e=0;#t="";constructor(n,a,o={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(n,o),o===null&&(o={});let i=o.lastModified===void 0?Date.now():Number(o.lastModified);Number.isNaN(i)||(this.#e=i),this.#t=String(a)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](n){return!!n&&n instanceof at&&/^(File)$/.test(n[Symbol.toStringTag])}},nc=rc,tr=nc});function Bo(r,n=at){var a=`${Io()}${Io()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),o=[],i=`--${a}\r
Content-Disposition: form-data; name="`;return r.forEach((u,f)=>typeof u=="string"?o.push(i+ga(f)+`"\r
\r
${u.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):o.push(i+ga(f)+`"; filename="${ga(u.name,1)}"\r
Content-Type: ${u.type||"application/octet-stream"}\r
\r
`,u,`\r
`)),o.push(`--${a}--`),new n(o,{type:"multipart/form-data; boundary="+a})}var Er,ac,ic,Io,oc,Do,ga,qt,Ft,gn=Tr(()=>{Rr();ya();({toStringTag:Er,iterator:ac,hasInstance:ic}=Symbol),Io=Math.random,oc="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),Do=(r,n,a)=>(r+="",/^(Blob|File)$/.test(n&&n[Er])?[(a=a!==void 0?a+"":n[Er]=="File"?n.name:"blob",r),n.name!==a||n[Er]=="blob"?new tr([n],a,n):n]:[r,n+""]),ga=(r,n)=>(n?r:r.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),qt=(r,n,a)=>{if(n.length<a)throw new TypeError(`Failed to execute '${r}' on 'FormData': ${a} arguments required, but only ${n.length} present.`)},Ft=class{#e=[];constructor(...n){if(n.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[Er](){return"FormData"}[ac](){return this.entries()}static[ic](n){return n&&typeof n=="object"&&n[Er]==="FormData"&&!oc.some(a=>typeof n[a]!="function")}append(...n){qt("append",arguments,2),this.#e.push(Do(...n))}delete(n){qt("delete",arguments,1),n+="",this.#e=this.#e.filter(([a])=>a!==n)}get(n){qt("get",arguments,1),n+="";for(var a=this.#e,o=a.length,i=0;i<o;i++)if(a[i][0]===n)return a[i][1];return null}getAll(n,a){return qt("getAll",arguments,1),a=[],n+="",this.#e.forEach(o=>o[0]===n&&a.push(o[1])),a}has(n){return qt("has",arguments,1),n+="",this.#e.some(a=>a[0]===n)}forEach(n,a){qt("forEach",arguments,1);for(var[o,i]of this)n.call(a,i,o,this)}set(...n){qt("set",arguments,2);var a=[],o=!0;n=Do(...n),this.#e.forEach(i=>{i[0]===n[0]?o&&(o=!a.push(n)):a.push(i)}),o&&a.push(n),this.#e=a}*entries(){yield*this.#e}*keys(){for(var[n]of this)yield n}*values(){for(var[,n]of this)yield n}}});var Fo=ie((Af,qo)=>{if(!globalThis.DOMException)try{let{MessageChannel:r}=require("worker_threads"),n=new r().port1,a=new ArrayBuffer;n.postMessage(a,[a,a])}catch(r){r.constructor.name==="DOMException"&&(globalThis.DOMException=r.constructor)}qo.exports=globalThis.DOMException});var wn,sc,If,wa=Tr(()=>{wn=require("node:fs"),sc=He(Fo(),1);ya();Rr();({stat:If}=wn.promises)});var Mo={};So(Mo,{toFormData:()=>hc});function mc(r){let n=r.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!n)return;let a=n[2]||n[3]||"",o=a.slice(a.lastIndexOf("\\")+1);return o=o.replace(/%22/g,'"'),o=o.replace(/&#(\d{4});/g,(i,u)=>String.fromCharCode(u)),o}async function hc(r,n){if(!/multipart/i.test(n))throw new TypeError("Failed to fetch");let a=n.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!a)throw new TypeError("no or bad content-type header, no multipart boundary");let o=new Sa(a[1]||a[2]),i,u,f,b,h,m,_=[],E=new Ft,I=M=>{f+=O.decode(M,{stream:!0})},A=M=>{_.push(M)},R=()=>{let M=new tr(_,m,{type:h});E.append(b,M)},q=()=>{E.append(b,f)},O=new TextDecoder("utf-8");O.decode(),o.onPartBegin=function(){o.onPartData=I,o.onPartEnd=q,i="",u="",f="",b="",h="",m=null,_.length=0},o.onHeaderField=function(M){i+=O.decode(M,{stream:!0})},o.onHeaderValue=function(M){u+=O.decode(M,{stream:!0})},o.onHeaderEnd=function(){if(u+=O.decode(),i=i.toLowerCase(),i==="content-disposition"){let M=u.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);M&&(b=M[2]||M[3]||""),m=mc(u),m&&(o.onPartData=A,o.onPartEnd=R)}else i==="content-type"&&(h=u);u="",i=""};for await(let M of r)o.write(M);return o.end(),E}var Qe,Z,No,wt,Sn,Tn,lc,Ar,uc,cc,dc,fc,Nt,Sa,xo=Tr(()=>{wa();gn();Qe=0,Z={START_BOUNDARY:Qe++,HEADER_FIELD_START:Qe++,HEADER_FIELD:Qe++,HEADER_VALUE_START:Qe++,HEADER_VALUE:Qe++,HEADER_VALUE_ALMOST_DONE:Qe++,HEADERS_ALMOST_DONE:Qe++,PART_DATA_START:Qe++,PART_DATA:Qe++,END:Qe++},No=1,wt={PART_BOUNDARY:No,LAST_BOUNDARY:No*=2},Sn=10,Tn=13,lc=32,Ar=45,uc=58,cc=97,dc=122,fc=r=>r|32,Nt=()=>{},Sa=class{constructor(n){this.index=0,this.flags=0,this.onHeaderEnd=Nt,this.onHeaderField=Nt,this.onHeadersEnd=Nt,this.onHeaderValue=Nt,this.onPartBegin=Nt,this.onPartData=Nt,this.onPartEnd=Nt,this.boundaryChars={},n=`\r
--`+n;let a=new Uint8Array(n.length);for(let o=0;o<n.length;o++)a[o]=n.charCodeAt(o),this.boundaryChars[a[o]]=!0;this.boundary=a,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=Z.START_BOUNDARY}write(n){let a=0,o=n.length,i=this.index,{lookbehind:u,boundary:f,boundaryChars:b,index:h,state:m,flags:_}=this,E=this.boundary.length,I=E-1,A=n.length,R,q,O=P=>{this[P+"Mark"]=a},M=P=>{delete this[P+"Mark"]},v=(P,L,U,G)=>{(L===void 0||L!==U)&&this[P](G&&G.subarray(L,U))},B=(P,L)=>{let U=P+"Mark";U in this&&(L?(v(P,this[U],a,n),delete this[U]):(v(P,this[U],n.length,n),this[U]=0))};for(a=0;a<o;a++)switch(R=n[a],m){case Z.START_BOUNDARY:if(h===f.length-2){if(R===Ar)_|=wt.LAST_BOUNDARY;else if(R!==Tn)return;h++;break}else if(h-1===f.length-2){if(_&wt.LAST_BOUNDARY&&R===Ar)m=Z.END,_=0;else if(!(_&wt.LAST_BOUNDARY)&&R===Sn)h=0,v("onPartBegin"),m=Z.HEADER_FIELD_START;else return;break}R!==f[h+2]&&(h=-2),R===f[h+2]&&h++;break;case Z.HEADER_FIELD_START:m=Z.HEADER_FIELD,O("onHeaderField"),h=0;case Z.HEADER_FIELD:if(R===Tn){M("onHeaderField"),m=Z.HEADERS_ALMOST_DONE;break}if(h++,R===Ar)break;if(R===uc){if(h===1)return;B("onHeaderField",!0),m=Z.HEADER_VALUE_START;break}if(q=fc(R),q<cc||q>dc)return;break;case Z.HEADER_VALUE_START:if(R===lc)break;O("onHeaderValue"),m=Z.HEADER_VALUE;case Z.HEADER_VALUE:R===Tn&&(B("onHeaderValue",!0),v("onHeaderEnd"),m=Z.HEADER_VALUE_ALMOST_DONE);break;case Z.HEADER_VALUE_ALMOST_DONE:if(R!==Sn)return;m=Z.HEADER_FIELD_START;break;case Z.HEADERS_ALMOST_DONE:if(R!==Sn)return;v("onHeadersEnd"),m=Z.PART_DATA_START;break;case Z.PART_DATA_START:m=Z.PART_DATA,O("onPartData");case Z.PART_DATA:if(i=h,h===0){for(a+=I;a<A&&!(n[a]in b);)a+=E;a-=I,R=n[a]}if(h<f.length)f[h]===R?(h===0&&B("onPartData",!0),h++):h=0;else if(h===f.length)h++,R===Tn?_|=wt.PART_BOUNDARY:R===Ar?_|=wt.LAST_BOUNDARY:h=0;else if(h-1===f.length)if(_&wt.PART_BOUNDARY){if(h=0,R===Sn){_&=~wt.PART_BOUNDARY,v("onPartEnd"),v("onPartBegin"),m=Z.HEADER_FIELD_START;break}}else _&wt.LAST_BOUNDARY&&R===Ar?(v("onPartEnd"),m=Z.END,_=0):h=0;if(h>0)u[h-1]=R;else if(i>0){let P=new Uint8Array(u.buffer,u.byteOffset,u.byteLength);v("onPartData",0,i,P),i=0,O("onPartData"),a--}break;case Z.END:break;default:throw new Error(`Unexpected state entered: ${m}`)}B("onHeaderField"),B("onHeaderValue"),B("onPartData"),this.index=h,this.state=m,this.flags=_}end(){if(this.state===Z.HEADER_FIELD_START&&this.index===0||this.state===Z.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==Z.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});var qa=ie(Bn=>{(function(r){r.parser=function(c,l){return new a(c,l)},r.SAXParser=a,r.SAXStream=m,r.createStream=h,r.MAX_BUFFER_LENGTH=64*1024;var n=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];r.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function a(c,l){if(!(this instanceof a))return new a(c,l);var T=this;i(T),T.q=T.c="",T.bufferCheckPosition=r.MAX_BUFFER_LENGTH,T.opt=l||{},T.opt.lowercase=T.opt.lowercase||T.opt.lowercasetags,T.looseCase=T.opt.lowercase?"toLowerCase":"toUpperCase",T.tags=[],T.closed=T.closedRoot=T.sawRoot=!1,T.tag=T.error=null,T.strict=!!c,T.noscript=!!(c||T.opt.noscript),T.state=y.BEGIN,T.strictEntities=T.opt.strictEntities,T.ENTITIES=T.strictEntities?Object.create(r.XML_ENTITIES):Object.create(r.ENTITIES),T.attribList=[],T.opt.xmlns&&(T.ns=Object.create(R)),T.trackPosition=T.opt.position!==!1,T.trackPosition&&(T.position=T.line=T.column=0),F(T,"onready")}Object.create||(Object.create=function(c){function l(){}l.prototype=c;var T=new l;return T}),Object.keys||(Object.keys=function(c){var l=[];for(var T in c)c.hasOwnProperty(T)&&l.push(T);return l});function o(c){for(var l=Math.max(r.MAX_BUFFER_LENGTH,10),T=0,g=0,Q=n.length;g<Q;g++){var ee=c[n[g]].length;if(ee>l)switch(n[g]){case"textNode":j(c);break;case"cdata":D(c,"oncdata",c.cdata),c.cdata="";break;case"script":D(c,"onscript",c.script),c.script="";break;default:Y(c,"Max buffer length exceeded: "+n[g])}T=Math.max(T,ee)}var ne=r.MAX_BUFFER_LENGTH-T;c.bufferCheckPosition=ne+c.position}function i(c){for(var l=0,T=n.length;l<T;l++)c[n[l]]=""}function u(c){j(c),c.cdata!==""&&(D(c,"oncdata",c.cdata),c.cdata=""),c.script!==""&&(D(c,"onscript",c.script),c.script="")}a.prototype={end:function(){be(this)},write:ye,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){u(this)}};var f;try{f=require("stream").Stream}catch{f=function(){}}var b=r.EVENTS.filter(function(c){return c!=="error"&&c!=="end"});function h(c,l){return new m(c,l)}function m(c,l){if(!(this instanceof m))return new m(c,l);f.apply(this),this._parser=new a(c,l),this.writable=!0,this.readable=!0;var T=this;this._parser.onend=function(){T.emit("end")},this._parser.onerror=function(g){T.emit("error",g),T._parser.error=null},this._decoder=null,b.forEach(function(g){Object.defineProperty(T,"on"+g,{get:function(){return T._parser["on"+g]},set:function(Q){if(!Q)return T.removeAllListeners(g),T._parser["on"+g]=Q,Q;T.on(g,Q)},enumerable:!0,configurable:!1})})}m.prototype=Object.create(f.prototype,{constructor:{value:m}}),m.prototype.write=function(c){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(c)){if(!this._decoder){var l=require("string_decoder").StringDecoder;this._decoder=new l("utf8")}c=this._decoder.write(c)}return this._parser.write(c.toString()),this.emit("data",c),!0},m.prototype.end=function(c){return c&&c.length&&this.write(c),this._parser.end(),!0},m.prototype.on=function(c,l){var T=this;return!T._parser["on"+c]&&b.indexOf(c)!==-1&&(T._parser["on"+c]=function(){var g=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);g.splice(0,0,c),T.emit.apply(T,g)}),f.prototype.on.call(T,c,l)};var _="[CDATA[",E="DOCTYPE",I="http://www.w3.org/XML/1998/namespace",A="http://www.w3.org/2000/xmlns/",R={xml:I,xmlns:A},q=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,O=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,M=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,v=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function B(c){return c===" "||c===`
`||c==="\r"||c==="	"}function P(c){return c==='"'||c==="'"}function L(c){return c===">"||B(c)}function U(c,l){return c.test(l)}function G(c,l){return!U(c,l)}var y=0;r.STATE={BEGIN:y++,BEGIN_WHITESPACE:y++,TEXT:y++,TEXT_ENTITY:y++,OPEN_WAKA:y++,SGML_DECL:y++,SGML_DECL_QUOTED:y++,DOCTYPE:y++,DOCTYPE_QUOTED:y++,DOCTYPE_DTD:y++,DOCTYPE_DTD_QUOTED:y++,COMMENT_STARTING:y++,COMMENT:y++,COMMENT_ENDING:y++,COMMENT_ENDED:y++,CDATA:y++,CDATA_ENDING:y++,CDATA_ENDING_2:y++,PROC_INST:y++,PROC_INST_BODY:y++,PROC_INST_ENDING:y++,OPEN_TAG:y++,OPEN_TAG_SLASH:y++,ATTRIB:y++,ATTRIB_NAME:y++,ATTRIB_NAME_SAW_WHITE:y++,ATTRIB_VALUE:y++,ATTRIB_VALUE_QUOTED:y++,ATTRIB_VALUE_CLOSED:y++,ATTRIB_VALUE_UNQUOTED:y++,ATTRIB_VALUE_ENTITY_Q:y++,ATTRIB_VALUE_ENTITY_U:y++,CLOSE_TAG:y++,CLOSE_TAG_SAW_WHITE:y++,SCRIPT:y++,SCRIPT_ENDING:y++},r.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},r.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(r.ENTITIES).forEach(function(c){var l=r.ENTITIES[c],T=typeof l=="number"?String.fromCharCode(l):l;r.ENTITIES[c]=T});for(var te in r.STATE)r.STATE[r.STATE[te]]=te;y=r.STATE;function F(c,l,T){c[l]&&c[l](T)}function D(c,l,T){c.textNode&&j(c),F(c,l,T)}function j(c){c.textNode=X(c.opt,c.textNode),c.textNode&&F(c,"ontext",c.textNode),c.textNode=""}function X(c,l){return c.trim&&(l=l.trim()),c.normalize&&(l=l.replace(/\s+/g," ")),l}function Y(c,l){return j(c),c.trackPosition&&(l+=`
Line: `+c.line+`
Column: `+c.column+`
Char: `+c.c),l=new Error(l),c.error=l,F(c,"onerror",l),c}function be(c){return c.sawRoot&&!c.closedRoot&&x(c,"Unclosed root tag"),c.state!==y.BEGIN&&c.state!==y.BEGIN_WHITESPACE&&c.state!==y.TEXT&&Y(c,"Unexpected end"),j(c),c.c="",c.closed=!0,F(c,"onend"),a.call(c,c.strict,c.opt),c}function x(c,l){if(typeof c!="object"||!(c instanceof a))throw new Error("bad call to strictFail");c.strict&&Y(c,l)}function k(c){c.strict||(c.tagName=c.tagName[c.looseCase]());var l=c.tags[c.tags.length-1]||c,T=c.tag={name:c.tagName,attributes:{}};c.opt.xmlns&&(T.ns=l.ns),c.attribList.length=0,D(c,"onopentagstart",T)}function re(c,l){var T=c.indexOf(":"),g=T<0?["",c]:c.split(":"),Q=g[0],ee=g[1];return l&&c==="xmlns"&&(Q="xmlns",ee=""),{prefix:Q,local:ee}}function dt(c){if(c.strict||(c.attribName=c.attribName[c.looseCase]()),c.attribList.indexOf(c.attribName)!==-1||c.tag.attributes.hasOwnProperty(c.attribName)){c.attribName=c.attribValue="";return}if(c.opt.xmlns){var l=re(c.attribName,!0),T=l.prefix,g=l.local;if(T==="xmlns")if(g==="xml"&&c.attribValue!==I)x(c,"xml: prefix must be bound to "+I+`
Actual: `+c.attribValue);else if(g==="xmlns"&&c.attribValue!==A)x(c,"xmlns: prefix must be bound to "+A+`
Actual: `+c.attribValue);else{var Q=c.tag,ee=c.tags[c.tags.length-1]||c;Q.ns===ee.ns&&(Q.ns=Object.create(ee.ns)),Q.ns[g]=c.attribValue}c.attribList.push([c.attribName,c.attribValue])}else c.tag.attributes[c.attribName]=c.attribValue,D(c,"onattribute",{name:c.attribName,value:c.attribValue});c.attribName=c.attribValue=""}function ze(c,l){if(c.opt.xmlns){var T=c.tag,g=re(c.tagName);T.prefix=g.prefix,T.local=g.local,T.uri=T.ns[g.prefix]||"",T.prefix&&!T.uri&&(x(c,"Unbound namespace prefix: "+JSON.stringify(c.tagName)),T.uri=g.prefix);var Q=c.tags[c.tags.length-1]||c;T.ns&&Q.ns!==T.ns&&Object.keys(T.ns).forEach(function(Ne){D(c,"onopennamespace",{prefix:Ne,uri:T.ns[Ne]})});for(var ee=0,ne=c.attribList.length;ee<ne;ee++){var le=c.attribList[ee],ge=le[0],Ee=le[1],ae=re(ge,!0),ve=ae.prefix,$t=ae.local,dr=ve===""?"":T.ns[ve]||"",Be={name:ge,value:Ee,prefix:ve,local:$t,uri:dr};ve&&ve!=="xmlns"&&!dr&&(x(c,"Unbound namespace prefix: "+JSON.stringify(ve)),Be.uri=ve),c.tag.attributes[ge]=Be,D(c,"onattribute",Be)}c.attribList.length=0}c.tag.isSelfClosing=!!l,c.sawRoot=!0,c.tags.push(c.tag),D(c,"onopentag",c.tag),l||(!c.noscript&&c.tagName.toLowerCase()==="script"?c.state=y.SCRIPT:c.state=y.TEXT,c.tag=null,c.tagName=""),c.attribName=c.attribValue="",c.attribList.length=0}function Vt(c){if(!c.tagName){x(c,"Weird empty close tag."),c.textNode+="</>",c.state=y.TEXT;return}if(c.script){if(c.tagName!=="script"){c.script+="</"+c.tagName+">",c.tagName="",c.state=y.SCRIPT;return}D(c,"onscript",c.script),c.script=""}var l=c.tags.length,T=c.tagName;c.strict||(T=T[c.looseCase]());for(var g=T;l--;){var Q=c.tags[l];if(Q.name!==g)x(c,"Unexpected close tag");else break}if(l<0){x(c,"Unmatched closing tag: "+c.tagName),c.textNode+="</"+c.tagName+">",c.state=y.TEXT;return}c.tagName=T;for(var ee=c.tags.length;ee-- >l;){var ne=c.tag=c.tags.pop();c.tagName=c.tag.name,D(c,"onclosetag",c.tagName);var le={};for(var ge in ne.ns)le[ge]=ne.ns[ge];var Ee=c.tags[c.tags.length-1]||c;c.opt.xmlns&&ne.ns!==Ee.ns&&Object.keys(ne.ns).forEach(function(ae){var ve=ne.ns[ae];D(c,"onclosenamespace",{prefix:ae,uri:ve})})}l===0&&(c.closedRoot=!0),c.tagName=c.attribValue=c.attribName="",c.attribList.length=0,c.state=y.TEXT}function Mn(c){var l=c.entity,T=l.toLowerCase(),g,Q="";return c.ENTITIES[l]?c.ENTITIES[l]:c.ENTITIES[T]?c.ENTITIES[T]:(l=T,l.charAt(0)==="#"&&(l.charAt(1)==="x"?(l=l.slice(2),g=parseInt(l,16),Q=g.toString(16)):(l=l.slice(1),g=parseInt(l,10),Q=g.toString(10))),l=l.replace(/^0+/,""),isNaN(g)||Q.toLowerCase()!==l?(x(c,"Invalid character entity"),"&"+c.entity+";"):String.fromCodePoint(g))}function Wr(c,l){l==="<"?(c.state=y.OPEN_WAKA,c.startTagPosition=c.position):B(l)||(x(c,"Non-whitespace before first tag."),c.textNode=l,c.state=y.TEXT)}function Re(c,l){var T="";return l<c.length&&(T=c.charAt(l)),T}function ye(c){var l=this;if(this.error)throw this.error;if(l.closed)return Y(l,"Cannot write after close. Assign an onready handler.");if(c===null)return be(l);typeof c=="object"&&(c=c.toString());for(var T=0,g="";g=Re(c,T++),l.c=g,!!g;)switch(l.trackPosition&&(l.position++,g===`
`?(l.line++,l.column=0):l.column++),l.state){case y.BEGIN:if(l.state=y.BEGIN_WHITESPACE,g==="\uFEFF")continue;Wr(l,g);continue;case y.BEGIN_WHITESPACE:Wr(l,g);continue;case y.TEXT:if(l.sawRoot&&!l.closedRoot){for(var Q=T-1;g&&g!=="<"&&g!=="&";)g=Re(c,T++),g&&l.trackPosition&&(l.position++,g===`
`?(l.line++,l.column=0):l.column++);l.textNode+=c.substring(Q,T-1)}g==="<"&&!(l.sawRoot&&l.closedRoot&&!l.strict)?(l.state=y.OPEN_WAKA,l.startTagPosition=l.position):(!B(g)&&(!l.sawRoot||l.closedRoot)&&x(l,"Text data outside of root node."),g==="&"?l.state=y.TEXT_ENTITY:l.textNode+=g);continue;case y.SCRIPT:g==="<"?l.state=y.SCRIPT_ENDING:l.script+=g;continue;case y.SCRIPT_ENDING:g==="/"?l.state=y.CLOSE_TAG:(l.script+="<"+g,l.state=y.SCRIPT);continue;case y.OPEN_WAKA:if(g==="!")l.state=y.SGML_DECL,l.sgmlDecl="";else if(!B(g))if(U(q,g))l.state=y.OPEN_TAG,l.tagName=g;else if(g==="/")l.state=y.CLOSE_TAG,l.tagName="";else if(g==="?")l.state=y.PROC_INST,l.procInstName=l.procInstBody="";else{if(x(l,"Unencoded <"),l.startTagPosition+1<l.position){var ee=l.position-l.startTagPosition;g=new Array(ee).join(" ")+g}l.textNode+="<"+g,l.state=y.TEXT}continue;case y.SGML_DECL:(l.sgmlDecl+g).toUpperCase()===_?(D(l,"onopencdata"),l.state=y.CDATA,l.sgmlDecl="",l.cdata=""):l.sgmlDecl+g==="--"?(l.state=y.COMMENT,l.comment="",l.sgmlDecl=""):(l.sgmlDecl+g).toUpperCase()===E?(l.state=y.DOCTYPE,(l.doctype||l.sawRoot)&&x(l,"Inappropriately located doctype declaration"),l.doctype="",l.sgmlDecl=""):g===">"?(D(l,"onsgmldeclaration",l.sgmlDecl),l.sgmlDecl="",l.state=y.TEXT):(P(g)&&(l.state=y.SGML_DECL_QUOTED),l.sgmlDecl+=g);continue;case y.SGML_DECL_QUOTED:g===l.q&&(l.state=y.SGML_DECL,l.q=""),l.sgmlDecl+=g;continue;case y.DOCTYPE:g===">"?(l.state=y.TEXT,D(l,"ondoctype",l.doctype),l.doctype=!0):(l.doctype+=g,g==="["?l.state=y.DOCTYPE_DTD:P(g)&&(l.state=y.DOCTYPE_QUOTED,l.q=g));continue;case y.DOCTYPE_QUOTED:l.doctype+=g,g===l.q&&(l.q="",l.state=y.DOCTYPE);continue;case y.DOCTYPE_DTD:l.doctype+=g,g==="]"?l.state=y.DOCTYPE:P(g)&&(l.state=y.DOCTYPE_DTD_QUOTED,l.q=g);continue;case y.DOCTYPE_DTD_QUOTED:l.doctype+=g,g===l.q&&(l.state=y.DOCTYPE_DTD,l.q="");continue;case y.COMMENT:g==="-"?l.state=y.COMMENT_ENDING:l.comment+=g;continue;case y.COMMENT_ENDING:g==="-"?(l.state=y.COMMENT_ENDED,l.comment=X(l.opt,l.comment),l.comment&&D(l,"oncomment",l.comment),l.comment=""):(l.comment+="-"+g,l.state=y.COMMENT);continue;case y.COMMENT_ENDED:g!==">"?(x(l,"Malformed comment"),l.comment+="--"+g,l.state=y.COMMENT):l.state=y.TEXT;continue;case y.CDATA:g==="]"?l.state=y.CDATA_ENDING:l.cdata+=g;continue;case y.CDATA_ENDING:g==="]"?l.state=y.CDATA_ENDING_2:(l.cdata+="]"+g,l.state=y.CDATA);continue;case y.CDATA_ENDING_2:g===">"?(l.cdata&&D(l,"oncdata",l.cdata),D(l,"onclosecdata"),l.cdata="",l.state=y.TEXT):g==="]"?l.cdata+="]":(l.cdata+="]]"+g,l.state=y.CDATA);continue;case y.PROC_INST:g==="?"?l.state=y.PROC_INST_ENDING:B(g)?l.state=y.PROC_INST_BODY:l.procInstName+=g;continue;case y.PROC_INST_BODY:if(!l.procInstBody&&B(g))continue;g==="?"?l.state=y.PROC_INST_ENDING:l.procInstBody+=g;continue;case y.PROC_INST_ENDING:g===">"?(D(l,"onprocessinginstruction",{name:l.procInstName,body:l.procInstBody}),l.procInstName=l.procInstBody="",l.state=y.TEXT):(l.procInstBody+="?"+g,l.state=y.PROC_INST_BODY);continue;case y.OPEN_TAG:U(O,g)?l.tagName+=g:(k(l),g===">"?ze(l):g==="/"?l.state=y.OPEN_TAG_SLASH:(B(g)||x(l,"Invalid character in tag name"),l.state=y.ATTRIB));continue;case y.OPEN_TAG_SLASH:g===">"?(ze(l,!0),Vt(l)):(x(l,"Forward-slash in opening tag not followed by >"),l.state=y.ATTRIB);continue;case y.ATTRIB:if(B(g))continue;g===">"?ze(l):g==="/"?l.state=y.OPEN_TAG_SLASH:U(q,g)?(l.attribName=g,l.attribValue="",l.state=y.ATTRIB_NAME):x(l,"Invalid attribute name");continue;case y.ATTRIB_NAME:g==="="?l.state=y.ATTRIB_VALUE:g===">"?(x(l,"Attribute without value"),l.attribValue=l.attribName,dt(l),ze(l)):B(g)?l.state=y.ATTRIB_NAME_SAW_WHITE:U(O,g)?l.attribName+=g:x(l,"Invalid attribute name");continue;case y.ATTRIB_NAME_SAW_WHITE:if(g==="=")l.state=y.ATTRIB_VALUE;else{if(B(g))continue;x(l,"Attribute without value"),l.tag.attributes[l.attribName]="",l.attribValue="",D(l,"onattribute",{name:l.attribName,value:""}),l.attribName="",g===">"?ze(l):U(q,g)?(l.attribName=g,l.state=y.ATTRIB_NAME):(x(l,"Invalid attribute name"),l.state=y.ATTRIB)}continue;case y.ATTRIB_VALUE:if(B(g))continue;P(g)?(l.q=g,l.state=y.ATTRIB_VALUE_QUOTED):(x(l,"Unquoted attribute value"),l.state=y.ATTRIB_VALUE_UNQUOTED,l.attribValue=g);continue;case y.ATTRIB_VALUE_QUOTED:if(g!==l.q){g==="&"?l.state=y.ATTRIB_VALUE_ENTITY_Q:l.attribValue+=g;continue}dt(l),l.q="",l.state=y.ATTRIB_VALUE_CLOSED;continue;case y.ATTRIB_VALUE_CLOSED:B(g)?l.state=y.ATTRIB:g===">"?ze(l):g==="/"?l.state=y.OPEN_TAG_SLASH:U(q,g)?(x(l,"No whitespace between attributes"),l.attribName=g,l.attribValue="",l.state=y.ATTRIB_NAME):x(l,"Invalid attribute name");continue;case y.ATTRIB_VALUE_UNQUOTED:if(!L(g)){g==="&"?l.state=y.ATTRIB_VALUE_ENTITY_U:l.attribValue+=g;continue}dt(l),g===">"?ze(l):l.state=y.ATTRIB;continue;case y.CLOSE_TAG:if(l.tagName)g===">"?Vt(l):U(O,g)?l.tagName+=g:l.script?(l.script+="</"+l.tagName,l.tagName="",l.state=y.SCRIPT):(B(g)||x(l,"Invalid tagname in closing tag"),l.state=y.CLOSE_TAG_SAW_WHITE);else{if(B(g))continue;G(q,g)?l.script?(l.script+="</"+g,l.state=y.SCRIPT):x(l,"Invalid tagname in closing tag."):l.tagName=g}continue;case y.CLOSE_TAG_SAW_WHITE:if(B(g))continue;g===">"?Vt(l):x(l,"Invalid characters in closing tag");continue;case y.TEXT_ENTITY:case y.ATTRIB_VALUE_ENTITY_Q:case y.ATTRIB_VALUE_ENTITY_U:var ne,le;switch(l.state){case y.TEXT_ENTITY:ne=y.TEXT,le="textNode";break;case y.ATTRIB_VALUE_ENTITY_Q:ne=y.ATTRIB_VALUE_QUOTED,le="attribValue";break;case y.ATTRIB_VALUE_ENTITY_U:ne=y.ATTRIB_VALUE_UNQUOTED,le="attribValue";break}g===";"?(l[le]+=Mn(l),l.entity="",l.state=ne):U(l.entity.length?v:M,g)?l.entity+=g:(x(l,"Invalid character in entity name"),l[le]+="&"+l.entity+g,l.entity="",l.state=ne);continue;default:throw new Error(l,"Unknown state: "+l.state)}return l.position>=l.bufferCheckPosition&&o(l),l}String.fromCodePoint||(function(){var c=String.fromCharCode,l=Math.floor,T=function(){var g=16384,Q=[],ee,ne,le=-1,ge=arguments.length;if(!ge)return"";for(var Ee="";++le<ge;){var ae=Number(arguments[le]);if(!isFinite(ae)||ae<0||ae>1114111||l(ae)!==ae)throw RangeError("Invalid code point: "+ae);ae<=65535?Q.push(ae):(ae-=65536,ee=(ae>>10)+55296,ne=ae%1024+56320,Q.push(ee,ne)),(le+1===ge||Q.length>g)&&(Ee+=c.apply(null,Q),Q.length=0)}return Ee};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:T,configurable:!0,writable:!0}):String.fromCodePoint=T})()})(typeof Bn>"u"?Bn.sax={}:Bn)});var Br=ie((Fa,ds)=>{"use strict";var cs=Fa&&Fa.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},Tc=cs(require("http")),Rc=cs(require("https")),Ec=require("stream"),us={"http:":Tc.default,"https:":Rc.default},vc=new Set([301,302,303,307,308]),Ac=new Set([429,503]),Cc=["connect","continue","information","socket","timeout","upgrade"],Pc=["aborted"];Xe.MinigetError=class extends Error{constructor(n,a){super(n),this.statusCode=a}};Xe.defaultOptions={maxRedirects:10,maxRetries:2,maxReconnects:0,backoff:{inc:100,max:1e4}};function Xe(r,n={}){var a;let o=Object.assign({},Xe.defaultOptions,n),i=new Ec.PassThrough({highWaterMark:o.highWaterMark});i.destroyed=i.aborted=!1;let u,f,b,h=0,m=0,_,E=0,I,A=!1,R=0,q,O=0;if(!((a=o.headers)===null||a===void 0)&&a.Range){let F=/bytes=(\d+)-(\d+)?/.exec(`${o.headers.Range}`);F&&(R=parseInt(F[1],10),q=parseInt(F[2],10))}o.acceptEncoding&&(o.headers=Object.assign({"Accept-Encoding":Object.keys(o.acceptEncoding).join(", ")},o.headers));let M=()=>b&&O>0,v=()=>!A||O===I,B=F=>{b=null,m=0;let D=o.backoff.inc,j=Math.min(D,o.backoff.max);_=setTimeout(G,j),i.emit("reconnect",E,F)},P=F=>n.method!=="HEAD"&&!v()&&E++<o.maxReconnects?(B(F),!0):!1,L=F=>{if(i.destroyed)return!1;if(M())return P(F.err);if((!F.err||F.err.message==="ENOTFOUND")&&m++<o.maxRetries){let D=F.retryAfter||Math.min(m*o.backoff.inc,o.backoff.max);return _=setTimeout(G,D),i.emit("retry",m,F.err),!0}return!1},U=(F,D)=>{for(let j of D)F.on(j,i.emit.bind(i,j))},G=()=>{let F={},D;try{let k=typeof r=="string"?new URL(r):r;F=Object.assign({},{host:k.host,hostname:k.hostname,path:k.pathname+k.search+k.hash,port:k.port,protocol:k.protocol}),k.username&&(F.auth=`${k.username}:${k.password}`),D=us[String(F.protocol)]}catch{}if(!D){i.emit("error",new Xe.MinigetError(`Invalid URL: ${r}`));return}if(Object.assign(F,o),A&&O>0){let k=O+R,re=q||"";F.headers=Object.assign({},F.headers,{Range:`bytes=${k}-${re}`})}if(o.transform){try{F=o.transform(F)}catch(k){i.emit("error",k);return}if((!F||F.protocol)&&(D=us[String(F?.protocol)],!D)){i.emit("error",new Xe.MinigetError("Invalid URL object from `transform` function"));return}}let j=k=>{i.destroyed||i.readableEnded||(Y(),L({err:k})?u.removeListener("close",X):i.emit("error",k))},X=()=>{Y(),L({})},Y=()=>{u.removeListener("close",X),f?.removeListener("data",be),b?.removeListener("end",x)},be=k=>{O+=k.length},x=()=>{Y(),P()||i.end()};u=D.request(F,k=>{if(!i.destroyed){if(vc.has(k.statusCode)){if(h++>=o.maxRedirects)i.emit("error",new Xe.MinigetError("Too many redirects"));else{if(k.headers.location)r=k.headers.location;else{let re=new Xe.MinigetError("Redirect status code given with no location",k.statusCode);i.emit("error",re),Y();return}setTimeout(G,parseInt(k.headers["retry-after"]||"0",10)*1e3),i.emit("redirect",r)}Y();return}else if(Ac.has(k.statusCode)){if(!L({retryAfter:parseInt(k.headers["retry-after"]||"0",10)})){let re=new Xe.MinigetError(`Status code: ${k.statusCode}`,k.statusCode);i.emit("error",re)}Y();return}else if(k.statusCode&&(k.statusCode<200||k.statusCode>=400)){let re=new Xe.MinigetError(`Status code: ${k.statusCode}`,k.statusCode);k.statusCode>=500?j(re):i.emit("error",re),Y();return}if(b=k,o.acceptEncoding&&k.headers["content-encoding"])for(let re of k.headers["content-encoding"].split(", ").reverse()){let dt=o.acceptEncoding[re];dt&&(b=b.pipe(dt()),b.on("error",j))}I||(I=parseInt(`${k.headers["content-length"]}`,10),A=k.headers["accept-ranges"]==="bytes"&&I>0&&o.maxReconnects>0),k.on("data",be),b.on("end",x),b.pipe(i,{end:!A}),f=k,i.emit("response",k),k.on("error",j),U(k,Pc)}}),u.on("error",j),u.on("close",X),U(u,Cc),i.destroyed&&te(...y),i.emit("request",u),u.end()};i.abort=F=>{console.warn("`MinigetStream#abort()` has been deprecated in favor of `MinigetStream#destroy()`"),i.aborted=!0,i.emit("abort"),i.destroy(F)};let y,te=F=>{u.destroy(F),b?.unpipe(i),b?.destroy(),clearTimeout(_)};return i._destroy=(...F)=>{i.destroyed=!0,u?te(...F):y=F},i.text=()=>new Promise((F,D)=>{let j="";i.setEncoding("utf8"),i.on("data",X=>j+=X),i.on("end",()=>F(j)),i.on("error",D)}),process.nextTick(G),i}ds.exports=Xe});var Na=ie((zm,Ic)=>{Ic.exports={name:"ytdl-core",description:"YouTube video downloader in pure javascript.",keywords:["youtube","video","download"],version:"4.11.5",repository:{type:"git",url:"git://github.com/fent/node-ytdl-core.git"},author:"fent <fentbox@gmail.com> (https://github.com/fent)",contributors:["Tobias Kutscha (https://github.com/TimeForANinja)","Andrew Kelley (https://github.com/andrewrk)","Mauricio Allende (https://github.com/mallendeo)","Rodrigo Altamirano (https://github.com/raltamirano)","Jim Buck (https://github.com/JimmyBoh)","Pawe\u0142 Ruci\u0144ski (https://github.com/Roki100)","Alexander Paolini (https://github.com/Million900o)"],main:"./lib/index.js",types:"./typings/index.d.ts",files:["lib","typings"],scripts:{test:"nyc --reporter=lcov --reporter=text-summary npm run test:unit","test:unit":"mocha --ignore test/irl-test.js test/*-test.js --timeout 4000","test:irl":"mocha --timeout 16000 test/irl-test.js",lint:"eslint ./","lint:fix":"eslint --fix ./","lint:typings":"tslint typings/index.d.ts","lint:typings:fix":"tslint --fix typings/index.d.ts"},dependencies:{m3u8stream:"^0.8.6",miniget:"^4.2.2",sax:"^1.1.3"},devDependencies:{"@types/node":"^13.1.0","assert-diff":"^3.0.1",dtslint:"^3.6.14",eslint:"^6.8.0",mocha:"^7.0.0","muk-require":"^1.2.0",nock:"^13.0.4",nyc:"^15.0.0",sinon:"^9.0.0","stream-equal":"~1.1.0",typescript:"^3.9.7"},engines:{node:">=12"},license:"MIT"}});var or=ie(Te=>{var ms=Br();Te.between=(r,n,a)=>{let o;if(n instanceof RegExp){let i=r.match(n);if(!i)return"";o=i.index+i[0].length}else{if(o=r.indexOf(n),o===-1)return"";o+=n.length}return r=r.slice(o),o=r.indexOf(a),o===-1?"":(r=r.slice(0,o),r)};Te.parseAbbreviatedNumber=r=>{let n=r.replace(",",".").replace(" ","").match(/([\d,.]+)([MK]?)/);if(n){let[,a,o]=n;return a=parseFloat(a),Math.round(o==="M"?a*1e6:o==="K"?a*1e3:a)}return null};var Dc=[{start:'"',end:'"'},{start:"'",end:"'"},{start:"`",end:"`"},{start:"/",end:"/",startPrefix:/(^|[[{:;,/])\s?$/}];Te.cutAfterJS=r=>{let n,a;if(r[0]==="["?(n="[",a="]"):r[0]==="{"&&(n="{",a="}"),!n)throw new Error(`Can't cut unsupported JSON (need to begin with [ or { ) but got: ${r[0]}`);let o=null,i=!1,u=0,f;for(f=0;f<r.length;f++){if(!i&&o!==null&&r[f]===o.end){o=null;continue}else if(!i&&o===null){for(let b of Dc)if(r[f]===b.start&&(!b.startPrefix||r.substring(f-10,f).match(b.startPrefix))){o=b;break}if(o!==null)continue}if(i=r[f]==="\\"&&!i,o===null&&(r[f]===n?u++:r[f]===a&&u--,u===0))return r.substring(0,f+1)}throw Error("Can't cut unsupported JSON (no matching closing bracket found)")};Te.playError=(r,n,a=Error)=>{let o=r&&r.playabilityStatus;return o&&n.includes(o.status)?new a(o.reason||o.messages&&o.messages[0]):null};Te.exposedMiniget=(r,n={},a)=>{let o=ms(r,a||n.requestOptions);return typeof n.requestCallback=="function"&&n.requestCallback(o),o};Te.deprecate=(r,n,a,o,i)=>{Object.defineProperty(r,n,{get:()=>(console.warn(`\`${o}\` will be removed in a near future release, use \`${i}\` instead.`),a)})};var fs=Na(),Bc=1e3*60*60*12;Te.lastUpdateCheck=0;Te.checkForUpdates=()=>!process.env.YTDL_NO_UPDATE&&!fs.version.startsWith("0.0.0-")&&Date.now()-Te.lastUpdateCheck>=Bc?(Te.lastUpdateCheck=Date.now(),ms("https://api.github.com/repos/fent/node-ytdl-core/releases/latest",{headers:{"User-Agent":"ytdl-core"}}).text().then(r=>{JSON.parse(r).tag_name!==`v${fs.version}`&&console.warn('\x1B[33mWARNING:\x1B[0m ytdl-core is out of date! Update with "npm install ytdl-core@latest".')},r=>{console.warn("Error checking for updates:",r.message),console.warn("You can disable this check by setting the `YTDL_NO_UPDATE` env variable.")})):null;Te.getRandomIPv6=r=>{if(!Oc(r))throw Error("Invalid IPv6 format");let[n,a]=r.split("/"),o=parseInt(a);if(!o||o>128||o<24)throw Error("Invalid IPv6 subnet");let i=kc(n);return new Array(8).fill(1).map(()=>Math.floor(Math.random()*65535)).map((b,h)=>{let m=Math.min(o,16);o-=m;let _=65535-(2**(16-m)-1);return(i[h]&_)+(b&(_^65535))}).map(b=>b.toString("16")).join(":")};var Lc=/^(([0-9a-f]{1,4}:)(:[0-9a-f]{1,4}){1,6}|([0-9a-f]{1,4}:){1,2}(:[0-9a-f]{1,4}){1,5}|([0-9a-f]{1,4}:){1,3}(:[0-9a-f]{1,4}){1,4}|([0-9a-f]{1,4}:){1,4}(:[0-9a-f]{1,4}){1,3}|([0-9a-f]{1,4}:){1,5}(:[0-9a-f]{1,4}){1,2}|([0-9a-f]{1,4}:){1,6}(:[0-9a-f]{1,4})|([0-9a-f]{1,4}:){1,7}(([0-9a-f]{1,4})|:))\/(1[0-1]\d|12[0-8]|\d{1,2})$/,Oc=Te.isIPv6=r=>Lc.test(r),kc=Te.normalizeIP=r=>{let n=r.split("::").map(u=>u.split(":")),a=n[0]||[],o=n[1]||[];o.reverse();let i=new Array(8).fill(0);for(let u=0;u<Math.min(a.length,8);u++)i[u]=parseInt(a[u],16)||0;for(let u=0;u<Math.min(o.length,8);u++)i[7-u]=parseInt(o[u],16)||0;return i}});var ps=ie((Hm,hs)=>{hs.exports={5:{mimeType:'video/flv; codecs="Sorenson H.283, mp3"',qualityLabel:"240p",bitrate:25e4,audioBitrate:64},6:{mimeType:'video/flv; codecs="Sorenson H.263, mp3"',qualityLabel:"270p",bitrate:8e5,audioBitrate:64},13:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:null,bitrate:5e5,audioBitrate:null},17:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:"144p",bitrate:5e4,audioBitrate:24},18:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:96},22:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},34:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},35:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"480p",bitrate:8e5,audioBitrate:128},36:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:"240p",bitrate:175e3,audioBitrate:32},37:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:3e6,audioBitrate:192},38:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"3072p",bitrate:35e5,audioBitrate:192},43:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},44:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"480p",bitrate:1e6,audioBitrate:128},45:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},46:{mimeType:'audio/webm; codecs="vp8, vorbis"',qualityLabel:"1080p",bitrate:null,audioBitrate:192},82:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:96},83:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"240p",bitrate:5e5,audioBitrate:96},84:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},85:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:3e6,audioBitrate:192},91:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"144p",bitrate:1e5,audioBitrate:48},92:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"240p",bitrate:15e4,audioBitrate:48},93:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},94:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"480p",bitrate:8e5,audioBitrate:128},95:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:15e5,audioBitrate:256},96:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:25e5,audioBitrate:256},100:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:null,audioBitrate:128},101:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:null,audioBitrate:192},102:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"720p",bitrate:null,audioBitrate:192},120:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:128},127:{mimeType:'audio/ts; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:96},128:{mimeType:'audio/ts; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:96},132:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"240p",bitrate:15e4,audioBitrate:48},133:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"240p",bitrate:2e5,audioBitrate:null},134:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"360p",bitrate:3e5,audioBitrate:null},135:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"480p",bitrate:5e5,audioBitrate:null},136:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"720p",bitrate:1e6,audioBitrate:null},137:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1080p",bitrate:25e5,audioBitrate:null},138:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"4320p",bitrate:135e5,audioBitrate:null},139:{mimeType:'audio/mp4; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:48},140:{mimeType:'audio/m4a; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:128},141:{mimeType:'audio/mp4; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:256},151:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:5e4,audioBitrate:24},160:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"144p",bitrate:1e5,audioBitrate:null},171:{mimeType:'audio/webm; codecs="vorbis"',qualityLabel:null,bitrate:null,audioBitrate:128},172:{mimeType:'audio/webm; codecs="vorbis"',qualityLabel:null,bitrate:null,audioBitrate:192},242:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p",bitrate:1e5,audioBitrate:null},243:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"360p",bitrate:25e4,audioBitrate:null},244:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"480p",bitrate:5e5,audioBitrate:null},247:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p",bitrate:7e5,audioBitrate:null},248:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p",bitrate:15e5,audioBitrate:null},249:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:48},250:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:64},251:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:160},264:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1440p",bitrate:4e6,audioBitrate:null},266:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"2160p",bitrate:125e5,audioBitrate:null},271:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p",bitrate:9e6,audioBitrate:null},272:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"4320p",bitrate:2e7,audioBitrate:null},278:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"144p 30fps",bitrate:8e4,audioBitrate:null},298:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"720p",bitrate:3e6,audioBitrate:null},299:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1080p",bitrate:55e5,audioBitrate:null},300:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:1318e3,audioBitrate:48},302:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p HFR",bitrate:25e5,audioBitrate:null},303:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p HFR",bitrate:5e6,audioBitrate:null},308:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p HFR",bitrate:1e7,audioBitrate:null},313:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p",bitrate:13e6,audioBitrate:null},315:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p HFR",bitrate:2e7,audioBitrate:null},330:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"144p HDR, HFR",bitrate:8e4,audioBitrate:null},331:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p HDR, HFR",bitrate:1e5,audioBitrate:null},332:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"360p HDR, HFR",bitrate:25e4,audioBitrate:null},333:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p HDR, HFR",bitrate:5e5,audioBitrate:null},334:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p HDR, HFR",bitrate:1e6,audioBitrate:null},335:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p HDR, HFR",bitrate:15e5,audioBitrate:null},336:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p HDR, HFR",bitrate:5e6,audioBitrate:null},337:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p HDR, HFR",bitrate:12e6,audioBitrate:null}}});var Ua=ie(Ke=>{var qc=or(),Fc=ps(),Nc=["mp4a","mp3","vorbis","aac","opus","flac"],Mc=["mp4v","avc1","Sorenson H.283","MPEG-4 Visual","VP8","VP9","H.264"],bs=r=>r.bitrate||0,ys=r=>Mc.findIndex(n=>r.codecs&&r.codecs.includes(n)),gs=r=>r.audioBitrate||0,_s=r=>Nc.findIndex(n=>r.codecs&&r.codecs.includes(n)),Wa=(r,n,a)=>{let o=0;for(let i of a)if(o=i(n)-i(r),o!==0)break;return o},Ma=(r,n)=>Wa(r,n,[a=>parseInt(a.qualityLabel),bs,ys]),xa=(r,n)=>Wa(r,n,[gs,_s]);Ke.sortFormats=(r,n)=>Wa(r,n,[a=>+!!a.isHLS,a=>+!!a.isDashMPD,a=>+(a.contentLength>0),a=>+(a.hasVideo&&a.hasAudio),a=>+a.hasVideo,a=>parseInt(a.qualityLabel)||0,bs,gs,ys,_s]);Ke.chooseFormat=(r,n)=>{if(typeof n.format=="object"){if(!n.format.url)throw Error("Invalid format given, did you use `ytdl.getInfo()`?");return n.format}n.filter&&(r=Ke.filterFormats(r,n.filter)),r.some(i=>i.isHLS)&&(r=r.filter(i=>i.isHLS||!i.isLive));let a,o=n.quality||"highest";switch(o){case"highest":a=r[0];break;case"lowest":a=r[r.length-1];break;case"highestaudio":{r=Ke.filterFormats(r,"audio"),r.sort(xa);let i=r[0];r=r.filter(f=>xa(i,f)===0);let u=r.map(f=>parseInt(f.qualityLabel)||0).sort((f,b)=>f-b)[0];a=r.find(f=>(parseInt(f.qualityLabel)||0)===u);break}case"lowestaudio":r=Ke.filterFormats(r,"audio"),r.sort(xa),a=r[r.length-1];break;case"highestvideo":{r=Ke.filterFormats(r,"video"),r.sort(Ma);let i=r[0];r=r.filter(f=>Ma(i,f)===0);let u=r.map(f=>f.audioBitrate||0).sort((f,b)=>f-b)[0];a=r.find(f=>(f.audioBitrate||0)===u);break}case"lowestvideo":r=Ke.filterFormats(r,"video"),r.sort(Ma),a=r[r.length-1];break;default:a=xc(o,r);break}if(!a)throw Error(`No such format found: ${o}`);return a};var xc=(r,n)=>{let a=o=>n.find(i=>`${i.itag}`==`${o}`);return Array.isArray(r)?a(r.find(o=>a(o))):a(r)};Ke.filterFormats=(r,n)=>{let a;switch(n){case"videoandaudio":case"audioandvideo":a=o=>o.hasVideo&&o.hasAudio;break;case"video":a=o=>o.hasVideo;break;case"videoonly":a=o=>o.hasVideo&&!o.hasAudio;break;case"audio":a=o=>o.hasAudio;break;case"audioonly":a=o=>!o.hasVideo&&o.hasAudio;break;default:if(typeof n=="function")a=n;else throw TypeError(`Given filter (${n}) is not supported`)}return r.filter(o=>!!o.url&&a(o))};Ke.addFormatMeta=r=>(r=Object.assign({},Fc[r.itag],r),r.hasVideo=!!r.qualityLabel,r.hasAudio=!!r.audioBitrate,r.container=r.mimeType?r.mimeType.split(";")[0].split("/")[1]:null,r.codecs=r.mimeType?qc.between(r.mimeType,'codecs="','"'):null,r.videoCodec=r.hasVideo&&r.codecs?r.codecs.split(", ")[0]:null,r.audioCodec=r.hasAudio&&r.codecs?r.codecs.split(", ").slice(-1)[0]:null,r.isLive=/\bsource[/=]yt_live_broadcast\b/.test(r.url),r.isHLS=/\/manifest\/hls_(variant|playlist)\//.test(r.url),r.isDashMPD=/\/manifest\/dash\//.test(r.url),r)});var Va=ie(ut=>{var Wc=new Set(["youtube.com","www.youtube.com","m.youtube.com","music.youtube.com","gaming.youtube.com"]),Uc=/^https?:\/\/(youtu\.be\/|(www\.)?youtube\.com\/(embed|v|shorts)\/)/;ut.getURLVideoID=r=>{let n=new URL(r.trim()),a=n.searchParams.get("v");if(Uc.test(r.trim())&&!a){let o=n.pathname.split("/");a=n.host==="youtu.be"?o[1]:o[2]}else if(n.hostname&&!Wc.has(n.hostname))throw Error("Not a YouTube domain");if(!a)throw Error(`No video id found: "${r}"`);if(a=a.substring(0,11),!ut.validateID(a))throw TypeError(`Video id (${a}) does not match expected format (${ws.toString()})`);return a};var Vc=/^https?:\/\//;ut.getVideoID=r=>{if(ut.validateID(r))return r;if(Vc.test(r.trim()))return ut.getURLVideoID(r);throw Error(`No video id found: ${r}`)};var ws=/^[a-zA-Z0-9-_]{11}$/;ut.validateID=r=>ws.test(r.trim());ut.validateURL=r=>{try{return ut.getURLVideoID(r),!0}catch{return!1}}});var Ss=ie(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});var $c=require("stream"),$a=class extends $c.Writable{constructor(){super(),this._lastLine="",this._seq=0,this._nextItemDuration=null,this._nextItemRange=null,this._lastItemRangeEnd=0,this.on("finish",()=>{this._parseLine(this._lastLine),this.emit("end")})}_parseAttrList(n){let a={},o=/([A-Z0-9-]+)=(?:"([^"]*?)"|([^,]*?))/g,i;for(;(i=o.exec(n))!==null;)a[i[1]]=i[2]||i[3];return a}_parseRange(n){if(!n)return null;let a=n.split("@"),o=a[1]?parseInt(a[1]):this._lastItemRangeEnd+1,i=o+parseInt(a[0])-1,u={start:o,end:i};return this._lastItemRangeEnd=u.end,u}_parseLine(n){let a=n.match(/^#(EXT[A-Z0-9-]+)(?::(.*))?/);if(a){let o=a[1],i=a[2]||"";switch(o){case"EXT-X-PROGRAM-DATE-TIME":this.emit("starttime",new Date(i).getTime());break;case"EXT-X-MEDIA-SEQUENCE":this._seq=parseInt(i);break;case"EXT-X-MAP":{let u=this._parseAttrList(i);if(!u.URI){this.destroy(new Error("`EXT-X-MAP` found without required attribute `URI`"));return}this.emit("item",{url:u.URI,seq:this._seq,init:!0,duration:0,range:this._parseRange(u.BYTERANGE)});break}case"EXT-X-BYTERANGE":{this._nextItemRange=this._parseRange(i);break}case"EXTINF":this._nextItemDuration=Math.round(parseFloat(i.split(",")[0])*1e3);break;case"EXT-X-ENDLIST":this.emit("endlist");break}}else!/^#/.test(n)&&n.trim()&&(this.emit("item",{url:n.trim(),seq:this._seq++,duration:this._nextItemDuration,range:this._nextItemRange}),this._nextItemRange=null)}_write(n,a,o){let i=n.toString("utf8").split(`
`);this._lastLine&&(i[0]=this._lastLine+i[0]),i.forEach((u,f)=>{this.destroyed||(f<i.length-1?this._parseLine(u):this._lastLine=u)}),o()}};za.default=$a});var ja=ie(sr=>{"use strict";Object.defineProperty(sr,"__esModule",{value:!0});sr.durationStr=sr.humanStr=void 0;var zc=/^\d+$/,jc=/^(?:(?:(\d+):)?(\d{1,2}):)?(\d{1,2})(?:\.(\d{3}))?$/,Lr={ms:1,s:1e3,m:6e4,h:36e5};sr.humanStr=r=>{if(typeof r=="number")return r;if(zc.test(r))return+r;let n=jc.exec(r);if(n)return+(n[1]||0)*Lr.h+ +(n[2]||0)*Lr.m+ +n[3]*Lr.s+ +(n[4]||0);{let a=0,o=/(-?\d+)(ms|s|m|h)/g,i;for(;(i=o.exec(r))!==null;)a+=+i[1]*Lr[i[2]];return a}};sr.durationStr=r=>{let n=0,a=/(\d+(?:\.\d+)?)(S|M|H)/g,o;for(;(o=a.exec(r))!==null;)n+=+o[1]*Lr[o[2].toLowerCase()];return n}});var Ts=ie(Or=>{"use strict";var Hc=Or&&Or.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Or,"__esModule",{value:!0});var Qc=require("stream"),Gc=Hc(qa()),Yc=ja(),Ha=class extends Qc.Writable{constructor(n){super(),this._parser=Gc.default.createStream(!1,{lowercase:!0}),this._parser.on("error",this.destroy.bind(this));let a,o=0,i=0,u,f,b,h,m,_=[],E=!1,I=!1,A,R,q,O=v=>{let B={RepresentationID:n,Number:i,Time:o};return v.replace(/\$(\w+)\$/g,(P,L)=>`${B[L]}`)};this._parser.on("opentag",v=>{switch(v.name){case"mpd":o=v.attributes.availabilitystarttime?new Date(v.attributes.availabilitystarttime).getTime():0,A=v.attributes.type!=="dynamic";break;case"period":i=0,f=1e3,h=0,b=0,m=[],R=0,q=Yc.durationStr(v.attributes.start)||0;break;case"segmentlist":i=parseInt(v.attributes.startnumber)||i,f=parseInt(v.attributes.timescale)||f,h=parseInt(v.attributes.duration)||h,b=parseInt(v.attributes.presentationtimeoffset)||b;break;case"segmenttemplate":u=v.attributes,i=parseInt(v.attributes.startnumber)||i,f=parseInt(v.attributes.timescale)||f;break;case"segmenttimeline":case"baseurl":a=v.name;break;case"s":_.push({duration:parseInt(v.attributes.d),repeat:parseInt(v.attributes.r),time:parseInt(v.attributes.t)});break;case"adaptationset":case"representation":R++,n||(n=v.attributes.id),E=v.attributes.id===`${n}`,E&&(q&&(o+=q),b&&(o-=b/f*1e3),this.emit("starttime",o));break;case"initialization":E&&this.emit("item",{url:m.filter(B=>!!B).join("")+v.attributes.sourceurl,seq:i,init:!0,duration:0});break;case"segmenturl":if(E){I=!0;let B=_.shift(),P=(B?.duration||h)/f*1e3;this.emit("item",{url:m.filter(L=>!!L).join("")+v.attributes.media,seq:i++,duration:P}),o+=P}break}});let M=()=>{A&&this.emit("endlist"),E?this.emit("end"):this.destroy(Error(`Representation '${n}' not found`))};this._parser.on("closetag",v=>{switch(v){case"adaptationset":case"representation":if(R--,u&&_.length){I=!0,u.initialization&&this.emit("item",{url:m.filter(B=>!!B).join("")+O(u.initialization),seq:i,init:!0,duration:0});for(let{duration:B,repeat:P,time:L}of _){B=B/f*1e3,P=P||1,o=L||o;for(let U=0;U<P;U++)this.emit("item",{url:m.filter(G=>!!G).join("")+O(u.media),seq:i++,duration:B}),o+=B}}I&&(this.emit("endearly"),M(),this._parser.removeAllListeners(),this.removeAllListeners("finish"));break}}),this._parser.on("text",v=>{a==="baseurl"&&(m[R]=v,a=null)}),this.on("finish",M)}_write(n,a,o){this._parser.write(n),o()}};Or.default=Ha});var Rs=ie(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.Queue=void 0;var Qa=class{constructor(n,a={}){this._worker=n,this._concurrency=a.concurrency||1,this.tasks=[],this.total=0,this.active=0}push(n,a){this.tasks.push({item:n,callback:a}),this.total++,this._next()}_next(){if(this.active>=this._concurrency||!this.tasks.length)return;let{item:n,callback:a}=this.tasks.shift(),o=!1;this.active++,this._worker(n,(i,u)=>{o||(this.active--,o=!0,a?.(i,u),this._next())})}die(){this.tasks=[]}};Ln.Queue=Qa});var On=ie((Ga,Is)=>{"use strict";var Ya=Ga&&Ga.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},Es=require("stream"),vs=Ya(Br()),Xc=Ya(Ss()),Kc=Ya(Ts()),As=Rs(),Cs=ja(),Jc={m3u8:Xc.default,"dash-mpd":Kc.default},Ps=((r,n={})=>{let a=new Es.PassThrough({highWaterMark:n.highWaterMark}),o=n.chunkReadahead||3,i=n.liveBuffer||2e4,u=n.requestOptions,f=Jc[n.parser||(/\.mpd$/.test(r)?"dash-mpd":"m3u8")];if(!f)throw TypeError(`parser '${n.parser}' not supported`);let b=0;typeof n.begin<"u"&&(b=typeof n.begin=="string"?Cs.humanStr(n.begin):Math.max(n.begin-i,0));let h=D=>{for(let j of["abort","request","response","redirect","retry","reconnect"])D.on(j,a.emit.bind(a,j))},m,_=new As.Queue((D,j)=>{m=D;let X=0;D.on("data",Y=>X+=Y.length),D.pipe(a,{end:!1}),D.on("end",()=>j(null,X))},{concurrency:1}),E=0,I=0,A=new As.Queue((D,j)=>{let X=Object.assign({},u);D.range&&(X.headers=Object.assign({},X.headers,{Range:`bytes=${D.range.start}-${D.range.end}`}));let Y=vs.default(new URL(D.url,r).toString(),X);Y.on("error",j),h(Y),_.push(Y,(be,x)=>{I+=+x,a.emit("progress",{num:++E,size:x,duration:D.duration,url:D.url},A.total,I),j(null)})},{concurrency:o}),R=D=>{a.emit("error",D),a.end()},q,O,M,v=!0,B=!1,P=!1,L,U=D=>{if(m=null,D)R(D);else if(!v&&!B&&!P&&A.tasks.length+A.active<=q){let j=Math.max(0,O-(Date.now()-L));v=!0,M=setTimeout(F,j)}else(B||P)&&!A.tasks.length&&!A.active&&a.end()},G,y,te=0,F=()=>{L=Date.now(),G=vs.default(r,u),G.on("error",R),h(G);let D=G.pipe(new f(n.id));D.on("starttime",x=>{te||(te=x,typeof n.begin=="string"&&b>=0&&(b+=te))}),D.on("endlist",()=>{P=!0}),D.on("endearly",G.unpipe.bind(G,D));let j=[],X=x=>{if(!x.init){if(x.seq<=y)return;y=x.seq}b=x.time,A.push(x,U),j.push(x)},Y=[],be=0;D.on("item",x=>{let k=Object.assign({time:te},x);if(b<=k.time)X(k);else for(Y.push(k),be+=k.duration;Y.length>1&&be-Y[0].duration>i;){let re=Y.shift();be-=re.duration}te+=k.duration}),D.on("end",()=>{G=null,!j.length&&Y.length&&Y.forEach(x=>{X(x)}),q=Math.max(1,Math.ceil(j.length*.01)),O=j.reduce((x,k)=>k.duration+x,0),v=!1,U(null)})};return F(),a.end=()=>(B=!0,_.die(),A.die(),clearTimeout(M),G?.destroy(),m?.destroy(),Es.PassThrough.prototype.end.call(a,null),a),a});Ps.parseTimestamp=Cs.humanStr;Is.exports=Ps});var Ls=ie(ct=>{var Wt=or(),Zc=require("querystring"),{parseTimestamp:ed}=On(),lr="https://www.youtube.com/watch?v=",Xa={song:{name:"Music",url:"https://music.youtube.com/"}},he=r=>r?r.runs?r.runs[0].text:r.simpleText:null;ct.getMedia=r=>{let n={},a=[];try{a=r.response.contents.twoColumnWatchNextResults.results.results.contents}catch{}let o=a.find(i=>i.videoSecondaryInfoRenderer);if(!o)return{};try{let i=(o.metadataRowContainer||o.videoSecondaryInfoRenderer.metadataRowContainer).metadataRowContainerRenderer.rows;for(let u of i)if(u.metadataRowRenderer){let f=he(u.metadataRowRenderer.title).toLowerCase(),b=u.metadataRowRenderer.contents[0];n[f]=he(b);let h=b.runs;h&&h[0].navigationEndpoint&&(n[`${f}_url`]=new URL(h[0].navigationEndpoint.commandMetadata.webCommandMetadata.url,lr).toString()),f in Xa&&(n.category=Xa[f].name,n.category_url=Xa[f].url)}else if(u.richMetadataRowRenderer){let f=u.richMetadataRowRenderer.contents,b=f.filter(m=>m.richMetadataRenderer.style==="RICH_METADATA_RENDERER_STYLE_BOX_ART");for(let{richMetadataRenderer:m}of b){let _=m;n.year=he(_.subtitle);let E=he(_.callToAction).split(" ")[1];n[E]=he(_.title),n[`${E}_url`]=new URL(_.endpoint.commandMetadata.webCommandMetadata.url,lr).toString(),n.thumbnails=_.thumbnail.thumbnails}let h=f.filter(m=>m.richMetadataRenderer.style==="RICH_METADATA_RENDERER_STYLE_TOPIC");for(let{richMetadataRenderer:m}of h){let _=m;n.category=he(_.title),n.category_url=new URL(_.endpoint.commandMetadata.webCommandMetadata.url,lr).toString()}}}catch{}return n};var Bs=r=>!!(r&&r.find(n=>n.metadataBadgeRenderer.tooltip==="Verified"));ct.getAuthor=r=>{let n,a=[],o,i=!1;try{let b=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(h=>h.videoSecondaryInfoRenderer&&h.videoSecondaryInfoRenderer.owner&&h.videoSecondaryInfoRenderer.owner.videoOwnerRenderer).videoSecondaryInfoRenderer.owner.videoOwnerRenderer;n=b.navigationEndpoint.browseEndpoint.browseId,a=b.thumbnail.thumbnails.map(h=>(h.url=new URL(h.url,lr).toString(),h)),o=Wt.parseAbbreviatedNumber(he(b.subscriberCountText)),i=Bs(b.badges)}catch{}try{let u=r.player_response.microformat&&r.player_response.microformat.playerMicroformatRenderer,f=u&&u.channelId||n||r.player_response.videoDetails.channelId,b={id:f,name:u?u.ownerChannelName:r.player_response.videoDetails.author,user:u?u.ownerProfileUrl.split("/").slice(-1)[0]:null,channel_url:`https://www.youtube.com/channel/${f}`,external_channel_url:u?`https://www.youtube.com/channel/${u.externalChannelId}`:"",user_url:u?new URL(u.ownerProfileUrl,lr).toString():"",thumbnails:a,verified:i,subscriber_count:o};return a.length&&Wt.deprecate(b,"avatar",b.thumbnails[0].url,"author.avatar","author.thumbnails[0].url"),b}catch{return{}}};var Ds=(r,n)=>{if(r)try{let a=he(r.viewCountText),o=he(r.shortViewCountText),i=n.find(_=>_.id===r.videoId);/^\d/.test(o)||(o=i&&i.short_view_count_text||""),a=(/^\d/.test(a)?a:o).split(" ")[0];let u=r.shortBylineText.runs[0].navigationEndpoint.browseEndpoint,f=u.browseId,b=he(r.shortBylineText),h=(u.canonicalBaseUrl||"").split("/").slice(-1)[0],m={id:r.videoId,title:he(r.title),published:he(r.publishedTimeText),author:{id:f,name:b,user:h,channel_url:`https://www.youtube.com/channel/${f}`,user_url:`https://www.youtube.com/user/${h}`,thumbnails:r.channelThumbnail.thumbnails.map(_=>(_.url=new URL(_.url,lr).toString(),_)),verified:Bs(r.ownerBadges),[Symbol.toPrimitive](){return console.warn("`relatedVideo.author` will be removed in a near future release, use `relatedVideo.author.name` instead."),m.author.name}},short_view_count_text:o.split(" ")[0],view_count:a.replace(/,/g,""),length_seconds:r.lengthText?Math.floor(ed(he(r.lengthText))/1e3):n&&`${n.length_seconds}`,thumbnails:r.thumbnail.thumbnails,richThumbnails:r.richThumbnail?r.richThumbnail.movingThumbnailRenderer.movingThumbnailDetails.thumbnails:[],isLive:!!(r.badges&&r.badges.find(_=>_.metadataBadgeRenderer.label==="LIVE NOW"))};return Wt.deprecate(m,"author_thumbnail",m.author.thumbnails[0].url,"relatedVideo.author_thumbnail","relatedVideo.author.thumbnails[0].url"),Wt.deprecate(m,"ucid",m.author.id,"relatedVideo.ucid","relatedVideo.author.id"),Wt.deprecate(m,"video_thumbnail",m.thumbnails[0].url,"relatedVideo.video_thumbnail","relatedVideo.thumbnails[0].url"),m}catch{}};ct.getRelatedVideos=r=>{let n=[],a=[];try{n=r.response.webWatchNextResponseExtensionData.relatedVideoArgs.split(",").map(i=>Zc.parse(i))}catch{}try{a=r.response.contents.twoColumnWatchNextResults.secondaryResults.secondaryResults.results}catch{return[]}let o=[];for(let i of a||[]){let u=i.compactVideoRenderer;if(u){let f=Ds(u,n);f&&o.push(f)}else{let f=i.compactAutoplayRenderer||i.itemSectionRenderer;if(!f||!Array.isArray(f.contents))continue;for(let b of f.contents){let h=Ds(b.compactVideoRenderer,n);h&&o.push(h)}}}return o};ct.getLikes=r=>{try{let i=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(u=>u.videoPrimaryInfoRenderer).videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons.find(u=>u.toggleButtonRenderer&&u.toggleButtonRenderer.defaultIcon.iconType==="LIKE");return parseInt(i.toggleButtonRenderer.defaultText.accessibility.accessibilityData.label.replace(/\D+/g,""))}catch{return null}};ct.getDislikes=r=>{try{let i=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(u=>u.videoPrimaryInfoRenderer).videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons.find(u=>u.toggleButtonRenderer&&u.toggleButtonRenderer.defaultIcon.iconType==="DISLIKE");return parseInt(i.toggleButtonRenderer.defaultText.accessibility.accessibilityData.label.replace(/\D+/g,""))}catch{return null}};ct.cleanVideoDetails=(r,n)=>(r.thumbnails=r.thumbnail.thumbnails,delete r.thumbnail,Wt.deprecate(r,"thumbnail",{thumbnails:r.thumbnails},"videoDetails.thumbnail.thumbnails","videoDetails.thumbnails"),r.description=r.shortDescription||he(r.description),delete r.shortDescription,Wt.deprecate(r,"shortDescription",r.description,"videoDetails.shortDescription","videoDetails.description"),r.lengthSeconds=n.player_response.microformat&&n.player_response.microformat.playerMicroformatRenderer.lengthSeconds||n.player_response.videoDetails.lengthSeconds,r);ct.getStoryboards=r=>{let n=r.player_response.storyboards&&r.player_response.storyboards.playerStoryboardSpecRenderer&&r.player_response.storyboards.playerStoryboardSpecRenderer.spec&&r.player_response.storyboards.playerStoryboardSpecRenderer.spec.split("|");if(!n)return[];let a=new URL(n.shift());return n.map((o,i)=>{let[u,f,b,h,m,_,E,I]=o.split("#");a.searchParams.set("sigh",I),b=parseInt(b,10),h=parseInt(h,10),m=parseInt(m,10);let A=Math.ceil(b/(h*m));return{templateUrl:a.toString().replace("$L",i).replace("$N",E),thumbnailWidth:parseInt(u,10),thumbnailHeight:parseInt(f,10),thumbnailCount:b,interval:parseInt(_,10),columns:h,rows:m,storyboardCount:A}})};ct.getChapters=r=>{let n=r.response&&r.response.playerOverlays&&r.response.playerOverlays.playerOverlayRenderer,a=n&&n.decoratedPlayerBarRenderer&&n.decoratedPlayerBarRenderer.decoratedPlayerBarRenderer&&n.decoratedPlayerBarRenderer.decoratedPlayerBarRenderer.playerBar,o=a&&a.multiMarkersPlayerBarRenderer&&a.multiMarkersPlayerBarRenderer.markersMap,i=Array.isArray(o)&&o.find(f=>f.value&&Array.isArray(f.value.chapters));return i?i.value.chapters.map(f=>({title:he(f.chapterRenderer.title),start_time:f.chapterRenderer.timeRangeStartMillis/1e3})):[]}});var Ka=ie((th,Os)=>{var{setTimeout:td}=require("timers");Os.exports=class extends Map{constructor(n=1e3){super(),this.timeout=n}set(n,a){this.has(n)&&clearTimeout(super.get(n).tid),super.set(n,{tid:td(this.delete.bind(this,n),this.timeout).unref(),value:a})}get(n){let a=super.get(n);return a?a.value:null}getOrSet(n,a){if(this.has(n))return this.get(n);{let o=a();return this.set(n,o),(async()=>{try{await o}catch{this.delete(n)}})(),o}}delete(n){let a=super.get(n);a&&(clearTimeout(a.tid),super.delete(n))}clear(){for(let n of this.values())clearTimeout(n.tid);super.clear()}}});var Ja=ie($e=>{var rd=require("querystring"),nd=Ka(),Et=or(),ks=require("vm");$e.cache=new nd;$e.getFunctions=(r,n)=>$e.cache.getOrSet(r,async()=>{let a=await Et.exposedMiniget(r,n).text(),o=$e.extractFunctions(a);if(!o||!o.length)throw Error("Could not extract functions");return $e.cache.set(r,o),o});$e.extractFunctions=r=>{let n=[],a=u=>{let f=Et.between(u,'a=a.split("");',".");if(!f)return"";let b=`var ${f}={`,h=r.indexOf(b);if(h<0)return"";let m=r.slice(h+b.length-1);return`var ${f}=${Et.cutAfterJS(m)}`},o=()=>{let u=Et.between(r,'a.set("alr","yes");c&&(c=',"(decodeURIC");if(u&&u.length){let f=`${u}=function(a)`,b=r.indexOf(f);if(b>=0){let h=r.slice(b+f.length),m=`var ${f}${Et.cutAfterJS(h)}`;m=`${a(m)};${m};${u}(sig);`,n.push(m)}}},i=()=>{let u=Et.between(r,'&&(b=a.get("n"))&&(b=',"(b)");if(u.includes("[")&&(u=Et.between(r,`var ${u.split("[")[0]}=[`,"]")),u&&u.length){let f=`${u}=function(a)`,b=r.indexOf(f);if(b>=0){let h=r.slice(b+f.length),m=`var ${f}${Et.cutAfterJS(h)};${u}(ncode);`;n.push(m)}}};return o(),i(),n};$e.setDownloadURL=(r,n,a)=>{let o=b=>{let h=rd.parse(b);if(!h.s||!n)return h.url;let m=new URL(decodeURIComponent(h.url));return m.searchParams.set(h.sp?h.sp:"signature",n.runInNewContext({sig:decodeURIComponent(h.s)})),m.toString()},i=b=>{let h=new URL(decodeURIComponent(b)),m=h.searchParams.get("n");return!m||!a?b:(h.searchParams.set("n",a.runInNewContext({ncode:m})),h.toString())},u=!r.url,f=r.url||r.signatureCipher||r.cipher;r.url=i(u?o(f):f),delete r.signatureCipher,delete r.cipher};$e.decipherFormats=async(r,n,a)=>{let o={},i=await $e.getFunctions(n,a),u=i.length?new ks.Script(i[0]):null,f=i.length>1?new ks.Script(i[1]):null;return r.forEach(b=>{$e.setDownloadURL(b,u,f),o[b.url]=b}),o}});var Ms=ie(ce=>{var ad=require("querystring"),id=qa(),Fs=Br(),Fe=or(),{setTimeout:od}=require("timers"),qs=Ua(),kr=Va(),vt=Ls(),sd=Ja(),ri=Ka(),qr="https://www.youtube.com/watch?v=";ce.cache=new ri;ce.cookieCache=new ri(1e3*60*60*24);ce.watchPageCache=new ri;var ni="2.20210622.10.00",Ut=class extends Error{},ld=["support.google.com/youtube/?p=age_restrictions","youtube.com/t/community_guidelines"];ce.getBasicInfo=async(r,n)=>{n.IPv6Block&&(n.requestOptions=Object.assign({},n.requestOptions,{family:6,localAddress:Fe.getRandomIPv6(n.IPv6Block)}));let a=Object.assign({},Fs.defaultOptions,n.requestOptions);n.requestOptions=Object.assign({},n.requestOptions,{}),n.requestOptions.headers=Object.assign({},{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.101 Safari/537.36"},n.requestOptions.headers);let i=await pd([r,n],b=>{let h=Fe.playError(b.player_response,["ERROR"],Ut),m=ud(b.player_response);if(h||m)throw h||m;return b&&b.player_response&&(b.player_response.streamingData||cd(b.player_response)||dd(b.player_response))},a,[wd,_d,Ed]);Object.assign(i,{formats:vd(i.player_response),related_videos:vt.getRelatedVideos(i)});let u=vt.getMedia(i),f={author:vt.getAuthor(i),media:u,likes:vt.getLikes(i),dislikes:vt.getDislikes(i),age_restricted:!!(u&&ld.some(b=>Object.values(u).some(h=>typeof h=="string"&&h.includes(b)))),video_url:qr+r,storyboards:vt.getStoryboards(i),chapters:vt.getChapters(i)};return i.videoDetails=vt.cleanVideoDetails(Object.assign({},i.player_response&&i.player_response.microformat&&i.player_response.microformat.playerMicroformatRenderer,i.player_response&&i.player_response.videoDetails,f),i),i};var ud=r=>{let n=r&&r.playabilityStatus;return n&&n.status==="LOGIN_REQUIRED"&&n.messages&&n.messages.filter(a=>/This is a private video/.test(a)).length?new Ut(n.reason||n.messages&&n.messages[0]):null},cd=r=>{let n=r.playabilityStatus;return n&&n.status==="UNPLAYABLE"&&n.errorScreen&&n.errorScreen.playerLegacyDesktopYpcOfferRenderer},dd=r=>{let n=r.playabilityStatus;return n&&n.status==="LIVE_STREAM_OFFLINE"},Ns=(r,n)=>`${qr+r}&hl=${n.lang||"en"}`,ai=(r,n)=>{let a=Ns(r,n);return ce.watchPageCache.getOrSet(a,()=>Fe.exposedMiniget(a,n).text())},fd="https://www.youtube.com/embed/",md=(r,n)=>{let a=`${fd+r}?hl=${n.lang||"en"}`;return Fe.exposedMiniget(a,n).text()},ti=r=>{let n=/<script\s+src="([^"]+)"(?:\s+type="text\/javascript")?\s+name="player_ias\/base"\s*>|"jsUrl":"([^"]+)"/.exec(r);return n?n[1]||n[2]:null},hd=(r,n,a,o)=>ce.cookieCache.getOrSet(a,async()=>{let u=(await ai(r,n)).match(/(["'])ID_TOKEN\1[:,]\s?"([^"]+)"/);if(!u&&o)throw new Ut("Cookie header used in request, but unable to find YouTube identity token");return u&&u[2]}),pd=async(r,n,a,o)=>{let i;for(let u of o)try{let f=await bd(u,r.concat([i]),a);if(f.player_response&&(f.player_response.videoDetails=Za(i&&i.player_response&&i.player_response.videoDetails,f.player_response.videoDetails),f.player_response=Za(i&&i.player_response,f.player_response)),i=Za(i,f),n(i,!1))break}catch(f){if(f instanceof Ut||u===o[o.length-1])throw f}return i},Za=(r,n)=>{if(!r||!n)return r||n;for(let[a,o]of Object.entries(n))o!=null&&(r[a]=o);return r},bd=async(r,n,a)=>{let o=0,i;for(;o<=a.maxRetries;)try{i=await r(...n);break}catch(u){if(u instanceof Ut||u instanceof Fs.MinigetError&&u.statusCode<500||o>=a.maxRetries)throw u;let f=Math.min(++o*a.backoff.inc,a.backoff.max);await new Promise(b=>od(b,f))}return i},yd=/^[)\]}'\s]+/,ii=(r,n,a)=>{if(!a||typeof a=="object")return a;try{return a=a.replace(yd,""),JSON.parse(a)}catch(o){throw Error(`Error parsing ${n} in ${r}: ${o.message}`)}},ei=(r,n,a,o,i,u)=>{let f=Fe.between(a,o,i);if(!f)throw Error(`Could not find ${n} in ${r}`);return ii(r,n,Fe.cutAfterJS(`${u}${f}`))},oi=(r,n)=>{let a=n&&(n.args&&n.args.player_response||n.player_response||n.playerResponse||n.embedded_player_response);return ii(r,"player_response",a)},gd=(r,n)=>`${Ns(r,n)}&pbj=1`,_d=async(r,n)=>{let a=Object.assign({headers:{}},n.requestOptions),o=a.headers.Cookie||a.headers.cookie;a.headers=Object.assign({"x-youtube-client-name":"1","x-youtube-client-version":ni,"x-youtube-identity-token":ce.cookieCache.get(o||"browser")||""},a.headers);let i=async(m,_)=>{a.headers["x-youtube-identity-token"]||(a.headers["x-youtube-identity-token"]=await hd(r,n,m,_))};o&&await i(o,!0);let u=gd(r,n),f=await Fe.exposedMiniget(u,n,a).text(),b=ii("watch.json","body",f);if(b.reload==="now"&&await i("browser",!1),b.reload==="now"||!Array.isArray(b))throw Error("Unable to retrieve video metadata in watch.json");let h=b.reduce((m,_)=>Object.assign(_,m),{});return h.player_response=oi("watch.json",h),h.html5player=h.player&&h.player.assets&&h.player.assets.js,h},wd=async(r,n)=>{let a=await ai(r,n),o={page:"watch"};try{ni=Fe.between(a,'{"key":"cver","value":"','"}'),o.player_response=ei("watch.html","player_response",a,/\bytInitialPlayerResponse\s*=\s*\{/i,"</script>","{")}catch{let u=ei("watch.html","player_response",a,/\bytplayer\.config\s*=\s*{/,"</script>","{");o.player_response=oi("watch.html",u)}return o.response=ei("watch.html","response",a,/\bytInitialData("\])?\s*=\s*\{/i,"</script>","{"),o.html5player=ti(a),o},Sd="www.youtube.com",Td="/get_video_info",Rd="https://youtube.googleapis.com/v/",Ed=async(r,n)=>{let a=new URL(`https://${Sd}${Td}`);a.searchParams.set("video_id",r),a.searchParams.set("c","TVHTML5"),a.searchParams.set("cver",`7${ni.substr(1)}`),a.searchParams.set("eurl",Rd+r),a.searchParams.set("ps","default"),a.searchParams.set("gl","US"),a.searchParams.set("hl",n.lang||"en"),a.searchParams.set("html5","1");let o=await Fe.exposedMiniget(a.toString(),n).text(),i=ad.parse(o);return i.player_response=oi("get_video_info",i),i},vd=r=>{let n=[];return r&&r.streamingData&&(n=n.concat(r.streamingData.formats||[]).concat(r.streamingData.adaptiveFormats||[])),n};ce.getInfo=async(r,n)=>{let a=await ce.getBasicInfo(r,n),o=a.player_response&&a.player_response.streamingData&&(a.player_response.streamingData.dashManifestUrl||a.player_response.streamingData.hlsManifestUrl),i=[];if(a.formats.length){if(a.html5player=a.html5player||ti(await ai(r,n))||ti(await md(r,n)),!a.html5player)throw Error("Unable to find html5player file");let f=new URL(a.html5player,qr).toString();i.push(sd.decipherFormats(a.formats,f,n))}if(o&&a.player_response.streamingData.dashManifestUrl){let f=a.player_response.streamingData.dashManifestUrl;i.push(Ad(f,n))}if(o&&a.player_response.streamingData.hlsManifestUrl){let f=a.player_response.streamingData.hlsManifestUrl;i.push(Cd(f,n))}let u=await Promise.all(i);return a.formats=Object.values(Object.assign({},...u)),a.formats=a.formats.map(qs.addFormatMeta),a.formats.sort(qs.sortFormats),a.full=!0,a};var Ad=(r,n)=>new Promise((a,o)=>{let i={},u=id.parser(!1);u.onerror=o;let f;u.onopentag=h=>{if(h.name==="ADAPTATIONSET")f=h.attributes;else if(h.name==="REPRESENTATION"){let m=parseInt(h.attributes.ID);isNaN(m)||(i[r]=Object.assign({itag:m,url:r,bitrate:parseInt(h.attributes.BANDWIDTH),mimeType:`${f.MIMETYPE}; codecs="${h.attributes.CODECS}"`},h.attributes.HEIGHT?{width:parseInt(h.attributes.WIDTH),height:parseInt(h.attributes.HEIGHT),fps:parseInt(h.attributes.FRAMERATE)}:{audioSampleRate:h.attributes.AUDIOSAMPLINGRATE}))}},u.onend=()=>{a(i)};let b=Fe.exposedMiniget(new URL(r,qr).toString(),n);b.setEncoding("utf8"),b.on("error",o),b.on("data",h=>{u.write(h)}),b.on("end",u.close.bind(u))}),Cd=async(r,n)=>{r=new URL(r,qr);let a=await Fe.exposedMiniget(r.toString(),n).text(),o={};return a.split(`
`).filter(i=>/^https?:\/\//.test(i)).forEach(i=>{let u=parseInt(i.match(/\/itag\/(\d+)\//)[1]);o[i]={itag:u,url:i}}),o};for(let r of["getBasicInfo","getInfo"]){let n=ce[r];ce[r]=async(a,o={})=>{Fe.checkForUpdates();let i=await kr.getVideoID(a),u=[r,i,o.lang].join("-");return ce.cache.getOrSet(u,()=>n(i,o))}}ce.validateID=kr.validateID;ce.validateURL=kr.validateURL;ce.getURLVideoID=kr.getURLVideoID;ce.getVideoID=kr.getVideoID});var ui=ie((ah,$s)=>{var Pd=require("stream").PassThrough,Fr=Ms(),xs=or(),li=Ua(),kn=Va(),Id=Ja(),Ws=Br(),Dd=On(),{parseTimestamp:Bd}=On(),De=(r,n)=>{let a=Us(n);return De.getInfo(r,n).then(o=>{Vs(a,o,n)},a.emit.bind(a,"error")),a};$s.exports=De;De.getBasicInfo=Fr.getBasicInfo;De.getInfo=Fr.getInfo;De.chooseFormat=li.chooseFormat;De.filterFormats=li.filterFormats;De.validateID=kn.validateID;De.validateURL=kn.validateURL;De.getURLVideoID=kn.getURLVideoID;De.getVideoID=kn.getVideoID;De.cache={sig:Id.cache,info:Fr.cache,watch:Fr.watchPageCache,cookie:Fr.cookieCache};De.version=Na().version;var Us=r=>{let n=new Pd({highWaterMark:r&&r.highWaterMark||524288});return n._destroy=()=>{n.destroyed=!0},n},si=(r,n,a)=>{["abort","request","response","error","redirect","retry","reconnect"].forEach(o=>{r.prependListener(o,n.emit.bind(n,o))}),r.pipe(n,{end:a})},Vs=(r,n,a)=>{a=a||{};let o=xs.playError(n.player_response,["UNPLAYABLE","LIVE_STREAM_OFFLINE","LOGIN_REQUIRED"]);if(o){r.emit("error",o);return}if(!n.formats.length){r.emit("error",Error("This video is unavailable"));return}let i;try{i=li.chooseFormat(n.formats,a)}catch(E){r.emit("error",E);return}if(r.emit("info",n,i),r.destroyed)return;let u,f=0,b=E=>{f+=E.length,r.emit("progress",E.length,f,u)};a.IPv6Block&&(a.requestOptions=Object.assign({},a.requestOptions,{family:6,localAddress:xs.getRandomIPv6(a.IPv6Block)}));let h=a.dlChunkSize||1024*1024*10,m,_=!0;if(i.isHLS||i.isDashMPD)m=Dd(i.url,{chunkReadahead:+n.live_chunk_readahead,begin:a.begin||i.isLive&&Date.now(),liveBuffer:a.liveBuffer,requestOptions:a.requestOptions,parser:i.isDashMPD?"dash-mpd":"m3u8",id:i.itag}),m.on("progress",(E,I)=>{r.emit("progress",E.size,E.num,I)}),si(m,r,_);else{let E=Object.assign({},a.requestOptions,{maxReconnects:6,maxRetries:3,backoff:{inc:500,max:1e4}});if(h!==0&&(!i.hasAudio||!i.hasVideo)){let A=a.range&&a.range.start||0,R=A+h,q=a.range&&a.range.end;u=a.range?(q?q+1:parseInt(i.contentLength))-A:parseInt(i.contentLength);let O=()=>{!q&&R>=u&&(R=0),q&&R>q&&(R=q),_=!R||R===q,E.headers=Object.assign({},E.headers,{Range:`bytes=${A}-${R||""}`}),m=Ws(i.url,E),m.on("data",b),m.on("end",()=>{r.destroyed||R&&R!==q&&(A=R+1,R+=h,O())}),si(m,r,_)};O()}else a.begin&&(i.url+=`&begin=${Bd(a.begin)}`),a.range&&(a.range.start||a.range.end)&&(E.headers=Object.assign({},E.headers,{Range:`bytes=${a.range.start||"0"}-${a.range.end||""}`})),m=Ws(i.url,E),m.on("response",A=>{r.destroyed||(u=u||parseInt(A.headers["content-length"]))}),m.on("data",b),si(m,r,_)}r._destroy=()=>{r.destroyed=!0,m.destroy(),m.end()}};De.downloadFromInfo=(r,n)=>{let a=Us(n);if(!r.full)throw Error("Cannot use `ytdl.downloadFromInfo()` when called with info from `ytdl.getBasicInfo()`");return setImmediate(()=>{Vs(a,r,n)}),a}});var lf={};So(lf,{default:()=>ul});module.exports=Zu(lf);var ll=require("@raycast/api");var es=He(require("node:http"),1),ts=He(require("node:https"),1),xt=He(require("node:zlib"),1),Ie=He(require("node:stream"),1),Ir=require("node:buffer");function ec(r){if(!/^data:/i.test(r))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');r=r.replace(/\r?\n/g,"");let n=r.indexOf(",");if(n===-1||n<=4)throw new TypeError("malformed data: URI");let a=r.substring(5,n).split(";"),o="",i=!1,u=a[0]||"text/plain",f=u;for(let _=1;_<a.length;_++)a[_]==="base64"?i=!0:a[_]&&(f+=`;${a[_]}`,a[_].indexOf("charset=")===0&&(o=a[_].substring(8)));!a[0]&&!o.length&&(f+=";charset=US-ASCII",o="US-ASCII");let b=i?"base64":"ascii",h=unescape(r.substring(n+1)),m=Buffer.from(h,b);return m.type=u,m.typeFull=f,m.charset=o,m}var Ro=ec;var ke=He(require("node:stream"),1),ot=require("node:util"),Ce=require("node:buffer");Rr();gn();var it=class extends Error{constructor(n,a){super(n),Error.captureStackTrace(this,this.constructor),this.type=a}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var we=class extends it{constructor(n,a,o){super(n,a),o&&(this.code=this.errno=o.code,this.erroredSysCall=o.syscall)}};var _n=Symbol.toStringTag,_a=r=>typeof r=="object"&&typeof r.append=="function"&&typeof r.delete=="function"&&typeof r.get=="function"&&typeof r.getAll=="function"&&typeof r.has=="function"&&typeof r.set=="function"&&typeof r.sort=="function"&&r[_n]==="URLSearchParams",vr=r=>r&&typeof r=="object"&&typeof r.arrayBuffer=="function"&&typeof r.type=="string"&&typeof r.stream=="function"&&typeof r.constructor=="function"&&/^(Blob|File)$/.test(r[_n]),Lo=r=>typeof r=="object"&&(r[_n]==="AbortSignal"||r[_n]==="EventTarget"),Oo=(r,n)=>{let a=new URL(n).hostname,o=new URL(r).hostname;return a===o||a.endsWith(`.${o}`)},ko=(r,n)=>{let a=new URL(n).protocol,o=new URL(r).protocol;return a===o};var pc=(0,ot.promisify)(ke.default.pipeline),Se=Symbol("Body internals"),Ge=class{constructor(n,{size:a=0}={}){let o=null;n===null?n=null:_a(n)?n=Ce.Buffer.from(n.toString()):vr(n)||Ce.Buffer.isBuffer(n)||(ot.types.isAnyArrayBuffer(n)?n=Ce.Buffer.from(n):ArrayBuffer.isView(n)?n=Ce.Buffer.from(n.buffer,n.byteOffset,n.byteLength):n instanceof ke.default||(n instanceof Ft?(n=Bo(n),o=n.type.split("=")[1]):n=Ce.Buffer.from(String(n))));let i=n;Ce.Buffer.isBuffer(n)?i=ke.default.Readable.from(n):vr(n)&&(i=ke.default.Readable.from(n.stream())),this[Se]={body:n,stream:i,boundary:o,disturbed:!1,error:null},this.size=a,n instanceof ke.default&&n.on("error",u=>{let f=u instanceof it?u:new we(`Invalid response body while trying to fetch ${this.url}: ${u.message}`,"system",u);this[Se].error=f})}get body(){return this[Se].stream}get bodyUsed(){return this[Se].disturbed}async arrayBuffer(){let{buffer:n,byteOffset:a,byteLength:o}=await Ta(this);return n.slice(a,a+o)}async formData(){let n=this.headers.get("content-type");if(n.startsWith("application/x-www-form-urlencoded")){let o=new Ft,i=new URLSearchParams(await this.text());for(let[u,f]of i)o.append(u,f);return o}let{toFormData:a}=await Promise.resolve().then(()=>(xo(),Mo));return a(this.body,n)}async blob(){let n=this.headers&&this.headers.get("content-type")||this[Se].body&&this[Se].body.type||"",a=await this.arrayBuffer();return new at([a],{type:n})}async json(){let n=await this.text();return JSON.parse(n)}async text(){let n=await Ta(this);return new TextDecoder().decode(n)}buffer(){return Ta(this)}};Ge.prototype.buffer=(0,ot.deprecate)(Ge.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(Ge.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,ot.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});async function Ta(r){if(r[Se].disturbed)throw new TypeError(`body used already for: ${r.url}`);if(r[Se].disturbed=!0,r[Se].error)throw r[Se].error;let{body:n}=r;if(n===null)return Ce.Buffer.alloc(0);if(!(n instanceof ke.default))return Ce.Buffer.alloc(0);let a=[],o=0;try{for await(let i of n){if(r.size>0&&o+i.length>r.size){let u=new we(`content size at ${r.url} over limit: ${r.size}`,"max-size");throw n.destroy(u),u}o+=i.length,a.push(i)}}catch(i){throw i instanceof it?i:new we(`Invalid response body while trying to fetch ${r.url}: ${i.message}`,"system",i)}if(n.readableEnded===!0||n._readableState.ended===!0)try{return a.every(i=>typeof i=="string")?Ce.Buffer.from(a.join("")):Ce.Buffer.concat(a,o)}catch(i){throw new we(`Could not create Buffer from response body for ${r.url}: ${i.message}`,"system",i)}else throw new we(`Premature close of server response while trying to fetch ${r.url}`)}var rr=(r,n)=>{let a,o,{body:i}=r[Se];if(r.bodyUsed)throw new Error("cannot clone body after it is used");return i instanceof ke.default&&typeof i.getBoundary!="function"&&(a=new ke.PassThrough({highWaterMark:n}),o=new ke.PassThrough({highWaterMark:n}),i.pipe(a),i.pipe(o),r[Se].stream=a,i=o),i},bc=(0,ot.deprecate)(r=>r.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Rn=(r,n)=>r===null?null:typeof r=="string"?"text/plain;charset=UTF-8":_a(r)?"application/x-www-form-urlencoded;charset=UTF-8":vr(r)?r.type||null:Ce.Buffer.isBuffer(r)||ot.types.isAnyArrayBuffer(r)||ArrayBuffer.isView(r)?null:r instanceof Ft?`multipart/form-data; boundary=${n[Se].boundary}`:r&&typeof r.getBoundary=="function"?`multipart/form-data;boundary=${bc(r)}`:r instanceof ke.default?null:"text/plain;charset=UTF-8",Wo=r=>{let{body:n}=r[Se];return n===null?0:vr(n)?n.size:Ce.Buffer.isBuffer(n)?n.length:n&&typeof n.getLengthSync=="function"&&n.hasKnownLength&&n.hasKnownLength()?n.getLengthSync():null},Uo=async(r,{body:n})=>{n===null?r.end():await pc(n,r)};var Ra=require("node:util"),Cr=He(require("node:http"),1),En=typeof Cr.default.validateHeaderName=="function"?Cr.default.validateHeaderName:r=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(r)){let n=new TypeError(`Header name must be a valid HTTP token [${r}]`);throw Object.defineProperty(n,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),n}},Ea=typeof Cr.default.validateHeaderValue=="function"?Cr.default.validateHeaderValue:(r,n)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(n)){let a=new TypeError(`Invalid character in header content ["${r}"]`);throw Object.defineProperty(a,"code",{value:"ERR_INVALID_CHAR"}),a}},Pe=class r extends URLSearchParams{constructor(n){let a=[];if(n instanceof r){let o=n.raw();for(let[i,u]of Object.entries(o))a.push(...u.map(f=>[i,f]))}else if(n!=null)if(typeof n=="object"&&!Ra.types.isBoxedPrimitive(n)){let o=n[Symbol.iterator];if(o==null)a.push(...Object.entries(n));else{if(typeof o!="function")throw new TypeError("Header pairs must be iterable");a=[...n].map(i=>{if(typeof i!="object"||Ra.types.isBoxedPrimitive(i))throw new TypeError("Each header pair must be an iterable object");return[...i]}).map(i=>{if(i.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...i]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return a=a.length>0?a.map(([o,i])=>(En(o),Ea(o,String(i)),[String(o).toLowerCase(),String(i)])):void 0,super(a),new Proxy(this,{get(o,i,u){switch(i){case"append":case"set":return(f,b)=>(En(f),Ea(f,String(b)),URLSearchParams.prototype[i].call(o,String(f).toLowerCase(),String(b)));case"delete":case"has":case"getAll":return f=>(En(f),URLSearchParams.prototype[i].call(o,String(f).toLowerCase()));case"keys":return()=>(o.sort(),new Set(URLSearchParams.prototype.keys.call(o)).keys());default:return Reflect.get(o,i,u)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(n){let a=this.getAll(n);if(a.length===0)return null;let o=a.join(", ");return/^content-encoding$/i.test(n)&&(o=o.toLowerCase()),o}forEach(n,a=void 0){for(let o of this.keys())Reflect.apply(n,a,[this.get(o),o,this])}*values(){for(let n of this.keys())yield this.get(n)}*entries(){for(let n of this.keys())yield[n,this.get(n)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((n,a)=>(n[a]=this.getAll(a),n),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((n,a)=>{let o=this.getAll(a);return a==="host"?n[a]=o[0]:n[a]=o.length>1?o:o[0],n},{})}};Object.defineProperties(Pe.prototype,["get","entries","forEach","values"].reduce((r,n)=>(r[n]={enumerable:!0},r),{}));function Vo(r=[]){return new Pe(r.reduce((n,a,o,i)=>(o%2===0&&n.push(i.slice(o,o+2)),n),[]).filter(([n,a])=>{try{return En(n),Ea(n,String(a)),!0}catch{return!1}}))}var yc=new Set([301,302,303,307,308]),vn=r=>yc.has(r);var Ue=Symbol("Response internals"),qe=class r extends Ge{constructor(n=null,a={}){super(n,a);let o=a.status!=null?a.status:200,i=new Pe(a.headers);if(n!==null&&!i.has("Content-Type")){let u=Rn(n,this);u&&i.append("Content-Type",u)}this[Ue]={type:"default",url:a.url,status:o,statusText:a.statusText||"",headers:i,counter:a.counter,highWaterMark:a.highWaterMark}}get type(){return this[Ue].type}get url(){return this[Ue].url||""}get status(){return this[Ue].status}get ok(){return this[Ue].status>=200&&this[Ue].status<300}get redirected(){return this[Ue].counter>0}get statusText(){return this[Ue].statusText}get headers(){return this[Ue].headers}get highWaterMark(){return this[Ue].highWaterMark}clone(){return new r(rr(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(n,a=302){if(!vn(a))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new r(null,{headers:{location:new URL(n).toString()},status:a})}static error(){let n=new r(null,{status:0,statusText:""});return n[Ue].type="error",n}static json(n=void 0,a={}){let o=JSON.stringify(n);if(o===void 0)throw new TypeError("data is not JSON serializable");let i=new Pe(a&&a.headers);return i.has("content-type")||i.set("content-type","application/json"),new r(o,{...a,headers:i})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(qe.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var Ko=require("node:url"),Jo=require("node:util");var $o=r=>{if(r.search)return r.search;let n=r.href.length-1,a=r.hash||(r.href[n]==="#"?"#":"");return r.href[n-a.length]==="?"?"?":""};var jo=require("node:net");function zo(r,n=!1){return r==null||(r=new URL(r),/^(about|blob|data):$/.test(r.protocol))?"no-referrer":(r.username="",r.password="",r.hash="",n&&(r.pathname="",r.search=""),r)}var Ho=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),Qo="strict-origin-when-cross-origin";function Go(r){if(!Ho.has(r))throw new TypeError(`Invalid referrerPolicy: ${r}`);return r}function gc(r){if(/^(http|ws)s:$/.test(r.protocol))return!0;let n=r.host.replace(/(^\[)|(]$)/g,""),a=(0,jo.isIP)(n);return a===4&&/^127\./.test(n)||a===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(n)?!0:r.host==="localhost"||r.host.endsWith(".localhost")?!1:r.protocol==="file:"}function nr(r){return/^about:(blank|srcdoc)$/.test(r)||r.protocol==="data:"||/^(blob|filesystem):$/.test(r.protocol)?!0:gc(r)}function Yo(r,{referrerURLCallback:n,referrerOriginCallback:a}={}){if(r.referrer==="no-referrer"||r.referrerPolicy==="")return null;let o=r.referrerPolicy;if(r.referrer==="about:client")return"no-referrer";let i=r.referrer,u=zo(i),f=zo(i,!0);u.toString().length>4096&&(u=f),n&&(u=n(u)),a&&(f=a(f));let b=new URL(r.url);switch(o){case"no-referrer":return"no-referrer";case"origin":return f;case"unsafe-url":return u;case"strict-origin":return nr(u)&&!nr(b)?"no-referrer":f.toString();case"strict-origin-when-cross-origin":return u.origin===b.origin?u:nr(u)&&!nr(b)?"no-referrer":f;case"same-origin":return u.origin===b.origin?u:"no-referrer";case"origin-when-cross-origin":return u.origin===b.origin?u:f;case"no-referrer-when-downgrade":return nr(u)&&!nr(b)?"no-referrer":u;default:throw new TypeError(`Invalid referrerPolicy: ${o}`)}}function Xo(r){let n=(r.get("referrer-policy")||"").split(/[,\s]+/),a="";for(let o of n)o&&Ho.has(o)&&(a=o);return a}var ue=Symbol("Request internals"),Pr=r=>typeof r=="object"&&typeof r[ue]=="object",_c=(0,Jo.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),Mt=class r extends Ge{constructor(n,a={}){let o;if(Pr(n)?o=new URL(n.url):(o=new URL(n),n={}),o.username!==""||o.password!=="")throw new TypeError(`${o} is an url with embedded credentials.`);let i=a.method||n.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(i)&&(i=i.toUpperCase()),!Pr(a)&&"data"in a&&_c(),(a.body!=null||Pr(n)&&n.body!==null)&&(i==="GET"||i==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let u=a.body?a.body:Pr(n)&&n.body!==null?rr(n):null;super(u,{size:a.size||n.size||0});let f=new Pe(a.headers||n.headers||{});if(u!==null&&!f.has("Content-Type")){let m=Rn(u,this);m&&f.set("Content-Type",m)}let b=Pr(n)?n.signal:null;if("signal"in a&&(b=a.signal),b!=null&&!Lo(b))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let h=a.referrer==null?n.referrer:a.referrer;if(h==="")h="no-referrer";else if(h){let m=new URL(h);h=/^about:(\/\/)?client$/.test(m)?"client":m}else h=void 0;this[ue]={method:i,redirect:a.redirect||n.redirect||"follow",headers:f,parsedURL:o,signal:b,referrer:h},this.follow=a.follow===void 0?n.follow===void 0?20:n.follow:a.follow,this.compress=a.compress===void 0?n.compress===void 0?!0:n.compress:a.compress,this.counter=a.counter||n.counter||0,this.agent=a.agent||n.agent,this.highWaterMark=a.highWaterMark||n.highWaterMark||16384,this.insecureHTTPParser=a.insecureHTTPParser||n.insecureHTTPParser||!1,this.referrerPolicy=a.referrerPolicy||n.referrerPolicy||""}get method(){return this[ue].method}get url(){return(0,Ko.format)(this[ue].parsedURL)}get headers(){return this[ue].headers}get redirect(){return this[ue].redirect}get signal(){return this[ue].signal}get referrer(){if(this[ue].referrer==="no-referrer")return"";if(this[ue].referrer==="client")return"about:client";if(this[ue].referrer)return this[ue].referrer.toString()}get referrerPolicy(){return this[ue].referrerPolicy}set referrerPolicy(n){this[ue].referrerPolicy=Go(n)}clone(){return new r(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(Mt.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});var Zo=r=>{let{parsedURL:n}=r[ue],a=new Pe(r[ue].headers);a.has("Accept")||a.set("Accept","*/*");let o=null;if(r.body===null&&/^(post|put)$/i.test(r.method)&&(o="0"),r.body!==null){let b=Wo(r);typeof b=="number"&&!Number.isNaN(b)&&(o=String(b))}o&&a.set("Content-Length",o),r.referrerPolicy===""&&(r.referrerPolicy=Qo),r.referrer&&r.referrer!=="no-referrer"?r[ue].referrer=Yo(r):r[ue].referrer="no-referrer",r[ue].referrer instanceof URL&&a.set("Referer",r.referrer),a.has("User-Agent")||a.set("User-Agent","node-fetch"),r.compress&&!a.has("Accept-Encoding")&&a.set("Accept-Encoding","gzip, deflate, br");let{agent:i}=r;typeof i=="function"&&(i=i(n));let u=$o(n),f={path:n.pathname+u,method:r.method,headers:a[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:r.insecureHTTPParser,agent:i};return{parsedURL:n,options:f}};var An=class extends it{constructor(n,a="aborted"){super(n,a)}};gn();wa();var wc=new Set(["data:","http:","https:"]);async function Cn(r,n){return new Promise((a,o)=>{let i=new Mt(r,n),{parsedURL:u,options:f}=Zo(i);if(!wc.has(u.protocol))throw new TypeError(`node-fetch cannot load ${r}. URL scheme "${u.protocol.replace(/:$/,"")}" is not supported.`);if(u.protocol==="data:"){let R=Ro(i.url),q=new qe(R,{headers:{"Content-Type":R.typeFull}});a(q);return}let b=(u.protocol==="https:"?ts.default:es.default).request,{signal:h}=i,m=null,_=()=>{let R=new An("The operation was aborted.");o(R),i.body&&i.body instanceof Ie.default.Readable&&i.body.destroy(R),!(!m||!m.body)&&m.body.emit("error",R)};if(h&&h.aborted){_();return}let E=()=>{_(),A()},I=b(u.toString(),f);h&&h.addEventListener("abort",E);let A=()=>{I.abort(),h&&h.removeEventListener("abort",E)};I.on("error",R=>{o(new we(`request to ${i.url} failed, reason: ${R.message}`,"system",R)),A()}),Sc(I,R=>{m&&m.body&&m.body.destroy(R)}),process.version<"v14"&&I.on("socket",R=>{let q;R.prependListener("end",()=>{q=R._eventsCount}),R.prependListener("close",O=>{if(m&&q<R._eventsCount&&!O){let M=new Error("Premature close");M.code="ERR_STREAM_PREMATURE_CLOSE",m.body.emit("error",M)}})}),I.on("response",R=>{I.setTimeout(0);let q=Vo(R.rawHeaders);if(vn(R.statusCode)){let P=q.get("Location"),L=null;try{L=P===null?null:new URL(P,i.url)}catch{if(i.redirect!=="manual"){o(new we(`uri requested responds with an invalid redirect URL: ${P}`,"invalid-redirect")),A();return}}switch(i.redirect){case"error":o(new we(`uri requested responds with a redirect, redirect mode is set to error: ${i.url}`,"no-redirect")),A();return;case"manual":break;case"follow":{if(L===null)break;if(i.counter>=i.follow){o(new we(`maximum redirect reached at: ${i.url}`,"max-redirect")),A();return}let U={headers:new Pe(i.headers),follow:i.follow,counter:i.counter+1,agent:i.agent,compress:i.compress,method:i.method,body:rr(i),signal:i.signal,size:i.size,referrer:i.referrer,referrerPolicy:i.referrerPolicy};if(!Oo(i.url,L)||!ko(i.url,L))for(let y of["authorization","www-authenticate","cookie","cookie2"])U.headers.delete(y);if(R.statusCode!==303&&i.body&&n.body instanceof Ie.default.Readable){o(new we("Cannot follow redirect with body being a readable stream","unsupported-redirect")),A();return}(R.statusCode===303||(R.statusCode===301||R.statusCode===302)&&i.method==="POST")&&(U.method="GET",U.body=void 0,U.headers.delete("content-length"));let G=Xo(q);G&&(U.referrerPolicy=G),a(Cn(new Mt(L,U))),A();return}default:return o(new TypeError(`Redirect option '${i.redirect}' is not a valid value of RequestRedirect`))}}h&&R.once("end",()=>{h.removeEventListener("abort",E)});let O=(0,Ie.pipeline)(R,new Ie.PassThrough,P=>{P&&o(P)});process.version<"v12.10"&&R.on("aborted",E);let M={url:i.url,status:R.statusCode,statusText:R.statusMessage,headers:q,size:i.size,counter:i.counter,highWaterMark:i.highWaterMark},v=q.get("Content-Encoding");if(!i.compress||i.method==="HEAD"||v===null||R.statusCode===204||R.statusCode===304){m=new qe(O,M),a(m);return}let B={flush:xt.default.Z_SYNC_FLUSH,finishFlush:xt.default.Z_SYNC_FLUSH};if(v==="gzip"||v==="x-gzip"){O=(0,Ie.pipeline)(O,xt.default.createGunzip(B),P=>{P&&o(P)}),m=new qe(O,M),a(m);return}if(v==="deflate"||v==="x-deflate"){let P=(0,Ie.pipeline)(R,new Ie.PassThrough,L=>{L&&o(L)});P.once("data",L=>{(L[0]&15)===8?O=(0,Ie.pipeline)(O,xt.default.createInflate(),U=>{U&&o(U)}):O=(0,Ie.pipeline)(O,xt.default.createInflateRaw(),U=>{U&&o(U)}),m=new qe(O,M),a(m)}),P.once("end",()=>{m||(m=new qe(O,M),a(m))});return}if(v==="br"){O=(0,Ie.pipeline)(O,xt.default.createBrotliDecompress(),P=>{P&&o(P)}),m=new qe(O,M),a(m);return}m=new qe(O,M),a(m)}),Uo(I,i).catch(o)})}function Sc(r,n){let a=Ir.Buffer.from(`0\r
\r
`),o=!1,i=!1,u;r.on("response",f=>{let{headers:b}=f;o=b["transfer-encoding"]==="chunked"&&!b["content-length"]}),r.on("socket",f=>{let b=()=>{if(o&&!i){let m=new Error("Premature close");m.code="ERR_STREAM_PREMATURE_CLOSE",n(m)}},h=m=>{i=Ir.Buffer.compare(m.slice(-5),a)===0,!i&&u&&(i=Ir.Buffer.compare(u.slice(-3),a.slice(0,3))===0&&Ir.Buffer.compare(m.slice(-2),a.slice(3))===0),u=m};f.prependListener("close",b),f.on("data",h),r.on("close",()=>{f.removeListener("close",b),f.removeListener("data",h)})})}var At=require("react");var St=require("@raycast/api"),ns=require("react");var va={title:"\u{1F4A1}",message:"Summarizing video"},Aa={title:"\u{1F4DD}",message:"Video summarized!"},Pn={title:"\u{1F6A8}"},ar={title:"\u{1F50D}",message:"Answering your question"};var Ca={title:"\u{1F517}",message:"Checking video URL"},Pa={title:"\u{1F517}",message:"Checking Browser Extension"},Ia={title:"\u{1F517}",message:"Checking Clipboard"};function ir(){return`q-${Date.now()}`}function rs(r,n,a){return`Summarize the following transcription of a youtube video as a list of the most important points each starting with a fitting emoji. Ignore Sponsor Segments and Video Sponsors. Answer in ${r}.
  
  Format:

  [Emoji] [List Item] &nbsp;&nbsp;
  
  Here is the transcript: ${n.length>0?n:a}`}function In(r,n){return`The following text is the content of a video. Refer to it as video. You already summarized it for the person asking a question. Answer with a list starting with a fitting emoji. Ignore Sponsor Segments and Video Sponsors.
  
  Format:

  [Emoji] [List Item] &nbsp;&nbsp;
  
  Here is the transcript: ${n}. This is the question: ${r}`}function as({setQuestions:r,setQuestion:n,transcript:a,question:o}){let i=new AbortController,u=(0,St.getPreferenceValues)(),{creativity:f}=u;(0,ns.useEffect)(()=>((async()=>{if(!o||!a)return;let h=ir(),m=await(0,St.showToast)({style:St.Toast.Style.Animated,title:ar.title,message:ar.message}),_=St.AI.ask(In(o,a),{creativity:Number.parseInt(f,10),signal:i.signal});r(E=>[{id:h,question:o,answer:""},...E]),_.on("data",E=>{m.show(),r(I=>I.map(R=>R.id===h?{...R,answer:R.answer+E}:R))}),_.finally(async()=>{m.hide(),n("")}),i.signal.aborted})(),()=>{i.abort()}),[o,a,f,n,r])}var oe=require("@raycast/api"),is=require("react");var os=({transcript:r,setSummaryIsLoading:n,setSummary:a})=>{let o=new AbortController,i=(0,oe.getPreferenceValues)(),{creativity:u,language:f}=i;if(!oe.environment.canAccess(oe.AI)){(0,oe.showToast)({title:"No access to Raycast Pro",message:"Raycast Pro is required for this extension to work. You need Raycast Pro.",style:oe.Toast.Style.Failure}),(0,oe.popToRoot)();return}(0,is.useEffect)(()=>{if(!r)return;let b=rs(f,r,r),h=oe.AI.ask(b,{creativity:Number.parseInt(u),signal:o.signal});return n(!0),(0,oe.showToast)({style:oe.Toast.Style.Animated,title:va.title,message:va.message}),h.on("data",m=>{a(_=>_===void 0?m:_+m)}),h.finally(()=>{n(!1),(0,oe.showToast)({style:oe.Toast.Style.Success,title:Aa.title,message:Aa.message})}),h.catch(m=>{o.signal.aborted||(0,oe.showToast)({style:oe.Toast.Style.Failure,title:Pn.title,message:m.message})}),()=>{o.abort()}},[r,f,u,a,n])};var ls=require("@raycast/api");var lt=require("@raycast/api");var fe=require("@raycast/api"),Tt=require("react");var st=require("react/jsx-runtime");function Da({transcript:r,questions:n,onQuestionsUpdate:a}){let[o,i]=(0,Tt.useState)(""),[u,f]=(0,Tt.useState)(n[0]?.id??""),[b,h]=(0,Tt.useState)(n);(0,Tt.useEffect)(()=>{a&&a(b)},[b,a]);let m=(0,Tt.useCallback)(A=>{h(A)},[]),_=async()=>{if(!o)return;let A=ir(),R=o,q=await(0,fe.showToast)({style:fe.Toast.Style.Animated,title:ar.title,message:ar.message}),O=fe.AI.ask(In(R,r)),M=[{id:A,question:R,answer:""},...b];m(M),i("");let v=!0;O.on("data",B=>{v&&(q.show(),v=!1),h(P=>P.map(L=>L.id===A?{...L,answer:L.answer+B}:L))}),O.finally(()=>{q.hide(),f(A)})},E=()=>`${b.length?`Questions:
${b.map(R=>`Q: ${R.question}
A: ${R.answer}`).join(`

`)}`:""}`,I=()=>{let A=b.find(R=>R.id===u);return A?A.id===b[0]?.id?A.answer:`Q: ${A.question}
A: ${A.answer}`:""};return(0,st.jsx)(fe.List,{filtering:!1,isShowingDetail:!0,navigationTitle:"Additional Questions",onSearchTextChange:i,searchText:o,searchBarPlaceholder:"Ask another question",selectedItemId:u,searchBarAccessory:(0,st.jsxs)(fe.ActionPanel,{children:[(0,st.jsx)(fe.Action.SubmitForm,{onSubmit:_}),(0,st.jsx)(fe.Action.CopyToClipboard,{title:"Copy Selected Answer",content:I()}),(0,st.jsx)(fe.Action.CopyToClipboard,{title:"Copy All Q&A",content:E()})]}),children:b.map(A=>(0,st.jsx)(fe.List.Item,{title:A.question,detail:(0,st.jsx)(fe.List.Item.Detail,{markdown:A.answer}),id:A.id},A.id))})}var Rt=require("react/jsx-runtime");function Ba({transcript:r,summary:n,video_url:a,ownerProfileUrl:o,questions:i,onQuestionsUpdate:u}){return(0,Rt.jsxs)(lt.ActionPanel,{title:"Video Actions",children:[(0,Rt.jsx)(lt.Action.Push,{icon:lt.Icon.QuestionMark,title:"Ask Follow-Up Question",target:(0,Rt.jsx)(Da,{transcript:r,questions:i,onQuestionsUpdate:u})}),(0,Rt.jsx)(lt.Action.CopyToClipboard,{title:"Copy Summary",content:n??""}),(0,Rt.jsx)(lt.Action.OpenInBrowser,{title:"Go to Video",url:a}),(0,Rt.jsx)(lt.Action.OpenInBrowser,{title:"Go to Channel",url:o})]})}var Ye=require("@raycast/api");var ss=require("@raycast/api");var La=(i=>(i.summarizeVideoWithRaycast="Ray1",i.summarizeVideoWithAnthropic="Anthropic",i.summarizeVideoWithOpenAI="OpenAI",i.summarizeVideoWithOllama="Ollama",i))(La||{});var Dr=La[ss.environment.commandName];var Ve=require("react/jsx-runtime");function Oa({duration:r,ownerChannelName:n,ownerProfileUrl:a,publishDate:o,title:i,viewCount:u}){return(0,Ve.jsxs)(Ye.Detail.Metadata,{children:[(0,Ve.jsx)(Ye.Detail.Metadata.Label,{title:"Title",text:i}),(0,Ve.jsx)(Ye.Detail.Metadata.Link,{title:"Channel",target:a,text:n}),(0,Ve.jsx)(Ye.Detail.Metadata.Separator,{}),(0,Ve.jsx)(Ye.Detail.Metadata.Label,{title:"Published",text:o}),(0,Ve.jsx)(Ye.Detail.Metadata.Label,{title:"Duration",text:r}),(0,Ve.jsx)(Ye.Detail.Metadata.Label,{title:"Views",text:u}),(0,Ve.jsx)(Ye.Detail.Metadata.Separator,{}),(0,Ve.jsx)(Ye.Detail.Metadata.Label,{title:"AI Model",text:Dr})]})}var Dn=require("react/jsx-runtime");function ka({summary:r,summaryIsLoading:n,transcript:a,videoData:o,questions:i,onQuestionsUpdate:u}){if(!r)return null;let{duration:f,ownerChannelName:b,ownerProfileUrl:h,publishDate:m,title:_,video_url:E,viewCount:I}=o;return(0,Dn.jsx)(ls.Detail,{actions:(0,Dn.jsx)(Ba,{transcript:a,summary:r,video_url:E,ownerProfileUrl:h,questions:i,onQuestionsUpdate:u}),isLoading:n,markdown:r,metadata:(0,Dn.jsx)(Oa,{title:_,ownerChannelName:b,ownerProfileUrl:h,publishDate:m,duration:f,viewCount:I}),navigationTitle:o&&`${_} by ${b}`})}var se=require("@raycast/api"),zs=require("react"),qn=He(ui());var js=({input:r,setVideoURL:n})=>{(0,zs.useEffect)(()=>{(async()=>{if((0,se.showToast)({style:se.Toast.Style.Animated,title:Ca.title,message:Ca.message}),r&&qn.default.validateURL(r)){n(r);return}let o=await se.Clipboard.readText(),i=o&&qn.default.validateURL(o);if(!r&&i){(0,se.showToast)({style:se.Toast.Style.Animated,title:Ia.title,message:Ia.message}),n(o);return}if(!r&&se.environment.canAccess(se.BrowserExtension)){let f=(await se.BrowserExtension.getTabs()).find(b=>b.active&&qn.default.validateURL(b.url));if(f){(0,se.showToast)({style:se.Toast.Style.Animated,title:Pa.title,message:Pa.message}),n(f.url);return}}(0,se.showToast)({style:se.Toast.Style.Failure,title:"No video URL found",message:"Please provide a valid YouTube video URL or ID."}),(0,se.popToRoot)()})()},[r,n])};var Nr=require("@raycast/api"),Hs="youtube-summary-",Qs="youtube-summary-keys",Gs=()=>{let r=async o=>{let i=`${o.id}-${o.aiService}`;await Nr.LocalStorage.setItem(`${Hs}${i}`,JSON.stringify(o));let u=await a();u.includes(i)||(u.unshift(i),await Nr.LocalStorage.setItem(Qs,JSON.stringify(u)))},n=async()=>{let o=await a();return(await Promise.all(o.map(async u=>{let f=await Nr.LocalStorage.getItem(`${Hs}${u}`);if(!f)return null;let b=JSON.parse(f);return b.createdAt=new Date(b.createdAt),b}))).filter(u=>u!==null)},a=async()=>{let o=await Nr.LocalStorage.getItem(Qs);return o?JSON.parse(o):[]};return{addToHistory:r,getHistory:n}};var Mr=require("react");function Ys(r){let[n,a]=(0,Mr.useState)(""),[o,i]=(0,Mr.useState)([{id:ir(),question:"Initial Summary of the video",answer:r??""}]);return(0,Mr.useEffect)(()=>{r&&i(u=>[{...u[0],answer:r},...u.slice(1)])},[r]),{questions:o,setQuestions:i,question:n,setQuestion:a}}var Nn=require("@raycast/api"),xr=require("react");var Ld={};function Xs(){return Ld}var Od={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Ks=(r,n,a)=>{let o,i=Od[r];return typeof i=="string"?o=i:n===1?o=i.one:o=i.other.replace("{{count}}",n.toString()),a?.addSuffix?a.comparison&&a.comparison>0?"in "+o:o+" ago":o};function Fn(r){return(n={})=>{let a=n.width?String(n.width):r.defaultWidth;return r.formats[a]||r.formats[r.defaultWidth]}}var kd={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},qd={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Fd={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Js={date:Fn({formats:kd,defaultWidth:"full"}),time:Fn({formats:qd,defaultWidth:"full"}),dateTime:Fn({formats:Fd,defaultWidth:"full"})};var Nd={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Zs=(r,n,a,o)=>Nd[r];function ur(r){return(n,a)=>{let o=a?.context?String(a.context):"standalone",i;if(o==="formatting"&&r.formattingValues){let f=r.defaultFormattingWidth||r.defaultWidth,b=a?.width?String(a.width):f;i=r.formattingValues[b]||r.formattingValues[f]}else{let f=r.defaultWidth,b=a?.width?String(a.width):r.defaultWidth;i=r.values[b]||r.values[f]}let u=r.argumentCallback?r.argumentCallback(n):n;return i[u]}}var Md={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},xd={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Wd={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Ud={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Vd={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},$d={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},zd=(r,n)=>{let a=Number(r),o=a%100;if(o>20||o<10)switch(o%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},el={ordinalNumber:zd,era:ur({values:Md,defaultWidth:"wide"}),quarter:ur({values:xd,defaultWidth:"wide",argumentCallback:r=>r-1}),month:ur({values:Wd,defaultWidth:"wide"}),day:ur({values:Ud,defaultWidth:"wide"}),dayPeriod:ur({values:Vd,defaultWidth:"wide",formattingValues:$d,defaultFormattingWidth:"wide"})};function cr(r){return(n,a={})=>{let o=a.width,i=o&&r.matchPatterns[o]||r.matchPatterns[r.defaultMatchWidth],u=n.match(i);if(!u)return null;let f=u[0],b=o&&r.parsePatterns[o]||r.parsePatterns[r.defaultParseWidth],h=Array.isArray(b)?Hd(b,E=>E.test(f)):jd(b,E=>E.test(f)),m;m=r.valueCallback?r.valueCallback(h):h,m=a.valueCallback?a.valueCallback(m):m;let _=n.slice(f.length);return{value:m,rest:_}}}function jd(r,n){for(let a in r)if(Object.prototype.hasOwnProperty.call(r,a)&&n(r[a]))return a}function Hd(r,n){for(let a=0;a<r.length;a++)if(n(r[a]))return a}function tl(r){return(n,a={})=>{let o=n.match(r.matchPattern);if(!o)return null;let i=o[0],u=n.match(r.parsePattern);if(!u)return null;let f=r.valueCallback?r.valueCallback(u[0]):u[0];f=a.valueCallback?a.valueCallback(f):f;let b=n.slice(i.length);return{value:f,rest:b}}}var Qd=/^(\d+)(th|st|nd|rd)?/i,Gd=/\d+/i,Yd={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Xd={any:[/^b/i,/^(a|c)/i]},Kd={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Jd={any:[/1/i,/2/i,/3/i,/4/i]},Zd={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},ef={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},tf={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},rf={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},nf={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},af={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},rl={ordinalNumber:tl({matchPattern:Qd,parsePattern:Gd,valueCallback:r=>parseInt(r,10)}),era:cr({matchPatterns:Yd,defaultMatchWidth:"wide",parsePatterns:Xd,defaultParseWidth:"any"}),quarter:cr({matchPatterns:Kd,defaultMatchWidth:"wide",parsePatterns:Jd,defaultParseWidth:"any",valueCallback:r=>r+1}),month:cr({matchPatterns:Zd,defaultMatchWidth:"wide",parsePatterns:ef,defaultParseWidth:"any"}),day:cr({matchPatterns:tf,defaultMatchWidth:"wide",parsePatterns:rf,defaultParseWidth:"any"}),dayPeriod:cr({matchPatterns:nf,defaultMatchWidth:"any",parsePatterns:af,defaultParseWidth:"any"})};var ci={code:"en-US",formatDistance:Ks,formatLong:Js,formatRelative:Zs,localize:el,match:rl,options:{weekStartsOn:0,firstWeekContainsDate:1}};var of=["years","months","weeks","days","hours","minutes","seconds"];function nl(r,n){let a=Xs(),o=n?.locale??a.locale??ci,i=n?.format??of,u=n?.zero??!1,f=n?.delimiter??" ";return o.formatDistance?i.reduce((h,m)=>{let _=`x${m.replace(/(^.)/,I=>I.toUpperCase())}`,E=r[m];return E!==void 0&&(u||r[m])?h.concat(o.formatDistance(_,E)):h},[]).join(f):""}var al=He(ui());async function il(r){let n=await al.default.getBasicInfo(r),a=new Date(n.videoDetails.publishDate).toLocaleDateString(),o=Number(n.videoDetails.viewCount).toLocaleString(),i=Math.floor(Number(n.videoDetails.lengthSeconds)/3600),u=Math.floor(Number(n.videoDetails.lengthSeconds)%3600/60);return{duration:nl({hours:i,minutes:u},{format:["hours","minutes","seconds"]}),ownerChannelName:n.videoDetails.ownerChannelName,ownerProfileUrl:n.videoDetails.ownerProfileUrl,publishDate:a,thumbnail:n.videoDetails.thumbnails[4],title:n.videoDetails.title,video_url:n.videoDetails.video_url,viewCount:o,videoId:n.videoDetails.videoId}}var pe=require("@raycast/api");function sf(r){return r.includes("youtube.com/watch?v=")?r.split("v=")[1].split("&")[0]:r.includes("youtu.be/")?r.split("youtu.be/")[1].split("?")[0]:r}async function ol(r){try{let n=sf(r),a=`https://www.youtube.com/watch?v=${n}`,i=await(await fetch(a,{headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}})).text(),u=i.match(/"transcriptEndpoint":\{"getTranscriptEndpoint":\{"videoId":"[^"]+","params":"([^"]+)"/);if(u||(u=i.match(/"getTranscriptEndpoint":[^}]*"params":"([^"]+)"/)),!u){let P=i.match(/"params":"([A-Za-z0-9+/=%]{20,})"/g);if(P&&P.length>0){for(let L of P){let U=L.match(/"params":"([^"]+)"/);if(U){let G=U[1],y=i.indexOf(L),te=i.substring(Math.max(0,y-200),y),F=i.substring(y,Math.min(i.length,y+200));if(te.includes("transcript")||F.includes("transcript")||te.includes("caption")||F.includes("caption")){u=[L,G];break}}}if(!u){let L=P[0].match(/"params":"([^"]+)"/);L&&(u=[P[0],L[1]])}}}if(!u){(0,pe.showToast)({style:pe.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,pe.popToRoot)();return}let f=i.match(/"INNERTUBE_API_KEY":"([^"]+)"/),b=f?f[1]:"AIzaSyAO_FJ2SlqU8Q4STEHLGCilw_Y9_11qcW8",h=u[1],m=`https://www.youtube.com/youtubei/v1/get_transcript?key=${b}`,_={context:{client:{clientName:"WEB",clientVersion:"2.20240101.00.00"}},params:h},E=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Origin:"https://www.youtube.com",Referer:`https://www.youtube.com/watch?v=${n}`},body:JSON.stringify(_)});if(!E.ok)throw new Error(`Transcript API returned ${E.status}`);let M=(await E.json())?.actions?.[0]?.updateEngagementPanelAction?.content?.transcriptRenderer?.content,v=M?.transcriptBodyRenderer;if(!v){let P=M?.transcriptSearchPanelRenderer;v=P?.body?.transcriptSegmentListRenderer,v||(v=P?.footer)}if(!v?.cueGroups&&!v?.initialSegments){(0,pe.showToast)({style:pe.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,pe.popToRoot)();return}let B="";if(v.initialSegments?B=v.initialSegments.map(L=>L.transcriptSegmentRenderer?.snippet?.runs?.map(te=>te.text||"").join("")||"").join(" ").replace(/\s+/g," ").trim():v.cueGroups&&(B=v.cueGroups.map(L=>L.transcriptCueGroupRenderer?.cues?.map(y=>y.transcriptCueRenderer?.cue?.simpleText||"").join(" ")||"").join(" ").replace(/\s+/g," ").trim()),!B){(0,pe.showToast)({style:pe.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,pe.popToRoot)();return}return B}catch{(0,pe.showToast)({style:pe.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,pe.popToRoot)();return}}function sl(r){let[n,a]=(0,xr.useState)(),[o,i]=(0,xr.useState)();return(0,xr.useEffect)(()=>{r&&il(r).then(u=>(a(u),ol(r))).then(i).catch(u=>{(0,Nn.showToast)({style:Nn.Toast.Style.Failure,title:Pn.title,message:`Error fetching video data or transcript: ${u.message}`})})},[r]),{videoData:n,transcript:o}}var di=require("react/jsx-runtime");globalThis.fetch=Cn;function ul(r){let[n,a]=(0,At.useState)(),[o,i]=(0,At.useState)(!1),[u,f]=(0,At.useState)(r.arguments.video),{addToHistory:b}=Gs();js({input:r.arguments.video||r.launchContext?.video,setVideoURL:f});let{videoData:h,transcript:m}=sl(u),{questions:_,setQuestions:E,question:I,setQuestion:A}=Ys(n);os({transcript:m,setSummaryIsLoading:i,setSummary:a}),as({setQuestions:E,setQuestion:A,transcript:m,question:I});let[R,q]=(0,At.useState)(null);if((0,At.useEffect)(()=>{if(n&&h&&!R){let P={aiService:Dr,createdAt:new Date,id:h.videoId,questions:_,summary:n,title:h.title,videoUrl:u??""};b(P),q(h.videoId)}},[n,h,b,u,R,_]),(0,At.useEffect)(()=>{R&&_.length>0&&b({aiService:Dr,createdAt:new Date,id:R,questions:_,summary:n||"",title:h?.title||"",videoUrl:u??""})},[_,R,b,n,h,u]),!h||!m)return(0,di.jsx)(ll.List,{isLoading:!0});let{thumbnail:O,title:M}=h,v=n?`${n}

![${M}](${O?.url})
  `:void 0;return(0,di.jsx)(ka,{questions:_,summary:v,summaryIsLoading:o,transcript:m,videoData:h,onQuestionsUpdate:P=>{E(P)}})}
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

sax/lib/sax.js:
  (*! http://mths.be/fromcodepoint v0.1.0 by @mathias *)
*/
