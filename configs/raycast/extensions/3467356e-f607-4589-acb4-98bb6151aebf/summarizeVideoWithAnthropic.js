"use strict";var Bf=Object.create;var xi=Object.defineProperty;var Lf=Object.getOwnPropertyDescriptor;var Ff=Object.getOwnPropertyNames;var qf=Object.getPrototypeOf,Nf=Object.prototype.hasOwnProperty;var wn=(r,e)=>()=>(r&&(e=r(r=0)),e);var ce=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Cl=(r,e)=>{for(var t in e)xi(r,t,{get:e[t],enumerable:!0})},Il=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Ff(e))!Nf.call(r,o)&&o!==t&&xi(r,o,{get:()=>e[o],enumerable:!(i=Lf(e,o))||i.enumerable});return r};var lt=(r,e,t)=>(t=r!=null?Bf(qf(r)):{},Il(e||!r||!r.__esModule?xi(t,"default",{value:r,enumerable:!0}):t,r)),Uf=r=>Il(xi({},"__esModule",{value:!0}),r);var Dl=ce((Di,xl)=>{(function(r,e){typeof Di=="object"&&typeof xl<"u"?e(Di):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.WebStreamsPolyfill={}))})(Di,(function(r){"use strict";function e(){}function t(n){return typeof n=="object"&&n!==null||typeof n=="function"}let i=e;function o(n,a){try{Object.defineProperty(n,"name",{value:a,configurable:!0})}catch{}}let s=Promise,u=Promise.prototype.then,h=Promise.reject.bind(s);function p(n){return new s(n)}function m(n){return p(a=>a(n))}function y(n){return h(n)}function v(n,a,l){return u.call(n,a,l)}function C(n,a,l){v(v(n,a,l),void 0,i)}function E(n,a){C(n,a)}function R(n,a){C(n,void 0,a)}function B(n,a,l){return v(n,a,l)}function x(n){v(n,void 0,i)}let L=n=>{if(typeof queueMicrotask=="function")L=queueMicrotask;else{let a=m(void 0);L=l=>v(a,l)}return L(n)};function P(n,a,l){if(typeof n!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(n,a,l)}function D(n,a,l){try{return m(P(n,a,l))}catch(f){return y(f)}}let k=16384;class M{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(a){let l=this._back,f=l;l._elements.length===k-1&&(f={_elements:[],_next:void 0}),l._elements.push(a),f!==l&&(this._back=f,l._next=f),++this._size}shift(){let a=this._front,l=a,f=this._cursor,b=f+1,w=a._elements,S=w[f];return b===k&&(l=a._next,b=0),--this._size,this._cursor=b,a!==l&&(this._front=l),w[f]=void 0,S}forEach(a){let l=this._cursor,f=this._front,b=f._elements;for(;(l!==b.length||f._next!==void 0)&&!(l===b.length&&(f=f._next,b=f._elements,l=0,b.length===0));)a(b[l]),++l}peek(){let a=this._front,l=this._cursor;return a._elements[l]}}let j=Symbol("[[AbortSteps]]"),G=Symbol("[[ErrorSteps]]"),g=Symbol("[[CancelSteps]]"),ae=Symbol("[[PullSteps]]"),q=Symbol("[[ReleaseSteps]]");function O(n,a){n._ownerReadableStream=a,a._reader=n,a._state==="readable"?Ae(n):a._state==="closed"?F(n):U(n,a._storedError)}function Y(n,a){let l=n._ownerReadableStream;return tt(l,a)}function ee(n){let a=n._ownerReadableStream;a._state==="readable"?se(n,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):Ot(n,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),a._readableStreamController[q](),a._reader=void 0,n._ownerReadableStream=void 0}function Z(n){return new TypeError("Cannot "+n+" a stream using a released reader")}function Ae(n){n._closedPromise=p((a,l)=>{n._closedPromise_resolve=a,n._closedPromise_reject=l})}function U(n,a){Ae(n),se(n,a)}function F(n){Ae(n),at(n)}function se(n,a){n._closedPromise_reject!==void 0&&(x(n._closedPromise),n._closedPromise_reject(a),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0)}function Ot(n,a){U(n,a)}function at(n){n._closedPromise_resolve!==void 0&&(n._closedPromise_resolve(void 0),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0)}let Rr=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},Eo=Math.trunc||function(n){return n<0?Math.ceil(n):Math.floor(n)};function ri(n){return typeof n=="object"||typeof n=="function"}function Me(n,a){if(n!==void 0&&!ri(n))throw new TypeError(`${a} is not an object.`)}function ve(n,a){if(typeof n!="function")throw new TypeError(`${a} is not a function.`)}function d(n){return typeof n=="object"&&n!==null||typeof n=="function"}function c(n,a){if(!d(n))throw new TypeError(`${a} is not an object.`)}function T(n,a,l){if(n===void 0)throw new TypeError(`Parameter ${a} is required in '${l}'.`)}function _(n,a,l){if(n===void 0)throw new TypeError(`${a} is required in '${l}'.`)}function J(n){return Number(n)}function oe(n){return n===0?0:n}function le(n){return oe(Eo(n))}function he(n,a){let f=Number.MAX_SAFE_INTEGER,b=Number(n);if(b=oe(b),!Rr(b))throw new TypeError(`${a} is not a finite number`);if(b=le(b),b<0||b>f)throw new TypeError(`${a} is outside the accepted range of 0 to ${f}, inclusive`);return!Rr(b)||b===0?0:b}function Pe(n,a){if(!Nt(n))throw new TypeError(`${a} is not a ReadableStream.`)}function Oe(n){return new je(n)}function ue(n,a){n._reader._readRequests.push(a)}function Be(n,a,l){let b=n._reader._readRequests.shift();l?b._closeSteps():b._chunkSteps(a)}function Tr(n){return n._reader._readRequests.length}function un(n){let a=n._reader;return!(a===void 0||!Ze(a))}class je{constructor(a){if(T(a,1,"ReadableStreamDefaultReader"),Pe(a,"First parameter"),Ut(a))throw new TypeError("This stream has already been locked for exclusive reading by another reader");O(this,a),this._readRequests=new M}get closed(){return Ze(this)?this._closedPromise:y(ni("closed"))}cancel(a=void 0){return Ze(this)?this._ownerReadableStream===void 0?y(Z("cancel")):Y(this,a):y(ni("cancel"))}read(){if(!Ze(this))return y(ni("read"));if(this._ownerReadableStream===void 0)return y(Z("read from"));let a,l,f=p((w,S)=>{a=w,l=S});return cn(this,{_chunkSteps:w=>a({value:w,done:!1}),_closeSteps:()=>a({value:void 0,done:!0}),_errorSteps:w=>l(w)}),f}releaseLock(){if(!Ze(this))throw ni("releaseLock");this._ownerReadableStream!==void 0&&Xc(this)}}Object.defineProperties(je.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),o(je.prototype.cancel,"cancel"),o(je.prototype.read,"read"),o(je.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(je.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Ze(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_readRequests")?!1:n instanceof je}function cn(n,a){let l=n._ownerReadableStream;l._disturbed=!0,l._state==="closed"?a._closeSteps():l._state==="errored"?a._errorSteps(l._storedError):l._readableStreamController[ae](a)}function Xc(n){ee(n);let a=new TypeError("Reader was released");ws(n,a)}function ws(n,a){let l=n._readRequests;n._readRequests=new M,l.forEach(f=>{f._errorSteps(a)})}function ni(n){return new TypeError(`ReadableStreamDefaultReader.prototype.${n} can only be used on a ReadableStreamDefaultReader`)}let Jc=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class Ss{constructor(a,l){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=a,this._preventCancel=l}next(){let a=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?B(this._ongoingPromise,a,a):a(),this._ongoingPromise}return(a){let l=()=>this._returnSteps(a);return this._ongoingPromise?B(this._ongoingPromise,l,l):l()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let a=this._reader,l,f,b=p((S,I)=>{l=S,f=I});return cn(a,{_chunkSteps:S=>{this._ongoingPromise=void 0,L(()=>l({value:S,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,ee(a),l({value:void 0,done:!0})},_errorSteps:S=>{this._ongoingPromise=void 0,this._isFinished=!0,ee(a),f(S)}}),b}_returnSteps(a){if(this._isFinished)return Promise.resolve({value:a,done:!0});this._isFinished=!0;let l=this._reader;if(!this._preventCancel){let f=Y(l,a);return ee(l),B(f,()=>({value:a,done:!0}))}return ee(l),m({value:a,done:!0})}}let Rs={next(){return Ts(this)?this._asyncIteratorImpl.next():y(Es("next"))},return(n){return Ts(this)?this._asyncIteratorImpl.return(n):y(Es("return"))}};Object.setPrototypeOf(Rs,Jc);function Kc(n,a){let l=Oe(n),f=new Ss(l,a),b=Object.create(Rs);return b._asyncIteratorImpl=f,b}function Ts(n){if(!t(n)||!Object.prototype.hasOwnProperty.call(n,"_asyncIteratorImpl"))return!1;try{return n._asyncIteratorImpl instanceof Ss}catch{return!1}}function Es(n){return new TypeError(`ReadableStreamAsyncIterator.${n} can only be used on a ReadableSteamAsyncIterator`)}let As=Number.isNaN||function(n){return n!==n};var Ao,vo,Po;function dn(n){return n.slice()}function vs(n,a,l,f,b){new Uint8Array(n).set(new Uint8Array(l,f,b),a)}let bt=n=>(typeof n.transfer=="function"?bt=a=>a.transfer():typeof structuredClone=="function"?bt=a=>structuredClone(a,{transfer:[a]}):bt=a=>a,bt(n)),Bt=n=>(typeof n.detached=="boolean"?Bt=a=>a.detached:Bt=a=>a.byteLength===0,Bt(n));function Ps(n,a,l){if(n.slice)return n.slice(a,l);let f=l-a,b=new ArrayBuffer(f);return vs(b,0,n,a,f),b}function ii(n,a){let l=n[a];if(l!=null){if(typeof l!="function")throw new TypeError(`${String(a)} is not a function`);return l}}function Zc(n){let a={[Symbol.iterator]:()=>n.iterator},l=(async function*(){return yield*a})(),f=l.next;return{iterator:l,nextMethod:f,done:!1}}let Co=(Po=(Ao=Symbol.asyncIterator)!==null&&Ao!==void 0?Ao:(vo=Symbol.for)===null||vo===void 0?void 0:vo.call(Symbol,"Symbol.asyncIterator"))!==null&&Po!==void 0?Po:"@@asyncIterator";function Cs(n,a="sync",l){if(l===void 0)if(a==="async"){if(l=ii(n,Co),l===void 0){let w=ii(n,Symbol.iterator),S=Cs(n,"sync",w);return Zc(S)}}else l=ii(n,Symbol.iterator);if(l===void 0)throw new TypeError("The object is not iterable");let f=P(l,n,[]);if(!t(f))throw new TypeError("The iterator method must return an object");let b=f.next;return{iterator:f,nextMethod:b,done:!1}}function ed(n){let a=P(n.nextMethod,n.iterator,[]);if(!t(a))throw new TypeError("The iterator.next() method must return an object");return a}function td(n){return!!n.done}function rd(n){return n.value}function nd(n){return!(typeof n!="number"||As(n)||n<0)}function Is(n){let a=Ps(n.buffer,n.byteOffset,n.byteOffset+n.byteLength);return new Uint8Array(a)}function Io(n){let a=n._queue.shift();return n._queueTotalSize-=a.size,n._queueTotalSize<0&&(n._queueTotalSize=0),a.value}function ko(n,a,l){if(!nd(l)||l===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");n._queue.push({value:a,size:l}),n._queueTotalSize+=l}function id(n){return n._queue.peek().value}function Lt(n){n._queue=new M,n._queueTotalSize=0}function ks(n){return n===DataView}function od(n){return ks(n.constructor)}function ad(n){return ks(n)?1:n.BYTES_PER_ELEMENT}class er{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!xo(this))throw Lo("view");return this._view}respond(a){if(!xo(this))throw Lo("respond");if(T(a,1,"respond"),a=he(a,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Bt(this._view.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");li(this._associatedReadableByteStreamController,a)}respondWithNewView(a){if(!xo(this))throw Lo("respondWithNewView");if(T(a,1,"respondWithNewView"),!ArrayBuffer.isView(a))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");if(Bt(a.buffer))throw new TypeError("The given view's buffer has been detached and so cannot be used as a response");ui(this._associatedReadableByteStreamController,a)}}Object.defineProperties(er.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),o(er.prototype.respond,"respond"),o(er.prototype.respondWithNewView,"respondWithNewView"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(er.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class gt{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!tr(this))throw hn("byobRequest");return Bo(this)}get desiredSize(){if(!tr(this))throw hn("desiredSize");return Us(this)}close(){if(!tr(this))throw hn("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let a=this._controlledReadableByteStream._state;if(a!=="readable")throw new TypeError(`The stream (in ${a} state) is not in the readable state and cannot be closed`);fn(this)}enqueue(a){if(!tr(this))throw hn("enqueue");if(T(a,1,"enqueue"),!ArrayBuffer.isView(a))throw new TypeError("chunk must be an array buffer view");if(a.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(a.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let l=this._controlledReadableByteStream._state;if(l!=="readable")throw new TypeError(`The stream (in ${l} state) is not in the readable state and cannot be enqueued to`);si(this,a)}error(a=void 0){if(!tr(this))throw hn("error");He(this,a)}[g](a){xs(this),Lt(this);let l=this._cancelAlgorithm(a);return ai(this),l}[ae](a){let l=this._controlledReadableByteStream;if(this._queueTotalSize>0){Ns(this,a);return}let f=this._autoAllocateChunkSize;if(f!==void 0){let b;try{b=new ArrayBuffer(f)}catch(S){a._errorSteps(S);return}let w={buffer:b,bufferByteLength:f,byteOffset:0,byteLength:f,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(w)}ue(l,a),rr(this)}[q](){if(this._pendingPullIntos.length>0){let a=this._pendingPullIntos.peek();a.readerType="none",this._pendingPullIntos=new M,this._pendingPullIntos.push(a)}}}Object.defineProperties(gt.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),o(gt.prototype.close,"close"),o(gt.prototype.enqueue,"enqueue"),o(gt.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(gt.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function tr(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledReadableByteStream")?!1:n instanceof gt}function xo(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_associatedReadableByteStreamController")?!1:n instanceof er}function rr(n){if(!dd(n))return;if(n._pulling){n._pullAgain=!0;return}n._pulling=!0;let l=n._pullAlgorithm();C(l,()=>(n._pulling=!1,n._pullAgain&&(n._pullAgain=!1,rr(n)),null),f=>(He(n,f),null))}function xs(n){Mo(n),n._pendingPullIntos=new M}function Do(n,a){let l=!1;n._state==="closed"&&(l=!0);let f=Ds(a);a.readerType==="default"?Be(n,f,l):gd(n,f,l)}function Ds(n){let a=n.bytesFilled,l=n.elementSize;return new n.viewConstructor(n.buffer,n.byteOffset,a/l)}function oi(n,a,l,f){n._queue.push({buffer:a,byteOffset:l,byteLength:f}),n._queueTotalSize+=f}function Ms(n,a,l,f){let b;try{b=Ps(a,l,l+f)}catch(w){throw He(n,w),w}oi(n,b,0,f)}function Os(n,a){a.bytesFilled>0&&Ms(n,a.buffer,a.byteOffset,a.bytesFilled),Er(n)}function Bs(n,a){let l=Math.min(n._queueTotalSize,a.byteLength-a.bytesFilled),f=a.bytesFilled+l,b=l,w=!1,S=f%a.elementSize,I=f-S;I>=a.minimumFill&&(b=I-a.bytesFilled,w=!0);let V=n._queue;for(;b>0;){let N=V.peek(),z=Math.min(b,N.byteLength),Q=a.byteOffset+a.bytesFilled;vs(a.buffer,Q,N.buffer,N.byteOffset,z),N.byteLength===z?V.shift():(N.byteOffset+=z,N.byteLength-=z),n._queueTotalSize-=z,Ls(n,z,a),b-=z}return w}function Ls(n,a,l){l.bytesFilled+=a}function Fs(n){n._queueTotalSize===0&&n._closeRequested?(ai(n),_n(n._controlledReadableByteStream)):rr(n)}function Mo(n){n._byobRequest!==null&&(n._byobRequest._associatedReadableByteStreamController=void 0,n._byobRequest._view=null,n._byobRequest=null)}function Oo(n){for(;n._pendingPullIntos.length>0;){if(n._queueTotalSize===0)return;let a=n._pendingPullIntos.peek();Bs(n,a)&&(Er(n),Do(n._controlledReadableByteStream,a))}}function sd(n){let a=n._controlledReadableByteStream._reader;for(;a._readRequests.length>0;){if(n._queueTotalSize===0)return;let l=a._readRequests.shift();Ns(n,l)}}function ld(n,a,l,f){let b=n._controlledReadableByteStream,w=a.constructor,S=ad(w),{byteOffset:I,byteLength:V}=a,N=l*S,z;try{z=bt(a.buffer)}catch(te){f._errorSteps(te);return}let Q={buffer:z,bufferByteLength:z.byteLength,byteOffset:I,byteLength:V,bytesFilled:0,minimumFill:N,elementSize:S,viewConstructor:w,readerType:"byob"};if(n._pendingPullIntos.length>0){n._pendingPullIntos.push(Q),js(b,f);return}if(b._state==="closed"){let te=new w(Q.buffer,Q.byteOffset,0);f._closeSteps(te);return}if(n._queueTotalSize>0){if(Bs(n,Q)){let te=Ds(Q);Fs(n),f._chunkSteps(te);return}if(n._closeRequested){let te=new TypeError("Insufficient bytes to fill elements in the given buffer");He(n,te),f._errorSteps(te);return}}n._pendingPullIntos.push(Q),js(b,f),rr(n)}function ud(n,a){a.readerType==="none"&&Er(n);let l=n._controlledReadableByteStream;if(Fo(l))for(;Hs(l)>0;){let f=Er(n);Do(l,f)}}function cd(n,a,l){if(Ls(n,a,l),l.readerType==="none"){Os(n,l),Oo(n);return}if(l.bytesFilled<l.minimumFill)return;Er(n);let f=l.bytesFilled%l.elementSize;if(f>0){let b=l.byteOffset+l.bytesFilled;Ms(n,l.buffer,b-f,f)}l.bytesFilled-=f,Do(n._controlledReadableByteStream,l),Oo(n)}function qs(n,a){let l=n._pendingPullIntos.peek();Mo(n),n._controlledReadableByteStream._state==="closed"?ud(n,l):cd(n,a,l),rr(n)}function Er(n){return n._pendingPullIntos.shift()}function dd(n){let a=n._controlledReadableByteStream;return a._state!=="readable"||n._closeRequested||!n._started?!1:!!(un(a)&&Tr(a)>0||Fo(a)&&Hs(a)>0||Us(n)>0)}function ai(n){n._pullAlgorithm=void 0,n._cancelAlgorithm=void 0}function fn(n){let a=n._controlledReadableByteStream;if(!(n._closeRequested||a._state!=="readable")){if(n._queueTotalSize>0){n._closeRequested=!0;return}if(n._pendingPullIntos.length>0){let l=n._pendingPullIntos.peek();if(l.bytesFilled%l.elementSize!==0){let f=new TypeError("Insufficient bytes to fill elements in the given buffer");throw He(n,f),f}}ai(n),_n(a)}}function si(n,a){let l=n._controlledReadableByteStream;if(n._closeRequested||l._state!=="readable")return;let{buffer:f,byteOffset:b,byteLength:w}=a;if(Bt(f))throw new TypeError("chunk's buffer is detached and so cannot be enqueued");let S=bt(f);if(n._pendingPullIntos.length>0){let I=n._pendingPullIntos.peek();if(Bt(I.buffer))throw new TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");Mo(n),I.buffer=bt(I.buffer),I.readerType==="none"&&Os(n,I)}if(un(l))if(sd(n),Tr(l)===0)oi(n,S,b,w);else{n._pendingPullIntos.length>0&&Er(n);let I=new Uint8Array(S,b,w);Be(l,I,!1)}else Fo(l)?(oi(n,S,b,w),Oo(n)):oi(n,S,b,w);rr(n)}function He(n,a){let l=n._controlledReadableByteStream;l._state==="readable"&&(xs(n),Lt(n),ai(n),ml(l,a))}function Ns(n,a){let l=n._queue.shift();n._queueTotalSize-=l.byteLength,Fs(n);let f=new Uint8Array(l.buffer,l.byteOffset,l.byteLength);a._chunkSteps(f)}function Bo(n){if(n._byobRequest===null&&n._pendingPullIntos.length>0){let a=n._pendingPullIntos.peek(),l=new Uint8Array(a.buffer,a.byteOffset+a.bytesFilled,a.byteLength-a.bytesFilled),f=Object.create(er.prototype);hd(f,n,l),n._byobRequest=f}return n._byobRequest}function Us(n){let a=n._controlledReadableByteStream._state;return a==="errored"?null:a==="closed"?0:n._strategyHWM-n._queueTotalSize}function li(n,a){let l=n._pendingPullIntos.peek();if(n._controlledReadableByteStream._state==="closed"){if(a!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(a===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(l.bytesFilled+a>l.byteLength)throw new RangeError("bytesWritten out of range")}l.buffer=bt(l.buffer),qs(n,a)}function ui(n,a){let l=n._pendingPullIntos.peek();if(n._controlledReadableByteStream._state==="closed"){if(a.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(a.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(l.byteOffset+l.bytesFilled!==a.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(l.bufferByteLength!==a.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(l.bytesFilled+a.byteLength>l.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");let b=a.byteLength;l.buffer=bt(a.buffer),qs(n,b)}function Ws(n,a,l,f,b,w,S){a._controlledReadableByteStream=n,a._pullAgain=!1,a._pulling=!1,a._byobRequest=null,a._queue=a._queueTotalSize=void 0,Lt(a),a._closeRequested=!1,a._started=!1,a._strategyHWM=w,a._pullAlgorithm=f,a._cancelAlgorithm=b,a._autoAllocateChunkSize=S,a._pendingPullIntos=new M,n._readableStreamController=a;let I=l();C(m(I),()=>(a._started=!0,rr(a),null),V=>(He(a,V),null))}function fd(n,a,l){let f=Object.create(gt.prototype),b,w,S;a.start!==void 0?b=()=>a.start(f):b=()=>{},a.pull!==void 0?w=()=>a.pull(f):w=()=>m(void 0),a.cancel!==void 0?S=V=>a.cancel(V):S=()=>m(void 0);let I=a.autoAllocateChunkSize;if(I===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Ws(n,f,b,w,S,l,I)}function hd(n,a,l){n._associatedReadableByteStreamController=a,n._view=l}function Lo(n){return new TypeError(`ReadableStreamBYOBRequest.prototype.${n} can only be used on a ReadableStreamBYOBRequest`)}function hn(n){return new TypeError(`ReadableByteStreamController.prototype.${n} can only be used on a ReadableByteStreamController`)}function md(n,a){Me(n,a);let l=n?.mode;return{mode:l===void 0?void 0:pd(l,`${a} has member 'mode' that`)}}function pd(n,a){if(n=`${n}`,n!=="byob")throw new TypeError(`${a} '${n}' is not a valid enumeration value for ReadableStreamReaderMode`);return n}function bd(n,a){var l;Me(n,a);let f=(l=n?.min)!==null&&l!==void 0?l:1;return{min:he(f,`${a} has member 'min' that`)}}function $s(n){return new Ft(n)}function js(n,a){n._reader._readIntoRequests.push(a)}function gd(n,a,l){let b=n._reader._readIntoRequests.shift();l?b._closeSteps(a):b._chunkSteps(a)}function Hs(n){return n._reader._readIntoRequests.length}function Fo(n){let a=n._reader;return!(a===void 0||!nr(a))}class Ft{constructor(a){if(T(a,1,"ReadableStreamBYOBReader"),Pe(a,"First parameter"),Ut(a))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!tr(a._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");O(this,a),this._readIntoRequests=new M}get closed(){return nr(this)?this._closedPromise:y(ci("closed"))}cancel(a=void 0){return nr(this)?this._ownerReadableStream===void 0?y(Z("cancel")):Y(this,a):y(ci("cancel"))}read(a,l={}){if(!nr(this))return y(ci("read"));if(!ArrayBuffer.isView(a))return y(new TypeError("view must be an array buffer view"));if(a.byteLength===0)return y(new TypeError("view must have non-zero byteLength"));if(a.buffer.byteLength===0)return y(new TypeError("view's buffer must have non-zero byteLength"));if(Bt(a.buffer))return y(new TypeError("view's buffer has been detached"));let f;try{f=bd(l,"options")}catch(N){return y(N)}let b=f.min;if(b===0)return y(new TypeError("options.min must be greater than 0"));if(od(a)){if(b>a.byteLength)return y(new RangeError("options.min must be less than or equal to view's byteLength"))}else if(b>a.length)return y(new RangeError("options.min must be less than or equal to view's length"));if(this._ownerReadableStream===void 0)return y(Z("read from"));let w,S,I=p((N,z)=>{w=N,S=z});return Vs(this,a,b,{_chunkSteps:N=>w({value:N,done:!1}),_closeSteps:N=>w({value:N,done:!0}),_errorSteps:N=>S(N)}),I}releaseLock(){if(!nr(this))throw ci("releaseLock");this._ownerReadableStream!==void 0&&yd(this)}}Object.defineProperties(Ft.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),o(Ft.prototype.cancel,"cancel"),o(Ft.prototype.read,"read"),o(Ft.prototype.releaseLock,"releaseLock"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ft.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function nr(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_readIntoRequests")?!1:n instanceof Ft}function Vs(n,a,l,f){let b=n._ownerReadableStream;b._disturbed=!0,b._state==="errored"?f._errorSteps(b._storedError):ld(b._readableStreamController,a,l,f)}function yd(n){ee(n);let a=new TypeError("Reader was released");zs(n,a)}function zs(n,a){let l=n._readIntoRequests;n._readIntoRequests=new M,l.forEach(f=>{f._errorSteps(a)})}function ci(n){return new TypeError(`ReadableStreamBYOBReader.prototype.${n} can only be used on a ReadableStreamBYOBReader`)}function mn(n,a){let{highWaterMark:l}=n;if(l===void 0)return a;if(As(l)||l<0)throw new RangeError("Invalid highWaterMark");return l}function di(n){let{size:a}=n;return a||(()=>1)}function fi(n,a){Me(n,a);let l=n?.highWaterMark,f=n?.size;return{highWaterMark:l===void 0?void 0:J(l),size:f===void 0?void 0:_d(f,`${a} has member 'size' that`)}}function _d(n,a){return ve(n,a),l=>J(n(l))}function wd(n,a){Me(n,a);let l=n?.abort,f=n?.close,b=n?.start,w=n?.type,S=n?.write;return{abort:l===void 0?void 0:Sd(l,n,`${a} has member 'abort' that`),close:f===void 0?void 0:Rd(f,n,`${a} has member 'close' that`),start:b===void 0?void 0:Td(b,n,`${a} has member 'start' that`),write:S===void 0?void 0:Ed(S,n,`${a} has member 'write' that`),type:w}}function Sd(n,a,l){return ve(n,l),f=>D(n,a,[f])}function Rd(n,a,l){return ve(n,l),()=>D(n,a,[])}function Td(n,a,l){return ve(n,l),f=>P(n,a,[f])}function Ed(n,a,l){return ve(n,l),(f,b)=>D(n,a,[f,b])}function Qs(n,a){if(!Ar(n))throw new TypeError(`${a} is not a WritableStream.`)}function Ad(n){if(typeof n!="object"||n===null)return!1;try{return typeof n.aborted=="boolean"}catch{return!1}}let vd=typeof AbortController=="function";function Pd(){if(vd)return new AbortController}class qt{constructor(a={},l={}){a===void 0?a=null:c(a,"First parameter");let f=fi(l,"Second parameter"),b=wd(a,"First parameter");if(Ys(this),b.type!==void 0)throw new RangeError("Invalid type is specified");let S=di(f),I=mn(f,1);Wd(this,b,I,S)}get locked(){if(!Ar(this))throw gi("locked");return vr(this)}abort(a=void 0){return Ar(this)?vr(this)?y(new TypeError("Cannot abort a stream that already has a writer")):hi(this,a):y(gi("abort"))}close(){return Ar(this)?vr(this)?y(new TypeError("Cannot close a stream that already has a writer")):st(this)?y(new TypeError("Cannot close an already-closing stream")):Xs(this):y(gi("close"))}getWriter(){if(!Ar(this))throw gi("getWriter");return Gs(this)}}Object.defineProperties(qt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),o(qt.prototype.abort,"abort"),o(qt.prototype.close,"close"),o(qt.prototype.getWriter,"getWriter"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(qt.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});function Gs(n){return new yt(n)}function Cd(n,a,l,f,b=1,w=()=>1){let S=Object.create(qt.prototype);Ys(S);let I=Object.create(Pr.prototype);return rl(S,I,n,a,l,f,b,w),S}function Ys(n){n._state="writable",n._storedError=void 0,n._writer=void 0,n._writableStreamController=void 0,n._writeRequests=new M,n._inFlightWriteRequest=void 0,n._closeRequest=void 0,n._inFlightCloseRequest=void 0,n._pendingAbortRequest=void 0,n._backpressure=!1}function Ar(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_writableStreamController")?!1:n instanceof qt}function vr(n){return n._writer!==void 0}function hi(n,a){var l;if(n._state==="closed"||n._state==="errored")return m(void 0);n._writableStreamController._abortReason=a,(l=n._writableStreamController._abortController)===null||l===void 0||l.abort(a);let f=n._state;if(f==="closed"||f==="errored")return m(void 0);if(n._pendingAbortRequest!==void 0)return n._pendingAbortRequest._promise;let b=!1;f==="erroring"&&(b=!0,a=void 0);let w=p((S,I)=>{n._pendingAbortRequest={_promise:void 0,_resolve:S,_reject:I,_reason:a,_wasAlreadyErroring:b}});return n._pendingAbortRequest._promise=w,b||No(n,a),w}function Xs(n){let a=n._state;if(a==="closed"||a==="errored")return y(new TypeError(`The stream (in ${a} state) is not in the writable state and cannot be closed`));let l=p((b,w)=>{let S={_resolve:b,_reject:w};n._closeRequest=S}),f=n._writer;return f!==void 0&&n._backpressure&&a==="writable"&&Qo(f),$d(n._writableStreamController),l}function Id(n){return p((l,f)=>{let b={_resolve:l,_reject:f};n._writeRequests.push(b)})}function qo(n,a){if(n._state==="writable"){No(n,a);return}Uo(n)}function No(n,a){let l=n._writableStreamController;n._state="erroring",n._storedError=a;let f=n._writer;f!==void 0&&Ks(f,a),!Od(n)&&l._started&&Uo(n)}function Uo(n){n._state="errored",n._writableStreamController[G]();let a=n._storedError;if(n._writeRequests.forEach(b=>{b._reject(a)}),n._writeRequests=new M,n._pendingAbortRequest===void 0){mi(n);return}let l=n._pendingAbortRequest;if(n._pendingAbortRequest=void 0,l._wasAlreadyErroring){l._reject(a),mi(n);return}let f=n._writableStreamController[j](l._reason);C(f,()=>(l._resolve(),mi(n),null),b=>(l._reject(b),mi(n),null))}function kd(n){n._inFlightWriteRequest._resolve(void 0),n._inFlightWriteRequest=void 0}function xd(n,a){n._inFlightWriteRequest._reject(a),n._inFlightWriteRequest=void 0,qo(n,a)}function Dd(n){n._inFlightCloseRequest._resolve(void 0),n._inFlightCloseRequest=void 0,n._state==="erroring"&&(n._storedError=void 0,n._pendingAbortRequest!==void 0&&(n._pendingAbortRequest._resolve(),n._pendingAbortRequest=void 0)),n._state="closed";let l=n._writer;l!==void 0&&al(l)}function Md(n,a){n._inFlightCloseRequest._reject(a),n._inFlightCloseRequest=void 0,n._pendingAbortRequest!==void 0&&(n._pendingAbortRequest._reject(a),n._pendingAbortRequest=void 0),qo(n,a)}function st(n){return!(n._closeRequest===void 0&&n._inFlightCloseRequest===void 0)}function Od(n){return!(n._inFlightWriteRequest===void 0&&n._inFlightCloseRequest===void 0)}function Bd(n){n._inFlightCloseRequest=n._closeRequest,n._closeRequest=void 0}function Ld(n){n._inFlightWriteRequest=n._writeRequests.shift()}function mi(n){n._closeRequest!==void 0&&(n._closeRequest._reject(n._storedError),n._closeRequest=void 0);let a=n._writer;a!==void 0&&Vo(a,n._storedError)}function Wo(n,a){let l=n._writer;l!==void 0&&a!==n._backpressure&&(a?Yd(l):Qo(l)),n._backpressure=a}class yt{constructor(a){if(T(a,1,"WritableStreamDefaultWriter"),Qs(a,"First parameter"),vr(a))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=a,a._writer=this;let l=a._state;if(l==="writable")!st(a)&&a._backpressure?_i(this):sl(this),yi(this);else if(l==="erroring")zo(this,a._storedError),yi(this);else if(l==="closed")sl(this),Qd(this);else{let f=a._storedError;zo(this,f),ol(this,f)}}get closed(){return ir(this)?this._closedPromise:y(or("closed"))}get desiredSize(){if(!ir(this))throw or("desiredSize");if(this._ownerWritableStream===void 0)throw bn("desiredSize");return Ud(this)}get ready(){return ir(this)?this._readyPromise:y(or("ready"))}abort(a=void 0){return ir(this)?this._ownerWritableStream===void 0?y(bn("abort")):Fd(this,a):y(or("abort"))}close(){if(!ir(this))return y(or("close"));let a=this._ownerWritableStream;return a===void 0?y(bn("close")):st(a)?y(new TypeError("Cannot close an already-closing stream")):Js(this)}releaseLock(){if(!ir(this))throw or("releaseLock");this._ownerWritableStream!==void 0&&Zs(this)}write(a=void 0){return ir(this)?this._ownerWritableStream===void 0?y(bn("write to")):el(this,a):y(or("write"))}}Object.defineProperties(yt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),o(yt.prototype.abort,"abort"),o(yt.prototype.close,"close"),o(yt.prototype.releaseLock,"releaseLock"),o(yt.prototype.write,"write"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(yt.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function ir(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_ownerWritableStream")?!1:n instanceof yt}function Fd(n,a){let l=n._ownerWritableStream;return hi(l,a)}function Js(n){let a=n._ownerWritableStream;return Xs(a)}function qd(n){let a=n._ownerWritableStream,l=a._state;return st(a)||l==="closed"?m(void 0):l==="errored"?y(a._storedError):Js(n)}function Nd(n,a){n._closedPromiseState==="pending"?Vo(n,a):Gd(n,a)}function Ks(n,a){n._readyPromiseState==="pending"?ll(n,a):Xd(n,a)}function Ud(n){let a=n._ownerWritableStream,l=a._state;return l==="errored"||l==="erroring"?null:l==="closed"?0:nl(a._writableStreamController)}function Zs(n){let a=n._ownerWritableStream,l=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");Ks(n,l),Nd(n,l),a._writer=void 0,n._ownerWritableStream=void 0}function el(n,a){let l=n._ownerWritableStream,f=l._writableStreamController,b=jd(f,a);if(l!==n._ownerWritableStream)return y(bn("write to"));let w=l._state;if(w==="errored")return y(l._storedError);if(st(l)||w==="closed")return y(new TypeError("The stream is closing or closed and cannot be written to"));if(w==="erroring")return y(l._storedError);let S=Id(l);return Hd(f,a,b),S}let tl={};class Pr{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!$o(this))throw Ho("abortReason");return this._abortReason}get signal(){if(!$o(this))throw Ho("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(a=void 0){if(!$o(this))throw Ho("error");this._controlledWritableStream._state==="writable"&&il(this,a)}[j](a){let l=this._abortAlgorithm(a);return pi(this),l}[G](){Lt(this)}}Object.defineProperties(Pr.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Pr.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function $o(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledWritableStream")?!1:n instanceof Pr}function rl(n,a,l,f,b,w,S,I){a._controlledWritableStream=n,n._writableStreamController=a,a._queue=void 0,a._queueTotalSize=void 0,Lt(a),a._abortReason=void 0,a._abortController=Pd(),a._started=!1,a._strategySizeAlgorithm=I,a._strategyHWM=S,a._writeAlgorithm=f,a._closeAlgorithm=b,a._abortAlgorithm=w;let V=jo(a);Wo(n,V);let N=l(),z=m(N);C(z,()=>(a._started=!0,bi(a),null),Q=>(a._started=!0,qo(n,Q),null))}function Wd(n,a,l,f){let b=Object.create(Pr.prototype),w,S,I,V;a.start!==void 0?w=()=>a.start(b):w=()=>{},a.write!==void 0?S=N=>a.write(N,b):S=()=>m(void 0),a.close!==void 0?I=()=>a.close():I=()=>m(void 0),a.abort!==void 0?V=N=>a.abort(N):V=()=>m(void 0),rl(n,b,w,S,I,V,l,f)}function pi(n){n._writeAlgorithm=void 0,n._closeAlgorithm=void 0,n._abortAlgorithm=void 0,n._strategySizeAlgorithm=void 0}function $d(n){ko(n,tl,0),bi(n)}function jd(n,a){try{return n._strategySizeAlgorithm(a)}catch(l){return pn(n,l),1}}function nl(n){return n._strategyHWM-n._queueTotalSize}function Hd(n,a,l){try{ko(n,a,l)}catch(b){pn(n,b);return}let f=n._controlledWritableStream;if(!st(f)&&f._state==="writable"){let b=jo(n);Wo(f,b)}bi(n)}function bi(n){let a=n._controlledWritableStream;if(!n._started||a._inFlightWriteRequest!==void 0)return;if(a._state==="erroring"){Uo(a);return}if(n._queue.length===0)return;let f=id(n);f===tl?Vd(n):zd(n,f)}function pn(n,a){n._controlledWritableStream._state==="writable"&&il(n,a)}function Vd(n){let a=n._controlledWritableStream;Bd(a),Io(n);let l=n._closeAlgorithm();pi(n),C(l,()=>(Dd(a),null),f=>(Md(a,f),null))}function zd(n,a){let l=n._controlledWritableStream;Ld(l);let f=n._writeAlgorithm(a);C(f,()=>{kd(l);let b=l._state;if(Io(n),!st(l)&&b==="writable"){let w=jo(n);Wo(l,w)}return bi(n),null},b=>(l._state==="writable"&&pi(n),xd(l,b),null))}function jo(n){return nl(n)<=0}function il(n,a){let l=n._controlledWritableStream;pi(n),No(l,a)}function gi(n){return new TypeError(`WritableStream.prototype.${n} can only be used on a WritableStream`)}function Ho(n){return new TypeError(`WritableStreamDefaultController.prototype.${n} can only be used on a WritableStreamDefaultController`)}function or(n){return new TypeError(`WritableStreamDefaultWriter.prototype.${n} can only be used on a WritableStreamDefaultWriter`)}function bn(n){return new TypeError("Cannot "+n+" a stream using a released writer")}function yi(n){n._closedPromise=p((a,l)=>{n._closedPromise_resolve=a,n._closedPromise_reject=l,n._closedPromiseState="pending"})}function ol(n,a){yi(n),Vo(n,a)}function Qd(n){yi(n),al(n)}function Vo(n,a){n._closedPromise_reject!==void 0&&(x(n._closedPromise),n._closedPromise_reject(a),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0,n._closedPromiseState="rejected")}function Gd(n,a){ol(n,a)}function al(n){n._closedPromise_resolve!==void 0&&(n._closedPromise_resolve(void 0),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0,n._closedPromiseState="resolved")}function _i(n){n._readyPromise=p((a,l)=>{n._readyPromise_resolve=a,n._readyPromise_reject=l}),n._readyPromiseState="pending"}function zo(n,a){_i(n),ll(n,a)}function sl(n){_i(n),Qo(n)}function ll(n,a){n._readyPromise_reject!==void 0&&(x(n._readyPromise),n._readyPromise_reject(a),n._readyPromise_resolve=void 0,n._readyPromise_reject=void 0,n._readyPromiseState="rejected")}function Yd(n){_i(n)}function Xd(n,a){zo(n,a)}function Qo(n){n._readyPromise_resolve!==void 0&&(n._readyPromise_resolve(void 0),n._readyPromise_resolve=void 0,n._readyPromise_reject=void 0,n._readyPromiseState="fulfilled")}function Jd(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof global<"u")return global}let Go=Jd();function Kd(n){if(!(typeof n=="function"||typeof n=="object")||n.name!=="DOMException")return!1;try{return new n,!0}catch{return!1}}function Zd(){let n=Go?.DOMException;return Kd(n)?n:void 0}function ef(){let n=function(l,f){this.message=l||"",this.name=f||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return o(n,"DOMException"),n.prototype=Object.create(Error.prototype),Object.defineProperty(n.prototype,"constructor",{value:n,writable:!0,configurable:!0}),n}let tf=Zd()||ef();function ul(n,a,l,f,b,w){let S=Oe(n),I=Gs(a);n._disturbed=!0;let V=!1,N=m(void 0);return p((z,Q)=>{let te;if(w!==void 0){if(te=()=>{let W=w.reason!==void 0?w.reason:new tf("Aborted","AbortError"),X=[];f||X.push(()=>a._state==="writable"?hi(a,W):m(void 0)),b||X.push(()=>n._state==="readable"?tt(n,W):m(void 0)),Ce(()=>Promise.all(X.map(re=>re())),!0,W)},w.aborted){te();return}w.addEventListener("abort",te)}function rt(){return p((W,X)=>{function re(Le){Le?W():v(xr(),re,X)}re(!1)})}function xr(){return V?m(!0):v(I._readyPromise,()=>p((W,X)=>{cn(S,{_chunkSteps:re=>{N=v(el(I,re),void 0,e),W(!1)},_closeSteps:()=>W(!0),_errorSteps:X})}))}if(wt(n,S._closedPromise,W=>(f?Ve(!0,W):Ce(()=>hi(a,W),!0,W),null)),wt(a,I._closedPromise,W=>(b?Ve(!0,W):Ce(()=>tt(n,W),!0,W),null)),Re(n,S._closedPromise,()=>(l?Ve():Ce(()=>qd(I)),null)),st(a)||a._state==="closed"){let W=new TypeError("the destination writable stream closed before all data could be piped to it");b?Ve(!0,W):Ce(()=>tt(n,W),!0,W)}x(rt());function $t(){let W=N;return v(N,()=>W!==N?$t():void 0)}function wt(W,X,re){W._state==="errored"?re(W._storedError):R(X,re)}function Re(W,X,re){W._state==="closed"?re():E(X,re)}function Ce(W,X,re){if(V)return;V=!0,a._state==="writable"&&!st(a)?E($t(),Le):Le();function Le(){return C(W(),()=>St(X,re),Dr=>St(!0,Dr)),null}}function Ve(W,X){V||(V=!0,a._state==="writable"&&!st(a)?E($t(),()=>St(W,X)):St(W,X))}function St(W,X){return Zs(I),ee(S),w!==void 0&&w.removeEventListener("abort",te),W?Q(X):z(void 0),null}})}class _t{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!wi(this))throw Ri("desiredSize");return Yo(this)}close(){if(!wi(this))throw Ri("close");if(!Ir(this))throw new TypeError("The stream is not in a state that permits close");ar(this)}enqueue(a=void 0){if(!wi(this))throw Ri("enqueue");if(!Ir(this))throw new TypeError("The stream is not in a state that permits enqueue");return Cr(this,a)}error(a=void 0){if(!wi(this))throw Ri("error");et(this,a)}[g](a){Lt(this);let l=this._cancelAlgorithm(a);return Si(this),l}[ae](a){let l=this._controlledReadableStream;if(this._queue.length>0){let f=Io(this);this._closeRequested&&this._queue.length===0?(Si(this),_n(l)):gn(this),a._chunkSteps(f)}else ue(l,a),gn(this)}[q](){}}Object.defineProperties(_t.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),o(_t.prototype.close,"close"),o(_t.prototype.enqueue,"enqueue"),o(_t.prototype.error,"error"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(_t.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function wi(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledReadableStream")?!1:n instanceof _t}function gn(n){if(!cl(n))return;if(n._pulling){n._pullAgain=!0;return}n._pulling=!0;let l=n._pullAlgorithm();C(l,()=>(n._pulling=!1,n._pullAgain&&(n._pullAgain=!1,gn(n)),null),f=>(et(n,f),null))}function cl(n){let a=n._controlledReadableStream;return!Ir(n)||!n._started?!1:!!(Ut(a)&&Tr(a)>0||Yo(n)>0)}function Si(n){n._pullAlgorithm=void 0,n._cancelAlgorithm=void 0,n._strategySizeAlgorithm=void 0}function ar(n){if(!Ir(n))return;let a=n._controlledReadableStream;n._closeRequested=!0,n._queue.length===0&&(Si(n),_n(a))}function Cr(n,a){if(!Ir(n))return;let l=n._controlledReadableStream;if(Ut(l)&&Tr(l)>0)Be(l,a,!1);else{let f;try{f=n._strategySizeAlgorithm(a)}catch(b){throw et(n,b),b}try{ko(n,a,f)}catch(b){throw et(n,b),b}}gn(n)}function et(n,a){let l=n._controlledReadableStream;l._state==="readable"&&(Lt(n),Si(n),ml(l,a))}function Yo(n){let a=n._controlledReadableStream._state;return a==="errored"?null:a==="closed"?0:n._strategyHWM-n._queueTotalSize}function rf(n){return!cl(n)}function Ir(n){let a=n._controlledReadableStream._state;return!n._closeRequested&&a==="readable"}function dl(n,a,l,f,b,w,S){a._controlledReadableStream=n,a._queue=void 0,a._queueTotalSize=void 0,Lt(a),a._started=!1,a._closeRequested=!1,a._pullAgain=!1,a._pulling=!1,a._strategySizeAlgorithm=S,a._strategyHWM=w,a._pullAlgorithm=f,a._cancelAlgorithm=b,n._readableStreamController=a;let I=l();C(m(I),()=>(a._started=!0,gn(a),null),V=>(et(a,V),null))}function nf(n,a,l,f){let b=Object.create(_t.prototype),w,S,I;a.start!==void 0?w=()=>a.start(b):w=()=>{},a.pull!==void 0?S=()=>a.pull(b):S=()=>m(void 0),a.cancel!==void 0?I=V=>a.cancel(V):I=()=>m(void 0),dl(n,b,w,S,I,l,f)}function Ri(n){return new TypeError(`ReadableStreamDefaultController.prototype.${n} can only be used on a ReadableStreamDefaultController`)}function of(n,a){return tr(n._readableStreamController)?sf(n):af(n)}function af(n,a){let l=Oe(n),f=!1,b=!1,w=!1,S=!1,I,V,N,z,Q,te=p(Re=>{Q=Re});function rt(){return f?(b=!0,m(void 0)):(f=!0,cn(l,{_chunkSteps:Ce=>{L(()=>{b=!1;let Ve=Ce,St=Ce;w||Cr(N._readableStreamController,Ve),S||Cr(z._readableStreamController,St),f=!1,b&&rt()})},_closeSteps:()=>{f=!1,w||ar(N._readableStreamController),S||ar(z._readableStreamController),(!w||!S)&&Q(void 0)},_errorSteps:()=>{f=!1}}),m(void 0))}function xr(Re){if(w=!0,I=Re,S){let Ce=dn([I,V]),Ve=tt(n,Ce);Q(Ve)}return te}function $t(Re){if(S=!0,V=Re,w){let Ce=dn([I,V]),Ve=tt(n,Ce);Q(Ve)}return te}function wt(){}return N=yn(wt,rt,xr),z=yn(wt,rt,$t),R(l._closedPromise,Re=>(et(N._readableStreamController,Re),et(z._readableStreamController,Re),(!w||!S)&&Q(void 0),null)),[N,z]}function sf(n){let a=Oe(n),l=!1,f=!1,b=!1,w=!1,S=!1,I,V,N,z,Q,te=p(W=>{Q=W});function rt(W){R(W._closedPromise,X=>(W!==a||(He(N._readableStreamController,X),He(z._readableStreamController,X),(!w||!S)&&Q(void 0)),null))}function xr(){nr(a)&&(ee(a),a=Oe(n),rt(a)),cn(a,{_chunkSteps:X=>{L(()=>{f=!1,b=!1;let re=X,Le=X;if(!w&&!S)try{Le=Is(X)}catch(Dr){He(N._readableStreamController,Dr),He(z._readableStreamController,Dr),Q(tt(n,Dr));return}w||si(N._readableStreamController,re),S||si(z._readableStreamController,Le),l=!1,f?wt():b&&Re()})},_closeSteps:()=>{l=!1,w||fn(N._readableStreamController),S||fn(z._readableStreamController),N._readableStreamController._pendingPullIntos.length>0&&li(N._readableStreamController,0),z._readableStreamController._pendingPullIntos.length>0&&li(z._readableStreamController,0),(!w||!S)&&Q(void 0)},_errorSteps:()=>{l=!1}})}function $t(W,X){Ze(a)&&(ee(a),a=$s(n),rt(a));let re=X?z:N,Le=X?N:z;Vs(a,W,1,{_chunkSteps:Mr=>{L(()=>{f=!1,b=!1;let Or=X?S:w;if(X?w:S)Or||ui(re._readableStreamController,Mr);else{let Pl;try{Pl=Is(Mr)}catch(ea){He(re._readableStreamController,ea),He(Le._readableStreamController,ea),Q(tt(n,ea));return}Or||ui(re._readableStreamController,Mr),si(Le._readableStreamController,Pl)}l=!1,f?wt():b&&Re()})},_closeSteps:Mr=>{l=!1;let Or=X?S:w,ki=X?w:S;Or||fn(re._readableStreamController),ki||fn(Le._readableStreamController),Mr!==void 0&&(Or||ui(re._readableStreamController,Mr),!ki&&Le._readableStreamController._pendingPullIntos.length>0&&li(Le._readableStreamController,0)),(!Or||!ki)&&Q(void 0)},_errorSteps:()=>{l=!1}})}function wt(){if(l)return f=!0,m(void 0);l=!0;let W=Bo(N._readableStreamController);return W===null?xr():$t(W._view,!1),m(void 0)}function Re(){if(l)return b=!0,m(void 0);l=!0;let W=Bo(z._readableStreamController);return W===null?xr():$t(W._view,!0),m(void 0)}function Ce(W){if(w=!0,I=W,S){let X=dn([I,V]),re=tt(n,X);Q(re)}return te}function Ve(W){if(S=!0,V=W,w){let X=dn([I,V]),re=tt(n,X);Q(re)}return te}function St(){}return N=hl(St,wt,Ce),z=hl(St,Re,Ve),rt(a),[N,z]}function lf(n){return t(n)&&typeof n.getReader<"u"}function uf(n){return lf(n)?df(n.getReader()):cf(n)}function cf(n){let a,l=Cs(n,"async"),f=e;function b(){let S;try{S=ed(l)}catch(V){return y(V)}let I=m(S);return B(I,V=>{if(!t(V))throw new TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(td(V))ar(a._readableStreamController);else{let z=rd(V);Cr(a._readableStreamController,z)}})}function w(S){let I=l.iterator,V;try{V=ii(I,"return")}catch(Q){return y(Q)}if(V===void 0)return m(void 0);let N;try{N=P(V,I,[S])}catch(Q){return y(Q)}let z=m(N);return B(z,Q=>{if(!t(Q))throw new TypeError("The promise returned by the iterator.return() method must fulfill with an object")})}return a=yn(f,b,w,0),a}function df(n){let a,l=e;function f(){let w;try{w=n.read()}catch(S){return y(S)}return B(w,S=>{if(!t(S))throw new TypeError("The promise returned by the reader.read() method must fulfill with an object");if(S.done)ar(a._readableStreamController);else{let I=S.value;Cr(a._readableStreamController,I)}})}function b(w){try{return m(n.cancel(w))}catch(S){return y(S)}}return a=yn(l,f,b,0),a}function ff(n,a){Me(n,a);let l=n,f=l?.autoAllocateChunkSize,b=l?.cancel,w=l?.pull,S=l?.start,I=l?.type;return{autoAllocateChunkSize:f===void 0?void 0:he(f,`${a} has member 'autoAllocateChunkSize' that`),cancel:b===void 0?void 0:hf(b,l,`${a} has member 'cancel' that`),pull:w===void 0?void 0:mf(w,l,`${a} has member 'pull' that`),start:S===void 0?void 0:pf(S,l,`${a} has member 'start' that`),type:I===void 0?void 0:bf(I,`${a} has member 'type' that`)}}function hf(n,a,l){return ve(n,l),f=>D(n,a,[f])}function mf(n,a,l){return ve(n,l),f=>D(n,a,[f])}function pf(n,a,l){return ve(n,l),f=>P(n,a,[f])}function bf(n,a){if(n=`${n}`,n!=="bytes")throw new TypeError(`${a} '${n}' is not a valid enumeration value for ReadableStreamType`);return n}function gf(n,a){return Me(n,a),{preventCancel:!!n?.preventCancel}}function fl(n,a){Me(n,a);let l=n?.preventAbort,f=n?.preventCancel,b=n?.preventClose,w=n?.signal;return w!==void 0&&yf(w,`${a} has member 'signal' that`),{preventAbort:!!l,preventCancel:!!f,preventClose:!!b,signal:w}}function yf(n,a){if(!Ad(n))throw new TypeError(`${a} is not an AbortSignal.`)}function _f(n,a){Me(n,a);let l=n?.readable;_(l,"readable","ReadableWritablePair"),Pe(l,`${a} has member 'readable' that`);let f=n?.writable;return _(f,"writable","ReadableWritablePair"),Qs(f,`${a} has member 'writable' that`),{readable:l,writable:f}}class ye{constructor(a={},l={}){a===void 0?a=null:c(a,"First parameter");let f=fi(l,"Second parameter"),b=ff(a,"First parameter");if(Xo(this),b.type==="bytes"){if(f.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let w=mn(f,0);fd(this,b,w)}else{let w=di(f),S=mn(f,1);nf(this,b,S,w)}}get locked(){if(!Nt(this))throw sr("locked");return Ut(this)}cancel(a=void 0){return Nt(this)?Ut(this)?y(new TypeError("Cannot cancel a stream that already has a reader")):tt(this,a):y(sr("cancel"))}getReader(a=void 0){if(!Nt(this))throw sr("getReader");return md(a,"First parameter").mode===void 0?Oe(this):$s(this)}pipeThrough(a,l={}){if(!Nt(this))throw sr("pipeThrough");T(a,1,"pipeThrough");let f=_f(a,"First parameter"),b=fl(l,"Second parameter");if(Ut(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(vr(f.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let w=ul(this,f.writable,b.preventClose,b.preventAbort,b.preventCancel,b.signal);return x(w),f.readable}pipeTo(a,l={}){if(!Nt(this))return y(sr("pipeTo"));if(a===void 0)return y("Parameter 1 is required in 'pipeTo'.");if(!Ar(a))return y(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let f;try{f=fl(l,"Second parameter")}catch(b){return y(b)}return Ut(this)?y(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):vr(a)?y(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):ul(this,a,f.preventClose,f.preventAbort,f.preventCancel,f.signal)}tee(){if(!Nt(this))throw sr("tee");let a=of(this);return dn(a)}values(a=void 0){if(!Nt(this))throw sr("values");let l=gf(a,"First parameter");return Kc(this,l.preventCancel)}[Co](a){return this.values(a)}static from(a){return uf(a)}}Object.defineProperties(ye,{from:{enumerable:!0}}),Object.defineProperties(ye.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),o(ye.from,"from"),o(ye.prototype.cancel,"cancel"),o(ye.prototype.getReader,"getReader"),o(ye.prototype.pipeThrough,"pipeThrough"),o(ye.prototype.pipeTo,"pipeTo"),o(ye.prototype.tee,"tee"),o(ye.prototype.values,"values"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(ye.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(ye.prototype,Co,{value:ye.prototype.values,writable:!0,configurable:!0});function yn(n,a,l,f=1,b=()=>1){let w=Object.create(ye.prototype);Xo(w);let S=Object.create(_t.prototype);return dl(w,S,n,a,l,f,b),w}function hl(n,a,l){let f=Object.create(ye.prototype);Xo(f);let b=Object.create(gt.prototype);return Ws(f,b,n,a,l,0,void 0),f}function Xo(n){n._state="readable",n._reader=void 0,n._storedError=void 0,n._disturbed=!1}function Nt(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_readableStreamController")?!1:n instanceof ye}function Ut(n){return n._reader!==void 0}function tt(n,a){if(n._disturbed=!0,n._state==="closed")return m(void 0);if(n._state==="errored")return y(n._storedError);_n(n);let l=n._reader;if(l!==void 0&&nr(l)){let b=l._readIntoRequests;l._readIntoRequests=new M,b.forEach(w=>{w._closeSteps(void 0)})}let f=n._readableStreamController[g](a);return B(f,e)}function _n(n){n._state="closed";let a=n._reader;if(a!==void 0&&(at(a),Ze(a))){let l=a._readRequests;a._readRequests=new M,l.forEach(f=>{f._closeSteps()})}}function ml(n,a){n._state="errored",n._storedError=a;let l=n._reader;l!==void 0&&(se(l,a),Ze(l)?ws(l,a):zs(l,a))}function sr(n){return new TypeError(`ReadableStream.prototype.${n} can only be used on a ReadableStream`)}function pl(n,a){Me(n,a);let l=n?.highWaterMark;return _(l,"highWaterMark","QueuingStrategyInit"),{highWaterMark:J(l)}}let bl=n=>n.byteLength;o(bl,"size");class Ti{constructor(a){T(a,1,"ByteLengthQueuingStrategy"),a=pl(a,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=a.highWaterMark}get highWaterMark(){if(!yl(this))throw gl("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!yl(this))throw gl("size");return bl}}Object.defineProperties(Ti.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ti.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function gl(n){return new TypeError(`ByteLengthQueuingStrategy.prototype.${n} can only be used on a ByteLengthQueuingStrategy`)}function yl(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_byteLengthQueuingStrategyHighWaterMark")?!1:n instanceof Ti}let _l=()=>1;o(_l,"size");class Ei{constructor(a){T(a,1,"CountQueuingStrategy"),a=pl(a,"First parameter"),this._countQueuingStrategyHighWaterMark=a.highWaterMark}get highWaterMark(){if(!Sl(this))throw wl("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Sl(this))throw wl("size");return _l}}Object.defineProperties(Ei.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ei.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function wl(n){return new TypeError(`CountQueuingStrategy.prototype.${n} can only be used on a CountQueuingStrategy`)}function Sl(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_countQueuingStrategyHighWaterMark")?!1:n instanceof Ei}function wf(n,a){Me(n,a);let l=n?.cancel,f=n?.flush,b=n?.readableType,w=n?.start,S=n?.transform,I=n?.writableType;return{cancel:l===void 0?void 0:Ef(l,n,`${a} has member 'cancel' that`),flush:f===void 0?void 0:Sf(f,n,`${a} has member 'flush' that`),readableType:b,start:w===void 0?void 0:Rf(w,n,`${a} has member 'start' that`),transform:S===void 0?void 0:Tf(S,n,`${a} has member 'transform' that`),writableType:I}}function Sf(n,a,l){return ve(n,l),f=>D(n,a,[f])}function Rf(n,a,l){return ve(n,l),f=>P(n,a,[f])}function Tf(n,a,l){return ve(n,l),(f,b)=>D(n,a,[f,b])}function Ef(n,a,l){return ve(n,l),f=>D(n,a,[f])}class Ai{constructor(a={},l={},f={}){a===void 0&&(a=null);let b=fi(l,"Second parameter"),w=fi(f,"Third parameter"),S=wf(a,"First parameter");if(S.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(S.writableType!==void 0)throw new RangeError("Invalid writableType specified");let I=mn(w,0),V=di(w),N=mn(b,1),z=di(b),Q,te=p(rt=>{Q=rt});Af(this,te,N,z,I,V),Pf(this,S),S.start!==void 0?Q(S.start(this._transformStreamController)):Q(void 0)}get readable(){if(!Rl(this))throw vl("readable");return this._readable}get writable(){if(!Rl(this))throw vl("writable");return this._writable}}Object.defineProperties(Ai.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Ai.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});function Af(n,a,l,f,b,w){function S(){return a}function I(te){return kf(n,te)}function V(te){return xf(n,te)}function N(){return Df(n)}n._writable=Cd(S,I,N,V,l,f);function z(){return Mf(n)}function Q(te){return Of(n,te)}n._readable=yn(S,z,Q,b,w),n._backpressure=void 0,n._backpressureChangePromise=void 0,n._backpressureChangePromise_resolve=void 0,vi(n,!0),n._transformStreamController=void 0}function Rl(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_transformStreamController")?!1:n instanceof Ai}function Tl(n,a){et(n._readable._readableStreamController,a),Jo(n,a)}function Jo(n,a){Ci(n._transformStreamController),pn(n._writable._writableStreamController,a),Ko(n)}function Ko(n){n._backpressure&&vi(n,!1)}function vi(n,a){n._backpressureChangePromise!==void 0&&n._backpressureChangePromise_resolve(),n._backpressureChangePromise=p(l=>{n._backpressureChangePromise_resolve=l}),n._backpressure=a}class Wt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Pi(this))throw Ii("desiredSize");let a=this._controlledTransformStream._readable._readableStreamController;return Yo(a)}enqueue(a=void 0){if(!Pi(this))throw Ii("enqueue");El(this,a)}error(a=void 0){if(!Pi(this))throw Ii("error");Cf(this,a)}terminate(){if(!Pi(this))throw Ii("terminate");If(this)}}Object.defineProperties(Wt.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),o(Wt.prototype.enqueue,"enqueue"),o(Wt.prototype.error,"error"),o(Wt.prototype.terminate,"terminate"),typeof Symbol.toStringTag=="symbol"&&Object.defineProperty(Wt.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function Pi(n){return!t(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledTransformStream")?!1:n instanceof Wt}function vf(n,a,l,f,b){a._controlledTransformStream=n,n._transformStreamController=a,a._transformAlgorithm=l,a._flushAlgorithm=f,a._cancelAlgorithm=b,a._finishPromise=void 0,a._finishPromise_resolve=void 0,a._finishPromise_reject=void 0}function Pf(n,a){let l=Object.create(Wt.prototype),f,b,w;a.transform!==void 0?f=S=>a.transform(S,l):f=S=>{try{return El(l,S),m(void 0)}catch(I){return y(I)}},a.flush!==void 0?b=()=>a.flush(l):b=()=>m(void 0),a.cancel!==void 0?w=S=>a.cancel(S):w=()=>m(void 0),vf(n,l,f,b,w)}function Ci(n){n._transformAlgorithm=void 0,n._flushAlgorithm=void 0,n._cancelAlgorithm=void 0}function El(n,a){let l=n._controlledTransformStream,f=l._readable._readableStreamController;if(!Ir(f))throw new TypeError("Readable side is not in a state that permits enqueue");try{Cr(f,a)}catch(w){throw Jo(l,w),l._readable._storedError}rf(f)!==l._backpressure&&vi(l,!0)}function Cf(n,a){Tl(n._controlledTransformStream,a)}function Al(n,a){let l=n._transformAlgorithm(a);return B(l,void 0,f=>{throw Tl(n._controlledTransformStream,f),f})}function If(n){let a=n._controlledTransformStream,l=a._readable._readableStreamController;ar(l);let f=new TypeError("TransformStream terminated");Jo(a,f)}function kf(n,a){let l=n._transformStreamController;if(n._backpressure){let f=n._backpressureChangePromise;return B(f,()=>{let b=n._writable;if(b._state==="erroring")throw b._storedError;return Al(l,a)})}return Al(l,a)}function xf(n,a){let l=n._transformStreamController;if(l._finishPromise!==void 0)return l._finishPromise;let f=n._readable;l._finishPromise=p((w,S)=>{l._finishPromise_resolve=w,l._finishPromise_reject=S});let b=l._cancelAlgorithm(a);return Ci(l),C(b,()=>(f._state==="errored"?kr(l,f._storedError):(et(f._readableStreamController,a),Zo(l)),null),w=>(et(f._readableStreamController,w),kr(l,w),null)),l._finishPromise}function Df(n){let a=n._transformStreamController;if(a._finishPromise!==void 0)return a._finishPromise;let l=n._readable;a._finishPromise=p((b,w)=>{a._finishPromise_resolve=b,a._finishPromise_reject=w});let f=a._flushAlgorithm();return Ci(a),C(f,()=>(l._state==="errored"?kr(a,l._storedError):(ar(l._readableStreamController),Zo(a)),null),b=>(et(l._readableStreamController,b),kr(a,b),null)),a._finishPromise}function Mf(n){return vi(n,!1),n._backpressureChangePromise}function Of(n,a){let l=n._transformStreamController;if(l._finishPromise!==void 0)return l._finishPromise;let f=n._writable;l._finishPromise=p((w,S)=>{l._finishPromise_resolve=w,l._finishPromise_reject=S});let b=l._cancelAlgorithm(a);return Ci(l),C(b,()=>(f._state==="errored"?kr(l,f._storedError):(pn(f._writableStreamController,a),Ko(n),Zo(l)),null),w=>(pn(f._writableStreamController,w),Ko(n),kr(l,w),null)),l._finishPromise}function Ii(n){return new TypeError(`TransformStreamDefaultController.prototype.${n} can only be used on a TransformStreamDefaultController`)}function Zo(n){n._finishPromise_resolve!==void 0&&(n._finishPromise_resolve(),n._finishPromise_resolve=void 0,n._finishPromise_reject=void 0)}function kr(n,a){n._finishPromise_reject!==void 0&&(x(n._finishPromise),n._finishPromise_reject(a),n._finishPromise_resolve=void 0,n._finishPromise_reject=void 0)}function vl(n){return new TypeError(`TransformStream.prototype.${n} can only be used on a TransformStream`)}r.ByteLengthQueuingStrategy=Ti,r.CountQueuingStrategy=Ei,r.ReadableByteStreamController=gt,r.ReadableStream=ye,r.ReadableStreamBYOBReader=Ft,r.ReadableStreamBYOBRequest=er,r.ReadableStreamDefaultController=_t,r.ReadableStreamDefaultReader=je,r.TransformStream=Ai,r.TransformStreamDefaultController=Wt,r.WritableStream=qt,r.WritableStreamDefaultController=Pr,r.WritableStreamDefaultWriter=yt}))});var Ml=ce(()=>{if(!globalThis.ReadableStream)try{let r=require("node:process"),{emitWarning:e}=r;try{r.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),r.emitWarning=e}catch(t){throw r.emitWarning=e,t}}catch{Object.assign(globalThis,Dl())}try{let{Blob:r}=require("buffer");r&&!r.prototype.stream&&(r.prototype.stream=function(t){let i=0,o=this;return new ReadableStream({type:"bytes",async pull(s){let h=await o.slice(i,Math.min(o.size,i+65536)).arrayBuffer();i+=h.byteLength,s.enqueue(new Uint8Array(h)),i===o.size&&s.close()}})})}catch{}});async function*ta(r,e=!0){for(let t of r)if("stream"in t)yield*t.stream();else if(ArrayBuffer.isView(t))if(e){let i=t.byteOffset,o=t.byteOffset+t.byteLength;for(;i!==o;){let s=Math.min(o-i,Ol),u=t.buffer.slice(i,i+s);i+=u.byteLength,yield new Uint8Array(u)}}else yield t;else{let i=0,o=t;for(;i!==o.size;){let u=await o.slice(i,Math.min(o.size,i+Ol)).arrayBuffer();i+=u.byteLength,yield new Uint8Array(u)}}}var Dp,Ol,Bl,$f,Rt,Sn=wn(()=>{Dp=lt(Ml(),1);Ol=65536;Bl=class ra{#e=[];#t="";#r=0;#n="transparent";constructor(e=[],t={}){if(typeof e!="object"||e===null)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if(typeof e[Symbol.iterator]!="function")throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if(typeof t!="object"&&typeof t!="function")throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");t===null&&(t={});let i=new TextEncoder;for(let s of e){let u;ArrayBuffer.isView(s)?u=new Uint8Array(s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)):s instanceof ArrayBuffer?u=new Uint8Array(s.slice(0)):s instanceof ra?u=s:u=i.encode(`${s}`),this.#r+=ArrayBuffer.isView(u)?u.byteLength:u.size,this.#e.push(u)}this.#n=`${t.endings===void 0?"transparent":t.endings}`;let o=t.type===void 0?"":String(t.type);this.#t=/^[\x20-\x7E]*$/.test(o)?o:""}get size(){return this.#r}get type(){return this.#t}async text(){let e=new TextDecoder,t="";for await(let i of ta(this.#e,!1))t+=e.decode(i,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){let e=new Uint8Array(this.size),t=0;for await(let i of ta(this.#e,!1))e.set(i,t),t+=i.length;return e.buffer}stream(){let e=ta(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(t){let i=await e.next();i.done?t.close():t.enqueue(i.value)},async cancel(){await e.return()}})}slice(e=0,t=this.size,i=""){let{size:o}=this,s=e<0?Math.max(o+e,0):Math.min(e,o),u=t<0?Math.max(o+t,0):Math.min(t,o),h=Math.max(u-s,0),p=this.#e,m=[],y=0;for(let C of p){if(y>=h)break;let E=ArrayBuffer.isView(C)?C.byteLength:C.size;if(s&&E<=s)s-=E,u-=E;else{let R;ArrayBuffer.isView(C)?(R=C.subarray(s,Math.min(E,u)),y+=R.byteLength):(R=C.slice(s,Math.min(E,u)),y+=R.size),u-=E,m.push(R),s=0}}let v=new ra([],{type:String(i).toLowerCase()});return v.#r=h,v.#e=m,v}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(Bl.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});$f=Bl,Rt=$f});var jf,Hf,Br,na=wn(()=>{Sn();jf=class extends Rt{#e=0;#t="";constructor(e,t,i={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,i),i===null&&(i={});let o=i.lastModified===void 0?Date.now():Number(i.lastModified);Number.isNaN(o)||(this.#e=o),this.#t=String(t)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof Rt&&/^(File)$/.test(e[Symbol.toStringTag])}},Hf=jf,Br=Hf});function ql(r,e=Rt){var t=`${Ll()}${Ll()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),i=[],o=`--${t}\r
Content-Disposition: form-data; name="`;return r.forEach((s,u)=>typeof s=="string"?i.push(o+ia(u)+`"\r
\r
${s.replace(/\r(?!\n)|(?<!\r)\n/g,`\r
`)}\r
`):i.push(o+ia(u)+`"; filename="${ia(s.name,1)}"\r
Content-Type: ${s.type||"application/octet-stream"}\r
\r
`,s,`\r
`)),i.push(`--${t}--`),new e(i,{type:"multipart/form-data; boundary="+t})}var Rn,Vf,zf,Ll,Qf,Fl,ia,lr,ur,Mi=wn(()=>{Sn();na();({toStringTag:Rn,iterator:Vf,hasInstance:zf}=Symbol),Ll=Math.random,Qf="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),Fl=(r,e,t)=>(r+="",/^(Blob|File)$/.test(e&&e[Rn])?[(t=t!==void 0?t+"":e[Rn]=="File"?e.name:"blob",r),e.name!==t||e[Rn]=="blob"?new Br([e],t,e):e]:[r,e+""]),ia=(r,e)=>(e?r:r.replace(/\r?\n|\r/g,`\r
`)).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),lr=(r,e,t)=>{if(e.length<t)throw new TypeError(`Failed to execute '${r}' on 'FormData': ${t} arguments required, but only ${e.length} present.`)},ur=class{#e=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[Rn](){return"FormData"}[Vf](){return this.entries()}static[zf](e){return e&&typeof e=="object"&&e[Rn]==="FormData"&&!Qf.some(t=>typeof e[t]!="function")}append(...e){lr("append",arguments,2),this.#e.push(Fl(...e))}delete(e){lr("delete",arguments,1),e+="",this.#e=this.#e.filter(([t])=>t!==e)}get(e){lr("get",arguments,1),e+="";for(var t=this.#e,i=t.length,o=0;o<i;o++)if(t[o][0]===e)return t[o][1];return null}getAll(e,t){return lr("getAll",arguments,1),t=[],e+="",this.#e.forEach(i=>i[0]===e&&t.push(i[1])),t}has(e){return lr("has",arguments,1),e+="",this.#e.some(t=>t[0]===e)}forEach(e,t){lr("forEach",arguments,1);for(var[i,o]of this)e.call(t,o,i,this)}set(...e){lr("set",arguments,2);var t=[],i=!0;e=Fl(...e),this.#e.forEach(o=>{o[0]===e[0]?i&&(i=!t.push(e)):t.push(o)}),i&&t.push(e),this.#e=t}*entries(){yield*this.#e}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}}});var jl=ce((Vp,$l)=>{if(!globalThis.DOMException)try{let{MessageChannel:r}=require("worker_threads"),e=new r().port1,t=new ArrayBuffer;e.postMessage(t,[t,t])}catch(r){r.constructor.name==="DOMException"&&(globalThis.DOMException=r.constructor)}$l.exports=globalThis.DOMException});var Bi,Gf,Gp,aa=wn(()=>{Bi=require("node:fs"),Gf=lt(jl(),1);na();Sn();({stat:Gp}=Bi.promises)});var Vl={};Cl(Vl,{toFormData:()=>th});function eh(r){let e=r.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!e)return;let t=e[2]||e[3]||"",i=t.slice(t.lastIndexOf("\\")+1);return i=i.replace(/%22/g,'"'),i=i.replace(/&#(\d{4});/g,(o,s)=>String.fromCharCode(s)),i}async function th(r,e){if(!/multipart/i.test(e))throw new TypeError("Failed to fetch");let t=e.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!t)throw new TypeError("no or bad content-type header, no multipart boundary");let i=new sa(t[1]||t[2]),o,s,u,h,p,m,y=[],v=new ur,C=L=>{u+=x.decode(L,{stream:!0})},E=L=>{y.push(L)},R=()=>{let L=new Br(y,m,{type:p});v.append(h,L)},B=()=>{v.append(h,u)},x=new TextDecoder("utf-8");x.decode(),i.onPartBegin=function(){i.onPartData=C,i.onPartEnd=B,o="",s="",u="",h="",p="",m=null,y.length=0},i.onHeaderField=function(L){o+=x.decode(L,{stream:!0})},i.onHeaderValue=function(L){s+=x.decode(L,{stream:!0})},i.onHeaderEnd=function(){if(s+=x.decode(),o=o.toLowerCase(),o==="content-disposition"){let L=s.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);L&&(h=L[2]||L[3]||""),m=eh(s),m&&(i.onPartData=E,i.onPartEnd=R)}else o==="content-type"&&(p=s);s="",o=""};for await(let L of r)i.write(L);return i.end(),v}var ut,ne,Hl,jt,Li,Fi,Yf,En,Xf,Jf,Kf,Zf,cr,sa,zl=wn(()=>{aa();Mi();ut=0,ne={START_BOUNDARY:ut++,HEADER_FIELD_START:ut++,HEADER_FIELD:ut++,HEADER_VALUE_START:ut++,HEADER_VALUE:ut++,HEADER_VALUE_ALMOST_DONE:ut++,HEADERS_ALMOST_DONE:ut++,PART_DATA_START:ut++,PART_DATA:ut++,END:ut++},Hl=1,jt={PART_BOUNDARY:Hl,LAST_BOUNDARY:Hl*=2},Li=10,Fi=13,Yf=32,En=45,Xf=58,Jf=97,Kf=122,Zf=r=>r|32,cr=()=>{},sa=class{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=cr,this.onHeaderField=cr,this.onHeadersEnd=cr,this.onHeaderValue=cr,this.onPartBegin=cr,this.onPartData=cr,this.onPartEnd=cr,this.boundaryChars={},e=`\r
--`+e;let t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i),this.boundaryChars[t[i]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=ne.START_BOUNDARY}write(e){let t=0,i=e.length,o=this.index,{lookbehind:s,boundary:u,boundaryChars:h,index:p,state:m,flags:y}=this,v=this.boundary.length,C=v-1,E=e.length,R,B,x=k=>{this[k+"Mark"]=t},L=k=>{delete this[k+"Mark"]},P=(k,M,j,G)=>{(M===void 0||M!==j)&&this[k](G&&G.subarray(M,j))},D=(k,M)=>{let j=k+"Mark";j in this&&(M?(P(k,this[j],t,e),delete this[j]):(P(k,this[j],e.length,e),this[j]=0))};for(t=0;t<i;t++)switch(R=e[t],m){case ne.START_BOUNDARY:if(p===u.length-2){if(R===En)y|=jt.LAST_BOUNDARY;else if(R!==Fi)return;p++;break}else if(p-1===u.length-2){if(y&jt.LAST_BOUNDARY&&R===En)m=ne.END,y=0;else if(!(y&jt.LAST_BOUNDARY)&&R===Li)p=0,P("onPartBegin"),m=ne.HEADER_FIELD_START;else return;break}R!==u[p+2]&&(p=-2),R===u[p+2]&&p++;break;case ne.HEADER_FIELD_START:m=ne.HEADER_FIELD,x("onHeaderField"),p=0;case ne.HEADER_FIELD:if(R===Fi){L("onHeaderField"),m=ne.HEADERS_ALMOST_DONE;break}if(p++,R===En)break;if(R===Xf){if(p===1)return;D("onHeaderField",!0),m=ne.HEADER_VALUE_START;break}if(B=Zf(R),B<Jf||B>Kf)return;break;case ne.HEADER_VALUE_START:if(R===Yf)break;x("onHeaderValue"),m=ne.HEADER_VALUE;case ne.HEADER_VALUE:R===Fi&&(D("onHeaderValue",!0),P("onHeaderEnd"),m=ne.HEADER_VALUE_ALMOST_DONE);break;case ne.HEADER_VALUE_ALMOST_DONE:if(R!==Li)return;m=ne.HEADER_FIELD_START;break;case ne.HEADERS_ALMOST_DONE:if(R!==Li)return;P("onHeadersEnd"),m=ne.PART_DATA_START;break;case ne.PART_DATA_START:m=ne.PART_DATA,x("onPartData");case ne.PART_DATA:if(o=p,p===0){for(t+=C;t<E&&!(e[t]in h);)t+=v;t-=C,R=e[t]}if(p<u.length)u[p]===R?(p===0&&D("onPartData",!0),p++):p=0;else if(p===u.length)p++,R===Fi?y|=jt.PART_BOUNDARY:R===En?y|=jt.LAST_BOUNDARY:p=0;else if(p-1===u.length)if(y&jt.PART_BOUNDARY){if(p=0,R===Li){y&=~jt.PART_BOUNDARY,P("onPartEnd"),P("onPartBegin"),m=ne.HEADER_FIELD_START;break}}else y&jt.LAST_BOUNDARY&&R===En?(P("onPartEnd"),m=ne.END,y=0):p=0;if(p>0)s[p-1]=R;else if(o>0){let k=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);P("onPartData",0,o,k),o=0,x("onPartData"),t--}break;case ne.END:break;default:throw new Error(`Unexpected state entered: ${m}`)}D("onHeaderField"),D("onHeaderValue"),D("onPartData"),this.index=p,this.state=m,this.flags=y}end(){if(this.state===ne.HEADER_FIELD_START&&this.index===0||this.state===ne.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==ne.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}});var ja=ce(go=>{(function(r){r.parser=function(d,c){return new t(d,c)},r.SAXParser=t,r.SAXStream=m,r.createStream=p,r.MAX_BUFFER_LENGTH=64*1024;var e=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];r.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function t(d,c){if(!(this instanceof t))return new t(d,c);var T=this;o(T),T.q=T.c="",T.bufferCheckPosition=r.MAX_BUFFER_LENGTH,T.opt=c||{},T.opt.lowercase=T.opt.lowercase||T.opt.lowercasetags,T.looseCase=T.opt.lowercase?"toLowerCase":"toUpperCase",T.tags=[],T.closed=T.closedRoot=T.sawRoot=!1,T.tag=T.error=null,T.strict=!!d,T.noscript=!!(d||T.opt.noscript),T.state=g.BEGIN,T.strictEntities=T.opt.strictEntities,T.ENTITIES=T.strictEntities?Object.create(r.XML_ENTITIES):Object.create(r.ENTITIES),T.attribList=[],T.opt.xmlns&&(T.ns=Object.create(R)),T.trackPosition=T.opt.position!==!1,T.trackPosition&&(T.position=T.line=T.column=0),q(T,"onready")}Object.create||(Object.create=function(d){function c(){}c.prototype=d;var T=new c;return T}),Object.keys||(Object.keys=function(d){var c=[];for(var T in d)d.hasOwnProperty(T)&&c.push(T);return c});function i(d){for(var c=Math.max(r.MAX_BUFFER_LENGTH,10),T=0,_=0,J=e.length;_<J;_++){var oe=d[e[_]].length;if(oe>c)switch(e[_]){case"textNode":Y(d);break;case"cdata":O(d,"oncdata",d.cdata),d.cdata="";break;case"script":O(d,"onscript",d.script),d.script="";break;default:Z(d,"Max buffer length exceeded: "+e[_])}T=Math.max(T,oe)}var le=r.MAX_BUFFER_LENGTH-T;d.bufferCheckPosition=le+d.position}function o(d){for(var c=0,T=e.length;c<T;c++)d[e[c]]=""}function s(d){Y(d),d.cdata!==""&&(O(d,"oncdata",d.cdata),d.cdata=""),d.script!==""&&(O(d,"onscript",d.script),d.script="")}t.prototype={end:function(){Ae(this)},write:ve,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){s(this)}};var u;try{u=require("stream").Stream}catch{u=function(){}}var h=r.EVENTS.filter(function(d){return d!=="error"&&d!=="end"});function p(d,c){return new m(d,c)}function m(d,c){if(!(this instanceof m))return new m(d,c);u.apply(this),this._parser=new t(d,c),this.writable=!0,this.readable=!0;var T=this;this._parser.onend=function(){T.emit("end")},this._parser.onerror=function(_){T.emit("error",_),T._parser.error=null},this._decoder=null,h.forEach(function(_){Object.defineProperty(T,"on"+_,{get:function(){return T._parser["on"+_]},set:function(J){if(!J)return T.removeAllListeners(_),T._parser["on"+_]=J,J;T.on(_,J)},enumerable:!0,configurable:!1})})}m.prototype=Object.create(u.prototype,{constructor:{value:m}}),m.prototype.write=function(d){if(typeof Buffer=="function"&&typeof Buffer.isBuffer=="function"&&Buffer.isBuffer(d)){if(!this._decoder){var c=require("string_decoder").StringDecoder;this._decoder=new c("utf8")}d=this._decoder.write(d)}return this._parser.write(d.toString()),this.emit("data",d),!0},m.prototype.end=function(d){return d&&d.length&&this.write(d),this._parser.end(),!0},m.prototype.on=function(d,c){var T=this;return!T._parser["on"+d]&&h.indexOf(d)!==-1&&(T._parser["on"+d]=function(){var _=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);_.splice(0,0,d),T.emit.apply(T,_)}),u.prototype.on.call(T,d,c)};var y="[CDATA[",v="DOCTYPE",C="http://www.w3.org/XML/1998/namespace",E="http://www.w3.org/2000/xmlns/",R={xml:C,xmlns:E},B=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,x=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,L=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,P=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function D(d){return d===" "||d===`
`||d==="\r"||d==="	"}function k(d){return d==='"'||d==="'"}function M(d){return d===">"||D(d)}function j(d,c){return d.test(c)}function G(d,c){return!j(d,c)}var g=0;r.STATE={BEGIN:g++,BEGIN_WHITESPACE:g++,TEXT:g++,TEXT_ENTITY:g++,OPEN_WAKA:g++,SGML_DECL:g++,SGML_DECL_QUOTED:g++,DOCTYPE:g++,DOCTYPE_QUOTED:g++,DOCTYPE_DTD:g++,DOCTYPE_DTD_QUOTED:g++,COMMENT_STARTING:g++,COMMENT:g++,COMMENT_ENDING:g++,COMMENT_ENDED:g++,CDATA:g++,CDATA_ENDING:g++,CDATA_ENDING_2:g++,PROC_INST:g++,PROC_INST_BODY:g++,PROC_INST_ENDING:g++,OPEN_TAG:g++,OPEN_TAG_SLASH:g++,ATTRIB:g++,ATTRIB_NAME:g++,ATTRIB_NAME_SAW_WHITE:g++,ATTRIB_VALUE:g++,ATTRIB_VALUE_QUOTED:g++,ATTRIB_VALUE_CLOSED:g++,ATTRIB_VALUE_UNQUOTED:g++,ATTRIB_VALUE_ENTITY_Q:g++,ATTRIB_VALUE_ENTITY_U:g++,CLOSE_TAG:g++,CLOSE_TAG_SAW_WHITE:g++,SCRIPT:g++,SCRIPT_ENDING:g++},r.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},r.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(r.ENTITIES).forEach(function(d){var c=r.ENTITIES[d],T=typeof c=="number"?String.fromCharCode(c):c;r.ENTITIES[d]=T});for(var ae in r.STATE)r.STATE[r.STATE[ae]]=ae;g=r.STATE;function q(d,c,T){d[c]&&d[c](T)}function O(d,c,T){d.textNode&&Y(d),q(d,c,T)}function Y(d){d.textNode=ee(d.opt,d.textNode),d.textNode&&q(d,"ontext",d.textNode),d.textNode=""}function ee(d,c){return d.trim&&(c=c.trim()),d.normalize&&(c=c.replace(/\s+/g," ")),c}function Z(d,c){return Y(d),d.trackPosition&&(c+=`
Line: `+d.line+`
Column: `+d.column+`
Char: `+d.c),c=new Error(c),d.error=c,q(d,"onerror",c),d}function Ae(d){return d.sawRoot&&!d.closedRoot&&U(d,"Unclosed root tag"),d.state!==g.BEGIN&&d.state!==g.BEGIN_WHITESPACE&&d.state!==g.TEXT&&Z(d,"Unexpected end"),Y(d),d.c="",d.closed=!0,q(d,"onend"),t.call(d,d.strict,d.opt),d}function U(d,c){if(typeof d!="object"||!(d instanceof t))throw new Error("bad call to strictFail");d.strict&&Z(d,c)}function F(d){d.strict||(d.tagName=d.tagName[d.looseCase]());var c=d.tags[d.tags.length-1]||d,T=d.tag={name:d.tagName,attributes:{}};d.opt.xmlns&&(T.ns=c.ns),d.attribList.length=0,O(d,"onopentagstart",T)}function se(d,c){var T=d.indexOf(":"),_=T<0?["",d]:d.split(":"),J=_[0],oe=_[1];return c&&d==="xmlns"&&(J="xmlns",oe=""),{prefix:J,local:oe}}function Ot(d){if(d.strict||(d.attribName=d.attribName[d.looseCase]()),d.attribList.indexOf(d.attribName)!==-1||d.tag.attributes.hasOwnProperty(d.attribName)){d.attribName=d.attribValue="";return}if(d.opt.xmlns){var c=se(d.attribName,!0),T=c.prefix,_=c.local;if(T==="xmlns")if(_==="xml"&&d.attribValue!==C)U(d,"xml: prefix must be bound to "+C+`
Actual: `+d.attribValue);else if(_==="xmlns"&&d.attribValue!==E)U(d,"xmlns: prefix must be bound to "+E+`
Actual: `+d.attribValue);else{var J=d.tag,oe=d.tags[d.tags.length-1]||d;J.ns===oe.ns&&(J.ns=Object.create(oe.ns)),J.ns[_]=d.attribValue}d.attribList.push([d.attribName,d.attribValue])}else d.tag.attributes[d.attribName]=d.attribValue,O(d,"onattribute",{name:d.attribName,value:d.attribValue});d.attribName=d.attribValue=""}function at(d,c){if(d.opt.xmlns){var T=d.tag,_=se(d.tagName);T.prefix=_.prefix,T.local=_.local,T.uri=T.ns[_.prefix]||"",T.prefix&&!T.uri&&(U(d,"Unbound namespace prefix: "+JSON.stringify(d.tagName)),T.uri=_.prefix);var J=d.tags[d.tags.length-1]||d;T.ns&&J.ns!==T.ns&&Object.keys(T.ns).forEach(function(Ze){O(d,"onopennamespace",{prefix:Ze,uri:T.ns[Ze]})});for(var oe=0,le=d.attribList.length;oe<le;oe++){var he=d.attribList[oe],Pe=he[0],Oe=he[1],ue=se(Pe,!0),Be=ue.prefix,Tr=ue.local,un=Be===""?"":T.ns[Be]||"",je={name:Pe,value:Oe,prefix:Be,local:Tr,uri:un};Be&&Be!=="xmlns"&&!un&&(U(d,"Unbound namespace prefix: "+JSON.stringify(Be)),je.uri=Be),d.tag.attributes[Pe]=je,O(d,"onattribute",je)}d.attribList.length=0}d.tag.isSelfClosing=!!c,d.sawRoot=!0,d.tags.push(d.tag),O(d,"onopentag",d.tag),c||(!d.noscript&&d.tagName.toLowerCase()==="script"?d.state=g.SCRIPT:d.state=g.TEXT,d.tag=null,d.tagName=""),d.attribName=d.attribValue="",d.attribList.length=0}function Rr(d){if(!d.tagName){U(d,"Weird empty close tag."),d.textNode+="</>",d.state=g.TEXT;return}if(d.script){if(d.tagName!=="script"){d.script+="</"+d.tagName+">",d.tagName="",d.state=g.SCRIPT;return}O(d,"onscript",d.script),d.script=""}var c=d.tags.length,T=d.tagName;d.strict||(T=T[d.looseCase]());for(var _=T;c--;){var J=d.tags[c];if(J.name!==_)U(d,"Unexpected close tag");else break}if(c<0){U(d,"Unmatched closing tag: "+d.tagName),d.textNode+="</"+d.tagName+">",d.state=g.TEXT;return}d.tagName=T;for(var oe=d.tags.length;oe-- >c;){var le=d.tag=d.tags.pop();d.tagName=d.tag.name,O(d,"onclosetag",d.tagName);var he={};for(var Pe in le.ns)he[Pe]=le.ns[Pe];var Oe=d.tags[d.tags.length-1]||d;d.opt.xmlns&&le.ns!==Oe.ns&&Object.keys(le.ns).forEach(function(ue){var Be=le.ns[ue];O(d,"onclosenamespace",{prefix:ue,uri:Be})})}c===0&&(d.closedRoot=!0),d.tagName=d.attribValue=d.attribName="",d.attribList.length=0,d.state=g.TEXT}function Eo(d){var c=d.entity,T=c.toLowerCase(),_,J="";return d.ENTITIES[c]?d.ENTITIES[c]:d.ENTITIES[T]?d.ENTITIES[T]:(c=T,c.charAt(0)==="#"&&(c.charAt(1)==="x"?(c=c.slice(2),_=parseInt(c,16),J=_.toString(16)):(c=c.slice(1),_=parseInt(c,10),J=_.toString(10))),c=c.replace(/^0+/,""),isNaN(_)||J.toLowerCase()!==c?(U(d,"Invalid character entity"),"&"+d.entity+";"):String.fromCodePoint(_))}function ri(d,c){c==="<"?(d.state=g.OPEN_WAKA,d.startTagPosition=d.position):D(c)||(U(d,"Non-whitespace before first tag."),d.textNode=c,d.state=g.TEXT)}function Me(d,c){var T="";return c<d.length&&(T=d.charAt(c)),T}function ve(d){var c=this;if(this.error)throw this.error;if(c.closed)return Z(c,"Cannot write after close. Assign an onready handler.");if(d===null)return Ae(c);typeof d=="object"&&(d=d.toString());for(var T=0,_="";_=Me(d,T++),c.c=_,!!_;)switch(c.trackPosition&&(c.position++,_===`
`?(c.line++,c.column=0):c.column++),c.state){case g.BEGIN:if(c.state=g.BEGIN_WHITESPACE,_==="\uFEFF")continue;ri(c,_);continue;case g.BEGIN_WHITESPACE:ri(c,_);continue;case g.TEXT:if(c.sawRoot&&!c.closedRoot){for(var J=T-1;_&&_!=="<"&&_!=="&";)_=Me(d,T++),_&&c.trackPosition&&(c.position++,_===`
`?(c.line++,c.column=0):c.column++);c.textNode+=d.substring(J,T-1)}_==="<"&&!(c.sawRoot&&c.closedRoot&&!c.strict)?(c.state=g.OPEN_WAKA,c.startTagPosition=c.position):(!D(_)&&(!c.sawRoot||c.closedRoot)&&U(c,"Text data outside of root node."),_==="&"?c.state=g.TEXT_ENTITY:c.textNode+=_);continue;case g.SCRIPT:_==="<"?c.state=g.SCRIPT_ENDING:c.script+=_;continue;case g.SCRIPT_ENDING:_==="/"?c.state=g.CLOSE_TAG:(c.script+="<"+_,c.state=g.SCRIPT);continue;case g.OPEN_WAKA:if(_==="!")c.state=g.SGML_DECL,c.sgmlDecl="";else if(!D(_))if(j(B,_))c.state=g.OPEN_TAG,c.tagName=_;else if(_==="/")c.state=g.CLOSE_TAG,c.tagName="";else if(_==="?")c.state=g.PROC_INST,c.procInstName=c.procInstBody="";else{if(U(c,"Unencoded <"),c.startTagPosition+1<c.position){var oe=c.position-c.startTagPosition;_=new Array(oe).join(" ")+_}c.textNode+="<"+_,c.state=g.TEXT}continue;case g.SGML_DECL:(c.sgmlDecl+_).toUpperCase()===y?(O(c,"onopencdata"),c.state=g.CDATA,c.sgmlDecl="",c.cdata=""):c.sgmlDecl+_==="--"?(c.state=g.COMMENT,c.comment="",c.sgmlDecl=""):(c.sgmlDecl+_).toUpperCase()===v?(c.state=g.DOCTYPE,(c.doctype||c.sawRoot)&&U(c,"Inappropriately located doctype declaration"),c.doctype="",c.sgmlDecl=""):_===">"?(O(c,"onsgmldeclaration",c.sgmlDecl),c.sgmlDecl="",c.state=g.TEXT):(k(_)&&(c.state=g.SGML_DECL_QUOTED),c.sgmlDecl+=_);continue;case g.SGML_DECL_QUOTED:_===c.q&&(c.state=g.SGML_DECL,c.q=""),c.sgmlDecl+=_;continue;case g.DOCTYPE:_===">"?(c.state=g.TEXT,O(c,"ondoctype",c.doctype),c.doctype=!0):(c.doctype+=_,_==="["?c.state=g.DOCTYPE_DTD:k(_)&&(c.state=g.DOCTYPE_QUOTED,c.q=_));continue;case g.DOCTYPE_QUOTED:c.doctype+=_,_===c.q&&(c.q="",c.state=g.DOCTYPE);continue;case g.DOCTYPE_DTD:c.doctype+=_,_==="]"?c.state=g.DOCTYPE:k(_)&&(c.state=g.DOCTYPE_DTD_QUOTED,c.q=_);continue;case g.DOCTYPE_DTD_QUOTED:c.doctype+=_,_===c.q&&(c.state=g.DOCTYPE_DTD,c.q="");continue;case g.COMMENT:_==="-"?c.state=g.COMMENT_ENDING:c.comment+=_;continue;case g.COMMENT_ENDING:_==="-"?(c.state=g.COMMENT_ENDED,c.comment=ee(c.opt,c.comment),c.comment&&O(c,"oncomment",c.comment),c.comment=""):(c.comment+="-"+_,c.state=g.COMMENT);continue;case g.COMMENT_ENDED:_!==">"?(U(c,"Malformed comment"),c.comment+="--"+_,c.state=g.COMMENT):c.state=g.TEXT;continue;case g.CDATA:_==="]"?c.state=g.CDATA_ENDING:c.cdata+=_;continue;case g.CDATA_ENDING:_==="]"?c.state=g.CDATA_ENDING_2:(c.cdata+="]"+_,c.state=g.CDATA);continue;case g.CDATA_ENDING_2:_===">"?(c.cdata&&O(c,"oncdata",c.cdata),O(c,"onclosecdata"),c.cdata="",c.state=g.TEXT):_==="]"?c.cdata+="]":(c.cdata+="]]"+_,c.state=g.CDATA);continue;case g.PROC_INST:_==="?"?c.state=g.PROC_INST_ENDING:D(_)?c.state=g.PROC_INST_BODY:c.procInstName+=_;continue;case g.PROC_INST_BODY:if(!c.procInstBody&&D(_))continue;_==="?"?c.state=g.PROC_INST_ENDING:c.procInstBody+=_;continue;case g.PROC_INST_ENDING:_===">"?(O(c,"onprocessinginstruction",{name:c.procInstName,body:c.procInstBody}),c.procInstName=c.procInstBody="",c.state=g.TEXT):(c.procInstBody+="?"+_,c.state=g.PROC_INST_BODY);continue;case g.OPEN_TAG:j(x,_)?c.tagName+=_:(F(c),_===">"?at(c):_==="/"?c.state=g.OPEN_TAG_SLASH:(D(_)||U(c,"Invalid character in tag name"),c.state=g.ATTRIB));continue;case g.OPEN_TAG_SLASH:_===">"?(at(c,!0),Rr(c)):(U(c,"Forward-slash in opening tag not followed by >"),c.state=g.ATTRIB);continue;case g.ATTRIB:if(D(_))continue;_===">"?at(c):_==="/"?c.state=g.OPEN_TAG_SLASH:j(B,_)?(c.attribName=_,c.attribValue="",c.state=g.ATTRIB_NAME):U(c,"Invalid attribute name");continue;case g.ATTRIB_NAME:_==="="?c.state=g.ATTRIB_VALUE:_===">"?(U(c,"Attribute without value"),c.attribValue=c.attribName,Ot(c),at(c)):D(_)?c.state=g.ATTRIB_NAME_SAW_WHITE:j(x,_)?c.attribName+=_:U(c,"Invalid attribute name");continue;case g.ATTRIB_NAME_SAW_WHITE:if(_==="=")c.state=g.ATTRIB_VALUE;else{if(D(_))continue;U(c,"Attribute without value"),c.tag.attributes[c.attribName]="",c.attribValue="",O(c,"onattribute",{name:c.attribName,value:""}),c.attribName="",_===">"?at(c):j(B,_)?(c.attribName=_,c.state=g.ATTRIB_NAME):(U(c,"Invalid attribute name"),c.state=g.ATTRIB)}continue;case g.ATTRIB_VALUE:if(D(_))continue;k(_)?(c.q=_,c.state=g.ATTRIB_VALUE_QUOTED):(U(c,"Unquoted attribute value"),c.state=g.ATTRIB_VALUE_UNQUOTED,c.attribValue=_);continue;case g.ATTRIB_VALUE_QUOTED:if(_!==c.q){_==="&"?c.state=g.ATTRIB_VALUE_ENTITY_Q:c.attribValue+=_;continue}Ot(c),c.q="",c.state=g.ATTRIB_VALUE_CLOSED;continue;case g.ATTRIB_VALUE_CLOSED:D(_)?c.state=g.ATTRIB:_===">"?at(c):_==="/"?c.state=g.OPEN_TAG_SLASH:j(B,_)?(U(c,"No whitespace between attributes"),c.attribName=_,c.attribValue="",c.state=g.ATTRIB_NAME):U(c,"Invalid attribute name");continue;case g.ATTRIB_VALUE_UNQUOTED:if(!M(_)){_==="&"?c.state=g.ATTRIB_VALUE_ENTITY_U:c.attribValue+=_;continue}Ot(c),_===">"?at(c):c.state=g.ATTRIB;continue;case g.CLOSE_TAG:if(c.tagName)_===">"?Rr(c):j(x,_)?c.tagName+=_:c.script?(c.script+="</"+c.tagName,c.tagName="",c.state=g.SCRIPT):(D(_)||U(c,"Invalid tagname in closing tag"),c.state=g.CLOSE_TAG_SAW_WHITE);else{if(D(_))continue;G(B,_)?c.script?(c.script+="</"+_,c.state=g.SCRIPT):U(c,"Invalid tagname in closing tag."):c.tagName=_}continue;case g.CLOSE_TAG_SAW_WHITE:if(D(_))continue;_===">"?Rr(c):U(c,"Invalid characters in closing tag");continue;case g.TEXT_ENTITY:case g.ATTRIB_VALUE_ENTITY_Q:case g.ATTRIB_VALUE_ENTITY_U:var le,he;switch(c.state){case g.TEXT_ENTITY:le=g.TEXT,he="textNode";break;case g.ATTRIB_VALUE_ENTITY_Q:le=g.ATTRIB_VALUE_QUOTED,he="attribValue";break;case g.ATTRIB_VALUE_ENTITY_U:le=g.ATTRIB_VALUE_UNQUOTED,he="attribValue";break}_===";"?(c[he]+=Eo(c),c.entity="",c.state=le):j(c.entity.length?P:L,_)?c.entity+=_:(U(c,"Invalid character in entity name"),c[he]+="&"+c.entity+_,c.entity="",c.state=le);continue;default:throw new Error(c,"Unknown state: "+c.state)}return c.position>=c.bufferCheckPosition&&i(c),c}String.fromCodePoint||(function(){var d=String.fromCharCode,c=Math.floor,T=function(){var _=16384,J=[],oe,le,he=-1,Pe=arguments.length;if(!Pe)return"";for(var Oe="";++he<Pe;){var ue=Number(arguments[he]);if(!isFinite(ue)||ue<0||ue>1114111||c(ue)!==ue)throw RangeError("Invalid code point: "+ue);ue<=65535?J.push(ue):(ue-=65536,oe=(ue>>10)+55296,le=ue%1024+56320,J.push(oe,le)),(he+1===Pe||J.length>_)&&(Oe+=d.apply(null,J),J.length=0)}return Oe};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:T,configurable:!0,writable:!0}):String.fromCodePoint=T})()})(typeof go>"u"?go.sax={}:go)});var Qn=ce((Ha,Ju)=>{"use strict";var Xu=Ha&&Ha.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},$h=Xu(require("http")),jh=Xu(require("https")),Hh=require("stream"),Yu={"http:":$h.default,"https:":jh.default},Vh=new Set([301,302,303,307,308]),zh=new Set([429,503]),Qh=["connect","continue","information","socket","timeout","upgrade"],Gh=["aborted"];mt.MinigetError=class extends Error{constructor(e,t){super(e),this.statusCode=t}};mt.defaultOptions={maxRedirects:10,maxRetries:2,maxReconnects:0,backoff:{inc:100,max:1e4}};function mt(r,e={}){var t;let i=Object.assign({},mt.defaultOptions,e),o=new Hh.PassThrough({highWaterMark:i.highWaterMark});o.destroyed=o.aborted=!1;let s,u,h,p=0,m=0,y,v=0,C,E=!1,R=0,B,x=0;if(!((t=i.headers)===null||t===void 0)&&t.Range){let q=/bytes=(\d+)-(\d+)?/.exec(`${i.headers.Range}`);q&&(R=parseInt(q[1],10),B=parseInt(q[2],10))}i.acceptEncoding&&(i.headers=Object.assign({"Accept-Encoding":Object.keys(i.acceptEncoding).join(", ")},i.headers));let L=()=>h&&x>0,P=()=>!E||x===C,D=q=>{h=null,m=0;let O=i.backoff.inc,Y=Math.min(O,i.backoff.max);y=setTimeout(G,Y),o.emit("reconnect",v,q)},k=q=>e.method!=="HEAD"&&!P()&&v++<i.maxReconnects?(D(q),!0):!1,M=q=>{if(o.destroyed)return!1;if(L())return k(q.err);if((!q.err||q.err.message==="ENOTFOUND")&&m++<i.maxRetries){let O=q.retryAfter||Math.min(m*i.backoff.inc,i.backoff.max);return y=setTimeout(G,O),o.emit("retry",m,q.err),!0}return!1},j=(q,O)=>{for(let Y of O)q.on(Y,o.emit.bind(o,Y))},G=()=>{let q={},O;try{let F=typeof r=="string"?new URL(r):r;q=Object.assign({},{host:F.host,hostname:F.hostname,path:F.pathname+F.search+F.hash,port:F.port,protocol:F.protocol}),F.username&&(q.auth=`${F.username}:${F.password}`),O=Yu[String(q.protocol)]}catch{}if(!O){o.emit("error",new mt.MinigetError(`Invalid URL: ${r}`));return}if(Object.assign(q,i),E&&x>0){let F=x+R,se=B||"";q.headers=Object.assign({},q.headers,{Range:`bytes=${F}-${se}`})}if(i.transform){try{q=i.transform(q)}catch(F){o.emit("error",F);return}if((!q||q.protocol)&&(O=Yu[String(q?.protocol)],!O)){o.emit("error",new mt.MinigetError("Invalid URL object from `transform` function"));return}}let Y=F=>{o.destroyed||o.readableEnded||(Z(),M({err:F})?s.removeListener("close",ee):o.emit("error",F))},ee=()=>{Z(),M({})},Z=()=>{s.removeListener("close",ee),u?.removeListener("data",Ae),h?.removeListener("end",U)},Ae=F=>{x+=F.length},U=()=>{Z(),k()||o.end()};s=O.request(q,F=>{if(!o.destroyed){if(Vh.has(F.statusCode)){if(p++>=i.maxRedirects)o.emit("error",new mt.MinigetError("Too many redirects"));else{if(F.headers.location)r=F.headers.location;else{let se=new mt.MinigetError("Redirect status code given with no location",F.statusCode);o.emit("error",se),Z();return}setTimeout(G,parseInt(F.headers["retry-after"]||"0",10)*1e3),o.emit("redirect",r)}Z();return}else if(zh.has(F.statusCode)){if(!M({retryAfter:parseInt(F.headers["retry-after"]||"0",10)})){let se=new mt.MinigetError(`Status code: ${F.statusCode}`,F.statusCode);o.emit("error",se)}Z();return}else if(F.statusCode&&(F.statusCode<200||F.statusCode>=400)){let se=new mt.MinigetError(`Status code: ${F.statusCode}`,F.statusCode);F.statusCode>=500?Y(se):o.emit("error",se),Z();return}if(h=F,i.acceptEncoding&&F.headers["content-encoding"])for(let se of F.headers["content-encoding"].split(", ").reverse()){let Ot=i.acceptEncoding[se];Ot&&(h=h.pipe(Ot()),h.on("error",Y))}C||(C=parseInt(`${F.headers["content-length"]}`,10),E=F.headers["accept-ranges"]==="bytes"&&C>0&&i.maxReconnects>0),F.on("data",Ae),h.on("end",U),h.pipe(o,{end:!E}),u=F,o.emit("response",F),F.on("error",Y),j(F,Gh)}}),s.on("error",Y),s.on("close",ee),j(s,Qh),o.destroyed&&ae(...g),o.emit("request",s),s.end()};o.abort=q=>{console.warn("`MinigetStream#abort()` has been deprecated in favor of `MinigetStream#destroy()`"),o.aborted=!0,o.emit("abort"),o.destroy(q)};let g,ae=q=>{s.destroy(q),h?.unpipe(o),h?.destroy(),clearTimeout(y)};return o._destroy=(...q)=>{o.destroyed=!0,s?ae(...q):g=q},o.text=()=>new Promise((q,O)=>{let Y="";o.setEncoding("utf8"),o.on("data",ee=>Y+=ee),o.on("end",()=>q(Y)),o.on("error",O)}),process.nextTick(G),o}Ju.exports=mt});var Va=ce((X_,Yh)=>{Yh.exports={name:"ytdl-core",description:"YouTube video downloader in pure javascript.",keywords:["youtube","video","download"],version:"4.11.5",repository:{type:"git",url:"git://github.com/fent/node-ytdl-core.git"},author:"fent <fentbox@gmail.com> (https://github.com/fent)",contributors:["Tobias Kutscha (https://github.com/TimeForANinja)","Andrew Kelley (https://github.com/andrewrk)","Mauricio Allende (https://github.com/mallendeo)","Rodrigo Altamirano (https://github.com/raltamirano)","Jim Buck (https://github.com/JimmyBoh)","Pawe\u0142 Ruci\u0144ski (https://github.com/Roki100)","Alexander Paolini (https://github.com/Million900o)"],main:"./lib/index.js",types:"./typings/index.d.ts",files:["lib","typings"],scripts:{test:"nyc --reporter=lcov --reporter=text-summary npm run test:unit","test:unit":"mocha --ignore test/irl-test.js test/*-test.js --timeout 4000","test:irl":"mocha --timeout 16000 test/irl-test.js",lint:"eslint ./","lint:fix":"eslint --fix ./","lint:typings":"tslint typings/index.d.ts","lint:typings:fix":"tslint --fix typings/index.d.ts"},dependencies:{m3u8stream:"^0.8.6",miniget:"^4.2.2",sax:"^1.1.3"},devDependencies:{"@types/node":"^13.1.0","assert-diff":"^3.0.1",dtslint:"^3.6.14",eslint:"^6.8.0",mocha:"^7.0.0","muk-require":"^1.2.0",nock:"^13.0.4",nyc:"^15.0.0",sinon:"^9.0.0","stream-equal":"~1.1.0",typescript:"^3.9.7"},engines:{node:">=12"},license:"MIT"}});var nn=ce(De=>{var Zu=Qn();De.between=(r,e,t)=>{let i;if(e instanceof RegExp){let o=r.match(e);if(!o)return"";i=o.index+o[0].length}else{if(i=r.indexOf(e),i===-1)return"";i+=e.length}return r=r.slice(i),i=r.indexOf(t),i===-1?"":(r=r.slice(0,i),r)};De.parseAbbreviatedNumber=r=>{let e=r.replace(",",".").replace(" ","").match(/([\d,.]+)([MK]?)/);if(e){let[,t,i]=e;return t=parseFloat(t),Math.round(i==="M"?t*1e6:i==="K"?t*1e3:t)}return null};var Xh=[{start:'"',end:'"'},{start:"'",end:"'"},{start:"`",end:"`"},{start:"/",end:"/",startPrefix:/(^|[[{:;,/])\s?$/}];De.cutAfterJS=r=>{let e,t;if(r[0]==="["?(e="[",t="]"):r[0]==="{"&&(e="{",t="}"),!e)throw new Error(`Can't cut unsupported JSON (need to begin with [ or { ) but got: ${r[0]}`);let i=null,o=!1,s=0,u;for(u=0;u<r.length;u++){if(!o&&i!==null&&r[u]===i.end){i=null;continue}else if(!o&&i===null){for(let h of Xh)if(r[u]===h.start&&(!h.startPrefix||r.substring(u-10,u).match(h.startPrefix))){i=h;break}if(i!==null)continue}if(o=r[u]==="\\"&&!o,i===null&&(r[u]===e?s++:r[u]===t&&s--,s===0))return r.substring(0,u+1)}throw Error("Can't cut unsupported JSON (no matching closing bracket found)")};De.playError=(r,e,t=Error)=>{let i=r&&r.playabilityStatus;return i&&e.includes(i.status)?new t(i.reason||i.messages&&i.messages[0]):null};De.exposedMiniget=(r,e={},t)=>{let i=Zu(r,t||e.requestOptions);return typeof e.requestCallback=="function"&&e.requestCallback(i),i};De.deprecate=(r,e,t,i,o)=>{Object.defineProperty(r,e,{get:()=>(console.warn(`\`${i}\` will be removed in a near future release, use \`${o}\` instead.`),t)})};var Ku=Va(),Jh=1e3*60*60*12;De.lastUpdateCheck=0;De.checkForUpdates=()=>!process.env.YTDL_NO_UPDATE&&!Ku.version.startsWith("0.0.0-")&&Date.now()-De.lastUpdateCheck>=Jh?(De.lastUpdateCheck=Date.now(),Zu("https://api.github.com/repos/fent/node-ytdl-core/releases/latest",{headers:{"User-Agent":"ytdl-core"}}).text().then(r=>{JSON.parse(r).tag_name!==`v${Ku.version}`&&console.warn('\x1B[33mWARNING:\x1B[0m ytdl-core is out of date! Update with "npm install ytdl-core@latest".')},r=>{console.warn("Error checking for updates:",r.message),console.warn("You can disable this check by setting the `YTDL_NO_UPDATE` env variable.")})):null;De.getRandomIPv6=r=>{if(!Zh(r))throw Error("Invalid IPv6 format");let[e,t]=r.split("/"),i=parseInt(t);if(!i||i>128||i<24)throw Error("Invalid IPv6 subnet");let o=em(e);return new Array(8).fill(1).map(()=>Math.floor(Math.random()*65535)).map((h,p)=>{let m=Math.min(i,16);i-=m;let y=65535-(2**(16-m)-1);return(o[p]&y)+(h&(y^65535))}).map(h=>h.toString("16")).join(":")};var Kh=/^(([0-9a-f]{1,4}:)(:[0-9a-f]{1,4}){1,6}|([0-9a-f]{1,4}:){1,2}(:[0-9a-f]{1,4}){1,5}|([0-9a-f]{1,4}:){1,3}(:[0-9a-f]{1,4}){1,4}|([0-9a-f]{1,4}:){1,4}(:[0-9a-f]{1,4}){1,3}|([0-9a-f]{1,4}:){1,5}(:[0-9a-f]{1,4}){1,2}|([0-9a-f]{1,4}:){1,6}(:[0-9a-f]{1,4})|([0-9a-f]{1,4}:){1,7}(([0-9a-f]{1,4})|:))\/(1[0-1]\d|12[0-8]|\d{1,2})$/,Zh=De.isIPv6=r=>Kh.test(r),em=De.normalizeIP=r=>{let e=r.split("::").map(s=>s.split(":")),t=e[0]||[],i=e[1]||[];i.reverse();let o=new Array(8).fill(0);for(let s=0;s<Math.min(t.length,8);s++)o[s]=parseInt(t[s],16)||0;for(let s=0;s<Math.min(i.length,8);s++)o[7-s]=parseInt(i[s],16)||0;return o}});var tc=ce((K_,ec)=>{ec.exports={5:{mimeType:'video/flv; codecs="Sorenson H.283, mp3"',qualityLabel:"240p",bitrate:25e4,audioBitrate:64},6:{mimeType:'video/flv; codecs="Sorenson H.263, mp3"',qualityLabel:"270p",bitrate:8e5,audioBitrate:64},13:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:null,bitrate:5e5,audioBitrate:null},17:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:"144p",bitrate:5e4,audioBitrate:24},18:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:96},22:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},34:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},35:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"480p",bitrate:8e5,audioBitrate:128},36:{mimeType:'video/3gp; codecs="MPEG-4 Visual, aac"',qualityLabel:"240p",bitrate:175e3,audioBitrate:32},37:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:3e6,audioBitrate:192},38:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"3072p",bitrate:35e5,audioBitrate:192},43:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},44:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"480p",bitrate:1e6,audioBitrate:128},45:{mimeType:'video/webm; codecs="VP8, vorbis"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},46:{mimeType:'audio/webm; codecs="vp8, vorbis"',qualityLabel:"1080p",bitrate:null,audioBitrate:192},82:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:96},83:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"240p",bitrate:5e5,audioBitrate:96},84:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:192},85:{mimeType:'video/mp4; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:3e6,audioBitrate:192},91:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"144p",bitrate:1e5,audioBitrate:48},92:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"240p",bitrate:15e4,audioBitrate:48},93:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"360p",bitrate:5e5,audioBitrate:128},94:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"480p",bitrate:8e5,audioBitrate:128},95:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:15e5,audioBitrate:256},96:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"1080p",bitrate:25e5,audioBitrate:256},100:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:null,audioBitrate:128},101:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"360p",bitrate:null,audioBitrate:192},102:{mimeType:'audio/webm; codecs="VP8, vorbis"',qualityLabel:"720p",bitrate:null,audioBitrate:192},120:{mimeType:'video/flv; codecs="H.264, aac"',qualityLabel:"720p",bitrate:2e6,audioBitrate:128},127:{mimeType:'audio/ts; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:96},128:{mimeType:'audio/ts; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:96},132:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"240p",bitrate:15e4,audioBitrate:48},133:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"240p",bitrate:2e5,audioBitrate:null},134:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"360p",bitrate:3e5,audioBitrate:null},135:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"480p",bitrate:5e5,audioBitrate:null},136:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"720p",bitrate:1e6,audioBitrate:null},137:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1080p",bitrate:25e5,audioBitrate:null},138:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"4320p",bitrate:135e5,audioBitrate:null},139:{mimeType:'audio/mp4; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:48},140:{mimeType:'audio/m4a; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:128},141:{mimeType:'audio/mp4; codecs="aac"',qualityLabel:null,bitrate:null,audioBitrate:256},151:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:5e4,audioBitrate:24},160:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"144p",bitrate:1e5,audioBitrate:null},171:{mimeType:'audio/webm; codecs="vorbis"',qualityLabel:null,bitrate:null,audioBitrate:128},172:{mimeType:'audio/webm; codecs="vorbis"',qualityLabel:null,bitrate:null,audioBitrate:192},242:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p",bitrate:1e5,audioBitrate:null},243:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"360p",bitrate:25e4,audioBitrate:null},244:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"480p",bitrate:5e5,audioBitrate:null},247:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p",bitrate:7e5,audioBitrate:null},248:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p",bitrate:15e5,audioBitrate:null},249:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:48},250:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:64},251:{mimeType:'audio/webm; codecs="opus"',qualityLabel:null,bitrate:null,audioBitrate:160},264:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1440p",bitrate:4e6,audioBitrate:null},266:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"2160p",bitrate:125e5,audioBitrate:null},271:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p",bitrate:9e6,audioBitrate:null},272:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"4320p",bitrate:2e7,audioBitrate:null},278:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"144p 30fps",bitrate:8e4,audioBitrate:null},298:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"720p",bitrate:3e6,audioBitrate:null},299:{mimeType:'video/mp4; codecs="H.264"',qualityLabel:"1080p",bitrate:55e5,audioBitrate:null},300:{mimeType:'video/ts; codecs="H.264, aac"',qualityLabel:"720p",bitrate:1318e3,audioBitrate:48},302:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p HFR",bitrate:25e5,audioBitrate:null},303:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p HFR",bitrate:5e6,audioBitrate:null},308:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p HFR",bitrate:1e7,audioBitrate:null},313:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p",bitrate:13e6,audioBitrate:null},315:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p HFR",bitrate:2e7,audioBitrate:null},330:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"144p HDR, HFR",bitrate:8e4,audioBitrate:null},331:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p HDR, HFR",bitrate:1e5,audioBitrate:null},332:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"360p HDR, HFR",bitrate:25e4,audioBitrate:null},333:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"240p HDR, HFR",bitrate:5e5,audioBitrate:null},334:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"720p HDR, HFR",bitrate:1e6,audioBitrate:null},335:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1080p HDR, HFR",bitrate:15e5,audioBitrate:null},336:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"1440p HDR, HFR",bitrate:5e6,audioBitrate:null},337:{mimeType:'video/webm; codecs="VP9"',qualityLabel:"2160p HDR, HFR",bitrate:12e6,audioBitrate:null}}});var Ya=ce(pt=>{var tm=nn(),rm=tc(),nm=["mp4a","mp3","vorbis","aac","opus","flac"],im=["mp4v","avc1","Sorenson H.283","MPEG-4 Visual","VP8","VP9","H.264"],rc=r=>r.bitrate||0,nc=r=>im.findIndex(e=>r.codecs&&r.codecs.includes(e)),ic=r=>r.audioBitrate||0,oc=r=>nm.findIndex(e=>r.codecs&&r.codecs.includes(e)),Ga=(r,e,t)=>{let i=0;for(let o of t)if(i=o(e)-o(r),i!==0)break;return i},za=(r,e)=>Ga(r,e,[t=>parseInt(t.qualityLabel),rc,nc]),Qa=(r,e)=>Ga(r,e,[ic,oc]);pt.sortFormats=(r,e)=>Ga(r,e,[t=>+!!t.isHLS,t=>+!!t.isDashMPD,t=>+(t.contentLength>0),t=>+(t.hasVideo&&t.hasAudio),t=>+t.hasVideo,t=>parseInt(t.qualityLabel)||0,rc,ic,nc,oc]);pt.chooseFormat=(r,e)=>{if(typeof e.format=="object"){if(!e.format.url)throw Error("Invalid format given, did you use `ytdl.getInfo()`?");return e.format}e.filter&&(r=pt.filterFormats(r,e.filter)),r.some(o=>o.isHLS)&&(r=r.filter(o=>o.isHLS||!o.isLive));let t,i=e.quality||"highest";switch(i){case"highest":t=r[0];break;case"lowest":t=r[r.length-1];break;case"highestaudio":{r=pt.filterFormats(r,"audio"),r.sort(Qa);let o=r[0];r=r.filter(u=>Qa(o,u)===0);let s=r.map(u=>parseInt(u.qualityLabel)||0).sort((u,h)=>u-h)[0];t=r.find(u=>(parseInt(u.qualityLabel)||0)===s);break}case"lowestaudio":r=pt.filterFormats(r,"audio"),r.sort(Qa),t=r[r.length-1];break;case"highestvideo":{r=pt.filterFormats(r,"video"),r.sort(za);let o=r[0];r=r.filter(u=>za(o,u)===0);let s=r.map(u=>u.audioBitrate||0).sort((u,h)=>u-h)[0];t=r.find(u=>(u.audioBitrate||0)===s);break}case"lowestvideo":r=pt.filterFormats(r,"video"),r.sort(za),t=r[r.length-1];break;default:t=om(i,r);break}if(!t)throw Error(`No such format found: ${i}`);return t};var om=(r,e)=>{let t=i=>e.find(o=>`${o.itag}`==`${i}`);return Array.isArray(r)?t(r.find(i=>t(i))):t(r)};pt.filterFormats=(r,e)=>{let t;switch(e){case"videoandaudio":case"audioandvideo":t=i=>i.hasVideo&&i.hasAudio;break;case"video":t=i=>i.hasVideo;break;case"videoonly":t=i=>i.hasVideo&&!i.hasAudio;break;case"audio":t=i=>i.hasAudio;break;case"audioonly":t=i=>!i.hasVideo&&i.hasAudio;break;default:if(typeof e=="function")t=e;else throw TypeError(`Given filter (${e}) is not supported`)}return r.filter(i=>!!i.url&&t(i))};pt.addFormatMeta=r=>(r=Object.assign({},rm[r.itag],r),r.hasVideo=!!r.qualityLabel,r.hasAudio=!!r.audioBitrate,r.container=r.mimeType?r.mimeType.split(";")[0].split("/")[1]:null,r.codecs=r.mimeType?tm.between(r.mimeType,'codecs="','"'):null,r.videoCodec=r.hasVideo&&r.codecs?r.codecs.split(", ")[0]:null,r.audioCodec=r.hasAudio&&r.codecs?r.codecs.split(", ").slice(-1)[0]:null,r.isLive=/\bsource[/=]yt_live_broadcast\b/.test(r.url),r.isHLS=/\/manifest\/hls_(variant|playlist)\//.test(r.url),r.isDashMPD=/\/manifest\/dash\//.test(r.url),r)});var Xa=ce(Dt=>{var am=new Set(["youtube.com","www.youtube.com","m.youtube.com","music.youtube.com","gaming.youtube.com"]),sm=/^https?:\/\/(youtu\.be\/|(www\.)?youtube\.com\/(embed|v|shorts)\/)/;Dt.getURLVideoID=r=>{let e=new URL(r.trim()),t=e.searchParams.get("v");if(sm.test(r.trim())&&!t){let i=e.pathname.split("/");t=e.host==="youtu.be"?i[1]:i[2]}else if(e.hostname&&!am.has(e.hostname))throw Error("Not a YouTube domain");if(!t)throw Error(`No video id found: "${r}"`);if(t=t.substring(0,11),!Dt.validateID(t))throw TypeError(`Video id (${t}) does not match expected format (${ac.toString()})`);return t};var lm=/^https?:\/\//;Dt.getVideoID=r=>{if(Dt.validateID(r))return r;if(lm.test(r.trim()))return Dt.getURLVideoID(r);throw Error(`No video id found: ${r}`)};var ac=/^[a-zA-Z0-9-_]{11}$/;Dt.validateID=r=>ac.test(r.trim());Dt.validateURL=r=>{try{return Dt.getURLVideoID(r),!0}catch{return!1}}});var sc=ce(Ka=>{"use strict";Object.defineProperty(Ka,"__esModule",{value:!0});var um=require("stream"),Ja=class extends um.Writable{constructor(){super(),this._lastLine="",this._seq=0,this._nextItemDuration=null,this._nextItemRange=null,this._lastItemRangeEnd=0,this.on("finish",()=>{this._parseLine(this._lastLine),this.emit("end")})}_parseAttrList(e){let t={},i=/([A-Z0-9-]+)=(?:"([^"]*?)"|([^,]*?))/g,o;for(;(o=i.exec(e))!==null;)t[o[1]]=o[2]||o[3];return t}_parseRange(e){if(!e)return null;let t=e.split("@"),i=t[1]?parseInt(t[1]):this._lastItemRangeEnd+1,o=i+parseInt(t[0])-1,s={start:i,end:o};return this._lastItemRangeEnd=s.end,s}_parseLine(e){let t=e.match(/^#(EXT[A-Z0-9-]+)(?::(.*))?/);if(t){let i=t[1],o=t[2]||"";switch(i){case"EXT-X-PROGRAM-DATE-TIME":this.emit("starttime",new Date(o).getTime());break;case"EXT-X-MEDIA-SEQUENCE":this._seq=parseInt(o);break;case"EXT-X-MAP":{let s=this._parseAttrList(o);if(!s.URI){this.destroy(new Error("`EXT-X-MAP` found without required attribute `URI`"));return}this.emit("item",{url:s.URI,seq:this._seq,init:!0,duration:0,range:this._parseRange(s.BYTERANGE)});break}case"EXT-X-BYTERANGE":{this._nextItemRange=this._parseRange(o);break}case"EXTINF":this._nextItemDuration=Math.round(parseFloat(o.split(",")[0])*1e3);break;case"EXT-X-ENDLIST":this.emit("endlist");break}}else!/^#/.test(e)&&e.trim()&&(this.emit("item",{url:e.trim(),seq:this._seq++,duration:this._nextItemDuration,range:this._nextItemRange}),this._nextItemRange=null)}_write(e,t,i){let o=e.toString("utf8").split(`
`);this._lastLine&&(o[0]=this._lastLine+o[0]),o.forEach((s,u)=>{this.destroyed||(u<o.length-1?this._parseLine(s):this._lastLine=s)}),i()}};Ka.default=Ja});var Za=ce(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.durationStr=on.humanStr=void 0;var cm=/^\d+$/,dm=/^(?:(?:(\d+):)?(\d{1,2}):)?(\d{1,2})(?:\.(\d{3}))?$/,Gn={ms:1,s:1e3,m:6e4,h:36e5};on.humanStr=r=>{if(typeof r=="number")return r;if(cm.test(r))return+r;let e=dm.exec(r);if(e)return+(e[1]||0)*Gn.h+ +(e[2]||0)*Gn.m+ +e[3]*Gn.s+ +(e[4]||0);{let t=0,i=/(-?\d+)(ms|s|m|h)/g,o;for(;(o=i.exec(r))!==null;)t+=+o[1]*Gn[o[2]];return t}};on.durationStr=r=>{let e=0,t=/(\d+(?:\.\d+)?)(S|M|H)/g,i;for(;(i=t.exec(r))!==null;)e+=+i[1]*Gn[i[2].toLowerCase()];return e}});var lc=ce(Yn=>{"use strict";var fm=Yn&&Yn.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Yn,"__esModule",{value:!0});var hm=require("stream"),mm=fm(ja()),pm=Za(),es=class extends hm.Writable{constructor(e){super(),this._parser=mm.default.createStream(!1,{lowercase:!0}),this._parser.on("error",this.destroy.bind(this));let t,i=0,o=0,s,u,h,p,m,y=[],v=!1,C=!1,E,R,B,x=P=>{let D={RepresentationID:e,Number:o,Time:i};return P.replace(/\$(\w+)\$/g,(k,M)=>`${D[M]}`)};this._parser.on("opentag",P=>{switch(P.name){case"mpd":i=P.attributes.availabilitystarttime?new Date(P.attributes.availabilitystarttime).getTime():0,E=P.attributes.type!=="dynamic";break;case"period":o=0,u=1e3,p=0,h=0,m=[],R=0,B=pm.durationStr(P.attributes.start)||0;break;case"segmentlist":o=parseInt(P.attributes.startnumber)||o,u=parseInt(P.attributes.timescale)||u,p=parseInt(P.attributes.duration)||p,h=parseInt(P.attributes.presentationtimeoffset)||h;break;case"segmenttemplate":s=P.attributes,o=parseInt(P.attributes.startnumber)||o,u=parseInt(P.attributes.timescale)||u;break;case"segmenttimeline":case"baseurl":t=P.name;break;case"s":y.push({duration:parseInt(P.attributes.d),repeat:parseInt(P.attributes.r),time:parseInt(P.attributes.t)});break;case"adaptationset":case"representation":R++,e||(e=P.attributes.id),v=P.attributes.id===`${e}`,v&&(B&&(i+=B),h&&(i-=h/u*1e3),this.emit("starttime",i));break;case"initialization":v&&this.emit("item",{url:m.filter(D=>!!D).join("")+P.attributes.sourceurl,seq:o,init:!0,duration:0});break;case"segmenturl":if(v){C=!0;let D=y.shift(),k=(D?.duration||p)/u*1e3;this.emit("item",{url:m.filter(M=>!!M).join("")+P.attributes.media,seq:o++,duration:k}),i+=k}break}});let L=()=>{E&&this.emit("endlist"),v?this.emit("end"):this.destroy(Error(`Representation '${e}' not found`))};this._parser.on("closetag",P=>{switch(P){case"adaptationset":case"representation":if(R--,s&&y.length){C=!0,s.initialization&&this.emit("item",{url:m.filter(D=>!!D).join("")+x(s.initialization),seq:o,init:!0,duration:0});for(let{duration:D,repeat:k,time:M}of y){D=D/u*1e3,k=k||1,i=M||i;for(let j=0;j<k;j++)this.emit("item",{url:m.filter(G=>!!G).join("")+x(s.media),seq:o++,duration:D}),i+=D}}C&&(this.emit("endearly"),L(),this._parser.removeAllListeners(),this.removeAllListeners("finish"));break}}),this._parser.on("text",P=>{t==="baseurl"&&(m[R]=P,t=null)}),this.on("finish",L)}_write(e,t,i){this._parser.write(e),i()}};Yn.default=es});var uc=ce(yo=>{"use strict";Object.defineProperty(yo,"__esModule",{value:!0});yo.Queue=void 0;var ts=class{constructor(e,t={}){this._worker=e,this._concurrency=t.concurrency||1,this.tasks=[],this.total=0,this.active=0}push(e,t){this.tasks.push({item:e,callback:t}),this.total++,this._next()}_next(){if(this.active>=this._concurrency||!this.tasks.length)return;let{item:e,callback:t}=this.tasks.shift(),i=!1;this.active++,this._worker(e,(o,s)=>{i||(this.active--,i=!0,t?.(o,s),this._next())})}die(){this.tasks=[]}};yo.Queue=ts});var _o=ce((rs,pc)=>{"use strict";var ns=rs&&rs.__importDefault||function(r){return r&&r.__esModule?r:{default:r}},cc=require("stream"),dc=ns(Qn()),bm=ns(sc()),gm=ns(lc()),fc=uc(),hc=Za(),ym={m3u8:bm.default,"dash-mpd":gm.default},mc=((r,e={})=>{let t=new cc.PassThrough({highWaterMark:e.highWaterMark}),i=e.chunkReadahead||3,o=e.liveBuffer||2e4,s=e.requestOptions,u=ym[e.parser||(/\.mpd$/.test(r)?"dash-mpd":"m3u8")];if(!u)throw TypeError(`parser '${e.parser}' not supported`);let h=0;typeof e.begin<"u"&&(h=typeof e.begin=="string"?hc.humanStr(e.begin):Math.max(e.begin-o,0));let p=O=>{for(let Y of["abort","request","response","redirect","retry","reconnect"])O.on(Y,t.emit.bind(t,Y))},m,y=new fc.Queue((O,Y)=>{m=O;let ee=0;O.on("data",Z=>ee+=Z.length),O.pipe(t,{end:!1}),O.on("end",()=>Y(null,ee))},{concurrency:1}),v=0,C=0,E=new fc.Queue((O,Y)=>{let ee=Object.assign({},s);O.range&&(ee.headers=Object.assign({},ee.headers,{Range:`bytes=${O.range.start}-${O.range.end}`}));let Z=dc.default(new URL(O.url,r).toString(),ee);Z.on("error",Y),p(Z),y.push(Z,(Ae,U)=>{C+=+U,t.emit("progress",{num:++v,size:U,duration:O.duration,url:O.url},E.total,C),Y(null)})},{concurrency:i}),R=O=>{t.emit("error",O),t.end()},B,x,L,P=!0,D=!1,k=!1,M,j=O=>{if(m=null,O)R(O);else if(!P&&!D&&!k&&E.tasks.length+E.active<=B){let Y=Math.max(0,x-(Date.now()-M));P=!0,L=setTimeout(q,Y)}else(D||k)&&!E.tasks.length&&!E.active&&t.end()},G,g,ae=0,q=()=>{M=Date.now(),G=dc.default(r,s),G.on("error",R),p(G);let O=G.pipe(new u(e.id));O.on("starttime",U=>{ae||(ae=U,typeof e.begin=="string"&&h>=0&&(h+=ae))}),O.on("endlist",()=>{k=!0}),O.on("endearly",G.unpipe.bind(G,O));let Y=[],ee=U=>{if(!U.init){if(U.seq<=g)return;g=U.seq}h=U.time,E.push(U,j),Y.push(U)},Z=[],Ae=0;O.on("item",U=>{let F=Object.assign({time:ae},U);if(h<=F.time)ee(F);else for(Z.push(F),Ae+=F.duration;Z.length>1&&Ae-Z[0].duration>o;){let se=Z.shift();Ae-=se.duration}ae+=F.duration}),O.on("end",()=>{G=null,!Y.length&&Z.length&&Z.forEach(U=>{ee(U)}),B=Math.max(1,Math.ceil(Y.length*.01)),x=Y.reduce((U,F)=>F.duration+U,0),P=!1,j(null)})};return q(),t.end=()=>(D=!0,y.die(),E.die(),clearTimeout(L),G?.destroy(),m?.destroy(),cc.PassThrough.prototype.end.call(t,null),t),t});mc.parseTimestamp=hc.humanStr;pc.exports=mc});var yc=ce(Mt=>{var wr=nn(),_m=require("querystring"),{parseTimestamp:wm}=_o(),an="https://www.youtube.com/watch?v=",is={song:{name:"Music",url:"https://music.youtube.com/"}},Te=r=>r?r.runs?r.runs[0].text:r.simpleText:null;Mt.getMedia=r=>{let e={},t=[];try{t=r.response.contents.twoColumnWatchNextResults.results.results.contents}catch{}let i=t.find(o=>o.videoSecondaryInfoRenderer);if(!i)return{};try{let o=(i.metadataRowContainer||i.videoSecondaryInfoRenderer.metadataRowContainer).metadataRowContainerRenderer.rows;for(let s of o)if(s.metadataRowRenderer){let u=Te(s.metadataRowRenderer.title).toLowerCase(),h=s.metadataRowRenderer.contents[0];e[u]=Te(h);let p=h.runs;p&&p[0].navigationEndpoint&&(e[`${u}_url`]=new URL(p[0].navigationEndpoint.commandMetadata.webCommandMetadata.url,an).toString()),u in is&&(e.category=is[u].name,e.category_url=is[u].url)}else if(s.richMetadataRowRenderer){let u=s.richMetadataRowRenderer.contents,h=u.filter(m=>m.richMetadataRenderer.style==="RICH_METADATA_RENDERER_STYLE_BOX_ART");for(let{richMetadataRenderer:m}of h){let y=m;e.year=Te(y.subtitle);let v=Te(y.callToAction).split(" ")[1];e[v]=Te(y.title),e[`${v}_url`]=new URL(y.endpoint.commandMetadata.webCommandMetadata.url,an).toString(),e.thumbnails=y.thumbnail.thumbnails}let p=u.filter(m=>m.richMetadataRenderer.style==="RICH_METADATA_RENDERER_STYLE_TOPIC");for(let{richMetadataRenderer:m}of p){let y=m;e.category=Te(y.title),e.category_url=new URL(y.endpoint.commandMetadata.webCommandMetadata.url,an).toString()}}}catch{}return e};var gc=r=>!!(r&&r.find(e=>e.metadataBadgeRenderer.tooltip==="Verified"));Mt.getAuthor=r=>{let e,t=[],i,o=!1;try{let h=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(p=>p.videoSecondaryInfoRenderer&&p.videoSecondaryInfoRenderer.owner&&p.videoSecondaryInfoRenderer.owner.videoOwnerRenderer).videoSecondaryInfoRenderer.owner.videoOwnerRenderer;e=h.navigationEndpoint.browseEndpoint.browseId,t=h.thumbnail.thumbnails.map(p=>(p.url=new URL(p.url,an).toString(),p)),i=wr.parseAbbreviatedNumber(Te(h.subscriberCountText)),o=gc(h.badges)}catch{}try{let s=r.player_response.microformat&&r.player_response.microformat.playerMicroformatRenderer,u=s&&s.channelId||e||r.player_response.videoDetails.channelId,h={id:u,name:s?s.ownerChannelName:r.player_response.videoDetails.author,user:s?s.ownerProfileUrl.split("/").slice(-1)[0]:null,channel_url:`https://www.youtube.com/channel/${u}`,external_channel_url:s?`https://www.youtube.com/channel/${s.externalChannelId}`:"",user_url:s?new URL(s.ownerProfileUrl,an).toString():"",thumbnails:t,verified:o,subscriber_count:i};return t.length&&wr.deprecate(h,"avatar",h.thumbnails[0].url,"author.avatar","author.thumbnails[0].url"),h}catch{return{}}};var bc=(r,e)=>{if(r)try{let t=Te(r.viewCountText),i=Te(r.shortViewCountText),o=e.find(y=>y.id===r.videoId);/^\d/.test(i)||(i=o&&o.short_view_count_text||""),t=(/^\d/.test(t)?t:i).split(" ")[0];let s=r.shortBylineText.runs[0].navigationEndpoint.browseEndpoint,u=s.browseId,h=Te(r.shortBylineText),p=(s.canonicalBaseUrl||"").split("/").slice(-1)[0],m={id:r.videoId,title:Te(r.title),published:Te(r.publishedTimeText),author:{id:u,name:h,user:p,channel_url:`https://www.youtube.com/channel/${u}`,user_url:`https://www.youtube.com/user/${p}`,thumbnails:r.channelThumbnail.thumbnails.map(y=>(y.url=new URL(y.url,an).toString(),y)),verified:gc(r.ownerBadges),[Symbol.toPrimitive](){return console.warn("`relatedVideo.author` will be removed in a near future release, use `relatedVideo.author.name` instead."),m.author.name}},short_view_count_text:i.split(" ")[0],view_count:t.replace(/,/g,""),length_seconds:r.lengthText?Math.floor(wm(Te(r.lengthText))/1e3):e&&`${e.length_seconds}`,thumbnails:r.thumbnail.thumbnails,richThumbnails:r.richThumbnail?r.richThumbnail.movingThumbnailRenderer.movingThumbnailDetails.thumbnails:[],isLive:!!(r.badges&&r.badges.find(y=>y.metadataBadgeRenderer.label==="LIVE NOW"))};return wr.deprecate(m,"author_thumbnail",m.author.thumbnails[0].url,"relatedVideo.author_thumbnail","relatedVideo.author.thumbnails[0].url"),wr.deprecate(m,"ucid",m.author.id,"relatedVideo.ucid","relatedVideo.author.id"),wr.deprecate(m,"video_thumbnail",m.thumbnails[0].url,"relatedVideo.video_thumbnail","relatedVideo.thumbnails[0].url"),m}catch{}};Mt.getRelatedVideos=r=>{let e=[],t=[];try{e=r.response.webWatchNextResponseExtensionData.relatedVideoArgs.split(",").map(o=>_m.parse(o))}catch{}try{t=r.response.contents.twoColumnWatchNextResults.secondaryResults.secondaryResults.results}catch{return[]}let i=[];for(let o of t||[]){let s=o.compactVideoRenderer;if(s){let u=bc(s,e);u&&i.push(u)}else{let u=o.compactAutoplayRenderer||o.itemSectionRenderer;if(!u||!Array.isArray(u.contents))continue;for(let h of u.contents){let p=bc(h.compactVideoRenderer,e);p&&i.push(p)}}}return i};Mt.getLikes=r=>{try{let o=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(s=>s.videoPrimaryInfoRenderer).videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons.find(s=>s.toggleButtonRenderer&&s.toggleButtonRenderer.defaultIcon.iconType==="LIKE");return parseInt(o.toggleButtonRenderer.defaultText.accessibility.accessibilityData.label.replace(/\D+/g,""))}catch{return null}};Mt.getDislikes=r=>{try{let o=r.response.contents.twoColumnWatchNextResults.results.results.contents.find(s=>s.videoPrimaryInfoRenderer).videoPrimaryInfoRenderer.videoActions.menuRenderer.topLevelButtons.find(s=>s.toggleButtonRenderer&&s.toggleButtonRenderer.defaultIcon.iconType==="DISLIKE");return parseInt(o.toggleButtonRenderer.defaultText.accessibility.accessibilityData.label.replace(/\D+/g,""))}catch{return null}};Mt.cleanVideoDetails=(r,e)=>(r.thumbnails=r.thumbnail.thumbnails,delete r.thumbnail,wr.deprecate(r,"thumbnail",{thumbnails:r.thumbnails},"videoDetails.thumbnail.thumbnails","videoDetails.thumbnails"),r.description=r.shortDescription||Te(r.description),delete r.shortDescription,wr.deprecate(r,"shortDescription",r.description,"videoDetails.shortDescription","videoDetails.description"),r.lengthSeconds=e.player_response.microformat&&e.player_response.microformat.playerMicroformatRenderer.lengthSeconds||e.player_response.videoDetails.lengthSeconds,r);Mt.getStoryboards=r=>{let e=r.player_response.storyboards&&r.player_response.storyboards.playerStoryboardSpecRenderer&&r.player_response.storyboards.playerStoryboardSpecRenderer.spec&&r.player_response.storyboards.playerStoryboardSpecRenderer.spec.split("|");if(!e)return[];let t=new URL(e.shift());return e.map((i,o)=>{let[s,u,h,p,m,y,v,C]=i.split("#");t.searchParams.set("sigh",C),h=parseInt(h,10),p=parseInt(p,10),m=parseInt(m,10);let E=Math.ceil(h/(p*m));return{templateUrl:t.toString().replace("$L",o).replace("$N",v),thumbnailWidth:parseInt(s,10),thumbnailHeight:parseInt(u,10),thumbnailCount:h,interval:parseInt(y,10),columns:p,rows:m,storyboardCount:E}})};Mt.getChapters=r=>{let e=r.response&&r.response.playerOverlays&&r.response.playerOverlays.playerOverlayRenderer,t=e&&e.decoratedPlayerBarRenderer&&e.decoratedPlayerBarRenderer.decoratedPlayerBarRenderer&&e.decoratedPlayerBarRenderer.decoratedPlayerBarRenderer.playerBar,i=t&&t.multiMarkersPlayerBarRenderer&&t.multiMarkersPlayerBarRenderer.markersMap,o=Array.isArray(i)&&i.find(u=>u.value&&Array.isArray(u.value.chapters));return o?o.value.chapters.map(u=>({title:Te(u.chapterRenderer.title),start_time:u.chapterRenderer.timeRangeStartMillis/1e3})):[]}});var os=ce((sw,_c)=>{var{setTimeout:Sm}=require("timers");_c.exports=class extends Map{constructor(e=1e3){super(),this.timeout=e}set(e,t){this.has(e)&&clearTimeout(super.get(e).tid),super.set(e,{tid:Sm(this.delete.bind(this,e),this.timeout).unref(),value:t})}get(e){let t=super.get(e);return t?t.value:null}getOrSet(e,t){if(this.has(e))return this.get(e);{let i=t();return this.set(e,i),(async()=>{try{await i}catch{this.delete(e)}})(),i}}delete(e){let t=super.get(e);t&&(clearTimeout(t.tid),super.delete(e))}clear(){for(let e of this.values())clearTimeout(e.tid);super.clear()}}});var as=ce(ot=>{var Rm=require("querystring"),Tm=os(),Jt=nn(),wc=require("vm");ot.cache=new Tm;ot.getFunctions=(r,e)=>ot.cache.getOrSet(r,async()=>{let t=await Jt.exposedMiniget(r,e).text(),i=ot.extractFunctions(t);if(!i||!i.length)throw Error("Could not extract functions");return ot.cache.set(r,i),i});ot.extractFunctions=r=>{let e=[],t=s=>{let u=Jt.between(s,'a=a.split("");',".");if(!u)return"";let h=`var ${u}={`,p=r.indexOf(h);if(p<0)return"";let m=r.slice(p+h.length-1);return`var ${u}=${Jt.cutAfterJS(m)}`},i=()=>{let s=Jt.between(r,'a.set("alr","yes");c&&(c=',"(decodeURIC");if(s&&s.length){let u=`${s}=function(a)`,h=r.indexOf(u);if(h>=0){let p=r.slice(h+u.length),m=`var ${u}${Jt.cutAfterJS(p)}`;m=`${t(m)};${m};${s}(sig);`,e.push(m)}}},o=()=>{let s=Jt.between(r,'&&(b=a.get("n"))&&(b=',"(b)");if(s.includes("[")&&(s=Jt.between(r,`var ${s.split("[")[0]}=[`,"]")),s&&s.length){let u=`${s}=function(a)`,h=r.indexOf(u);if(h>=0){let p=r.slice(h+u.length),m=`var ${u}${Jt.cutAfterJS(p)};${s}(ncode);`;e.push(m)}}};return i(),o(),e};ot.setDownloadURL=(r,e,t)=>{let i=h=>{let p=Rm.parse(h);if(!p.s||!e)return p.url;let m=new URL(decodeURIComponent(p.url));return m.searchParams.set(p.sp?p.sp:"signature",e.runInNewContext({sig:decodeURIComponent(p.s)})),m.toString()},o=h=>{let p=new URL(decodeURIComponent(h)),m=p.searchParams.get("n");return!m||!t?h:(p.searchParams.set("n",t.runInNewContext({ncode:m})),p.toString())},s=!r.url,u=r.url||r.signatureCipher||r.cipher;r.url=o(s?i(u):u),delete r.signatureCipher,delete r.cipher};ot.decipherFormats=async(r,e,t)=>{let i={},o=await ot.getFunctions(e,t),s=o.length?new wc.Script(o[0]):null,u=o.length>1?new wc.Script(o[1]):null;return r.forEach(h=>{ot.setDownloadURL(h,s,u),i[h.url]=h}),i}});var Ec=ce(ge=>{var Em=require("querystring"),Am=ja(),Rc=Qn(),Ke=nn(),{setTimeout:vm}=require("timers"),Sc=Ya(),Xn=Xa(),Kt=yc(),Pm=as(),cs=os(),Jn="https://www.youtube.com/watch?v=";ge.cache=new cs;ge.cookieCache=new cs(1e3*60*60*24);ge.watchPageCache=new cs;var ds="2.20210622.10.00",Sr=class extends Error{},Cm=["support.google.com/youtube/?p=age_restrictions","youtube.com/t/community_guidelines"];ge.getBasicInfo=async(r,e)=>{e.IPv6Block&&(e.requestOptions=Object.assign({},e.requestOptions,{family:6,localAddress:Ke.getRandomIPv6(e.IPv6Block)}));let t=Object.assign({},Rc.defaultOptions,e.requestOptions);e.requestOptions=Object.assign({},e.requestOptions,{}),e.requestOptions.headers=Object.assign({},{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.101 Safari/537.36"},e.requestOptions.headers);let o=await Bm([r,e],h=>{let p=Ke.playError(h.player_response,["ERROR"],Sr),m=Im(h.player_response);if(p||m)throw p||m;return h&&h.player_response&&(h.player_response.streamingData||km(h.player_response)||xm(h.player_response))},t,[Um,Nm,Hm]);Object.assign(o,{formats:Vm(o.player_response),related_videos:Kt.getRelatedVideos(o)});let s=Kt.getMedia(o),u={author:Kt.getAuthor(o),media:s,likes:Kt.getLikes(o),dislikes:Kt.getDislikes(o),age_restricted:!!(s&&Cm.some(h=>Object.values(s).some(p=>typeof p=="string"&&p.includes(h)))),video_url:Jn+r,storyboards:Kt.getStoryboards(o),chapters:Kt.getChapters(o)};return o.videoDetails=Kt.cleanVideoDetails(Object.assign({},o.player_response&&o.player_response.microformat&&o.player_response.microformat.playerMicroformatRenderer,o.player_response&&o.player_response.videoDetails,u),o),o};var Im=r=>{let e=r&&r.playabilityStatus;return e&&e.status==="LOGIN_REQUIRED"&&e.messages&&e.messages.filter(t=>/This is a private video/.test(t)).length?new Sr(e.reason||e.messages&&e.messages[0]):null},km=r=>{let e=r.playabilityStatus;return e&&e.status==="UNPLAYABLE"&&e.errorScreen&&e.errorScreen.playerLegacyDesktopYpcOfferRenderer},xm=r=>{let e=r.playabilityStatus;return e&&e.status==="LIVE_STREAM_OFFLINE"},Tc=(r,e)=>`${Jn+r}&hl=${e.lang||"en"}`,fs=(r,e)=>{let t=Tc(r,e);return ge.watchPageCache.getOrSet(t,()=>Ke.exposedMiniget(t,e).text())},Dm="https://www.youtube.com/embed/",Mm=(r,e)=>{let t=`${Dm+r}?hl=${e.lang||"en"}`;return Ke.exposedMiniget(t,e).text()},us=r=>{let e=/<script\s+src="([^"]+)"(?:\s+type="text\/javascript")?\s+name="player_ias\/base"\s*>|"jsUrl":"([^"]+)"/.exec(r);return e?e[1]||e[2]:null},Om=(r,e,t,i)=>ge.cookieCache.getOrSet(t,async()=>{let s=(await fs(r,e)).match(/(["'])ID_TOKEN\1[:,]\s?"([^"]+)"/);if(!s&&i)throw new Sr("Cookie header used in request, but unable to find YouTube identity token");return s&&s[2]}),Bm=async(r,e,t,i)=>{let o;for(let s of i)try{let u=await Lm(s,r.concat([o]),t);if(u.player_response&&(u.player_response.videoDetails=ss(o&&o.player_response&&o.player_response.videoDetails,u.player_response.videoDetails),u.player_response=ss(o&&o.player_response,u.player_response)),o=ss(o,u),e(o,!1))break}catch(u){if(u instanceof Sr||s===i[i.length-1])throw u}return o},ss=(r,e)=>{if(!r||!e)return r||e;for(let[t,i]of Object.entries(e))i!=null&&(r[t]=i);return r},Lm=async(r,e,t)=>{let i=0,o;for(;i<=t.maxRetries;)try{o=await r(...e);break}catch(s){if(s instanceof Sr||s instanceof Rc.MinigetError&&s.statusCode<500||i>=t.maxRetries)throw s;let u=Math.min(++i*t.backoff.inc,t.backoff.max);await new Promise(h=>vm(h,u))}return o},Fm=/^[)\]}'\s]+/,hs=(r,e,t)=>{if(!t||typeof t=="object")return t;try{return t=t.replace(Fm,""),JSON.parse(t)}catch(i){throw Error(`Error parsing ${e} in ${r}: ${i.message}`)}},ls=(r,e,t,i,o,s)=>{let u=Ke.between(t,i,o);if(!u)throw Error(`Could not find ${e} in ${r}`);return hs(r,e,Ke.cutAfterJS(`${s}${u}`))},ms=(r,e)=>{let t=e&&(e.args&&e.args.player_response||e.player_response||e.playerResponse||e.embedded_player_response);return hs(r,"player_response",t)},qm=(r,e)=>`${Tc(r,e)}&pbj=1`,Nm=async(r,e)=>{let t=Object.assign({headers:{}},e.requestOptions),i=t.headers.Cookie||t.headers.cookie;t.headers=Object.assign({"x-youtube-client-name":"1","x-youtube-client-version":ds,"x-youtube-identity-token":ge.cookieCache.get(i||"browser")||""},t.headers);let o=async(m,y)=>{t.headers["x-youtube-identity-token"]||(t.headers["x-youtube-identity-token"]=await Om(r,e,m,y))};i&&await o(i,!0);let s=qm(r,e),u=await Ke.exposedMiniget(s,e,t).text(),h=hs("watch.json","body",u);if(h.reload==="now"&&await o("browser",!1),h.reload==="now"||!Array.isArray(h))throw Error("Unable to retrieve video metadata in watch.json");let p=h.reduce((m,y)=>Object.assign(y,m),{});return p.player_response=ms("watch.json",p),p.html5player=p.player&&p.player.assets&&p.player.assets.js,p},Um=async(r,e)=>{let t=await fs(r,e),i={page:"watch"};try{ds=Ke.between(t,'{"key":"cver","value":"','"}'),i.player_response=ls("watch.html","player_response",t,/\bytInitialPlayerResponse\s*=\s*\{/i,"</script>","{")}catch{let s=ls("watch.html","player_response",t,/\bytplayer\.config\s*=\s*{/,"</script>","{");i.player_response=ms("watch.html",s)}return i.response=ls("watch.html","response",t,/\bytInitialData("\])?\s*=\s*\{/i,"</script>","{"),i.html5player=us(t),i},Wm="www.youtube.com",$m="/get_video_info",jm="https://youtube.googleapis.com/v/",Hm=async(r,e)=>{let t=new URL(`https://${Wm}${$m}`);t.searchParams.set("video_id",r),t.searchParams.set("c","TVHTML5"),t.searchParams.set("cver",`7${ds.substr(1)}`),t.searchParams.set("eurl",jm+r),t.searchParams.set("ps","default"),t.searchParams.set("gl","US"),t.searchParams.set("hl",e.lang||"en"),t.searchParams.set("html5","1");let i=await Ke.exposedMiniget(t.toString(),e).text(),o=Em.parse(i);return o.player_response=ms("get_video_info",o),o},Vm=r=>{let e=[];return r&&r.streamingData&&(e=e.concat(r.streamingData.formats||[]).concat(r.streamingData.adaptiveFormats||[])),e};ge.getInfo=async(r,e)=>{let t=await ge.getBasicInfo(r,e),i=t.player_response&&t.player_response.streamingData&&(t.player_response.streamingData.dashManifestUrl||t.player_response.streamingData.hlsManifestUrl),o=[];if(t.formats.length){if(t.html5player=t.html5player||us(await fs(r,e))||us(await Mm(r,e)),!t.html5player)throw Error("Unable to find html5player file");let u=new URL(t.html5player,Jn).toString();o.push(Pm.decipherFormats(t.formats,u,e))}if(i&&t.player_response.streamingData.dashManifestUrl){let u=t.player_response.streamingData.dashManifestUrl;o.push(zm(u,e))}if(i&&t.player_response.streamingData.hlsManifestUrl){let u=t.player_response.streamingData.hlsManifestUrl;o.push(Qm(u,e))}let s=await Promise.all(o);return t.formats=Object.values(Object.assign({},...s)),t.formats=t.formats.map(Sc.addFormatMeta),t.formats.sort(Sc.sortFormats),t.full=!0,t};var zm=(r,e)=>new Promise((t,i)=>{let o={},s=Am.parser(!1);s.onerror=i;let u;s.onopentag=p=>{if(p.name==="ADAPTATIONSET")u=p.attributes;else if(p.name==="REPRESENTATION"){let m=parseInt(p.attributes.ID);isNaN(m)||(o[r]=Object.assign({itag:m,url:r,bitrate:parseInt(p.attributes.BANDWIDTH),mimeType:`${u.MIMETYPE}; codecs="${p.attributes.CODECS}"`},p.attributes.HEIGHT?{width:parseInt(p.attributes.WIDTH),height:parseInt(p.attributes.HEIGHT),fps:parseInt(p.attributes.FRAMERATE)}:{audioSampleRate:p.attributes.AUDIOSAMPLINGRATE}))}},s.onend=()=>{t(o)};let h=Ke.exposedMiniget(new URL(r,Jn).toString(),e);h.setEncoding("utf8"),h.on("error",i),h.on("data",p=>{s.write(p)}),h.on("end",s.close.bind(s))}),Qm=async(r,e)=>{r=new URL(r,Jn);let t=await Ke.exposedMiniget(r.toString(),e).text(),i={};return t.split(`
`).filter(o=>/^https?:\/\//.test(o)).forEach(o=>{let s=parseInt(o.match(/\/itag\/(\d+)\//)[1]);i[o]={itag:s,url:o}}),i};for(let r of["getBasicInfo","getInfo"]){let e=ge[r];ge[r]=async(t,i={})=>{Ke.checkForUpdates();let o=await Xn.getVideoID(t),s=[r,o,i.lang].join("-");return ge.cache.getOrSet(s,()=>e(o,i))}}ge.validateID=Xn.validateID;ge.validateURL=Xn.validateURL;ge.getURLVideoID=Xn.getURLVideoID;ge.getVideoID=Xn.getVideoID});var gs=ce((cw,Ic)=>{var Gm=require("stream").PassThrough,Kn=Ec(),Ac=nn(),bs=Ya(),wo=Xa(),Ym=as(),vc=Qn(),Xm=_o(),{parseTimestamp:Jm}=_o(),$e=(r,e)=>{let t=Pc(e);return $e.getInfo(r,e).then(i=>{Cc(t,i,e)},t.emit.bind(t,"error")),t};Ic.exports=$e;$e.getBasicInfo=Kn.getBasicInfo;$e.getInfo=Kn.getInfo;$e.chooseFormat=bs.chooseFormat;$e.filterFormats=bs.filterFormats;$e.validateID=wo.validateID;$e.validateURL=wo.validateURL;$e.getURLVideoID=wo.getURLVideoID;$e.getVideoID=wo.getVideoID;$e.cache={sig:Ym.cache,info:Kn.cache,watch:Kn.watchPageCache,cookie:Kn.cookieCache};$e.version=Va().version;var Pc=r=>{let e=new Gm({highWaterMark:r&&r.highWaterMark||524288});return e._destroy=()=>{e.destroyed=!0},e},ps=(r,e,t)=>{["abort","request","response","error","redirect","retry","reconnect"].forEach(i=>{r.prependListener(i,e.emit.bind(e,i))}),r.pipe(e,{end:t})},Cc=(r,e,t)=>{t=t||{};let i=Ac.playError(e.player_response,["UNPLAYABLE","LIVE_STREAM_OFFLINE","LOGIN_REQUIRED"]);if(i){r.emit("error",i);return}if(!e.formats.length){r.emit("error",Error("This video is unavailable"));return}let o;try{o=bs.chooseFormat(e.formats,t)}catch(v){r.emit("error",v);return}if(r.emit("info",e,o),r.destroyed)return;let s,u=0,h=v=>{u+=v.length,r.emit("progress",v.length,u,s)};t.IPv6Block&&(t.requestOptions=Object.assign({},t.requestOptions,{family:6,localAddress:Ac.getRandomIPv6(t.IPv6Block)}));let p=t.dlChunkSize||1024*1024*10,m,y=!0;if(o.isHLS||o.isDashMPD)m=Xm(o.url,{chunkReadahead:+e.live_chunk_readahead,begin:t.begin||o.isLive&&Date.now(),liveBuffer:t.liveBuffer,requestOptions:t.requestOptions,parser:o.isDashMPD?"dash-mpd":"m3u8",id:o.itag}),m.on("progress",(v,C)=>{r.emit("progress",v.size,v.num,C)}),ps(m,r,y);else{let v=Object.assign({},t.requestOptions,{maxReconnects:6,maxRetries:3,backoff:{inc:500,max:1e4}});if(p!==0&&(!o.hasAudio||!o.hasVideo)){let E=t.range&&t.range.start||0,R=E+p,B=t.range&&t.range.end;s=t.range?(B?B+1:parseInt(o.contentLength))-E:parseInt(o.contentLength);let x=()=>{!B&&R>=s&&(R=0),B&&R>B&&(R=B),y=!R||R===B,v.headers=Object.assign({},v.headers,{Range:`bytes=${E}-${R||""}`}),m=vc(o.url,v),m.on("data",h),m.on("end",()=>{r.destroyed||R&&R!==B&&(E=R+1,R+=p,x())}),ps(m,r,y)};x()}else t.begin&&(o.url+=`&begin=${Jm(t.begin)}`),t.range&&(t.range.start||t.range.end)&&(v.headers=Object.assign({},v.headers,{Range:`bytes=${t.range.start||"0"}-${t.range.end||""}`})),m=vc(o.url,v),m.on("response",E=>{r.destroyed||(s=s||parseInt(E.headers["content-length"]))}),m.on("data",h),ps(m,r,y)}r._destroy=()=>{r.destroyed=!0,m.destroy(),m.end()}};$e.downloadFromInfo=(r,e)=>{let t=Pc(e);if(!r.full)throw Error("Cannot use `ytdl.downloadFromInfo()` when called with info from `ytdl.getBasicInfo()`");return setImmediate(()=>{Cc(t,r,e)}),t}});var Pp={};Cl(Pp,{default:()=>Yc});module.exports=Uf(Pp);var Gc=require("@raycast/api");var su=lt(require("node:http"),1),lu=lt(require("node:https"),1),fr=lt(require("node:zlib"),1),Ne=lt(require("node:stream"),1),Pn=require("node:buffer");function Wf(r){if(!/^data:/i.test(r))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');r=r.replace(/\r?\n/g,"");let e=r.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let t=r.substring(5,e).split(";"),i="",o=!1,s=t[0]||"text/plain",u=s;for(let y=1;y<t.length;y++)t[y]==="base64"?o=!0:t[y]&&(u+=`;${t[y]}`,t[y].indexOf("charset=")===0&&(i=t[y].substring(8)));!t[0]&&!i.length&&(u+=";charset=US-ASCII",i="US-ASCII");let h=o?"base64":"ascii",p=unescape(r.substring(e+1)),m=Buffer.from(p,h);return m.type=s,m.typeFull=u,m.charset=i,m}var kl=Wf;var ze=lt(require("node:stream"),1),Et=require("node:util"),Fe=require("node:buffer");Sn();Mi();var Tt=class extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var Ie=class extends Tt{constructor(e,t,i){super(e,t),i&&(this.code=this.errno=i.code,this.erroredSysCall=i.syscall)}};var Oi=Symbol.toStringTag,oa=r=>typeof r=="object"&&typeof r.append=="function"&&typeof r.delete=="function"&&typeof r.get=="function"&&typeof r.getAll=="function"&&typeof r.has=="function"&&typeof r.set=="function"&&typeof r.sort=="function"&&r[Oi]==="URLSearchParams",Tn=r=>r&&typeof r=="object"&&typeof r.arrayBuffer=="function"&&typeof r.type=="string"&&typeof r.stream=="function"&&typeof r.constructor=="function"&&/^(Blob|File)$/.test(r[Oi]),Nl=r=>typeof r=="object"&&(r[Oi]==="AbortSignal"||r[Oi]==="EventTarget"),Ul=(r,e)=>{let t=new URL(e).hostname,i=new URL(r).hostname;return t===i||t.endsWith(`.${i}`)},Wl=(r,e)=>{let t=new URL(e).protocol,i=new URL(r).protocol;return t===i};var rh=(0,Et.promisify)(ze.default.pipeline),ke=Symbol("Body internals"),ct=class{constructor(e,{size:t=0}={}){let i=null;e===null?e=null:oa(e)?e=Fe.Buffer.from(e.toString()):Tn(e)||Fe.Buffer.isBuffer(e)||(Et.types.isAnyArrayBuffer(e)?e=Fe.Buffer.from(e):ArrayBuffer.isView(e)?e=Fe.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof ze.default||(e instanceof ur?(e=ql(e),i=e.type.split("=")[1]):e=Fe.Buffer.from(String(e))));let o=e;Fe.Buffer.isBuffer(e)?o=ze.default.Readable.from(e):Tn(e)&&(o=ze.default.Readable.from(e.stream())),this[ke]={body:e,stream:o,boundary:i,disturbed:!1,error:null},this.size=t,e instanceof ze.default&&e.on("error",s=>{let u=s instanceof Tt?s:new Ie(`Invalid response body while trying to fetch ${this.url}: ${s.message}`,"system",s);this[ke].error=u})}get body(){return this[ke].stream}get bodyUsed(){return this[ke].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:t,byteLength:i}=await la(this);return e.slice(t,t+i)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let i=new ur,o=new URLSearchParams(await this.text());for(let[s,u]of o)i.append(s,u);return i}let{toFormData:t}=await Promise.resolve().then(()=>(zl(),Vl));return t(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[ke].body&&this[ke].body.type||"",t=await this.arrayBuffer();return new Rt([t],{type:e})}async json(){let e=await this.text();return JSON.parse(e)}async text(){let e=await la(this);return new TextDecoder().decode(e)}buffer(){return la(this)}};ct.prototype.buffer=(0,Et.deprecate)(ct.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer");Object.defineProperties(ct.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,Et.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});async function la(r){if(r[ke].disturbed)throw new TypeError(`body used already for: ${r.url}`);if(r[ke].disturbed=!0,r[ke].error)throw r[ke].error;let{body:e}=r;if(e===null)return Fe.Buffer.alloc(0);if(!(e instanceof ze.default))return Fe.Buffer.alloc(0);let t=[],i=0;try{for await(let o of e){if(r.size>0&&i+o.length>r.size){let s=new Ie(`content size at ${r.url} over limit: ${r.size}`,"max-size");throw e.destroy(s),s}i+=o.length,t.push(o)}}catch(o){throw o instanceof Tt?o:new Ie(`Invalid response body while trying to fetch ${r.url}: ${o.message}`,"system",o)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return t.every(o=>typeof o=="string")?Fe.Buffer.from(t.join("")):Fe.Buffer.concat(t,i)}catch(o){throw new Ie(`Could not create Buffer from response body for ${r.url}: ${o.message}`,"system",o)}else throw new Ie(`Premature close of server response while trying to fetch ${r.url}`)}var Lr=(r,e)=>{let t,i,{body:o}=r[ke];if(r.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof ze.default&&typeof o.getBoundary!="function"&&(t=new ze.PassThrough({highWaterMark:e}),i=new ze.PassThrough({highWaterMark:e}),o.pipe(t),o.pipe(i),r[ke].stream=t,o=i),o},nh=(0,Et.deprecate)(r=>r.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),qi=(r,e)=>r===null?null:typeof r=="string"?"text/plain;charset=UTF-8":oa(r)?"application/x-www-form-urlencoded;charset=UTF-8":Tn(r)?r.type||null:Fe.Buffer.isBuffer(r)||Et.types.isAnyArrayBuffer(r)||ArrayBuffer.isView(r)?null:r instanceof ur?`multipart/form-data; boundary=${e[ke].boundary}`:r&&typeof r.getBoundary=="function"?`multipart/form-data;boundary=${nh(r)}`:r instanceof ze.default?null:"text/plain;charset=UTF-8",Ql=r=>{let{body:e}=r[ke];return e===null?0:Tn(e)?e.size:Fe.Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"&&e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null},Gl=async(r,{body:e})=>{e===null?r.end():await rh(e,r)};var ua=require("node:util"),An=lt(require("node:http"),1),Ni=typeof An.default.validateHeaderName=="function"?An.default.validateHeaderName:r=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(r)){let e=new TypeError(`Header name must be a valid HTTP token [${r}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},ca=typeof An.default.validateHeaderValue=="function"?An.default.validateHeaderValue:(r,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let t=new TypeError(`Invalid character in header content ["${r}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}},qe=class r extends URLSearchParams{constructor(e){let t=[];if(e instanceof r){let i=e.raw();for(let[o,s]of Object.entries(i))t.push(...s.map(u=>[o,u]))}else if(e!=null)if(typeof e=="object"&&!ua.types.isBoxedPrimitive(e)){let i=e[Symbol.iterator];if(i==null)t.push(...Object.entries(e));else{if(typeof i!="function")throw new TypeError("Header pairs must be iterable");t=[...e].map(o=>{if(typeof o!="object"||ua.types.isBoxedPrimitive(o))throw new TypeError("Each header pair must be an iterable object");return[...o]}).map(o=>{if(o.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...o]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return t=t.length>0?t.map(([i,o])=>(Ni(i),ca(i,String(o)),[String(i).toLowerCase(),String(o)])):void 0,super(t),new Proxy(this,{get(i,o,s){switch(o){case"append":case"set":return(u,h)=>(Ni(u),ca(u,String(h)),URLSearchParams.prototype[o].call(i,String(u).toLowerCase(),String(h)));case"delete":case"has":case"getAll":return u=>(Ni(u),URLSearchParams.prototype[o].call(i,String(u).toLowerCase()));case"keys":return()=>(i.sort(),new Set(URLSearchParams.prototype.keys.call(i)).keys());default:return Reflect.get(i,o,s)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let t=this.getAll(e);if(t.length===0)return null;let i=t.join(", ");return/^content-encoding$/i.test(e)&&(i=i.toLowerCase()),i}forEach(e,t=void 0){for(let i of this.keys())Reflect.apply(e,t,[this.get(i),i,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,t)=>(e[t]=this.getAll(t),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,t)=>{let i=this.getAll(t);return t==="host"?e[t]=i[0]:e[t]=i.length>1?i:i[0],e},{})}};Object.defineProperties(qe.prototype,["get","entries","forEach","values"].reduce((r,e)=>(r[e]={enumerable:!0},r),{}));function Yl(r=[]){return new qe(r.reduce((e,t,i,o)=>(i%2===0&&e.push(o.slice(i,i+2)),e),[]).filter(([e,t])=>{try{return Ni(e),ca(e,String(t)),!0}catch{return!1}}))}var ih=new Set([301,302,303,307,308]),Ui=r=>ih.has(r);var nt=Symbol("Response internals"),Qe=class r extends ct{constructor(e=null,t={}){super(e,t);let i=t.status!=null?t.status:200,o=new qe(t.headers);if(e!==null&&!o.has("Content-Type")){let s=qi(e,this);s&&o.append("Content-Type",s)}this[nt]={type:"default",url:t.url,status:i,statusText:t.statusText||"",headers:o,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[nt].type}get url(){return this[nt].url||""}get status(){return this[nt].status}get ok(){return this[nt].status>=200&&this[nt].status<300}get redirected(){return this[nt].counter>0}get statusText(){return this[nt].statusText}get headers(){return this[nt].headers}get highWaterMark(){return this[nt].highWaterMark}clone(){return new r(Lr(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!Ui(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new r(null,{headers:{location:new URL(e).toString()},status:t})}static error(){let e=new r(null,{status:0,statusText:""});return e[nt].type="error",e}static json(e=void 0,t={}){let i=JSON.stringify(e);if(i===void 0)throw new TypeError("data is not JSON serializable");let o=new qe(t&&t.headers);return o.has("content-type")||o.set("content-type","application/json"),new r(i,{...t,headers:o})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(Qe.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var iu=require("node:url"),ou=require("node:util");var Xl=r=>{if(r.search)return r.search;let e=r.href.length-1,t=r.hash||(r.href[e]==="#"?"#":"");return r.href[e-t.length]==="?"?"?":""};var Kl=require("node:net");function Jl(r,e=!1){return r==null||(r=new URL(r),/^(about|blob|data):$/.test(r.protocol))?"no-referrer":(r.username="",r.password="",r.hash="",e&&(r.pathname="",r.search=""),r)}var Zl=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]),eu="strict-origin-when-cross-origin";function tu(r){if(!Zl.has(r))throw new TypeError(`Invalid referrerPolicy: ${r}`);return r}function oh(r){if(/^(http|ws)s:$/.test(r.protocol))return!0;let e=r.host.replace(/(^\[)|(]$)/g,""),t=(0,Kl.isIP)(e);return t===4&&/^127\./.test(e)||t===6&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(e)?!0:r.host==="localhost"||r.host.endsWith(".localhost")?!1:r.protocol==="file:"}function Fr(r){return/^about:(blank|srcdoc)$/.test(r)||r.protocol==="data:"||/^(blob|filesystem):$/.test(r.protocol)?!0:oh(r)}function ru(r,{referrerURLCallback:e,referrerOriginCallback:t}={}){if(r.referrer==="no-referrer"||r.referrerPolicy==="")return null;let i=r.referrerPolicy;if(r.referrer==="about:client")return"no-referrer";let o=r.referrer,s=Jl(o),u=Jl(o,!0);s.toString().length>4096&&(s=u),e&&(s=e(s)),t&&(u=t(u));let h=new URL(r.url);switch(i){case"no-referrer":return"no-referrer";case"origin":return u;case"unsafe-url":return s;case"strict-origin":return Fr(s)&&!Fr(h)?"no-referrer":u.toString();case"strict-origin-when-cross-origin":return s.origin===h.origin?s:Fr(s)&&!Fr(h)?"no-referrer":u;case"same-origin":return s.origin===h.origin?s:"no-referrer";case"origin-when-cross-origin":return s.origin===h.origin?s:u;case"no-referrer-when-downgrade":return Fr(s)&&!Fr(h)?"no-referrer":s;default:throw new TypeError(`Invalid referrerPolicy: ${i}`)}}function nu(r){let e=(r.get("referrer-policy")||"").split(/[,\s]+/),t="";for(let i of e)i&&Zl.has(i)&&(t=i);return t}var me=Symbol("Request internals"),vn=r=>typeof r=="object"&&typeof r[me]=="object",ah=(0,ou.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)"),dr=class r extends ct{constructor(e,t={}){let i;if(vn(e)?i=new URL(e.url):(i=new URL(e),e={}),i.username!==""||i.password!=="")throw new TypeError(`${i} is an url with embedded credentials.`);let o=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(o)&&(o=o.toUpperCase()),!vn(t)&&"data"in t&&ah(),(t.body!=null||vn(e)&&e.body!==null)&&(o==="GET"||o==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let s=t.body?t.body:vn(e)&&e.body!==null?Lr(e):null;super(s,{size:t.size||e.size||0});let u=new qe(t.headers||e.headers||{});if(s!==null&&!u.has("Content-Type")){let m=qi(s,this);m&&u.set("Content-Type",m)}let h=vn(e)?e.signal:null;if("signal"in t&&(h=t.signal),h!=null&&!Nl(h))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let p=t.referrer==null?e.referrer:t.referrer;if(p==="")p="no-referrer";else if(p){let m=new URL(p);p=/^about:(\/\/)?client$/.test(m)?"client":m}else p=void 0;this[me]={method:o,redirect:t.redirect||e.redirect||"follow",headers:u,parsedURL:i,signal:h,referrer:p},this.follow=t.follow===void 0?e.follow===void 0?20:e.follow:t.follow,this.compress=t.compress===void 0?e.compress===void 0?!0:e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[me].method}get url(){return(0,iu.format)(this[me].parsedURL)}get headers(){return this[me].headers}get redirect(){return this[me].redirect}get signal(){return this[me].signal}get referrer(){if(this[me].referrer==="no-referrer")return"";if(this[me].referrer==="client")return"about:client";if(this[me].referrer)return this[me].referrer.toString()}get referrerPolicy(){return this[me].referrerPolicy}set referrerPolicy(e){this[me].referrerPolicy=tu(e)}clone(){return new r(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(dr.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});var au=r=>{let{parsedURL:e}=r[me],t=new qe(r[me].headers);t.has("Accept")||t.set("Accept","*/*");let i=null;if(r.body===null&&/^(post|put)$/i.test(r.method)&&(i="0"),r.body!==null){let h=Ql(r);typeof h=="number"&&!Number.isNaN(h)&&(i=String(h))}i&&t.set("Content-Length",i),r.referrerPolicy===""&&(r.referrerPolicy=eu),r.referrer&&r.referrer!=="no-referrer"?r[me].referrer=ru(r):r[me].referrer="no-referrer",r[me].referrer instanceof URL&&t.set("Referer",r.referrer),t.has("User-Agent")||t.set("User-Agent","node-fetch"),r.compress&&!t.has("Accept-Encoding")&&t.set("Accept-Encoding","gzip, deflate, br");let{agent:o}=r;typeof o=="function"&&(o=o(e));let s=Xl(e),u={path:e.pathname+s,method:r.method,headers:t[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:r.insecureHTTPParser,agent:o};return{parsedURL:e,options:u}};var Wi=class extends Tt{constructor(e,t="aborted"){super(e,t)}};Mi();aa();var sh=new Set(["data:","http:","https:"]);async function $i(r,e){return new Promise((t,i)=>{let o=new dr(r,e),{parsedURL:s,options:u}=au(o);if(!sh.has(s.protocol))throw new TypeError(`node-fetch cannot load ${r}. URL scheme "${s.protocol.replace(/:$/,"")}" is not supported.`);if(s.protocol==="data:"){let R=kl(o.url),B=new Qe(R,{headers:{"Content-Type":R.typeFull}});t(B);return}let h=(s.protocol==="https:"?lu.default:su.default).request,{signal:p}=o,m=null,y=()=>{let R=new Wi("The operation was aborted.");i(R),o.body&&o.body instanceof Ne.default.Readable&&o.body.destroy(R),!(!m||!m.body)&&m.body.emit("error",R)};if(p&&p.aborted){y();return}let v=()=>{y(),E()},C=h(s.toString(),u);p&&p.addEventListener("abort",v);let E=()=>{C.abort(),p&&p.removeEventListener("abort",v)};C.on("error",R=>{i(new Ie(`request to ${o.url} failed, reason: ${R.message}`,"system",R)),E()}),lh(C,R=>{m&&m.body&&m.body.destroy(R)}),process.version<"v14"&&C.on("socket",R=>{let B;R.prependListener("end",()=>{B=R._eventsCount}),R.prependListener("close",x=>{if(m&&B<R._eventsCount&&!x){let L=new Error("Premature close");L.code="ERR_STREAM_PREMATURE_CLOSE",m.body.emit("error",L)}})}),C.on("response",R=>{C.setTimeout(0);let B=Yl(R.rawHeaders);if(Ui(R.statusCode)){let k=B.get("Location"),M=null;try{M=k===null?null:new URL(k,o.url)}catch{if(o.redirect!=="manual"){i(new Ie(`uri requested responds with an invalid redirect URL: ${k}`,"invalid-redirect")),E();return}}switch(o.redirect){case"error":i(new Ie(`uri requested responds with a redirect, redirect mode is set to error: ${o.url}`,"no-redirect")),E();return;case"manual":break;case"follow":{if(M===null)break;if(o.counter>=o.follow){i(new Ie(`maximum redirect reached at: ${o.url}`,"max-redirect")),E();return}let j={headers:new qe(o.headers),follow:o.follow,counter:o.counter+1,agent:o.agent,compress:o.compress,method:o.method,body:Lr(o),signal:o.signal,size:o.size,referrer:o.referrer,referrerPolicy:o.referrerPolicy};if(!Ul(o.url,M)||!Wl(o.url,M))for(let g of["authorization","www-authenticate","cookie","cookie2"])j.headers.delete(g);if(R.statusCode!==303&&o.body&&e.body instanceof Ne.default.Readable){i(new Ie("Cannot follow redirect with body being a readable stream","unsupported-redirect")),E();return}(R.statusCode===303||(R.statusCode===301||R.statusCode===302)&&o.method==="POST")&&(j.method="GET",j.body=void 0,j.headers.delete("content-length"));let G=nu(B);G&&(j.referrerPolicy=G),t($i(new dr(M,j))),E();return}default:return i(new TypeError(`Redirect option '${o.redirect}' is not a valid value of RequestRedirect`))}}p&&R.once("end",()=>{p.removeEventListener("abort",v)});let x=(0,Ne.pipeline)(R,new Ne.PassThrough,k=>{k&&i(k)});process.version<"v12.10"&&R.on("aborted",v);let L={url:o.url,status:R.statusCode,statusText:R.statusMessage,headers:B,size:o.size,counter:o.counter,highWaterMark:o.highWaterMark},P=B.get("Content-Encoding");if(!o.compress||o.method==="HEAD"||P===null||R.statusCode===204||R.statusCode===304){m=new Qe(x,L),t(m);return}let D={flush:fr.default.Z_SYNC_FLUSH,finishFlush:fr.default.Z_SYNC_FLUSH};if(P==="gzip"||P==="x-gzip"){x=(0,Ne.pipeline)(x,fr.default.createGunzip(D),k=>{k&&i(k)}),m=new Qe(x,L),t(m);return}if(P==="deflate"||P==="x-deflate"){let k=(0,Ne.pipeline)(R,new Ne.PassThrough,M=>{M&&i(M)});k.once("data",M=>{(M[0]&15)===8?x=(0,Ne.pipeline)(x,fr.default.createInflate(),j=>{j&&i(j)}):x=(0,Ne.pipeline)(x,fr.default.createInflateRaw(),j=>{j&&i(j)}),m=new Qe(x,L),t(m)}),k.once("end",()=>{m||(m=new Qe(x,L),t(m))});return}if(P==="br"){x=(0,Ne.pipeline)(x,fr.default.createBrotliDecompress(),k=>{k&&i(k)}),m=new Qe(x,L),t(m);return}m=new Qe(x,L),t(m)}),Gl(C,o).catch(i)})}function lh(r,e){let t=Pn.Buffer.from(`0\r
\r
`),i=!1,o=!1,s;r.on("response",u=>{let{headers:h}=u;i=h["transfer-encoding"]==="chunked"&&!h["content-length"]}),r.on("socket",u=>{let h=()=>{if(i&&!o){let m=new Error("Premature close");m.code="ERR_STREAM_PREMATURE_CLOSE",e(m)}},p=m=>{o=Pn.Buffer.compare(m.slice(-5),t)===0,!o&&s&&(o=Pn.Buffer.compare(s.slice(-3),t.slice(0,3))===0&&Pn.Buffer.compare(m.slice(-2),t.slice(3))===0),s=m};u.prependListener("close",h),u.on("data",p),r.on("close",()=>{u.removeListener("close",h),u.removeListener("data",p)})})}var Zt=require("react");function H(r,e,t,i,o){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!o:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?o.call(r,t):o?o.value=t:e.set(r,t),t}function A(r,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!i:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(r):i?i.value:e.get(r)}var da=function(){let{crypto:r}=globalThis;if(r?.randomUUID)return da=r.randomUUID.bind(r),r.randomUUID();let e=new Uint8Array(1),t=r?()=>r.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,i=>(+i^t()&15>>+i/4).toString(16))};function At(r){return typeof r=="object"&&r!==null&&("name"in r&&r.name==="AbortError"||"message"in r&&String(r.message).includes("FetchRequestCanceledException"))}var Cn=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null){try{if(Object.prototype.toString.call(r)==="[object Error]"){let e=new Error(r.message,r.cause?{cause:r.cause}:{});return r.stack&&(e.stack=r.stack),r.cause&&!e.cause&&(e.cause=r.cause),r.name&&(e.name=r.name),e}}catch{}try{return new Error(JSON.stringify(r))}catch{}}return new Error(r)};var $=class extends Error{},pe=class r extends ${constructor(e,t,i,o){super(`${r.makeMessage(e,t,i)}`),this.status=e,this.headers=o,this.requestID=o?.get("request-id"),this.error=t}static makeMessage(e,t,i){let o=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):i;return e&&o?`${e} ${o}`:e?`${e} status code (no body)`:o||"(no status code or body)"}static generate(e,t,i,o){if(!e||!o)return new Ht({message:i,cause:Cn(t)});let s=t;return e===400?new Nr(e,s,i,o):e===401?new Ur(e,s,i,o):e===403?new Wr(e,s,i,o):e===404?new $r(e,s,i,o):e===409?new jr(e,s,i,o):e===422?new Hr(e,s,i,o):e===429?new Vr(e,s,i,o):e>=500?new zr(e,s,i,o):new r(e,s,i,o)}},be=class extends pe{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Ht=class extends pe{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},qr=class extends Ht{constructor({message:e}={}){super({message:e??"Request timed out."})}},Nr=class extends pe{},Ur=class extends pe{},Wr=class extends pe{},$r=class extends pe{},jr=class extends pe{},Hr=class extends pe{},Vr=class extends pe{},zr=class extends pe{};var ch=/^[a-z][a-z0-9+.-]*:/i,uu=r=>ch.test(r);function fa(r){return typeof r!="object"?{}:r??{}}function cu(r){if(!r)return!0;for(let e in r)return!1;return!0}function du(r,e){return Object.prototype.hasOwnProperty.call(r,e)}var fu=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new $(`${r} must be an integer`);if(e<0)throw new $(`${r} must be a positive integer`);return e};var ji=r=>{try{return JSON.parse(r)}catch{return}};var hu=r=>new Promise(e=>setTimeout(e,r));var Vi={off:0,error:200,warn:300,info:400,debug:500},ha=(r,e,t)=>{if(r){if(du(Vi,r))return r;_e(t).warn(`${e} was set to ${JSON.stringify(r)}, expected one of ${JSON.stringify(Object.keys(Vi))}`)}};function In(){}function Hi(r,e,t){return!e||Vi[r]>Vi[t]?In:e[r].bind(e)}var dh={error:In,warn:In,info:In,debug:In},mu=new WeakMap;function _e(r){let e=r.logger,t=r.logLevel??"off";if(!e)return dh;let i=mu.get(e);if(i&&i[0]===t)return i[1];let o={error:Hi("error",e,t),warn:Hi("warn",e,t),info:Hi("info",e,t),debug:Hi("debug",e,t)};return mu.set(e,[t,o]),o}var vt=r=>(r.options&&(r.options={...r.options},delete r.options.headers),r.headers&&(r.headers=Object.fromEntries((r.headers instanceof Headers?[...r.headers]:Object.entries(r.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in r&&(r.retryOfRequestLogID&&(r.retryOf=r.retryOfRequestLogID),delete r.retryOfRequestLogID),r);var Vt="0.52.0";var yu=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function fh(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var hh=()=>{let r=fh();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vt,"X-Stainless-OS":bu(Deno.build.os),"X-Stainless-Arch":pu(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vt,"X-Stainless-OS":bu(globalThis.process.platform),"X-Stainless-Arch":pu(globalThis.process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version};let e=mh();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function mh(){if(typeof navigator>"u"||!navigator)return null;let r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of r){let i=t.exec(navigator.userAgent);if(i){let o=i[1]||0,s=i[2]||0,u=i[3]||0;return{browser:e,version:`${o}.${s}.${u}`}}}return null}var pu=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",bu=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown"),gu,_u=()=>gu??(gu=hh());function wu(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function ma(...r){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...r)}function zi(r){let e=Symbol.asyncIterator in r?r[Symbol.asyncIterator]():r[Symbol.iterator]();return ma({start(){},async pull(t){let{done:i,value:o}=await e.next();i?t.close():t.enqueue(o)},async cancel(){await e.return?.()}})}function kn(r){if(r[Symbol.asyncIterator])return r;let e=r.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Su(r){if(r===null||typeof r!="object")return;if(r[Symbol.asyncIterator]){await r[Symbol.asyncIterator]().return?.();return}let e=r.getReader(),t=e.cancel();e.releaseLock(),await t}var Ru=({headers:r,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});function Au(r){let e=0;for(let o of r)e+=o.length;let t=new Uint8Array(e),i=0;for(let o of r)t.set(o,i),i+=o.length;return t}var Tu;function xn(r){let e;return(Tu??(e=new globalThis.TextEncoder,Tu=e.encode.bind(e)))(r)}var Eu;function pa(r){let e;return(Eu??(e=new globalThis.TextDecoder,Eu=e.decode.bind(e)))(r)}var Ue,We,Pt=class{constructor(){Ue.set(this,void 0),We.set(this,void 0),H(this,Ue,new Uint8Array,"f"),H(this,We,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?xn(e):e;H(this,Ue,Au([A(this,Ue,"f"),t]),"f");let i=[],o;for(;(o=gh(A(this,Ue,"f"),A(this,We,"f")))!=null;){if(o.carriage&&A(this,We,"f")==null){H(this,We,o.index,"f");continue}if(A(this,We,"f")!=null&&(o.index!==A(this,We,"f")+1||o.carriage)){i.push(pa(A(this,Ue,"f").subarray(0,A(this,We,"f")-1))),H(this,Ue,A(this,Ue,"f").subarray(A(this,We,"f")),"f"),H(this,We,null,"f");continue}let s=A(this,We,"f")!==null?o.preceding-1:o.preceding,u=pa(A(this,Ue,"f").subarray(0,s));i.push(u),H(this,Ue,A(this,Ue,"f").subarray(o.index),"f"),H(this,We,null,"f")}return i}flush(){return A(this,Ue,"f").length?this.decode(`
`):[]}};Ue=new WeakMap,We=new WeakMap;Pt.NEWLINE_CHARS=new Set([`
`,"\r"]);Pt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function gh(r,e){for(let o=e??0;o<r.length;o++){if(r[o]===10)return{preceding:o,index:o+1,carriage:!1};if(r[o]===13)return{preceding:o,index:o+1,carriage:!0}}return null}function vu(r){for(let i=0;i<r.length-1;i++){if(r[i]===10&&r[i+1]===10||r[i]===13&&r[i+1]===13)return i+2;if(r[i]===13&&r[i+1]===10&&i+3<r.length&&r[i+2]===13&&r[i+3]===10)return i+4}return-1}var dt=class r{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let i=!1;async function*o(){if(i)throw new $("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let s=!1;try{for await(let u of yh(e,t)){if(u.event==="completion")try{yield JSON.parse(u.data)}catch(h){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),h}if(u.event==="message_start"||u.event==="message_delta"||u.event==="message_stop"||u.event==="content_block_start"||u.event==="content_block_delta"||u.event==="content_block_stop")try{yield JSON.parse(u.data)}catch(h){throw console.error("Could not parse message into JSON:",u.data),console.error("From chunk:",u.raw),h}if(u.event!=="ping"&&u.event==="error")throw new pe(void 0,ji(u.data)??u.data,void 0,e.headers)}s=!0}catch(u){if(At(u))return;throw u}finally{s||t.abort()}}return new r(o,t)}static fromReadableStream(e,t){let i=!1;async function*o(){let u=new Pt,h=kn(e);for await(let p of h)for(let m of u.decode(p))yield m;for(let p of u.flush())yield p}async function*s(){if(i)throw new $("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let u=!1;try{for await(let h of o())u||h&&(yield JSON.parse(h));u=!0}catch(h){if(At(h))return;throw h}finally{u||t.abort()}}return new r(s,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],i=this.iterator(),o=s=>({next:()=>{if(s.length===0){let u=i.next();e.push(u),t.push(u)}return s.shift()}});return[new r(()=>o(e),this.controller),new r(()=>o(t),this.controller)]}toReadableStream(){let e=this,t;return ma({async start(){t=e[Symbol.asyncIterator]()},async pull(i){try{let{value:o,done:s}=await t.next();if(s)return i.close();let u=xn(JSON.stringify(o)+`
`);i.enqueue(u)}catch(o){i.error(o)}},async cancel(){await t.return?.()}})}};async function*yh(r,e){if(!r.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new $("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new $("Attempted to iterate over a response with no body");let t=new ba,i=new Pt,o=kn(r.body);for await(let s of _h(o))for(let u of i.decode(s)){let h=t.decode(u);h&&(yield h)}for(let s of i.flush()){let u=t.decode(s);u&&(yield u)}}async function*_h(r){let e=new Uint8Array;for await(let t of r){if(t==null)continue;let i=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?xn(t):t,o=new Uint8Array(e.length+i.length);o.set(e),o.set(i,e.length),e=o;let s;for(;(s=vu(e))!==-1;)yield e.slice(0,s),e=e.slice(s)}e.length>0&&(yield e)}var ba=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,i,o]=wh(e,":");return o.startsWith(" ")&&(o=o.substring(1)),t==="event"?this.event=o:t==="data"&&this.data.push(o),null}};function wh(r,e){let t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}async function Qi(r,e){let{response:t,requestLogID:i,retryOfRequestLogID:o,startTime:s}=e,u=await(async()=>{if(e.options.stream)return _e(r).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):dt.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let p=t.headers.get("content-type")?.split(";")[0]?.trim();if(p?.includes("application/json")||p?.endsWith("+json")){let v=await t.json();return ga(v,t)}return await t.text()})();return _e(r).debug(`[${i}] response parsed`,vt({retryOfRequestLogID:o,url:t.url,status:t.status,body:u,durationMs:Date.now()-s})),u}function ga(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var Dn,hr=class r extends Promise{constructor(e,t,i=Qi){super(o=>{o(null)}),this.responsePromise=t,this.parseResponse=i,Dn.set(this,void 0),H(this,Dn,e,"f")}_thenUnwrap(e){return new r(A(this,Dn,"f"),this.responsePromise,async(t,i)=>ga(e(await this.parseResponse(t,i),i),i.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(A(this,Dn,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};Dn=new WeakMap;var Gi,ya=class{constructor(e,t,i,o){Gi.set(this,void 0),H(this,Gi,e,"f"),this.options=o,this.response=t,this.body=i}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new $("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await A(this,Gi,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Gi=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}},Mn=class extends hr{constructor(e,t,i){super(e,t,async(o,s)=>new i(o,s.response,await Qi(o,s),s.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}},Ge=class extends ya{constructor(e,t,i,o){super(e,t,i,o),this.data=i.data||[],this.has_more=i.has_more||!1,this.first_id=i.first_id||null,this.last_id=i.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let t=this.first_id;return t?{...this.options,query:{...fa(this.options.query),before_id:t}}:null}let e=this.last_id;return e?{...this.options,query:{...fa(this.options.query),after_id:e}}:null}};var wa=()=>{if(typeof File>"u"){let{process:r}=globalThis,e=typeof r?.versions?.node=="string"&&parseInt(r.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function mr(r,e,t){return wa(),new File(r,e??"unknown_file",t)}function On(r){return(typeof r=="object"&&r!==null&&("name"in r&&r.name&&String(r.name)||"url"in r&&r.url&&String(r.url)||"filename"in r&&r.filename&&String(r.filename)||"path"in r&&r.path&&String(r.path))||"").split(/[\\/]/).pop()||void 0}var Sa=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function";var Cu=async(r,e)=>({...r,body:await Th(r.body,e)}),Pu=new WeakMap;function Rh(r){let e=typeof r=="function"?r:r.fetch,t=Pu.get(e);if(t)return t;let i=(async()=>{try{let o="Response"in e?e.Response:(await e("data:,")).constructor,s=new FormData;return s.toString()!==await new o(s).text()}catch{return!0}})();return Pu.set(e,i),i}var Th=async(r,e)=>{if(!await Rh(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return await Promise.all(Object.entries(r||{}).map(([i,o])=>_a(t,i,o))),t},Eh=r=>r instanceof Blob&&"name"in r;var _a=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(t instanceof Response){let i={},o=t.headers.get("Content-Type");o&&(i={type:o}),r.append(e,mr([await t.blob()],On(t),i))}else if(Sa(t))r.append(e,mr([await new Response(zi(t)).blob()],On(t)));else if(Eh(t))r.append(e,mr([t],On(t),{type:t.type}));else if(Array.isArray(t))await Promise.all(t.map(i=>_a(r,e+"[]",i)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([i,o])=>_a(r,`${e}[${i}]`,o)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var Iu=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",Ah=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&Iu(r),vh=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function";async function Yi(r,e,t){if(wa(),r=await r,e||(e=On(r)),Ah(r))return r instanceof File&&e==null&&t==null?r:mr([await r.arrayBuffer()],e??r.name,{type:r.type,lastModified:r.lastModified,...t});if(vh(r)){let o=await r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()),mr(await Ra(o),e,t)}let i=await Ra(r);if(!t?.type){let o=i.find(s=>typeof s=="object"&&"type"in s&&s.type);typeof o=="string"&&(t={...t,type:o})}return mr(i,e,t)}async function Ra(r){let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(Iu(r))e.push(r instanceof Blob?r:await r.arrayBuffer());else if(Sa(r))for await(let t of r)e.push(...await Ra(t));else{let t=r?.constructor?.name;throw new Error(`Unexpected data type: ${typeof r}${t?`; constructor: ${t}`:""}${Ph(r)}`)}return e}function Ph(r){return typeof r!="object"||r===null?"":`; props: [${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}var de=class{constructor(e){this._client=e}};var xu=Symbol.for("brand.privateNullableHeaders"),ku=Array.isArray;function*Ih(r){if(!r)return;if(xu in r){let{values:i,nulls:o}=r;yield*i.entries();for(let s of o)yield[s,null];return}let e=!1,t;r instanceof Headers?t=r.entries():ku(r)?t=r:(e=!0,t=Object.entries(r??{}));for(let i of t){let o=i[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");let s=ku(i[1])?i[1]:[i[1]],u=!1;for(let h of s)h!==void 0&&(e&&!u&&(u=!0,yield[o,null]),yield[o,h])}}var K=r=>{let e=new Headers,t=new Set;for(let i of r){let o=new Set;for(let[s,u]of Ih(i)){let h=s.toLowerCase();o.has(h)||(e.delete(s),o.add(h)),u===null?(e.delete(s),t.add(h)):(e.append(s,u),t.delete(h))}}return{[xu]:!0,values:e,nulls:t}};function Du(r){return r.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var kh=(r=Du)=>function(t,...i){if(t.length===1)return t[0];let o=!1,s=t.reduce((y,v,C)=>(/[?#]/.test(v)&&(o=!0),y+v+(C===i.length?"":(o?encodeURIComponent:r)(String(i[C])))),""),u=s.split(/[?#]/,1)[0],h=[],p=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,m;for(;(m=p.exec(u))!==null;)h.push({start:m.index,length:m[0].length});if(h.length>0){let y=0,v=h.reduce((C,E)=>{let R=" ".repeat(E.start-y),B="^".repeat(E.length);return y=E.start+E.length,C+R+B},"");throw new $(`Path parameters result in path with invalid segments:
${s}
${v}`)}return s},we=kh(Du);var Qr=class extends de{list(e={},t){let{betas:i,...o}=e??{};return this._client.getAPIList("/v1/files",Ge,{query:o,...t,headers:K([{"anthropic-beta":[...i??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},i){let{betas:o}=t??{};return this._client.delete(we`/v1/files/${e}`,{...i,headers:K([{"anthropic-beta":[...o??[],"files-api-2025-04-14"].toString()},i?.headers])})}download(e,t={},i){let{betas:o}=t??{};return this._client.get(we`/v1/files/${e}/content`,{...i,headers:K([{"anthropic-beta":[...o??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},i?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},i){let{betas:o}=t??{};return this._client.get(we`/v1/files/${e}`,{...i,headers:K([{"anthropic-beta":[...o??[],"files-api-2025-04-14"].toString()},i?.headers])})}upload(e,t){let{betas:i,...o}=e;return this._client.post("/v1/files",Cu({body:o,...t,headers:K([{"anthropic-beta":[...i??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}};var Gr=class extends de{retrieve(e,t={},i){let{betas:o}=t??{};return this._client.get(we`/v1/models/${e}?beta=true`,{...i,headers:K([{...o?.toString()!=null?{"anthropic-beta":o?.toString()}:void 0},i?.headers])})}list(e={},t){let{betas:i,...o}=e??{};return this._client.getAPIList("/v1/models?beta=true",Ge,{query:o,...t,headers:K([{...i?.toString()!=null?{"anthropic-beta":i?.toString()}:void 0},t?.headers])})}};var Yr=class r{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){let e=new Pt;for await(let t of this.iterator)for(let i of e.decode(t))yield JSON.parse(i);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new $("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new $("Attempted to iterate over a response with no body");return new r(kn(e.body),t)}};var Xr=class extends de{create(e,t){let{betas:i,...o}=e;return this._client.post("/v1/messages/batches?beta=true",{body:o,...t,headers:K([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},i){let{betas:o}=t??{};return this._client.get(we`/v1/messages/batches/${e}?beta=true`,{...i,headers:K([{"anthropic-beta":[...o??[],"message-batches-2024-09-24"].toString()},i?.headers])})}list(e={},t){let{betas:i,...o}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",Ge,{query:o,...t,headers:K([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},i){let{betas:o}=t??{};return this._client.delete(we`/v1/messages/batches/${e}?beta=true`,{...i,headers:K([{"anthropic-beta":[...o??[],"message-batches-2024-09-24"].toString()},i?.headers])})}cancel(e,t={},i){let{betas:o}=t??{};return this._client.post(we`/v1/messages/batches/${e}/cancel?beta=true`,{...i,headers:K([{"anthropic-beta":[...o??[],"message-batches-2024-09-24"].toString()},i?.headers])})}async results(e,t={},i){let o=await this.retrieve(e);if(!o.results_url)throw new $(`No batch \`results_url\`; Has it finished processing? ${o.processing_status} - ${o.id}`);let{betas:s}=t??{};return this._client.get(o.results_url,{...i,headers:K([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},i?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((u,h)=>Yr.fromResponse(h.response,h.controller))}};var Oh=r=>{let e=0,t=[];for(;e<r.length;){let i=r[e];if(i==="\\"){e++;continue}if(i==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(i==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(i==="["){t.push({type:"paren",value:"["}),e++;continue}if(i==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(i===":"){t.push({type:"separator",value:":"}),e++;continue}if(i===","){t.push({type:"delimiter",value:","}),e++;continue}if(i==='"'){let h="",p=!1;for(i=r[++e];i!=='"';){if(e===r.length){p=!0;break}if(i==="\\"){if(e++,e===r.length){p=!0;break}h+=i+r[e],i=r[++e]}else h+=i,i=r[++e]}i=r[++e],p||t.push({type:"string",value:h});continue}if(i&&/\s/.test(i)){e++;continue}let s=/[0-9]/;if(i&&s.test(i)||i==="-"||i==="."){let h="";for(i==="-"&&(h+=i,i=r[++e]);i&&s.test(i)||i===".";)h+=i,i=r[++e];t.push({type:"number",value:h});continue}let u=/[a-z]/i;if(i&&u.test(i)){let h="";for(;i&&u.test(i)&&e!==r.length;)h+=i,i=r[++e];if(h=="true"||h=="false"||h==="null")t.push({type:"name",value:h});else{e++;continue}continue}e++}return t},Jr=r=>{if(r.length===0)return r;let e=r[r.length-1];switch(e.type){case"separator":return r=r.slice(0,r.length-1),Jr(r);break;case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return r=r.slice(0,r.length-1),Jr(r);case"string":let i=r[r.length-2];if(i?.type==="delimiter")return r=r.slice(0,r.length-1),Jr(r);if(i?.type==="brace"&&i.value==="{")return r=r.slice(0,r.length-1),Jr(r);break;case"delimiter":return r=r.slice(0,r.length-1),Jr(r);break}return r},Bh=r=>{let e=[];return r.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?r.push({type:"brace",value:"}"}):t==="]"&&r.push({type:"paren",value:"]"})}),r},Lh=r=>{let e="";return r.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},Xi=r=>JSON.parse(Lh(Bh(Jr(Oh(r)))));var Ye,zt,Bn,Ji,Ln,Fn,Ki,qn,Ct,Nn,Zi,eo,Kr,to,ro,Ta,Mu,Ea,Aa,va,Pa,Ou,Bu="__json_buf",no=class r{constructor(){Ye.add(this),this.messages=[],this.receivedMessages=[],zt.set(this,void 0),this.controller=new AbortController,Bn.set(this,void 0),Ji.set(this,()=>{}),Ln.set(this,()=>{}),Fn.set(this,void 0),Ki.set(this,()=>{}),qn.set(this,()=>{}),Ct.set(this,{}),Nn.set(this,!1),Zi.set(this,!1),eo.set(this,!1),Kr.set(this,!1),to.set(this,void 0),ro.set(this,void 0),Ea.set(this,e=>{if(H(this,Zi,!0,"f"),At(e)&&(e=new be),e instanceof be)return H(this,eo,!0,"f"),this._emit("abort",e);if(e instanceof $)return this._emit("error",e);if(e instanceof Error){let t=new $(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new $(String(e)))}),H(this,Bn,new Promise((e,t)=>{H(this,Ji,e,"f"),H(this,Ln,t,"f")}),"f"),H(this,Fn,new Promise((e,t)=>{H(this,Ki,e,"f"),H(this,qn,t,"f")}),"f"),A(this,Bn,"f").catch(()=>{}),A(this,Fn,"f").catch(()=>{})}get response(){return A(this,to,"f")}get request_id(){return A(this,ro,"f")}async withResponse(){let e=await A(this,Bn,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new r;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,i){let o=new r;for(let s of t.messages)o._addMessageParam(s);return o._run(()=>o._createMessage(e,{...t,stream:!0},{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),o}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},A(this,Ea,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,i){let o=i?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),A(this,Ye,"m",Aa).call(this);let{response:s,data:u}=await e.create({...t,stream:!0},{...i,signal:this.controller.signal}).withResponse();this._connected(s);for await(let h of u)A(this,Ye,"m",va).call(this,h);if(u.controller.signal?.aborted)throw new be;A(this,Ye,"m",Pa).call(this)}_connected(e){this.ended||(H(this,to,e,"f"),H(this,ro,e?.headers.get("request-id"),"f"),A(this,Ji,"f").call(this,e),this._emit("connect"))}get ended(){return A(this,Nn,"f")}get errored(){return A(this,Zi,"f")}get aborted(){return A(this,eo,"f")}abort(){this.controller.abort()}on(e,t){return(A(this,Ct,"f")[e]||(A(this,Ct,"f")[e]=[])).push({listener:t}),this}off(e,t){let i=A(this,Ct,"f")[e];if(!i)return this;let o=i.findIndex(s=>s.listener===t);return o>=0&&i.splice(o,1),this}once(e,t){return(A(this,Ct,"f")[e]||(A(this,Ct,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,i)=>{H(this,Kr,!0,"f"),e!=="error"&&this.once("error",i),this.once(e,t)})}async done(){H(this,Kr,!0,"f"),await A(this,Fn,"f")}get currentMessage(){return A(this,zt,"f")}async finalMessage(){return await this.done(),A(this,Ye,"m",Ta).call(this)}async finalText(){return await this.done(),A(this,Ye,"m",Mu).call(this)}_emit(e,...t){if(A(this,Nn,"f"))return;e==="end"&&(H(this,Nn,!0,"f"),A(this,Ki,"f").call(this));let i=A(this,Ct,"f")[e];if(i&&(A(this,Ct,"f")[e]=i.filter(o=>!o.once),i.forEach(({listener:o})=>o(...t))),e==="abort"){let o=t[0];!A(this,Kr,"f")&&!i?.length&&Promise.reject(o),A(this,Ln,"f").call(this,o),A(this,qn,"f").call(this,o),this._emit("end");return}if(e==="error"){let o=t[0];!A(this,Kr,"f")&&!i?.length&&Promise.reject(o),A(this,Ln,"f").call(this,o),A(this,qn,"f").call(this,o),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",A(this,Ye,"m",Ta).call(this))}async _fromReadableStream(e,t){let i=t?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),A(this,Ye,"m",Aa).call(this),this._connected(null);let o=dt.fromReadableStream(e,this.controller);for await(let s of o)A(this,Ye,"m",va).call(this,s);if(o.controller.signal?.aborted)throw new be;A(this,Ye,"m",Pa).call(this)}[(zt=new WeakMap,Bn=new WeakMap,Ji=new WeakMap,Ln=new WeakMap,Fn=new WeakMap,Ki=new WeakMap,qn=new WeakMap,Ct=new WeakMap,Nn=new WeakMap,Zi=new WeakMap,eo=new WeakMap,Kr=new WeakMap,to=new WeakMap,ro=new WeakMap,Ea=new WeakMap,Ye=new WeakSet,Ta=function(){if(this.receivedMessages.length===0)throw new $("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Mu=function(){if(this.receivedMessages.length===0)throw new $("stream ended without producing a Message with role=assistant");let t=this.receivedMessages.at(-1).content.filter(i=>i.type==="text").map(i=>i.text);if(t.length===0)throw new $("stream ended without producing a content block with type=text");return t.join(" ")},Aa=function(){this.ended||H(this,zt,void 0,"f")},va=function(t){if(this.ended)return;let i=A(this,Ye,"m",Ou).call(this,t);switch(this._emit("streamEvent",t,i),t.type){case"content_block_delta":{let o=i.content.at(-1);switch(t.delta.type){case"text_delta":{o.type==="text"&&this._emit("text",t.delta.text,o.text||"");break}case"citations_delta":{o.type==="text"&&this._emit("citation",t.delta.citation,o.citations??[]);break}case"input_json_delta":{(o.type==="tool_use"||o.type==="mcp_tool_use")&&o.input&&this._emit("inputJson",t.delta.partial_json,o.input);break}case"thinking_delta":{o.type==="thinking"&&this._emit("thinking",t.delta.thinking,o.thinking);break}case"signature_delta":{o.type==="thinking"&&this._emit("signature",o.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(i),this._addMessage(i,!0);break}case"content_block_stop":{this._emit("contentBlock",i.content.at(-1));break}case"message_start":{H(this,zt,i,"f");break}case"content_block_start":case"message_delta":break}},Pa=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");let t=A(this,zt,"f");if(!t)throw new $("request ended without sending any chunks");return H(this,zt,void 0,"f"),t},Ou=function(t){let i=A(this,zt,"f");if(t.type==="message_start"){if(i)throw new $(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!i)throw new $(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return i;case"message_delta":return i.container=t.delta.container,i.stop_reason=t.delta.stop_reason,i.stop_sequence=t.delta.stop_sequence,i.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(i.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(i.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(i.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(i.usage.server_tool_use=t.usage.server_tool_use),i;case"content_block_start":return i.content.push(t.content_block),i;case"content_block_delta":{let o=i.content.at(t.index);switch(t.delta.type){case"text_delta":{o?.type==="text"&&(o.text+=t.delta.text);break}case"citations_delta":{o?.type==="text"&&(o.citations??(o.citations=[]),o.citations.push(t.delta.citation));break}case"input_json_delta":{if(o?.type==="tool_use"||o?.type==="mcp_tool_use"){let s=o[Bu]||"";s+=t.delta.partial_json,Object.defineProperty(o,Bu,{value:s,enumerable:!1,writable:!0}),s&&(o.input=Xi(s))}break}case"thinking_delta":{o?.type==="thinking"&&(o.thinking+=t.delta.thinking);break}case"signature_delta":{o?.type==="thinking"&&(o.signature=t.delta.signature);break}default:t.delta}return i}case"content_block_stop":return i}},Symbol.asyncIterator)](){let e=[],t=[],i=!1;return this.on("streamEvent",o=>{let s=t.shift();s?s.resolve(o):e.push(o)}),this.on("end",()=>{i=!0;for(let o of t)o.resolve(void 0);t.length=0}),this.on("abort",o=>{i=!0;for(let s of t)s.reject(o);t.length=0}),this.on("error",o=>{i=!0;for(let s of t)s.reject(o);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:i?{value:void 0,done:!0}:new Promise((s,u)=>t.push({resolve:s,reject:u})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new dt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};var io={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192};var Lu={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"},pr=class extends de{constructor(){super(...arguments),this.batches=new Xr(this._client)}create(e,t){let{betas:i,...o}=e;o.model in Lu&&console.warn(`The model '${o.model}' is deprecated and will reach end-of-life on ${Lu[o.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let s=this._client._options.timeout;if(!o.stream&&s==null){let u=io[o.model]??void 0;s=this._client.calculateNonstreamingTimeout(o.max_tokens,u)}return this._client.post("/v1/messages?beta=true",{body:o,timeout:s??6e5,...t,headers:K([{...i?.toString()!=null?{"anthropic-beta":i?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}stream(e,t){return no.createMessage(this,e,t)}countTokens(e,t){let{betas:i,...o}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:o,...t,headers:K([{"anthropic-beta":[...i??[],"token-counting-2024-11-01"].toString()},t?.headers])})}};pr.Batches=Xr;var ft=class extends de{constructor(){super(...arguments),this.models=new Gr(this._client),this.messages=new pr(this._client),this.files=new Qr(this._client)}};ft.Models=Gr;ft.Messages=pr;ft.Files=Qr;var br=class extends de{create(e,t){let{betas:i,...o}=e;return this._client.post("/v1/complete",{body:o,timeout:this._client._options.timeout??6e5,...t,headers:K([{...i?.toString()!=null?{"anthropic-beta":i?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}};var Xe,Qt,Un,oo,Wn,$n,ao,jn,It,Hn,so,lo,Zr,uo,co,Ca,Fu,Ia,ka,xa,Da,qu,Nu="__json_buf",fo=class r{constructor(){Xe.add(this),this.messages=[],this.receivedMessages=[],Qt.set(this,void 0),this.controller=new AbortController,Un.set(this,void 0),oo.set(this,()=>{}),Wn.set(this,()=>{}),$n.set(this,void 0),ao.set(this,()=>{}),jn.set(this,()=>{}),It.set(this,{}),Hn.set(this,!1),so.set(this,!1),lo.set(this,!1),Zr.set(this,!1),uo.set(this,void 0),co.set(this,void 0),Ia.set(this,e=>{if(H(this,so,!0,"f"),At(e)&&(e=new be),e instanceof be)return H(this,lo,!0,"f"),this._emit("abort",e);if(e instanceof $)return this._emit("error",e);if(e instanceof Error){let t=new $(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new $(String(e)))}),H(this,Un,new Promise((e,t)=>{H(this,oo,e,"f"),H(this,Wn,t,"f")}),"f"),H(this,$n,new Promise((e,t)=>{H(this,ao,e,"f"),H(this,jn,t,"f")}),"f"),A(this,Un,"f").catch(()=>{}),A(this,$n,"f").catch(()=>{})}get response(){return A(this,uo,"f")}get request_id(){return A(this,co,"f")}async withResponse(){let e=await A(this,Un,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new r;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,i){let o=new r;for(let s of t.messages)o._addMessageParam(s);return o._run(()=>o._createMessage(e,{...t,stream:!0},{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),o}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},A(this,Ia,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,i){let o=i?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),A(this,Xe,"m",ka).call(this);let{response:s,data:u}=await e.create({...t,stream:!0},{...i,signal:this.controller.signal}).withResponse();this._connected(s);for await(let h of u)A(this,Xe,"m",xa).call(this,h);if(u.controller.signal?.aborted)throw new be;A(this,Xe,"m",Da).call(this)}_connected(e){this.ended||(H(this,uo,e,"f"),H(this,co,e?.headers.get("request-id"),"f"),A(this,oo,"f").call(this,e),this._emit("connect"))}get ended(){return A(this,Hn,"f")}get errored(){return A(this,so,"f")}get aborted(){return A(this,lo,"f")}abort(){this.controller.abort()}on(e,t){return(A(this,It,"f")[e]||(A(this,It,"f")[e]=[])).push({listener:t}),this}off(e,t){let i=A(this,It,"f")[e];if(!i)return this;let o=i.findIndex(s=>s.listener===t);return o>=0&&i.splice(o,1),this}once(e,t){return(A(this,It,"f")[e]||(A(this,It,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,i)=>{H(this,Zr,!0,"f"),e!=="error"&&this.once("error",i),this.once(e,t)})}async done(){H(this,Zr,!0,"f"),await A(this,$n,"f")}get currentMessage(){return A(this,Qt,"f")}async finalMessage(){return await this.done(),A(this,Xe,"m",Ca).call(this)}async finalText(){return await this.done(),A(this,Xe,"m",Fu).call(this)}_emit(e,...t){if(A(this,Hn,"f"))return;e==="end"&&(H(this,Hn,!0,"f"),A(this,ao,"f").call(this));let i=A(this,It,"f")[e];if(i&&(A(this,It,"f")[e]=i.filter(o=>!o.once),i.forEach(({listener:o})=>o(...t))),e==="abort"){let o=t[0];!A(this,Zr,"f")&&!i?.length&&Promise.reject(o),A(this,Wn,"f").call(this,o),A(this,jn,"f").call(this,o),this._emit("end");return}if(e==="error"){let o=t[0];!A(this,Zr,"f")&&!i?.length&&Promise.reject(o),A(this,Wn,"f").call(this,o),A(this,jn,"f").call(this,o),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",A(this,Xe,"m",Ca).call(this))}async _fromReadableStream(e,t){let i=t?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),A(this,Xe,"m",ka).call(this),this._connected(null);let o=dt.fromReadableStream(e,this.controller);for await(let s of o)A(this,Xe,"m",xa).call(this,s);if(o.controller.signal?.aborted)throw new be;A(this,Xe,"m",Da).call(this)}[(Qt=new WeakMap,Un=new WeakMap,oo=new WeakMap,Wn=new WeakMap,$n=new WeakMap,ao=new WeakMap,jn=new WeakMap,It=new WeakMap,Hn=new WeakMap,so=new WeakMap,lo=new WeakMap,Zr=new WeakMap,uo=new WeakMap,co=new WeakMap,Ia=new WeakMap,Xe=new WeakSet,Ca=function(){if(this.receivedMessages.length===0)throw new $("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Fu=function(){if(this.receivedMessages.length===0)throw new $("stream ended without producing a Message with role=assistant");let t=this.receivedMessages.at(-1).content.filter(i=>i.type==="text").map(i=>i.text);if(t.length===0)throw new $("stream ended without producing a content block with type=text");return t.join(" ")},ka=function(){this.ended||H(this,Qt,void 0,"f")},xa=function(t){if(this.ended)return;let i=A(this,Xe,"m",qu).call(this,t);switch(this._emit("streamEvent",t,i),t.type){case"content_block_delta":{let o=i.content.at(-1);switch(t.delta.type){case"text_delta":{o.type==="text"&&this._emit("text",t.delta.text,o.text||"");break}case"citations_delta":{o.type==="text"&&this._emit("citation",t.delta.citation,o.citations??[]);break}case"input_json_delta":{o.type==="tool_use"&&o.input&&this._emit("inputJson",t.delta.partial_json,o.input);break}case"thinking_delta":{o.type==="thinking"&&this._emit("thinking",t.delta.thinking,o.thinking);break}case"signature_delta":{o.type==="thinking"&&this._emit("signature",o.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(i),this._addMessage(i,!0);break}case"content_block_stop":{this._emit("contentBlock",i.content.at(-1));break}case"message_start":{H(this,Qt,i,"f");break}case"content_block_start":case"message_delta":break}},Da=function(){if(this.ended)throw new $("stream has ended, this shouldn't happen");let t=A(this,Qt,"f");if(!t)throw new $("request ended without sending any chunks");return H(this,Qt,void 0,"f"),t},qu=function(t){let i=A(this,Qt,"f");if(t.type==="message_start"){if(i)throw new $(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!i)throw new $(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return i;case"message_delta":return i.stop_reason=t.delta.stop_reason,i.stop_sequence=t.delta.stop_sequence,i.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(i.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(i.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(i.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(i.usage.server_tool_use=t.usage.server_tool_use),i;case"content_block_start":return i.content.push(t.content_block),i;case"content_block_delta":{let o=i.content.at(t.index);switch(t.delta.type){case"text_delta":{o?.type==="text"&&(o.text+=t.delta.text);break}case"citations_delta":{o?.type==="text"&&(o.citations??(o.citations=[]),o.citations.push(t.delta.citation));break}case"input_json_delta":{if(o?.type==="tool_use"){let s=o[Nu]||"";s+=t.delta.partial_json,Object.defineProperty(o,Nu,{value:s,enumerable:!1,writable:!0}),s&&(o.input=Xi(s))}break}case"thinking_delta":{o?.type==="thinking"&&(o.thinking+=t.delta.thinking);break}case"signature_delta":{o?.type==="thinking"&&(o.signature=t.delta.signature);break}default:t.delta}return i}case"content_block_stop":return i}},Symbol.asyncIterator)](){let e=[],t=[],i=!1;return this.on("streamEvent",o=>{let s=t.shift();s?s.resolve(o):e.push(o)}),this.on("end",()=>{i=!0;for(let o of t)o.resolve(void 0);t.length=0}),this.on("abort",o=>{i=!0;for(let s of t)s.reject(o);t.length=0}),this.on("error",o=>{i=!0;for(let s of t)s.reject(o);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:i?{value:void 0,done:!0}:new Promise((s,u)=>t.push({resolve:s,reject:u})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new dt(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};var en=class extends de{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(we`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",Ge,{query:e,...t})}delete(e,t){return this._client.delete(we`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(we`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let i=await this.retrieve(e);if(!i.results_url)throw new $(`No batch \`results_url\`; Has it finished processing? ${i.processing_status} - ${i.id}`);return this._client.get(i.results_url,{...t,headers:K([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((o,s)=>Yr.fromResponse(s.response,s.controller))}};var Gt=class extends de{constructor(){super(...arguments),this.batches=new en(this._client)}create(e,t){e.model in Uu&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${Uu[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let i=this._client._options.timeout;if(!e.stream&&i==null){let o=io[e.model]??void 0;i=this._client.calculateNonstreamingTimeout(e.max_tokens,o)}return this._client.post("/v1/messages",{body:e,timeout:i??6e5,...t,stream:e.stream??!1})}stream(e,t){return fo.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}},Uu={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};Gt.Batches=en;var gr=class extends de{retrieve(e,t={},i){let{betas:o}=t??{};return this._client.get(we`/v1/models/${e}`,{...i,headers:K([{...o?.toString()!=null?{"anthropic-beta":o?.toString()}:void 0},i?.headers])})}list(e={},t){let{betas:i,...o}=e??{};return this._client.getAPIList("/v1/models",Ge,{query:o,...t,headers:K([{...i?.toString()!=null?{"anthropic-beta":i?.toString()}:void 0},t?.headers])})}};var Vn=r=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[r]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(r)?.trim()};var Wu,ho,ie=class{constructor({baseURL:e=Vn("ANTHROPIC_BASE_URL"),apiKey:t=Vn("ANTHROPIC_API_KEY")??null,authToken:i=Vn("ANTHROPIC_AUTH_TOKEN")??null,...o}={}){ho.set(this,void 0);let s={apiKey:t,authToken:i,...o,baseURL:e||"https://api.anthropic.com"};if(!s.dangerouslyAllowBrowser&&yu())throw new $(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=s.baseURL,this.timeout=s.timeout??xe.DEFAULT_TIMEOUT,this.logger=s.logger??console;let u="warn";this.logLevel=u,this.logLevel=ha(s.logLevel,"ClientOptions.logLevel",this)??ha(Vn("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??u,this.fetchOptions=s.fetchOptions,this.maxRetries=s.maxRetries??2,this.fetch=s.fetch??wu(),H(this,ho,Ru,"f"),this._options=s,this.apiKey=t,this.authToken=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(this.apiKey&&e.get("x-api-key"))&&!t.has("x-api-key")&&!(this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){return K([this.apiKeyAuth(e),this.bearerAuth(e)])}apiKeyAuth(e){if(this.apiKey!=null)return K([{"X-Api-Key":this.apiKey}])}bearerAuth(e){if(this.authToken!=null)return K([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([t,i])=>typeof i<"u").map(([t,i])=>{if(typeof i=="string"||typeof i=="number"||typeof i=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(i)}`;if(i===null)return`${encodeURIComponent(t)}=`;throw new $(`Cannot stringify type ${typeof i}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Vt}`}defaultIdempotencyKey(){return`stainless-node-retry-${da()}`}makeStatusError(e,t,i,o){return pe.generate(e,t,i,o)}buildURL(e,t){let i=uu(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return cu(o)||(t={...o,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new $("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-python#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:i}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,i){return this.request(Promise.resolve(i).then(o=>({method:e,path:t,...o})))}request(e,t=null){return new hr(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,i){let o=await e,s=o.maxRetries??this.maxRetries;t==null&&(t=s),await this.prepareOptions(o);let{req:u,url:h,timeout:p}=this.buildRequest(o,{retryCount:s-t});await this.prepareRequest(u,{url:h,options:o});let m="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),y=i===void 0?"":`, retryOf: ${i}`,v=Date.now();if(_e(this).debug(`[${m}] sending request`,vt({retryOfRequestLogID:i,method:o.method,url:h,options:o,headers:u.headers})),o.signal?.aborted)throw new be;let C=new AbortController,E=await this.fetchWithTimeout(h,u,p,C).catch(Cn),R=Date.now();if(E instanceof Error){let L=`retrying, ${t} attempts remaining`;if(o.signal?.aborted)throw new be;let P=At(E)||/timed? ?out/i.test(String(E)+("cause"in E?String(E.cause):""));if(t)return _e(this).info(`[${m}] connection ${P?"timed out":"failed"} - ${L}`),_e(this).debug(`[${m}] connection ${P?"timed out":"failed"} (${L})`,vt({retryOfRequestLogID:i,url:h,durationMs:R-v,message:E.message})),this.retryRequest(o,t,i??m);throw _e(this).info(`[${m}] connection ${P?"timed out":"failed"} - error; no more retries left`),_e(this).debug(`[${m}] connection ${P?"timed out":"failed"} (error; no more retries left)`,vt({retryOfRequestLogID:i,url:h,durationMs:R-v,message:E.message})),P?new qr:new Ht({cause:E})}let B=[...E.headers.entries()].filter(([L])=>L==="request-id").map(([L,P])=>", "+L+": "+JSON.stringify(P)).join(""),x=`[${m}${y}${B}] ${u.method} ${h} ${E.ok?"succeeded":"failed"} with status ${E.status} in ${R-v}ms`;if(!E.ok){let L=this.shouldRetry(E);if(t&&L){let G=`retrying, ${t} attempts remaining`;return await Su(E.body),_e(this).info(`${x} - ${G}`),_e(this).debug(`[${m}] response error (${G})`,vt({retryOfRequestLogID:i,url:E.url,status:E.status,headers:E.headers,durationMs:R-v})),this.retryRequest(o,t,i??m,E.headers)}let P=L?"error; no more retries left":"error; not retryable";_e(this).info(`${x} - ${P}`);let D=await E.text().catch(G=>Cn(G).message),k=ji(D),M=k?void 0:D;throw _e(this).debug(`[${m}] response error (${P})`,vt({retryOfRequestLogID:i,url:E.url,status:E.status,headers:E.headers,message:M,durationMs:Date.now()-v})),this.makeStatusError(E.status,k,M,E.headers)}return _e(this).info(x),_e(this).debug(`[${m}] response start`,vt({retryOfRequestLogID:i,url:E.url,status:E.status,headers:E.headers,durationMs:R-v})),{response:E,options:o,controller:C,requestLogID:m,retryOfRequestLogID:i,startTime:v}}getAPIList(e,t,i){return this.requestAPIList(t,{method:"get",path:e,...i})}requestAPIList(e,t){let i=this.makeRequest(t,null,void 0);return new Mn(this,i,e)}async fetchWithTimeout(e,t,i,o){let{signal:s,method:u,...h}=t||{};s&&s.addEventListener("abort",()=>o.abort());let p=setTimeout(()=>o.abort(),i),m=globalThis.ReadableStream&&h.body instanceof globalThis.ReadableStream||typeof h.body=="object"&&h.body!==null&&Symbol.asyncIterator in h.body,y={signal:o.signal,...m?{duplex:"half"}:{},method:"GET",...h};u&&(y.method=u.toUpperCase());try{return await this.fetch.call(void 0,e,y)}finally{clearTimeout(p)}}shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,i,o){let s,u=o?.get("retry-after-ms");if(u){let p=parseFloat(u);Number.isNaN(p)||(s=p)}let h=o?.get("retry-after");if(h&&!s){let p=parseFloat(h);Number.isNaN(p)?s=Date.parse(h)-Date.now():s=p*1e3}if(!(s&&0<=s&&s<60*1e3)){let p=e.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(t,p)}return await hu(s),this.makeRequest(e,t-1,i)}calculateDefaultRetryTimeoutMillis(e,t){let s=t-e,u=Math.min(.5*Math.pow(2,s),8),h=1-Math.random()*.25;return u*h*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||t!=null&&e>t)throw new $("Streaming is strongly recommended for operations that may token longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}buildRequest(e,{retryCount:t=0}={}){let i={...e},{method:o,path:s,query:u}=i,h=this.buildURL(s,u);"timeout"in i&&fu("timeout",i.timeout),i.timeout=i.timeout??this.timeout;let{bodyHeaders:p,body:m}=this.buildBody({options:i}),y=this.buildHeaders({options:e,method:o,bodyHeaders:p,retryCount:t});return{req:{method:o,headers:y,...i.signal&&{signal:i.signal},...globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"},...m&&{body:m},...this.fetchOptions??{},...i.fetchOptions??{}},url:h,timeout:i.timeout}}buildHeaders({options:e,method:t,bodyHeaders:i,retryCount:o}){let s={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);let u=K([s,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(o),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},..._u(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},this.authHeaders(e),this._options.defaultHeaders,i,e.headers]);return this.validateHeaders(u),u.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let i=K([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&i.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:zi(e)}:A(this,ho,"f").call(this,{body:e,headers:i})}};Wu=ie,ho=new WeakMap;ie.Anthropic=Wu;ie.HUMAN_PROMPT=`

Human:`;ie.AI_PROMPT=`

Assistant:`;ie.DEFAULT_TIMEOUT=6e5;ie.AnthropicError=$;ie.APIError=pe;ie.APIConnectionError=Ht;ie.APIConnectionTimeoutError=qr;ie.APIUserAbortError=be;ie.NotFoundError=$r;ie.ConflictError=jr;ie.RateLimitError=Vr;ie.BadRequestError=Nr;ie.AuthenticationError=Ur;ie.InternalServerError=zr;ie.PermissionDeniedError=Wr;ie.UnprocessableEntityError=Hr;ie.toFile=Yi;var xe=class extends ie{constructor(){super(...arguments),this.completions=new br(this),this.messages=new Gt(this),this.models=new gr(this),this.beta=new ft(this)}};xe.Completions=br;xe.Messages=Gt;xe.Models=gr;xe.Beta=ft;var{HUMAN_PROMPT:Uh,AI_PROMPT:Wh}=xe;var _r=require("@raycast/api"),ju=require("react");var mo="claude-3-5-sonnet-latest";var Ma={title:"\u{1F4A1}",message:"Summarizing video"},Oa={title:"\u{1F4DD}",message:"Video summarized!"},yr={title:"\u{1F6A8}"},tn={title:"\u{1F50D}",message:"Answering your question"};var Ba={title:"\u{1F517}",message:"Checking video URL"},La={title:"\u{1F517}",message:"Checking Browser Extension"},Fa={title:"\u{1F517}",message:"Checking Clipboard"};function rn(){return`q-${Date.now()}`}function $u(r,e,t){return`Summarize the following transcription of a youtube video as a list of the most important points each starting with a fitting emoji. Ignore Sponsor Segments and Video Sponsors. Answer in ${r}.
  
  Format:

  [Emoji] [List Item] &nbsp;&nbsp;
  
  Here is the transcript: ${e.length>0?e:t}`}function po(r,e){return`The following text is the content of a video. Refer to it as video. You already summarized it for the person asking a question. Answer with a list starting with a fitting emoji. Ignore Sponsor Segments and Video Sponsors.
  
  Format:

  [Emoji] [List Item] &nbsp;&nbsp;
  
  Here is the transcript: ${e}. This is the question: ${r}`}function Hu({setQuestions:r,setQuestion:e,transcript:t,question:i}){let o=new AbortController,s=(0,_r.getPreferenceValues)(),{anthropicApiToken:u,anthropicModel:h,creativity:p}=s;(0,ju.useEffect)(()=>((async()=>{if(!i||!t)return;let y=rn(),v=new xe({apiKey:u}),C=await(0,_r.showToast)({style:_r.Toast.Style.Animated,title:tn.title,message:tn.message});r(R=>[{id:y,question:i,answer:""},...R]);let E=v.messages.stream({model:h||mo,max_tokens:8192,stream:!0,messages:[{role:"user",content:po(i,t)}],temperature:Number.parseInt(p,10)},{signal:o.signal});E.on("text",R=>{C.show(),r(B=>B.map(x=>x.id===y?{...x,answer:(x.answer||"")+R}:x))}),E.finalMessage().then(()=>{C.hide(),e("")}),!o.signal.aborted&&E.on("error",R=>{o.signal.aborted||(C.style=_r.Toast.Style.Failure,C.title=yr.title,C.message=R instanceof Error?R.message:"Unknown error occurred")})})(),()=>{o.abort()}),[i,t,o,u,h,p,e,r])}var Je=require("@raycast/api"),Vu=require("react");var zu=async({transcript:r,setSummaryIsLoading:e,setSummary:t})=>{let i=new AbortController,o=(0,Je.getPreferenceValues)(),{anthropicApiToken:s,language:u,anthropicModel:h,creativity:p}=o;if(s===""){(0,Je.showToast)({title:yr.title,message:"Anthropic Developer Account is required for this extension to work. You need to add your API key in preferences.",style:Je.Toast.Style.Failure});return}(0,Vu.useEffect)(()=>{if(!r)return;let m=new xe({apiKey:s});e(!0);let y=$u(u,r,r);(0,Je.showToast)({style:Je.Toast.Style.Animated,title:Ma.title,message:Ma.message});let v=m.messages.stream({model:h||mo,max_tokens:8192,stream:!0,messages:[{role:"user",content:y}],temperature:Number.parseInt(p)},{signal:i.signal});return v.on("text",C=>{t(E=>E===void 0?C||void 0:E+C||E)}),v.finalMessage().then(()=>{e(!1),(0,Je.showToast)({style:Je.Toast.Style.Success,title:Oa.title,message:Oa.message})}),v.on("error",C=>{i.signal.aborted||(e(!1),(0,Je.showToast)({style:Je.Toast.Style.Failure,title:yr.title,message:C.message}))}),()=>{i.abort()}},[r,s,h,p,u,t,e])};var Gu=require("@raycast/api");var xt=require("@raycast/api");var Se=require("@raycast/api"),Yt=require("react");var kt=require("react/jsx-runtime");function qa({transcript:r,questions:e,onQuestionsUpdate:t}){let[i,o]=(0,Yt.useState)(""),[s,u]=(0,Yt.useState)(e[0]?.id??""),[h,p]=(0,Yt.useState)(e);(0,Yt.useEffect)(()=>{t&&t(h)},[h,t]);let m=(0,Yt.useCallback)(E=>{p(E)},[]),y=async()=>{if(!i)return;let E=rn(),R=i,B=await(0,Se.showToast)({style:Se.Toast.Style.Animated,title:tn.title,message:tn.message}),x=Se.AI.ask(po(R,r)),L=[{id:E,question:R,answer:""},...h];m(L),o("");let P=!0;x.on("data",D=>{P&&(B.show(),P=!1),p(k=>k.map(M=>M.id===E?{...M,answer:M.answer+D}:M))}),x.finally(()=>{B.hide(),u(E)})},v=()=>`${h.length?`Questions:
${h.map(R=>`Q: ${R.question}
A: ${R.answer}`).join(`

`)}`:""}`,C=()=>{let E=h.find(R=>R.id===s);return E?E.id===h[0]?.id?E.answer:`Q: ${E.question}
A: ${E.answer}`:""};return(0,kt.jsx)(Se.List,{filtering:!1,isShowingDetail:!0,navigationTitle:"Additional Questions",onSearchTextChange:o,searchText:i,searchBarPlaceholder:"Ask another question",selectedItemId:s,searchBarAccessory:(0,kt.jsxs)(Se.ActionPanel,{children:[(0,kt.jsx)(Se.Action.SubmitForm,{onSubmit:y}),(0,kt.jsx)(Se.Action.CopyToClipboard,{title:"Copy Selected Answer",content:C()}),(0,kt.jsx)(Se.Action.CopyToClipboard,{title:"Copy All Q&A",content:v()})]}),children:h.map(E=>(0,kt.jsx)(Se.List.Item,{title:E.question,detail:(0,kt.jsx)(Se.List.Item.Detail,{markdown:E.answer}),id:E.id},E.id))})}var Xt=require("react/jsx-runtime");function Na({transcript:r,summary:e,video_url:t,ownerProfileUrl:i,questions:o,onQuestionsUpdate:s}){return(0,Xt.jsxs)(xt.ActionPanel,{title:"Video Actions",children:[(0,Xt.jsx)(xt.Action.Push,{icon:xt.Icon.QuestionMark,title:"Ask Follow-Up Question",target:(0,Xt.jsx)(qa,{transcript:r,questions:o,onQuestionsUpdate:s})}),(0,Xt.jsx)(xt.Action.CopyToClipboard,{title:"Copy Summary",content:e??""}),(0,Xt.jsx)(xt.Action.OpenInBrowser,{title:"Go to Video",url:t}),(0,Xt.jsx)(xt.Action.OpenInBrowser,{title:"Go to Channel",url:i})]})}var ht=require("@raycast/api");var Qu=require("@raycast/api");var Ua=(o=>(o.summarizeVideoWithRaycast="Ray1",o.summarizeVideoWithAnthropic="Anthropic",o.summarizeVideoWithOpenAI="OpenAI",o.summarizeVideoWithOllama="Ollama",o))(Ua||{});var zn=Ua[Qu.environment.commandName];var it=require("react/jsx-runtime");function Wa({duration:r,ownerChannelName:e,ownerProfileUrl:t,publishDate:i,title:o,viewCount:s}){return(0,it.jsxs)(ht.Detail.Metadata,{children:[(0,it.jsx)(ht.Detail.Metadata.Label,{title:"Title",text:o}),(0,it.jsx)(ht.Detail.Metadata.Link,{title:"Channel",target:t,text:e}),(0,it.jsx)(ht.Detail.Metadata.Separator,{}),(0,it.jsx)(ht.Detail.Metadata.Label,{title:"Published",text:i}),(0,it.jsx)(ht.Detail.Metadata.Label,{title:"Duration",text:r}),(0,it.jsx)(ht.Detail.Metadata.Label,{title:"Views",text:s}),(0,it.jsx)(ht.Detail.Metadata.Separator,{}),(0,it.jsx)(ht.Detail.Metadata.Label,{title:"AI Model",text:zn})]})}var bo=require("react/jsx-runtime");function $a({summary:r,summaryIsLoading:e,transcript:t,videoData:i,questions:o,onQuestionsUpdate:s}){if(!r)return null;let{duration:u,ownerChannelName:h,ownerProfileUrl:p,publishDate:m,title:y,video_url:v,viewCount:C}=i;return(0,bo.jsx)(Gu.Detail,{actions:(0,bo.jsx)(Na,{transcript:t,summary:r,video_url:v,ownerProfileUrl:p,questions:o,onQuestionsUpdate:s}),isLoading:e,markdown:r,metadata:(0,bo.jsx)(Wa,{title:y,ownerChannelName:h,ownerProfileUrl:p,publishDate:m,duration:u,viewCount:C}),navigationTitle:i&&`${y} by ${h}`})}var fe=require("@raycast/api"),kc=require("react"),So=lt(gs());var xc=({input:r,setVideoURL:e})=>{(0,kc.useEffect)(()=>{(async()=>{if((0,fe.showToast)({style:fe.Toast.Style.Animated,title:Ba.title,message:Ba.message}),r&&So.default.validateURL(r)){e(r);return}let i=await fe.Clipboard.readText(),o=i&&So.default.validateURL(i);if(!r&&o){(0,fe.showToast)({style:fe.Toast.Style.Animated,title:Fa.title,message:Fa.message}),e(i);return}if(!r&&fe.environment.canAccess(fe.BrowserExtension)){let u=(await fe.BrowserExtension.getTabs()).find(h=>h.active&&So.default.validateURL(h.url));if(u){(0,fe.showToast)({style:fe.Toast.Style.Animated,title:La.title,message:La.message}),e(u.url);return}}(0,fe.showToast)({style:fe.Toast.Style.Failure,title:"No video URL found",message:"Please provide a valid YouTube video URL or ID."}),(0,fe.popToRoot)()})()},[r,e])};var Zn=require("@raycast/api"),Dc="youtube-summary-",Mc="youtube-summary-keys",Oc=()=>{let r=async i=>{let o=`${i.id}-${i.aiService}`;await Zn.LocalStorage.setItem(`${Dc}${o}`,JSON.stringify(i));let s=await t();s.includes(o)||(s.unshift(o),await Zn.LocalStorage.setItem(Mc,JSON.stringify(s)))},e=async()=>{let i=await t();return(await Promise.all(i.map(async s=>{let u=await Zn.LocalStorage.getItem(`${Dc}${s}`);if(!u)return null;let h=JSON.parse(u);return h.createdAt=new Date(h.createdAt),h}))).filter(s=>s!==null)},t=async()=>{let i=await Zn.LocalStorage.getItem(Mc);return i?JSON.parse(i):[]};return{addToHistory:r,getHistory:e}};var ei=require("react");function Bc(r){let[e,t]=(0,ei.useState)(""),[i,o]=(0,ei.useState)([{id:rn(),question:"Initial Summary of the video",answer:r??""}]);return(0,ei.useEffect)(()=>{r&&o(s=>[{...s[0],answer:r},...s.slice(1)])},[r]),{questions:i,setQuestions:o,question:e,setQuestion:t}}var To=require("@raycast/api"),ti=require("react");var Km={};function Lc(){return Km}var Zm={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Fc=(r,e,t)=>{let i,o=Zm[r];return typeof o=="string"?i=o:e===1?i=o.one:i=o.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+i:i+" ago":i};function Ro(r){return(e={})=>{let t=e.width?String(e.width):r.defaultWidth;return r.formats[t]||r.formats[r.defaultWidth]}}var ep={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},tp={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},rp={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},qc={date:Ro({formats:ep,defaultWidth:"full"}),time:Ro({formats:tp,defaultWidth:"full"}),dateTime:Ro({formats:rp,defaultWidth:"full"})};var np={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Nc=(r,e,t,i)=>np[r];function sn(r){return(e,t)=>{let i=t?.context?String(t.context):"standalone",o;if(i==="formatting"&&r.formattingValues){let u=r.defaultFormattingWidth||r.defaultWidth,h=t?.width?String(t.width):u;o=r.formattingValues[h]||r.formattingValues[u]}else{let u=r.defaultWidth,h=t?.width?String(t.width):r.defaultWidth;o=r.values[h]||r.values[u]}let s=r.argumentCallback?r.argumentCallback(e):e;return o[s]}}var ip={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},op={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},ap={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},sp={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},lp={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},up={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},cp=(r,e)=>{let t=Number(r),i=t%100;if(i>20||i<10)switch(i%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},Uc={ordinalNumber:cp,era:sn({values:ip,defaultWidth:"wide"}),quarter:sn({values:op,defaultWidth:"wide",argumentCallback:r=>r-1}),month:sn({values:ap,defaultWidth:"wide"}),day:sn({values:sp,defaultWidth:"wide"}),dayPeriod:sn({values:lp,defaultWidth:"wide",formattingValues:up,defaultFormattingWidth:"wide"})};function ln(r){return(e,t={})=>{let i=t.width,o=i&&r.matchPatterns[i]||r.matchPatterns[r.defaultMatchWidth],s=e.match(o);if(!s)return null;let u=s[0],h=i&&r.parsePatterns[i]||r.parsePatterns[r.defaultParseWidth],p=Array.isArray(h)?fp(h,v=>v.test(u)):dp(h,v=>v.test(u)),m;m=r.valueCallback?r.valueCallback(p):p,m=t.valueCallback?t.valueCallback(m):m;let y=e.slice(u.length);return{value:m,rest:y}}}function dp(r,e){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&e(r[t]))return t}function fp(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return t}function Wc(r){return(e,t={})=>{let i=e.match(r.matchPattern);if(!i)return null;let o=i[0],s=e.match(r.parsePattern);if(!s)return null;let u=r.valueCallback?r.valueCallback(s[0]):s[0];u=t.valueCallback?t.valueCallback(u):u;let h=e.slice(o.length);return{value:u,rest:h}}}var hp=/^(\d+)(th|st|nd|rd)?/i,mp=/\d+/i,pp={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},bp={any:[/^b/i,/^(a|c)/i]},gp={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},yp={any:[/1/i,/2/i,/3/i,/4/i]},_p={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},wp={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Sp={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Rp={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Tp={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Ep={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},$c={ordinalNumber:Wc({matchPattern:hp,parsePattern:mp,valueCallback:r=>parseInt(r,10)}),era:ln({matchPatterns:pp,defaultMatchWidth:"wide",parsePatterns:bp,defaultParseWidth:"any"}),quarter:ln({matchPatterns:gp,defaultMatchWidth:"wide",parsePatterns:yp,defaultParseWidth:"any",valueCallback:r=>r+1}),month:ln({matchPatterns:_p,defaultMatchWidth:"wide",parsePatterns:wp,defaultParseWidth:"any"}),day:ln({matchPatterns:Sp,defaultMatchWidth:"wide",parsePatterns:Rp,defaultParseWidth:"any"}),dayPeriod:ln({matchPatterns:Tp,defaultMatchWidth:"any",parsePatterns:Ep,defaultParseWidth:"any"})};var ys={code:"en-US",formatDistance:Fc,formatLong:qc,formatRelative:Nc,localize:Uc,match:$c,options:{weekStartsOn:0,firstWeekContainsDate:1}};var Ap=["years","months","weeks","days","hours","minutes","seconds"];function jc(r,e){let t=Lc(),i=e?.locale??t.locale??ys,o=e?.format??Ap,s=e?.zero??!1,u=e?.delimiter??" ";return i.formatDistance?o.reduce((p,m)=>{let y=`x${m.replace(/(^.)/,C=>C.toUpperCase())}`,v=r[m];return v!==void 0&&(s||r[m])?p.concat(i.formatDistance(y,v)):p},[]).join(u):""}var Hc=lt(gs());async function Vc(r){let e=await Hc.default.getBasicInfo(r),t=new Date(e.videoDetails.publishDate).toLocaleDateString(),i=Number(e.videoDetails.viewCount).toLocaleString(),o=Math.floor(Number(e.videoDetails.lengthSeconds)/3600),s=Math.floor(Number(e.videoDetails.lengthSeconds)%3600/60);return{duration:jc({hours:o,minutes:s},{format:["hours","minutes","seconds"]}),ownerChannelName:e.videoDetails.ownerChannelName,ownerProfileUrl:e.videoDetails.ownerProfileUrl,publishDate:t,thumbnail:e.videoDetails.thumbnails[4],title:e.videoDetails.title,video_url:e.videoDetails.video_url,viewCount:i,videoId:e.videoDetails.videoId}}var Ee=require("@raycast/api");function vp(r){return r.includes("youtube.com/watch?v=")?r.split("v=")[1].split("&")[0]:r.includes("youtu.be/")?r.split("youtu.be/")[1].split("?")[0]:r}async function zc(r){try{let e=vp(r),t=`https://www.youtube.com/watch?v=${e}`,o=await(await fetch(t,{headers:{"User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}})).text(),s=o.match(/"transcriptEndpoint":\{"getTranscriptEndpoint":\{"videoId":"[^"]+","params":"([^"]+)"/);if(s||(s=o.match(/"getTranscriptEndpoint":[^}]*"params":"([^"]+)"/)),!s){let k=o.match(/"params":"([A-Za-z0-9+/=%]{20,})"/g);if(k&&k.length>0){for(let M of k){let j=M.match(/"params":"([^"]+)"/);if(j){let G=j[1],g=o.indexOf(M),ae=o.substring(Math.max(0,g-200),g),q=o.substring(g,Math.min(o.length,g+200));if(ae.includes("transcript")||q.includes("transcript")||ae.includes("caption")||q.includes("caption")){s=[M,G];break}}}if(!s){let M=k[0].match(/"params":"([^"]+)"/);M&&(s=[k[0],M[1]])}}}if(!s){(0,Ee.showToast)({style:Ee.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,Ee.popToRoot)();return}let u=o.match(/"INNERTUBE_API_KEY":"([^"]+)"/),h=u?u[1]:"AIzaSyAO_FJ2SlqU8Q4STEHLGCilw_Y9_11qcW8",p=s[1],m=`https://www.youtube.com/youtubei/v1/get_transcript?key=${h}`,y={context:{client:{clientName:"WEB",clientVersion:"2.20240101.00.00"}},params:p},v=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json","User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36",Origin:"https://www.youtube.com",Referer:`https://www.youtube.com/watch?v=${e}`},body:JSON.stringify(y)});if(!v.ok)throw new Error(`Transcript API returned ${v.status}`);let L=(await v.json())?.actions?.[0]?.updateEngagementPanelAction?.content?.transcriptRenderer?.content,P=L?.transcriptBodyRenderer;if(!P){let k=L?.transcriptSearchPanelRenderer;P=k?.body?.transcriptSegmentListRenderer,P||(P=k?.footer)}if(!P?.cueGroups&&!P?.initialSegments){(0,Ee.showToast)({style:Ee.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,Ee.popToRoot)();return}let D="";if(P.initialSegments?D=P.initialSegments.map(M=>M.transcriptSegmentRenderer?.snippet?.runs?.map(ae=>ae.text||"").join("")||"").join(" ").replace(/\s+/g," ").trim():P.cueGroups&&(D=P.cueGroups.map(M=>M.transcriptCueGroupRenderer?.cues?.map(g=>g.transcriptCueRenderer?.cue?.simpleText||"").join(" ")||"").join(" ").replace(/\s+/g," ").trim()),!D){(0,Ee.showToast)({style:Ee.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,Ee.popToRoot)();return}return D}catch{(0,Ee.showToast)({style:Ee.Toast.Style.Failure,title:"\u2757",message:"Sorry, this video doesn't have a transcript."}),(0,Ee.popToRoot)();return}}function Qc(r){let[e,t]=(0,ti.useState)(),[i,o]=(0,ti.useState)();return(0,ti.useEffect)(()=>{r&&Vc(r).then(s=>(t(s),zc(r))).then(o).catch(s=>{(0,To.showToast)({style:To.Toast.Style.Failure,title:yr.title,message:`Error fetching video data or transcript: ${s.message}`})})},[r]),{videoData:e,transcript:i}}var _s=require("react/jsx-runtime");globalThis.fetch=$i;function Yc(r){let[e,t]=(0,Zt.useState)(),[i,o]=(0,Zt.useState)(!1),[s,u]=(0,Zt.useState)(r.arguments.video),{addToHistory:h}=Oc();xc({input:r.arguments.video||r.launchContext?.video,setVideoURL:u});let{videoData:p,transcript:m}=Qc(s),{questions:y,setQuestions:v,question:C,setQuestion:E}=Bc(e);zu({transcript:m,setSummaryIsLoading:o,setSummary:t}),Hu({setQuestions:v,setQuestion:E,transcript:m,question:C});let[R,B]=(0,Zt.useState)(null);if((0,Zt.useEffect)(()=>{if(e&&p&&!R){let k={aiService:zn,createdAt:new Date,id:p.videoId,questions:y,summary:e,title:p.title,videoUrl:s??""};h(k),B(p.videoId)}},[e,p,h,s,R,y]),(0,Zt.useEffect)(()=>{R&&y.length>0&&h({aiService:zn,createdAt:new Date,id:R,questions:y,summary:e||"",title:p?.title||"",videoUrl:s??""})},[y,R,h,e,p,s]),!p||!m)return(0,_s.jsx)(Gc.List,{isLoading:!0});let{thumbnail:x,title:L}=p,P=e?`${e}

![${L}](${x?.url})
  `:void 0;return(0,_s.jsx)($a,{questions:y,summary:P,summaryIsLoading:i,transcript:m,videoData:p,onQuestionsUpdate:k=>{v(k)}})}
/*! Bundled license information:

web-streams-polyfill/dist/ponyfill.es2018.js:
  (**
   * @license
   * web-streams-polyfill v3.3.3
   * Copyright 2024 Mattias Buelens, Diwank Singh Tomer and other contributors.
   * This code is released under the MIT license.
   * SPDX-License-Identifier: MIT
   *)

fetch-blob/index.js:
  (*! fetch-blob. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

formdata-polyfill/esm.min.js:
  (*! formdata-polyfill. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

node-domexception/index.js:
  (*! node-domexception. MIT License. Jimmy Wrting <https://jimmy.warting.se/opensource> *)

sax/lib/sax.js:
  (*! http://mths.be/fromcodepoint v0.1.0 by @mathias *)
*/
