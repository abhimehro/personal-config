"use strict";var h=Object.create;var l=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var A=(t,e)=>{for(var r in e)l(t,r,{get:e[r],enumerable:!0})},d=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of F(e))!P.call(t,a)&&a!==r&&l(t,a,{get:()=>e[a],enumerable:!(i=y(e,a))||i.enumerable});return t};var f=(t,e,r)=>(r=t!=null?h(b(t)):{},d(e||!t||!t.__esModule?l(r,"default",{value:t,enumerable:!0}):r,t)),$=t=>d(l({},"__esModule",{value:!0}),t);var I={};A(I,{default:()=>w});module.exports=$(I);var o=require("@raycast/api"),s=f(require("path")),g=require("child_process"),u=require("util"),m=f(require("fs/promises")),c=(0,u.promisify)(g.exec);async function C(){let t=["/usr/local/bin/ffmpeg","/opt/homebrew/bin/ffmpeg","/usr/bin/ffmpeg"];for(let e of t)try{return await m.default.access(e),e}catch{}try{let{stdout:e}=await c("which ffmpeg");return e.trim()||null}catch{return null}}async function E(){let t="brew install ffmpeg",e={title:"FFmpeg Not Found",message:`FFmpeg is not installed. Please install it using Homebrew with the following command:

${t}

After installation, please restart Raycast and run this command again.`,primaryAction:{title:"Copy Install Command",onAction:()=>{(0,g.exec)(`echo "${t}" | pbcopy`)}},dismissAction:{title:"Cancel"}};await(0,o.confirmAlert)(e),await(0,o.showToast)({style:o.Toast.Style.Success,title:"Install Command Copied",message:"Paste it in Terminal to install FFmpeg"})}async function x(t,e){let r=await m.default.mkdtemp(s.default.join(s.default.dirname(e),"temp-")),i=s.default.join(r,"first_frame.png");try{await c(`"${t}" -i "${e}" -vframes 1 "${i}"`);let a=`PATH=/usr/local/bin:/opt/homebrew/bin:$PATH magick "${i}" -gravity North -crop 100%x10+0+0 +repage -colors 1 -unique-colors -format "%[hex:u]" info:`,{stdout:n}=await c(a),p=n.trim().replace("#","");return/^[0-9A-Fa-f]{6}$/.test(p)?p:(console.error("Unexpected ImageMagick output format:",n),"000000")}catch(a){return console.error("Error getting edge color:",a),"000000"}finally{await m.default.rm(r,{recursive:!0,force:!0})}}async function k(t,e,r){let i=s.default.join(s.default.dirname(e),`${s.default.basename(e,s.default.extname(e))}_padded${s.default.extname(e)}`),a=`"${t}" -i "${e}" -vf "scale='min(1920*0.8,iw)':'min(1080*0.8,ih)':force_original_aspect_ratio=decrease,pad=1920:1080:(ow-iw)/2:(oh-ih)/2:color=0x${r}" -c:a copy "${i}"`;try{let{stderr:n}=await c(a);return console.log("FFmpeg padding output:",n),i}catch(n){throw console.error("Error during video padding:",n),n instanceof Error&&console.error("Error details:",n.message),new Error("Failed to process video")}}async function w(){try{await(0,o.closeMainWindow)(),await(0,o.showHUD)("Checking for FFmpeg...");let t=await C();if(!t){await(0,o.showHUD)("FFmpeg not found"),await E(),await(0,o.popToRoot)();return}try{await c("PATH=/usr/local/bin:/opt/homebrew/bin:$PATH magick -version")}catch{await(0,o.showHUD)("ImageMagick not found"),await(0,o.confirmAlert)({title:"ImageMagick Not Found",message:`ImageMagick is required for this operation. Please install it using Homebrew with the command:

brew install imagemagick

After installation, please restart Raycast and run this command again.`,primaryAction:{title:"Copy Install Command",onAction:()=>{(0,g.exec)('echo "brew install imagemagick" | pbcopy')}}}),await(0,o.popToRoot)();return}await(0,o.showHUD)("Selecting video...");let e=await(0,o.getSelectedFinderItems)();if(e.length!==1){await(0,o.showToast)({style:o.Toast.Style.Failure,title:"Error",message:"Please select exactly one video file"}),await(0,o.popToRoot)();return}let r=e[0].path;await(0,o.showHUD)("Getting edge color...");let i=await x(t,r);console.log("Edge color:",i),await(0,o.showHUD)("Processing video..."),console.log("Processing video with color:",i);let a=await k(t,r,i);await(0,o.showHUD)("Video processed successfully!"),await(0,o.open)(a)}catch(t){console.error("Error:",t),t instanceof Error&&console.error("Error details:",t.message),await(0,o.showToast)({style:o.Toast.Style.Failure,title:"Error",message:"An error occurred while processing the video"})}finally{await(0,o.popToRoot)()}}
