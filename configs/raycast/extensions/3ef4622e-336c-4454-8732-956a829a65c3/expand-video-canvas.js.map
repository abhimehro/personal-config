{
  "version": 3,
  "sources": ["../src/expand-video-canvas.ts"],
  "sourcesContent": ["import {\n  showToast,\n  Toast,\n  getSelectedFinderItems,\n  open,\n  confirmAlert,\n  showHUD,\n  closeMainWindow,\n  popToRoot,\n} from \"@raycast/api\";\nimport path from \"path\";\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\nimport fs from \"fs/promises\";\n\nconst execAsync = promisify(exec);\n\nasync function findFFmpegPath(): Promise<string | null> {\n  const commonPaths = [\"/usr/local/bin/ffmpeg\", \"/opt/homebrew/bin/ffmpeg\", \"/usr/bin/ffmpeg\"];\n\n  for (const ffmpegPath of commonPaths) {\n    try {\n      await fs.access(ffmpegPath);\n      return ffmpegPath;\n    } catch {\n      // Path doesn't exist, continue to next path\n    }\n  }\n\n  try {\n    const { stdout } = await execAsync(\"which ffmpeg\");\n    return stdout.trim() || null;\n  } catch {\n    return null;\n  }\n}\n\nasync function installFFmpeg() {\n  const installCommand = \"brew install ffmpeg\";\n  const options = {\n    title: \"FFmpeg Not Found\",\n    message: `FFmpeg is not installed. Please install it using Homebrew with the following command:\\n\\n${installCommand}\\n\\nAfter installation, please restart Raycast and run this command again.`,\n    primaryAction: {\n      title: \"Copy Install Command\",\n      onAction: () => {\n        exec(`echo \"${installCommand}\" | pbcopy`);\n      },\n    },\n    dismissAction: {\n      title: \"Cancel\",\n    },\n  };\n\n  await confirmAlert(options);\n  await showToast({\n    style: Toast.Style.Success,\n    title: \"Install Command Copied\",\n    message: \"Paste it in Terminal to install FFmpeg\",\n  });\n}\n\nasync function getEdgeColor(ffmpegPath: string, videoPath: string): Promise<string> {\n  const tempDir = await fs.mkdtemp(path.join(path.dirname(videoPath), \"temp-\"));\n  const framePath = path.join(tempDir, \"first_frame.png\");\n\n  try {\n    // Extract the first frame\n    await execAsync(`\"${ffmpegPath}\" -i \"${videoPath}\" -vframes 1 \"${framePath}\"`);\n\n    // Use ImageMagick to get the most common color of the top 10 pixels\n    const command = `PATH=/usr/local/bin:/opt/homebrew/bin:$PATH magick \"${framePath}\" -gravity North -crop 100%x10+0+0 +repage -colors 1 -unique-colors -format \"%[hex:u]\" info:`;\n    const { stdout } = await execAsync(command);\n\n    // The output should be in the format \"#RRGGBB\"\n    const hexColor = stdout.trim().replace(\"#\", \"\");\n    if (/^[0-9A-Fa-f]{6}$/.test(hexColor)) {\n      return hexColor;\n    } else {\n      console.error(\"Unexpected ImageMagick output format:\", stdout);\n      return \"000000\"; // Default to black if output format is unexpected\n    }\n  } catch (error) {\n    console.error(\"Error getting edge color:\", error);\n    return \"000000\"; // Default to black on error\n  } finally {\n    // Clean up temporary files\n    await fs.rm(tempDir, { recursive: true, force: true });\n  }\n}\n\nasync function processVideo(ffmpegPath: string, videoPath: string, edgeColor: string): Promise<string> {\n  const outputPath = path.join(\n    path.dirname(videoPath),\n    `${path.basename(videoPath, path.extname(videoPath))}_padded${path.extname(videoPath)}`,\n  );\n  const paddingCommand = `\"${ffmpegPath}\" -i \"${videoPath}\" -vf \"scale='min(1920*0.8,iw)':'min(1080*0.8,ih)':force_original_aspect_ratio=decrease,pad=1920:1080:(ow-iw)/2:(oh-ih)/2:color=0x${edgeColor}\" -c:a copy \"${outputPath}\"`;\n\n  try {\n    const { stderr } = await execAsync(paddingCommand);\n    console.log(\"FFmpeg padding output:\", stderr);\n    return outputPath;\n  } catch (error) {\n    console.error(\"Error during video padding:\", error);\n    if (error instanceof Error) {\n      console.error(\"Error details:\", error.message);\n    }\n    throw new Error(\"Failed to process video\");\n  }\n}\n\nexport default async function Command() {\n  try {\n    await closeMainWindow();\n    await showHUD(\"Checking for FFmpeg...\");\n\n    const ffmpegPath = await findFFmpegPath();\n    if (!ffmpegPath) {\n      await showHUD(\"FFmpeg not found\");\n      await installFFmpeg();\n      await popToRoot();\n      return;\n    }\n\n    // Check for ImageMagick\n    try {\n      await execAsync(\"PATH=/usr/local/bin:/opt/homebrew/bin:$PATH magick -version\");\n    } catch (error) {\n      await showHUD(\"ImageMagick not found\");\n      await confirmAlert({\n        title: \"ImageMagick Not Found\",\n        message:\n          \"ImageMagick is required for this operation. Please install it using Homebrew with the command:\\n\\nbrew install imagemagick\\n\\nAfter installation, please restart Raycast and run this command again.\",\n        primaryAction: {\n          title: \"Copy Install Command\",\n          onAction: () => {\n            exec(`echo \"brew install imagemagick\" | pbcopy`);\n          },\n        },\n      });\n      await popToRoot();\n      return;\n    }\n\n    await showHUD(\"Selecting video...\");\n    const selectedItems = await getSelectedFinderItems();\n\n    if (selectedItems.length !== 1) {\n      await showToast({\n        style: Toast.Style.Failure,\n        title: \"Error\",\n        message: \"Please select exactly one video file\",\n      });\n      await popToRoot();\n      return;\n    }\n\n    const videoPath = selectedItems[0].path;\n\n    await showHUD(\"Getting edge color...\");\n    const edgeColor = await getEdgeColor(ffmpegPath, videoPath);\n    console.log(\"Edge color:\", edgeColor);\n\n    await showHUD(\"Processing video...\");\n    console.log(\"Processing video with color:\", edgeColor);\n    const outputPath = await processVideo(ffmpegPath, videoPath, edgeColor);\n\n    await showHUD(\"Video processed successfully!\");\n    await open(outputPath);\n  } catch (error) {\n    console.error(\"Error:\", error);\n    if (error instanceof Error) {\n      console.error(\"Error details:\", error.message);\n    }\n    await showToast({\n      style: Toast.Style.Failure,\n      title: \"Error\",\n      message: \"An error occurred while processing the video\",\n    });\n  } finally {\n    await popToRoot();\n  }\n}\n"],
  "mappings": "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",
  "names": ["expand_video_canvas_exports", "__export", "Command", "__toCommonJS", "import_api", "import_path", "import_child_process", "import_util", "import_promises", "execAsync", "findFFmpegPath", "commonPaths", "ffmpegPath", "fs", "stdout", "installFFmpeg", "installCommand", "options", "getEdgeColor", "videoPath", "tempDir", "path", "framePath", "command", "hexColor", "error", "processVideo", "edgeColor", "outputPath", "paddingCommand", "stderr", "selectedItems"]
}
