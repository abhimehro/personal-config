"use strict";var U=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var G=(n,t)=>{for(var e in t)U(n,e,{get:t[e],enumerable:!0})},Q=(n,t,e,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of X(t))!z.call(n,s)&&s!==e&&U(n,s,{get:()=>t[s],enumerable:!(a=H(t,s))||a.enumerable});return n};var Y=n=>Q(U({},"__esModule",{value:!0}),n);var et={};G(et,{default:()=>$});module.exports=Y(et);var w=require("react");var l=require("@raycast/api");var O="$arg_name_list";var L="$web_name_configs";var Z=l.Alert.ActionStyle;async function x(){let n=await l.LocalStorage.getItem(L);return new P(n)}async function E(n){return(await x()).webNameExists(n)}async function k(n,t){let e=await x();console.log("url config before update",e.toString()),e.delete(t),e.set(n.configName,n.itemValue,n.argList);let a=e.toString();console.log(a),await l.LocalStorage.setItem(L,a)}async function J(n,t){return await(0,l.confirmAlert)({title:"Delete Url Config: "+n+"?",message:"",primaryAction:{title:"Delete",style:Z.Destructive,onAction:async()=>{console.log("url config before deletion:",t.toString()),t.urlConfigs.delete(n),console.log("url config after deletion:",t.toString()),await l.LocalStorage.setItem(L,t.toString())}}})}var P=class{constructor(t){this.urlConfigs=this.parse(t)}parse(t){return t==null||t.trim().length==0?new Map:new Map(Object.entries(JSON.parse(t)))}webNameExists(t){return this.urlConfigs.has(t)}set(t,e,a){this.urlConfigs.set(t,new I(e,a))}delete(t){this.urlConfigs.delete(t)}toString(){return JSON.stringify(Object.fromEntries(this.urlConfigs))}},I=class{constructor(t,e){this.urlPattern=t,this.args=e}};var i=require("@raycast/api");var o=require("@raycast/api"),c=require("react");var d=require("@raycast/api");var m=require("@raycast/api");async function v(){let n=await d.LocalStorage.getItem(O);return n==null?[]:JSON.parse(n)}var p=require("@raycast/api"),F=require("react");var M=require("react/jsx-runtime");var b=class{constructor(t,e){this.urlPattern=t,this.argList=e,this.argPlaceHolder2ValueMap=this.parseUrlPattern(t),this.argNumInUrlPattern=this.argPlaceHolder2ValueMap.size}parseUrlPattern(t){let e=new Map,a=this.newRegExp(),s=a.exec(t);for(;s!=null;)e.set(s[0],""),s=a.exec(t);return e}validate(){if(this.argNumInUrlPattern!=this.argList.length)return this.unmatchedArgNumErrMsg(this.argNumInUrlPattern,this.argList.length);let t=this.newRegExp(),e=t.exec(this.urlPattern);for(;e!=null;){if(!this.findArg(e[0]))return"no arg find for place holder: "+e[0]+", please create the arg first";e=t.exec(this.urlPattern)}}findArg(t){console.log(t);for(let e of this.argList)if(this.buildPlaceHolder(e).trim()==t.trim())return!0;return!1}buildPlaceHolder(t){return"${"+t+"}"}newRegExp(){return/\$\{.+?}/g}unmatchedArgNumErrMsg(t,e){return"unmatched arg nums, url arg num: "+t+", chosen arg num: "+e}};var u=require("react/jsx-runtime"),j=o.Toast.Style;function T({oldWebName:n,urlConfigValue:t}){let[e,a]=(0,c.useState)(n),[s,h]=(0,c.useState)(t.urlPattern),[g,D]=(0,c.useState)(t.args),[W,A]=(0,c.useState)(),[K,S]=(0,c.useState)(),[q,R]=(0,c.useState)([]),[B,_]=(0,c.useState)(!0);(0,c.useEffect)(()=>{async function r(){R(await v())}r().then(()=>_(!1))},[]);function C(r,y){if(r==null||r.trim().length==0){S("The field shouldn't be empty!");return}else S(void 0);let N=new b(r,y).validate();if(console.log(N),N){S(N);return}else S(void 0)}async function V(r){if(r==null||r.trim().length==0){A("The field shouldn't be empty!");return}else A(void 0);if(r!=n)if(await E(r)){A("This web name already exists!");return}else A(void 0)}return(0,u.jsxs)(o.Form,{isLoading:B,actions:(0,u.jsx)(o.ActionPanel,{children:(0,u.jsx)(o.Action.SubmitForm,{onSubmit:r=>{console.log("add url onSubmit",r),k(r,n).then(()=>{(0,o.showToast)(j.Success,"Updated Success").then(()=>(0,o.popToRoot)().finally())})}})}),children:[(0,u.jsx)(o.Form.TextField,{id:"configName",title:"Web Name",placeholder:"Pick a name for your webpage",info:"like tce, tcc, argos",error:W,onChange:async r=>{a(r),await V(r)},value:e,onBlur:async r=>{await V(r.target.value?.trim())}}),(0,u.jsx)(o.Form.TextArea,{id:"itemValue",title:"Url Pattern",placeholder:"https://a.b.c?arg1=${argName1}&arg2=${argName2}",info:"url pattern, args are put in ${argName}. example: https://a.b.c?arg1=${argName1}&arg2=${argName2}",error:K,onChange:r=>{h(r),C(r,g)},value:s,onBlur:r=>{C(r.target.value?.trim(),g)}}),(0,u.jsx)(o.Form.TagPicker,{id:"argList",title:"Args And Orders",value:g,onChange:r=>{D(r),C(s,r)},onBlur:r=>{let y=r.target.value;y==null&&(y=[]),C(s,y)},children:q.map(r=>(0,u.jsx)(o.Form.TagPicker.Item,{value:r,title:r},r))})]})}var f=require("react/jsx-runtime"),tt=i.Toast.Style;function $(){let[n,t]=(0,w.useState)(!0),[e,a]=(0,w.useState)(),s=[];return(0,w.useEffect)(()=>{async function h(){let g=await x();a(g)}h().then(()=>t(!1))},[]),e?.urlConfigs.forEach((h,g)=>{s.push((0,f.jsx)(i.List.Item,{title:g,icon:"list-item.png",actions:(0,f.jsxs)(i.ActionPanel,{children:[(0,f.jsx)(i.Action.Push,{icon:i.Icon.Pencil,title:"Edit Url Config",target:(0,f.jsx)(T,{oldWebName:g,urlConfigValue:h})}),(0,f.jsx)(i.Action,{icon:i.Icon.XMarkCircle,title:"Delete Url Config",onAction:async()=>{await J(g,e)&&(await(0,i.popToRoot)(),await(0,i.showToast)(tt.Success,"deleted successfully"))}})]})},g))}),(0,f.jsx)(i.List,{isLoading:n,children:s})}
