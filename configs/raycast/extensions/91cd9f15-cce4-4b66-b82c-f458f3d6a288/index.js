"use strict";var x=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var H=Object.prototype.hasOwnProperty;var R=(r,t)=>{for(var e in t)x(r,e,{get:t[e],enumerable:!0})},W=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of z(t))!H.call(r,i)&&i!==e&&x(r,i,{get:()=>t[i],enumerable:!(n=q(t,i))||n.enumerable});return r};var _=r=>W(x({},"__esModule",{value:!0}),r);var G={};R(G,{default:()=>D});module.exports=_(G);var a=require("@raycast/api"),p=require("react");var f=require("@raycast/api");var U="arg_name:",M="$web_name_configs";async function O(){let r=await f.LocalStorage.getItem(M);return new N(r)}var N=class{constructor(t){this.urlConfigs=this.parse(t)}parse(t){return t==null||t.trim().length==0?new Map:new Map(Object.entries(JSON.parse(t)))}webNameExists(t){return this.urlConfigs.has(t)}set(t,e,n){this.urlConfigs.set(t,new C(e,n))}delete(t){this.urlConfigs.delete(t)}toString(){return JSON.stringify(Object.fromEntries(this.urlConfigs))}},C=class{constructor(t,e){this.urlPattern=t,this.args=e}};var m=require("@raycast/api"),k=require("react");var y=require("@raycast/api");var o=require("@raycast/api");var v=o.Toast.Style;async function B(r){let t=T(r),e=await o.LocalStorage.getItem(t);return e==null?void 0:JSON.parse(e)}async function J(r,t){let e=await B(r),n="Url";return t!=null&&n.length>0&&(n=t[0]),(e==null||e.length==0)&&(await(0,o.showToast)(v.Failure,'"'+n+'" contains invalid Arg: '+r,"Arg dose not exist"),await(0,o.popToRoot)()),e?.length==0&&(await(0,o.showToast)(v.Failure,'"'+n+'" contains invalid Arg: '+r,"Arg is empty"),await(0,o.popToRoot)()),e}function T(r){return U+r}var $=require("react/jsx-runtime");var w=class{constructor(t,e){this.urlPattern=t,this.argList=e,this.argPlaceHolder2ValueMap=this.parseUrlPattern(t),this.argNumInUrlPattern=this.argPlaceHolder2ValueMap.size}parseUrlPattern(t){let e=new Map,n=this.newRegExp(),i=n.exec(t);for(;i!=null;)e.set(i[0],""),i=n.exec(t);return e}validate(){if(this.argNumInUrlPattern!=this.argList.length)return this.unmatchedArgNumErrMsg(this.argNumInUrlPattern,this.argList.length);let t=this.newRegExp(),e=t.exec(this.urlPattern);for(;e!=null;){if(!this.findArg(e[0]))return"no arg find for place holder: "+e[0]+", please create the arg first";e=t.exec(this.urlPattern)}}findArg(t){console.log(t);for(let e of this.argList)if(this.buildPlaceHolder(e).trim()==t.trim())return!0;return!1}buildPlaceHolder(t){return"${"+t+"}"}newRegExp(){return/\$\{.+?}/g}unmatchedArgNumErrMsg(t,e){return"unmatched arg nums, url arg num: "+t+", chosen arg num: "+e}};var s=require("react/jsx-runtime");function D(r){let t=r.arguments.customizedInput||"",[e,n]=(0,p.useState)(!0),[i,u]=(0,p.useState)(),[S,K]=(0,p.useState)(new Map);(0,p.useEffect)(()=>{async function A(){let d=await O();u(d);let c=new Map;d.urlConfigs.forEach((g,l)=>{for(let h of g.args){let L=c.get(h);L==null?L=[]:L.push(l),c.set(h,L)}});let b=[];c.forEach((g,l)=>{b.push(l)});let V=new Map,E=[];for(let g of b)E.push(J(g,c.get(g)));Promise.all(E).then(g=>{for(let l=0;l<g.length;l++){let h=g[l];h!=null&&V.set(b[l],h)}}),K(V)}A().then(()=>n(!1))},[]),console.log("111",JSON.stringify(i),JSON.stringify(S)),console.log("222",i,S);let I=[];return i?.urlConfigs.forEach((A,d)=>{let c=new P(A.urlPattern,A.args,S,t);I.push((0,s.jsx)(a.List.Item,{title:d,icon:"list-item.png",actions:(0,s.jsx)(X,{urlBuilder:c})},d))}),(0,s.jsx)(a.List,{isLoading:e,children:I})}function X({urlBuilder:r}){return r.argList==null||r.argList.length==0?(0,s.jsx)(a.ActionPanel,{children:(0,s.jsx)(a.Action.OpenInBrowser,{url:r.build()})}):(0,s.jsx)(a.ActionPanel,{children:(0,s.jsx)(a.Action.Push,{title:"Next",target:(0,s.jsx)(F,{argIndex:0,urlBuilder:r})})})}function F({argIndex:r,urlBuilder:t}){if(console.log("next list",r,t.isLast(r)),t.isLast(r))return j(r,t);let e=t.getArgName(r),n=[],i=t.getArgValueList(r);for(let u of i)n.push((0,s.jsx)(a.List.Item,{title:u,icon:"list-item.png",actions:(0,s.jsx)(a.ActionPanel,{children:(0,s.jsx)(a.Action.Push,{title:"Next Arg",target:(0,s.jsx)(F,{argIndex:r+1,urlBuilder:t}),onPush:()=>t.setArgValue(e,u)})})},u));return(0,s.jsx)(a.List,{searchBarPlaceholder:e,children:n})}function j(r,t){let e=t.getArgName(r),n=t.getArgValueList(r);return n==null&&(n=[]),console.log(r,e,n),(0,s.jsx)(a.List,{searchBarPlaceholder:e,children:n.map(i=>(0,s.jsx)(a.List.Item,{title:i,icon:"list-item.png",actions:(0,s.jsx)(a.ActionPanel,{children:(0,s.jsx)(a.Action.OpenInBrowser,{url:t.setArgValue(e,i).build()})})},i))})}var P=class extends w{constructor(e,n,i,u){super(e,n);this.arg2ValueListMap=i,this.customizedInput=u}setArgValue(e,n){return this.argPlaceHolder2ValueMap.set(this.buildPlaceHolder(e),n),this}isLast(e){return e>=this.argList.length-1}getArgName(e){return this.argList[e]}getArgValueList(e){let n=this.arg2ValueListMap.get(this.getArgName(e));return n??[]}build(){let e=this.urlPattern;return this.argPlaceHolder2ValueMap.forEach((n,i)=>{e=e.replaceAll(i,n)}),e=e.replace("$$",encodeURIComponent(encodeURIComponent(this.customizedInput))),console.log("build:",e),e}};
