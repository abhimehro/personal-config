"use strict";var A=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var W=(n,t)=>{for(var r in t)A(n,r,{get:t[r],enumerable:!0})},q=(n,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of $(t))!K.call(n,s)&&s!==r&&A(n,s,{get:()=>t[s],enumerable:!(a=F(t,s))||a.enumerable});return n};var R=n=>q(A({},"__esModule",{value:!0}),n);var H={};W(H,{UrlPattern:()=>h,default:()=>V});module.exports=R(H);var i=require("@raycast/api"),o=require("react");var u=require("@raycast/api");var c=require("@raycast/api");var N="$arg_name_list";var x="$web_name_configs";async function C(){let n=await u.LocalStorage.getItem(N);return n==null?[]:JSON.parse(n)}var g=require("@raycast/api");async function I(){let n=await g.LocalStorage.getItem(x);return new S(n)}async function v(n){return(await I()).webNameExists(n)}async function P(n){let t=await I();if(t.webNameExists(n.configName))return await(0,g.showToast)(g.Toast.Style.Failure,"platform name exists!","consider change a name");console.log("url config before add",t.toString()),t.set(n.configName,n.itemValue,n.argList);let r=t.toString();console.log(r),await g.LocalStorage.setItem(x,r)}var S=class{constructor(t){this.urlConfigs=this.parse(t)}parse(t){return t==null||t.trim().length==0?new Map:new Map(Object.entries(JSON.parse(t)))}webNameExists(t){return this.urlConfigs.has(t)}set(t,r,a){this.urlConfigs.set(t,new L(r,a))}delete(t){this.urlConfigs.delete(t)}toString(){return JSON.stringify(Object.fromEntries(this.urlConfigs))}},L=class{constructor(t,r){this.urlPattern=t,this.args=r}};var l=require("react/jsx-runtime"),_=i.Toast.Style;function V(n){let{draftValues:t}=n,[r,a]=(0,o.useState)(t?.configName||""),[s,E]=(0,o.useState)(t?.itemValue||""),[y,U]=(0,o.useState)(t?.argList||[]),[O,m]=(0,o.useState)(),[T,d]=(0,o.useState)(),[J,M]=(0,o.useState)([]),[D,k]=(0,o.useState)(!0);(0,o.useEffect)(()=>{async function e(){M(await C())}e().then(()=>k(!1))},[]);function p(e,f){if(e==null||e.trim().length==0){d("The field shouldn't be empty!");return}else d(void 0);let w=new h(e,f).validate();if(console.log(w),w){d(w);return}else d(void 0)}async function b(e){if(e==null||e.trim().length==0){m("The field shouldn't be empty!");return}else m(void 0);if(await v(e)){m("This web name already exists!");return}else m(void 0)}return(0,l.jsxs)(i.Form,{enableDrafts:!0,isLoading:D,actions:(0,l.jsx)(i.ActionPanel,{children:(0,l.jsx)(i.Action.SubmitForm,{onSubmit:e=>{console.log("add url onSubmit",e),P(e).then(()=>{(0,i.showToast)(_.Success,"Success").then(()=>{(0,i.popToRoot)().finally()})})}})}),children:[(0,l.jsx)(i.Form.TextField,{id:"configName",title:"Web Name",placeholder:"Pick a name for your webpage",info:"like tce, tcc, argos",error:O,onChange:async e=>{a(e),await b(e)},value:r,onBlur:async e=>{await b(e.target.value?.trim())}}),(0,l.jsx)(i.Form.TextArea,{id:"itemValue",title:"Url Pattern",placeholder:"https://a.b.c?arg1=${argName1}&arg2=${argName2}",info:"url pattern, args are put in ${argName}. example: https://a.b.c?arg1=${argName1}&arg2=${argName2}",error:T,onChange:e=>{E(e),p(e,y)},value:s,onBlur:e=>{p(e.target.value?.trim(),y)}}),(0,l.jsx)(i.Form.TagPicker,{id:"argList",title:"Args And Orders",value:y,onChange:e=>{U(e),p(s,e)},onBlur:e=>{let f=e.target.value;f==null&&(f=[]),p(s,f)},children:J.map(e=>(0,l.jsx)(i.Form.TagPicker.Item,{value:e,title:e},e))})]})}var h=class{constructor(t,r){this.urlPattern=t,this.argList=r,this.argPlaceHolder2ValueMap=this.parseUrlPattern(t),this.argNumInUrlPattern=this.argPlaceHolder2ValueMap.size}parseUrlPattern(t){let r=new Map,a=this.newRegExp(),s=a.exec(t);for(;s!=null;)r.set(s[0],""),s=a.exec(t);return r}validate(){if(this.argNumInUrlPattern!=this.argList.length)return this.unmatchedArgNumErrMsg(this.argNumInUrlPattern,this.argList.length);let t=this.newRegExp(),r=t.exec(this.urlPattern);for(;r!=null;){if(!this.findArg(r[0]))return"no arg find for place holder: "+r[0]+", please create the arg first";r=t.exec(this.urlPattern)}}findArg(t){console.log(t);for(let r of this.argList)if(this.buildPlaceHolder(r).trim()==t.trim())return!0;return!1}buildPlaceHolder(t){return"${"+t+"}"}newRegExp(){return/\$\{.+?}/g}unmatchedArgNumErrMsg(t,r){return"unmatched arg nums, url arg num: "+t+", chosen arg num: "+r}};0&&(module.exports={UrlPattern});
