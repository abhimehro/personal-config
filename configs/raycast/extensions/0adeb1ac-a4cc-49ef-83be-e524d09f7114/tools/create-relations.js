"use strict";var g=Object.create;var c=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var v=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var N=(s,t)=>{for(var e in t)c(s,e,{get:t[e],enumerable:!0})},d=(s,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of u(t))!E.call(s,n)&&n!==e&&c(s,n,{get:()=>t[n],enumerable:!(i=G(t,n))||i.enumerable});return s};var b=(s,t,e)=>(e=s!=null?g(v(s)):{},d(t||!s||!s.__esModule?c(e,"default",{value:s,enumerable:!0}):e,s)),P=s=>d(c({},"__esModule",{value:!0}),s);var T={};N(T,{default:()=>O});module.exports=P(T);var o=require("fs"),m=b(require("path")),f=require("@raycast/api"),p=m.default.join(f.environment.supportPath,"memory.json");(async()=>{try{await o.promises.access(p)}catch(s){if(s instanceof Error&&"code"in s&&s.code==="ENOENT")await o.promises.writeFile(p,"");else throw s}})();var h=class{async loadGraph(){try{return(await o.promises.readFile(p,"utf-8")).split(`
`).filter(i=>i.trim()!=="").reduce((i,n)=>{let a=JSON.parse(n);return a.type==="entity"&&i.entities.push(a),a.type==="relation"&&i.relations.push(a),i},{entities:[],relations:[]})}catch(t){if(t instanceof Error&&"code"in t&&t.code==="ENOENT")return{entities:[],relations:[]};throw t}}async saveGraph(t){console.log(t);let e=[...t.entities.map(i=>JSON.stringify({type:"entity",...i})),...t.relations.map(i=>JSON.stringify({type:"relation",...i}))];await o.promises.writeFile(p,e.join(`
`))}async createEntities(t){let e=await this.loadGraph(),i=t.filter(n=>!e.entities.some(a=>a.name===n.name));return e.entities.push(...i),await this.saveGraph(e),i}async createRelations(t){let e=await this.loadGraph(),i=t.filter(n=>!e.relations.some(a=>a.from===n.from&&a.to===n.to&&a.relationType===n.relationType));return e.relations.push(...i),await this.saveGraph(e),i}async addObservations(t){let e=await this.loadGraph(),i=t.map(n=>{let a=e.entities.find(r=>r.name===n.entityName);if(!a)throw new Error(`Entity with name ${n.entityName} not found`);let l=n.contents.filter(r=>!a.observations.includes(r));return a.observations.push(...l),{entityName:n.entityName,addedObservations:l}});return await this.saveGraph(e),i}async deleteEntities(t){let e=await this.loadGraph();e.entities=e.entities.filter(i=>!t.includes(i.name)),e.relations=e.relations.filter(i=>!t.includes(i.from)&&!t.includes(i.to)),await this.saveGraph(e)}async deleteObservations(t){let e=await this.loadGraph();t.forEach(i=>{let n=e.entities.find(a=>a.name===i.entityName);n&&(n.observations=n.observations.filter(a=>!i.observations.includes(a)))}),await this.saveGraph(e)}async deleteRelations(t){let e=await this.loadGraph();e.relations=e.relations.filter(i=>!t.some(n=>i.from===n.from&&i.to===n.to&&i.relationType===n.relationType)),await this.saveGraph(e)}async readGraph(){return this.loadGraph()}async searchNodes(t){let e=await this.loadGraph(),i=e.entities.filter(r=>r.name.toLowerCase().includes(t.toLowerCase())||r.entityType.toLowerCase().includes(t.toLowerCase())||r.observations.some(w=>w.toLowerCase().includes(t.toLowerCase()))),n=new Set(i.map(r=>r.name)),a=e.relations.filter(r=>n.has(r.from)&&n.has(r.to));return{entities:i,relations:a}}async openNodes(t){let e=await this.loadGraph(),i=e.entities.filter(r=>t.includes(r.name)),n=new Set(i.map(r=>r.name)),a=e.relations.filter(r=>n.has(r.from)&&n.has(r.to));return{entities:i,relations:a}}},y=new h;async function O(s){return y.createRelations(s.relations)}
