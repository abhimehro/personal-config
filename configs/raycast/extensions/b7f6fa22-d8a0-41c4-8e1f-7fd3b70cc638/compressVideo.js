"use strict";var T=Object.create;var d=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var O=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var G=(o,a)=>{for(var i in a)d(o,i,{get:a[i],enumerable:!0})},f=(o,a,i,c)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of k(a))!E.call(o,n)&&n!==i&&d(o,n,{get:()=>a[n],enumerable:!(c=q(a,n))||c.enumerable});return o};var V=(o,a,i)=>(i=o!=null?T(O(o)):{},f(a||!o||!o.__esModule?d(i,"default",{value:o,enumerable:!0}):i,o)),X=o=>f(d({},"__esModule",{value:!0}),o);var M={};G(M,{default:()=>I});module.exports=X(M);var t=require("@raycast/api"),w=require("child_process");var r=require("@raycast/api");async function L(){return(await(0,r.getApplications)()).some(({bundleId:a})=>a==="com.hieudinh.CompressX")}async function v(){let o=await L();if(!o){let a={style:r.Toast.Style.Failure,title:"Compresto is not installed.",message:"Install it from: https://compresto.app",primaryAction:{title:"Go to https://compresto.app",onAction:i=>{(0,r.open)("https://compresto.app"),i.hide()}}};await(0,r.showToast)(a)}return o}var l=require("react"),y=V(require("path")),s=require("react/jsx-runtime");function I(){let[o,a]=(0,l.useState)(!1),[i,c]=(0,l.useState)([]),[n,S]=(0,l.useState)(new Set),[C,u]=(0,l.useState)("high"),[b,h]=(0,l.useState)("same"),[D,F]=(0,l.useState)("same");(0,l.useEffect)(()=>{v().then(a),(0,t.getSelectedFinderItems)().then(e=>{if(e.length>0){let p=e.map(g=>g.path);c(p);let m=new Set;p.forEach(g=>{y.default.extname(g).toLowerCase().match(/\.(mp4|mov|avi|mkv|webm)$/)?m.add("video"):m.add("image")}),S(m)}}),t.LocalStorage.getItem("savedQuality").then(e=>{e&&u(e)}),t.LocalStorage.getItem("savedVideoFormat").then(e=>{e&&h(e)}),t.LocalStorage.getItem("savedImageFormat").then(e=>{e&&F(e)})},[]);let A=[{title:"High",value:"high"},{title:"Good",value:"good"},{title:"Medium",value:"medium"},{title:"Acceptable",value:"acceptable"}],P=[{title:"Same as input",value:"same"},{title:"MP4",value:"mp4"},{title:"WebM",value:"webm"}],$=[{title:"Same as input",value:"same"},{title:"PNG",value:"png"},{title:"JPG",value:"jpg"},{title:"WebP",value:"webp"}],x=async e=>{if(i.length!==0)try{let m=`compresto://open?path=${i.join("|")}&quality=${e.quality}`;e.videoFormat&&n.has("video")&&(m+=`&videoFormat=${e.videoFormat}`),e.imageFormat&&n.has("image")&&(m+=`&imageFormat=${e.imageFormat}`),(0,w.exec)(`open "${m}"`),await t.LocalStorage.setItem("savedQuality",e.quality),e.videoFormat&&await t.LocalStorage.setItem("savedVideoFormat",e.videoFormat),e.imageFormat&&await t.LocalStorage.setItem("savedImageFormat",e.imageFormat),await(0,t.showToast)({style:t.Toast.Style.Success,title:"Sent to Compresto for compressing",message:`${i.length} files selected`}),await(0,t.popToRoot)()}catch(p){await(0,t.showToast)({style:t.Toast.Style.Failure,title:"Error",message:p instanceof Error?p.message:"An error occurred"})}};return o===null||i.length===0||n.size===0?(0,s.jsx)(t.Form,{isLoading:!0}):o===!1?(0,s.jsx)(t.Form,{actions:(0,s.jsx)(t.ActionPanel,{children:(0,s.jsx)(t.Action.OpenInBrowser,{title:"Install Compresto",url:"https://compresto.app"})}),children:(0,s.jsx)(t.Form.Description,{text:"Compresto is not installed. Please install it to use this extension."})}):(0,s.jsxs)(t.Form,{actions:(0,s.jsx)(t.ActionPanel,{children:(0,s.jsx)(t.Action.SubmitForm,{title:"Compress Files",onSubmit:x})}),children:[(0,s.jsx)(t.Form.Dropdown,{id:"quality",title:"Quality",value:C,onChange:u,children:A.map(e=>(0,s.jsx)(t.Form.Dropdown.Item,{value:e.value,title:e.title},e.value))}),n.has("video")&&(0,s.jsx)(t.Form.Dropdown,{id:"videoFormat",title:"Video Format",value:b,onChange:h,children:P.map(e=>(0,s.jsx)(t.Form.Dropdown.Item,{value:e.value,title:e.title},e.value))}),n.has("image")&&(0,s.jsx)(t.Form.Dropdown,{id:"imageFormat",title:"Image Format",value:D,onChange:F,children:$.map(e=>(0,s.jsx)(t.Form.Dropdown.Item,{value:e.value,title:e.title},e.value))}),(0,s.jsx)(t.Form.Description,{text:`Selected ${i.length} file${i.length>1?"s":""}`})]})}
