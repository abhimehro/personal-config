"use strict";var O=Object.create;var x=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty;var W=(t,e)=>{for(var n in e)x(t,n,{get:e[n],enumerable:!0})},A=(t,e,n,p)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of M(e))!V.call(t,i)&&i!==n&&x(t,i,{get:()=>e[i],enumerable:!(p=L(e,i))||p.enumerable});return t};var D=(t,e,n)=>(n=t!=null?O(N(t)):{},A(e||!t||!t.__esModule?x(n,"default",{value:t,enumerable:!0}):n,t)),z=t=>A(x({},"__esModule",{value:!0}),t);var j={};W(j,{default:()=>P});module.exports=z(j);var s=require("@raycast/api");var c=D(require("react")),l=require("@raycast/api");var _=require("react/jsx-runtime");function R(t){let e=(0,c.useRef)(t);return e.current=t,e}function E(t,e){if(t){if(typeof t=="function")return t(e);if(t==="required"){let n=typeof e<"u"&&e!==null;if(n)switch(typeof e){case"string":n=e.length>0;break;case"object":Array.isArray(e)?n=e.length>0:e instanceof Date&&(n=e.getTime()>0);break;default:break}if(!n)return"The item is required"}}}function C(t){let{onSubmit:e,validation:n,initialValues:p={}}=t,[i,o]=(0,c.useState)(p),[d,a]=(0,c.useState)({}),u=(0,c.useRef)({}),m=R(n||{}),$=R(e),v=(0,c.useCallback)(f=>{u.current[f]?.focus()},[u]),T=(0,c.useCallback)(async f=>{let r=!1;for(let[y,b]of Object.entries(m.current)){let w=E(b,f[y]);w&&(r||(r={},v(y)),r[y]=w)}if(r)return a(r),!1;let h=await $.current(f);return typeof h=="boolean"?h:!0},[m,$,v]),k=(0,c.useCallback)((f,r)=>{a(h=>({...h,[f]:r}))},[a]),S=(0,c.useCallback)(function(f,r){o(h=>({...h,[f]:typeof r=="function"?r(h[f]):r}))},[o]),U=(0,c.useMemo)(()=>new Proxy({},{get(f,r){let h=m.current[r],y=i[r];return{onChange(b){d[r]&&(E(h,b)||k(r,void 0)),S(r,b)},onBlur(b){let w=E(h,b.target.value);w&&k(r,w)},error:d[r],id:r,value:typeof y>"u"?null:y,ref:b=>{u.current[r]=b}}}}),[d,m,k,i,u,S]),I=(0,c.useCallback)(f=>{a({}),Object.entries(u.current).forEach(([r,h])=>{f?.[r]||h?.reset()}),f&&o(f)},[o,a,u]);return{handleSubmit:T,setValidationError:k,setValue:S,values:i,itemProps:U,focus:v,reset:I}}var g=require("react/jsx-runtime");function P(){let{handleSubmit:t,itemProps:e}=C({async onSubmit(n){let p=await s.LocalStorage.allItems(),i=JSON.parse(n.json),o=0,d=0;for(let a of Object.keys(i)){let u=i[a];if(typeof i[a]=="string"&&(u=JSON.parse(i[a])),a in p){let m=a;if(n.overwrite)d+=1;else{let $=2;for(m=`${a} ${$}`;m in p;)$+=1,m=`${a} ${$}`;u.name=m,o+=1}await s.LocalStorage.setItem(m,JSON.stringify(u))}else await s.LocalStorage.setItem(a,JSON.stringify(u)),o+=1}o>0&&d>0?(0,s.showToast)({title:`Added ${o} command${o==1?"":"s"}, replaced ${d}`}):o>0?(0,s.showToast)({title:`Added ${o} PromptLab command${o==1?"":"s"}`}):d>0?(0,s.showToast)({title:`Replaced ${d} PromptLab command${d==1?"":"s"}`}):(0,s.showToast)({title:"No PromptLab commands added or replaced"}),(0,s.launchCommand)({name:"search-commands",type:s.LaunchType.UserInitiated})},initialValues:{overwrite:!0},validation:{json:n=>{if(!n)return"Must not be empty";try{let p=JSON.parse(n),i=1;for(let[o,d]of Object.entries(p)){let a={};try{a=JSON.parse(d)}catch{a=d}if(a.name==null||a.name.length==0)return`Missing name argument for command #${i} with key ${o}`;if(a.prompt==null||a.prompt.length==0)return`Missing prompt argument for command #${i} with key ${o}`;let u=parseInt(a.minNumFiles);if(u==null||u<0)return`Invalid minimum file count argument for command #${i} with key ${o}`;i=i+1}}catch(p){return console.log(p),"Invalid JSON string"}}}});return(0,g.jsxs)(s.Form,{actions:(0,g.jsx)(s.ActionPanel,{children:(0,g.jsx)(s.Action.SubmitForm,{title:"Import Commands",onSubmit:t})}),children:[(0,g.jsx)(s.Form.TextArea,{title:"Commands JSON",placeholder:"JSON string of one or more commands",...e.json}),(0,g.jsx)(s.Form.Checkbox,{label:"Overwrite?",info:"If checked, existing commands will be overwritten with the newly imported ones. Otherwise, newly imported commands with duplicate titles will have a '2' appended at the end.",...e.overwrite})]})}
