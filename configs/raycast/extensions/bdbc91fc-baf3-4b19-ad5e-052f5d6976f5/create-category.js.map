{
  "version": 3,
  "sources": ["../src/create-category.tsx"],
  "sourcesContent": ["import {\n  ActionPanel,\n  Action,\n  Form,\n  LocalStorage,\n  getApplications,\n  showToast,\n  useNavigation,\n  Toast,\n  Application,\n  Icon,\n} from \"@raycast/api\";\nimport { useEffect, useState, useRef } from \"react\";\nimport { randomUUID } from \"crypto\";\nimport { Category } from \"./types\";\n\nconst EMOJI_ICONS: Record<string, string> = {\n  \"\uD83E\uDDD1\u200D\uD83D\uDCBB\": \"Developer\",\n  \"\uD83D\uDE80\": \"Rocket\",\n  \"\uD83D\uDCA1\": \"Idea\",\n  \"\uD83D\uDCBC\": \"Briefcase\",\n  \"\uD83D\uDCDA\": \"Books\",\n  \"\uD83C\uDFAE\": \"Gaming\",\n  \"\uD83D\uDCAC\": \"Chat\",\n  \"\uD83D\uDCDD\": \"Notes\",\n  \"\uD83C\uDFA8\": \"Art\",\n  \"\uD83C\uDFB5\": \"Music\",\n  \"\uD83D\uDCB0\": \"Money\",\n  \"\uD83D\uDD12\": \"Security\",\n  \"\u2699\uFE0F\": \"Settings\",\n  \"\uD83E\uDD16\": \"Bot\",\n  \"\uD83D\uDCBB\": \"Laptop\",\n  \"\uD83D\uDDA5\uFE0F\": \"Desktop\",\n  \"\uD83D\uDDB1\uFE0F\": \"Mouse\",\n  \"\u2328\uFE0F\": \"Keyboard\",\n  \"\uD83D\uDCBE\": \"Save\",\n  \"\uD83D\uDCBF\": \"Disc\",\n  \"\uD83D\uDD0C\": \"Plugin\",\n  \"\uD83D\uDD0B\": \"Battery\",\n  \"\uD83D\uDCE1\": \"Network\",\n  \"\uD83E\uDDE0\": \"Brain\",\n  \"\uD83D\uDCB3\": \"Card\",\n  \"\uD83D\uDCB5\": \"Dollar\",\n  \"\uD83D\uDCC8\": \"Chart\",\n  \"\uD83C\uDFE6\": \"Bank\",\n  \"\uD83D\uDEE1\uFE0F\": \"Shield\",\n  \"\uD83E\uDDFE\": \"Receipt\",\n  \"\u2705\": \"Done\",\n  \"\u274C\": \"Remove\",\n  \"\u2753\": \"Question\",\n  \"\u2757\": \"Alert\",\n  \"\uD83D\uDCCC\": \"Pin\",\n  \"\uD83D\uDCCD\": \"Location\",\n  \"\u23F0\": \"Alarm\",\n  \"\u23F3\": \"Hourglass\",\n  \"\uD83C\uDFC1\": \"Finish\",\n  \"\uD83C\uDFF3\uFE0F\": \"Flag\",\n  \"\u2728\": \"Magic\",\n  \"\uD83C\uDF0D\": \"Web\",\n};\n\ninterface CreateCategoryFormProps {\n  categoryId?: string;\n  onCategoryUpdated: () => void;\n}\n\nexport function CreateCategoryForm({ categoryId, onCategoryUpdated }: CreateCategoryFormProps) {\n  const { pop } = useNavigation();\n  const [isLoading, setIsLoading] = useState(true);\n  const hasInitialized = useRef(false);\n\n  const [apps, setApps] = useState<Application[]>([]);\n  const [categoryName, setCategoryName] = useState<string>(\"\");\n  const [selectedBundleIds, setSelectedBundleIds] = useState<string[]>([]);\n  const [selectedIcon, setSelectedIcon] = useState<string>(\"\uD83E\uDDD1\u200D\uD83D\uDCBB\");\n\n  // Track the initial bundle IDs to prevent them from being cleared by Form.TagPicker\n  const initialBundleIds = useRef<string[]>([]);\n\n  // Effect 1: Fetch all installed applications once on mount\n  useEffect(() => {\n    async function fetchApps() {\n      try {\n        const installedApps = await getApplications();\n        setApps(installedApps);\n      } catch (error) {\n        await showToast({\n          style: Toast.Style.Failure,\n          title: \"Failed to load applications\",\n          message: error instanceof Error ? error.message : \"An unknown error occurred\",\n        });\n        setIsLoading(false); // Stop loading on error\n      }\n    }\n    fetchApps();\n  }, []); // Runs only once\n\n  // Effect 2: Load category details, but only after apps have been loaded and if editing\n  useEffect(() => {\n    // Don't run this effect until the apps are loaded\n    if (apps.length === 0 && categoryId) {\n      return;\n    }\n\n    // If we are creating a new category, we can stop loading and exit.\n    if (!categoryId) {\n      setIsLoading(false);\n      hasInitialized.current = true;\n      return;\n    }\n\n    async function fetchCategoryDetails() {\n      try {\n        const storedCategoriesRaw = await LocalStorage.getItem<string>(\"categories\");\n        if (storedCategoriesRaw) {\n          const categories: Category[] = JSON.parse(storedCategoriesRaw);\n          const foundCategory = categories.find((cat) => cat.id === categoryId);\n\n          if (foundCategory) {\n            const installedBundleIdsSet = new Set(apps.map((app) => app.bundleId));\n            const validBundleIds = foundCategory.bundleIds.filter((id) => id && installedBundleIdsSet.has(id));\n\n            setCategoryName(foundCategory.name);\n            setSelectedBundleIds(validBundleIds);\n            initialBundleIds.current = validBundleIds;\n            setSelectedIcon(foundCategory.icon);\n            hasInitialized.current = true;\n          }\n        }\n      } catch (error) {\n        await showToast({\n          style: Toast.Style.Failure,\n          title: \"Failed to load category details\",\n          message: error instanceof Error ? error.message : \"An unknown error occurred\",\n        });\n      } finally {\n        setIsLoading(false); // Done loading\n      }\n    }\n\n    fetchCategoryDetails();\n  }, [categoryId, apps]); // This effect now correctly depends on `apps`\n\n  async function handleSubmit() {\n    if (!categoryName) {\n      await showToast({ style: Toast.Style.Failure, title: \"Category name is required\" });\n      return;\n    }\n    if (selectedBundleIds.length === 0) {\n      await showToast({ style: Toast.Style.Failure, title: \"Please select at least one application\" });\n      return;\n    }\n\n    const toast = await showToast({ style: Toast.Style.Animated, title: categoryId ? \"Saving...\" : \"Creating...\" });\n\n    try {\n      const storedCategories = await LocalStorage.getItem<string>(\"categories\");\n      const categories: Category[] = storedCategories ? JSON.parse(storedCategories) : [];\n\n      if (categoryId) {\n        const categoryIndex = categories.findIndex((cat) => cat.id === categoryId);\n        if (categoryIndex !== -1) {\n          categories[categoryIndex] = {\n            ...categories[categoryIndex],\n            name: categoryName,\n            icon: selectedIcon,\n            bundleIds: selectedBundleIds,\n          };\n        }\n      } else {\n        const newCategory: Category = {\n          id: randomUUID(),\n          name: categoryName,\n          bundleIds: selectedBundleIds,\n          icon: selectedIcon,\n        };\n        categories.push(newCategory);\n      }\n\n      await LocalStorage.setItem(\"categories\", JSON.stringify(categories));\n      toast.style = Toast.Style.Success;\n      toast.title = categoryId ? \"Category Updated\" : \"Category Created\";\n      onCategoryUpdated();\n      pop();\n    } catch (error) {\n      toast.style = Toast.Style.Failure;\n      toast.title = \"Failed to save category\";\n      toast.message = error instanceof Error ? error.message : \"An unknown error occurred\";\n    }\n  }\n\n  // Effect to prevent selectedBundleIds from being cleared by Form.TagPicker after initialization\n  useEffect(() => {\n    if (hasInitialized.current && initialBundleIds.current.length > 0 && selectedBundleIds.length === 0) {\n      setSelectedBundleIds(initialBundleIds.current);\n    }\n  }, [selectedBundleIds]);\n\n  return (\n    <Form\n      isLoading={isLoading}\n      actions={\n        <ActionPanel>\n          <Action.SubmitForm\n            title={categoryId ? \"Save Changes\" : \"Create Category\"}\n            onSubmit={handleSubmit}\n            icon={Icon.CheckCircle}\n          />\n        </ActionPanel>\n      }\n    >\n      <Form.TextField\n        id=\"name\"\n        title=\"Category Name\"\n        placeholder=\"e.g., Work Apps\"\n        value={categoryName}\n        onChange={setCategoryName}\n      />\n      <Form.Dropdown id=\"icon\" title=\"Icon\" value={selectedIcon} onChange={setSelectedIcon}>\n        {Object.entries(EMOJI_ICONS).map(([emoji, name]) => (\n          <Form.Dropdown.Item key={emoji} value={emoji} title={`${emoji} ${name}`} />\n        ))}\n      </Form.Dropdown>\n      <Form.TagPicker\n        id=\"apps\"\n        title=\"Applications\"\n        placeholder=\"Type to search for applications\"\n        value={selectedBundleIds}\n        onChange={setSelectedBundleIds}\n      >\n        {apps\n          .filter((app) => !!app.bundleId)\n          .map((app) => (\n            <Form.TagPicker.Item key={app.bundleId!} value={app.bundleId!} title={app.name} />\n          ))}\n      </Form.TagPicker>\n    </Form>\n  );\n}\n\nexport default function CreateCategoryCommand() {\n  return <CreateCategoryForm onCategoryUpdated={() => {}} />;\n}\n"],
  "mappings": "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",
  "names": ["create_category_exports", "__export", "CreateCategoryForm", "CreateCategoryCommand", "__toCommonJS", "import_api", "import_react", "import_crypto", "import_jsx_runtime", "EMOJI_ICONS", "categoryId", "onCategoryUpdated", "pop", "isLoading", "setIsLoading", "hasInitialized", "apps", "setApps", "categoryName", "setCategoryName", "selectedBundleIds", "setSelectedBundleIds", "selectedIcon", "setSelectedIcon", "initialBundleIds", "fetchApps", "installedApps", "error", "fetchCategoryDetails", "storedCategoriesRaw", "foundCategory", "cat", "installedBundleIdsSet", "app", "validBundleIds", "id", "handleSubmit", "toast", "storedCategories", "categories", "categoryIndex", "newCategory", "emoji", "name"]
}
