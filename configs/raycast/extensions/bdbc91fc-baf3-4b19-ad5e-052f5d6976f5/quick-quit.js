"use strict";var J=Object.create;var $=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty;var X=(r,t)=>{for(var e in t)$(r,e,{get:t[e],enumerable:!0})},T=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of q(t))!Q.call(r,a)&&a!==e&&$(r,a,{get:()=>t[a],enumerable:!(n=Z(t,a))||n.enumerable});return r};var k=(r,t,e)=>(e=r!=null?J(Y(r)):{},T(t||!r||!r.__esModule?$(e,"default",{value:r,enumerable:!0}):e,r)),ee=r=>T($({},"__esModule",{value:!0}),r);var fe={};X(fe,{default:()=>j});module.exports=ee(fe);var i=require("@raycast/api");var p=k(require("react")),u=require("@raycast/api");var L=k(require("node:child_process")),M=require("node:buffer"),m=k(require("node:stream")),D=require("node:util");var W=require("react/jsx-runtime");var x=globalThis;var y=r=>!!r&&typeof r=="object"&&typeof r.removeListener=="function"&&typeof r.emit=="function"&&typeof r.reallyExit=="function"&&typeof r.listeners=="function"&&typeof r.kill=="function"&&typeof r.pid=="number"&&typeof r.on=="function",v=Symbol.for("signal-exit emitter"),E=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),x[v])return x[v];Object.defineProperty(x,v,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(t,e){this.listeners[t].push(e)}removeListener(t,e){let n=this.listeners[t],a=n.indexOf(e);a!==-1&&(a===0&&n.length===1?n.length=0:n.splice(a,1))}emit(t,e,n){if(this.emitted[t])return!1;this.emitted[t]=!0;let a=!1;for(let s of this.listeners[t])a=s(e,n)===!0||a;return t==="exit"&&(a=this.emit("afterExit",e,n)||a),a}},A=class{onExit(){return()=>{}}load(){}unload(){}},C=class{#o;#t;#e;#s;#i;#a;#n;#r;constructor(t){this.#o=process.platform==="win32"?"SIGINT":"SIGHUP",this.#t=new E,this.#a={},this.#n=!1,this.#r=[],this.#r.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#r.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#r.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#e=t,this.#a={};for(let e of this.#r)this.#a[e]=()=>{let n=this.#e.listeners(e),{count:a}=this.#t,s=t;if(typeof s.__signal_exit_emitter__=="object"&&typeof s.__signal_exit_emitter__.count=="number"&&(a+=s.__signal_exit_emitter__.count),n.length===a){this.unload();let o=this.#t.emit("exit",null,e),c=e==="SIGHUP"?this.#o:e;o||t.kill(t.pid,c)}};this.#i=t.reallyExit,this.#s=t.emit}onExit(t,e){if(!y(this.#e))return()=>{};this.#n===!1&&this.load();let n=e?.alwaysLast?"afterExit":"exit";return this.#t.on(n,t),()=>{this.#t.removeListener(n,t),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#n){this.#n=!0,this.#t.count+=1;for(let t of this.#r)try{let e=this.#a[t];e&&this.#e.on(t,e)}catch{}this.#e.emit=(t,...e)=>this.#l(t,...e),this.#e.reallyExit=t=>this.#c(t)}}unload(){this.#n&&(this.#n=!1,this.#r.forEach(t=>{let e=this.#a[t];if(!e)throw new Error("Listener not defined for signal: "+t);try{this.#e.removeListener(t,e)}catch{}}),this.#e.emit=this.#s,this.#e.reallyExit=this.#i,this.#t.count-=1)}#c(t){return y(this.#e)?(this.#e.exitCode=t||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#l(t,...e){let n=this.#s;if(t==="exit"&&y(this.#e)){typeof e[0]=="number"&&(this.#e.exitCode=e[0]);let a=n.call(this.#e,t,...e);return this.#t.emit("exit",this.#e.exitCode,null),a}else return n.call(this.#e,t,...e)}},S=null,te=(r,t)=>(S||(S=y(process)?new C(process):new A),S.onExit(r,t));function re(r,{timeout:t}={}){let e=new Promise((c,l)=>{r.on("exit",(f,h)=>{c({exitCode:f,signal:h,timedOut:!1})}),r.on("error",f=>{l(f)}),r.stdin&&r.stdin.on("error",f=>{l(f)})}),n=te(()=>{r.kill()});if(t===0||t===void 0)return e.finally(()=>n());let a,s=new Promise((c,l)=>{a=setTimeout(()=>{r.kill("SIGTERM"),l(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},t)}),o=e.finally(()=>{clearTimeout(a)});return Promise.race([s,o]).finally(()=>n())}var R=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function ne(r){let{encoding:t}=r,e=t==="buffer",n=new m.default.PassThrough({objectMode:!1});t&&t!=="buffer"&&n.setEncoding(t);let a=0,s=[];return n.on("data",o=>{s.push(o),a+=o.length}),n.getBufferedValue=()=>e?Buffer.concat(s,a):s.join(""),n.getBufferedLength=()=>a,n}async function _(r,t){let e=ne(t);return await new Promise((n,a)=>{let s=o=>{o&&e.getBufferedLength()<=M.constants.MAX_LENGTH&&(o.bufferedData=e.getBufferedValue()),a(o)};(async()=>{try{await(0,D.promisify)(m.default.pipeline)(r,e),n()}catch(o){s(o)}})(),e.on("data",()=>{e.getBufferedLength()>8e7&&s(new R)})}),e.getBufferedValue()}async function U(r,t){r.destroy();try{return await t}catch(e){return e.bufferedData}}async function ae({stdout:r,stderr:t},{encoding:e},n){let a=_(r,{encoding:e}),s=_(t,{encoding:e});try{return await Promise.all([n,a,s])}catch(o){return Promise.all([{error:o,exitCode:null,signal:o.signal,timedOut:o.timedOut||!1},U(r,a),U(t,s)])}}function se(r){let t=typeof r=="string"?`
`:10,e=typeof r=="string"?"\r":13;return r[r.length-1]===t&&(r=r.slice(0,-1)),r[r.length-1]===e&&(r=r.slice(0,-1)),r}function O(r,t){return r.stripFinalNewline?se(t):t}function ie({timedOut:r,timeout:t,signal:e,exitCode:n}){return r?`timed out after ${t} milliseconds`:e!=null?`was killed with ${e}`:n!=null?`failed with exit code ${n}`:"failed"}function oe({stdout:r,stderr:t,error:e,signal:n,exitCode:a,command:s,timedOut:o,options:c,parentError:l}){let h=`Command ${ie({timedOut:o,timeout:c?.timeout,signal:n,exitCode:a})}: ${s}`,g=e?`${h}
${e.message}`:h,w=[g,t,r].filter(Boolean).join(`
`);return e?e.originalMessage=e.message:e=l,e.message=w,e.shortMessage=g,e.command=s,e.exitCode=a,e.signal=n,e.stdout=r,e.stderr=t,"bufferedData"in e&&delete e.bufferedData,e}function ce({stdout:r,stderr:t,error:e,exitCode:n,signal:a,timedOut:s,command:o,options:c,parentError:l}){if(e||n!==0||a!==null)throw oe({error:e,exitCode:n,signal:a,stdout:r,stderr:t,command:o,timedOut:s,options:c,parentError:l});return r}async function P(r,t,e){if(process.platform!=="darwin")throw new Error("AppleScript is only supported on macOS");let{humanReadableOutput:n,language:a,timeout:s,...o}=Array.isArray(t)?e||{}:t||{},c=n!==!1?[]:["-ss"];a==="JavaScript"&&c.push("-l","JavaScript"),Array.isArray(t)&&c.push("-",...t);let l=L.default.spawn("osascript",c,{...o,env:{PATH:"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"}}),f=re(l,{timeout:s??1e4});l.stdin.end(r);let[{error:h,exitCode:g,signal:w,timedOut:F},B,G]=await ae(l,{encoding:"utf8"},f),K=O({stripFinalNewline:!0},B),H=O({stripFinalNewline:!0},G);return ce({stdout:K,stderr:H,error:h,exitCode:g,signal:w,timedOut:F,command:"osascript",options:e,parentError:new Error})}var b=require("react");var I={"AI Assistants":[{bundleId:"com.openai.chat",name:"ChatGPT"},{bundleId:"com.anthropic.claudefordesktop",name:"Claude"}],"Developer Tools":[{bundleId:"com.github.GitHubClient",name:"GitHub Desktop"},{bundleId:"com.docker.docker",name:"Docker Desktop"},{bundleId:"com.googlecode.iterm2",name:"iTerm"},{bundleId:"com.postmanlabs.mac",name:"Postman"}],"Task Managers":[{bundleId:"com.TickTick.task.mac",name:"TickTick"},{bundleId:"com.todoist.mac.Todoist",name:"Todoist"}]};function z(r){let t=new Set(r.map(n=>n.bundleId)),e={};for(let n in I){let s=I[n].filter(o=>t.has(o.bundleId));s.length>0&&(e[n]=s)}return e}var d=require("react/jsx-runtime");function V(r,t){let e=t.find(n=>n.bundleId===r);return e?e.name:r}async function le(){let e=(await P(`
    set bundleIds to {}
    tell application "System Events"
      set allProcesses to every process whose background only is false
      repeat with aProcess in allProcesses
        try
          set end of bundleIds to bundle identifier of aProcess
        on error
          -- fallback: use name as bundle id if bundle identifier is not available
          set end of bundleIds to name of aProcess
        end try
      end repeat
    end tell
    return bundleIds
  `)).trim().split(", ").map(n=>n.trim());return new Set(e)}async function ue(){let r=await le(),t=await i.LocalStorage.getItem("categories"),e=t?JSON.parse(t):[],n=await(0,i.getApplications)(),a=z(n),s=e.map(c=>{let l=(c.bundleIds??[]).filter(f=>r.has(f));return{...c,bundleIds:l}}).filter(c=>c.bundleIds.length>0),o={};for(let[c,l]of Object.entries(a)){let f=l.filter(h=>r.has(h.bundleId));f.length>0&&(o[c]=f.map(h=>h.bundleId))}return{activeCustomCategories:s,activePrebuiltCategories:o}}async function N(r,t,e){let n=await(0,i.showToast)({style:i.Toast.Style.Animated,title:`Quitting ${r} apps...`});try{let a=t.map(s=>P(`
        tell application id ${JSON.stringify(s)} to quit
        delay 0.2
        tell application "System Events"
          repeat while (exists (processes where bundle identifier is ${JSON.stringify(s)}))
            delay 0.2
          end repeat
        end tell
      `));await Promise.all(a),n.style=i.Toast.Style.Success,n.title=`Successfully quit ${r} apps`,await e()}catch(a){n.style=i.Toast.Style.Failure,n.title="Failed to quit apps",n.message=a instanceof Error?a.message:"An unknown error occurred"}}function j(){let[r,t]=(0,b.useState)({isLoading:!0,installedApps:[]}),e=(0,b.useCallback)(async()=>{t(n=>({...n,isLoading:!0}));try{let n=(await(0,i.getApplications)()).filter(s=>typeof s.bundleId=="string"&&s.bundleId.length>0),a=await ue();t({data:a,isLoading:!1,installedApps:n})}catch(n){await(0,i.showToast)({style:i.Toast.Style.Failure,title:"Failed to load active categories",message:n instanceof Error?n.message:"An unknown error occurred"}),t({isLoading:!1,installedApps:[]})}},[]);return(0,b.useEffect)(()=>{e()},[e]),(0,d.jsxs)(i.List,{isLoading:r.isLoading,children:[(0,d.jsx)(i.List.EmptyView,{title:"No Active Categories Found",description:"None of the apps in your categories are currently running."}),(0,d.jsx)(i.List.Section,{title:"Your Active Categories & Apps",children:r.data?.activeCustomCategories.map(n=>(0,d.jsx)(i.List.Item,{title:n.name,icon:n.icon,subtitle:n.bundleIds.map(a=>V(a,r.installedApps)).join(", "),actions:(0,d.jsx)(i.ActionPanel,{children:(0,d.jsx)(i.Action,{title:`Quit ${n.name}`,icon:i.Icon.XMarkCircle,onAction:()=>N(n.name,n.bundleIds,e)})})},n.id))}),(0,d.jsx)(i.List.Section,{title:"Active Default Categories & Apps",children:Object.entries(r.data?.activePrebuiltCategories??{}).map(([n,a])=>(0,d.jsx)(i.List.Item,{icon:i.Icon.HardDrive,title:n,subtitle:a.map(s=>V(s,r.installedApps)).join(", "),actions:(0,d.jsx)(i.ActionPanel,{children:(0,d.jsx)(i.Action,{title:`Quit ${n}`,icon:i.Icon.XMarkCircle,onAction:()=>N(n,a,e)})})},n))})]})}
