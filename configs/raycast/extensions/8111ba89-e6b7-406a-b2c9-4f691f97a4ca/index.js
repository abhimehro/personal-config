"use strict";var y=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var _=Object.prototype.hasOwnProperty;var O=(s,p)=>{for(var r in p)y(s,r,{get:p[r],enumerable:!0})},v=(s,p,r,l)=>{if(p&&typeof p=="object"||typeof p=="function")for(let A of I(p))!_.call(s,A)&&A!==r&&y(s,A,{get:()=>p[A],enumerable:!(l=$(p,A))||l.enumerable});return s};var P=s=>v(y({},"__esModule",{value:!0}),s);var J={};O(J,{default:()=>C});module.exports=P(J);var m=require("react"),e=require("@raycast/api"),u=require("child_process"),n=require("react/jsx-runtime");async function b(s){let p=await e.LocalStorage.getItem("presetKeepApps"),r=p?JSON.parse(p):[];r.includes(s)?(r=r.filter(l=>l!==s),console.log(`Removed ${s} from presetKeepApps.`)):(r.push(s),console.log(`Added ${s} to presetKeepApps.`)),await e.LocalStorage.setItem("presetKeepApps",JSON.stringify(r))}function C(){let[s,p]=(0,m.useState)([]),[r,l]=(0,m.useState)(!0);s.sort((t,i)=>t.keep===i.keep?0:t.keep?-1:1),(0,m.useEffect)(()=>{let t=async()=>{let o=await e.LocalStorage.getItem("presetKeepApps");return o?JSON.parse(o):[]};(async()=>{l(!0);let o=await t();(0,u.exec)(`osascript -e 'tell application "System Events" to get name of (processes where background only is false)'`,(c,g)=>{if(l(!1),c){(0,e.showToast)({title:"Error fetching apps",message:c.message,style:e.Toast.Style.Failure});return}let k=g.split(", ").map(a=>({name:a,keep:!1,always_keep:o.includes(a)})).sort((a,f)=>a.keep===f.keep?0:a.keep?-1:1);p(k)})})()},[]);let A=t=>{let i=s.map(o=>o.name===t?{...o,keep:!o.keep}:o);p(i)},d=async t=>{await b(t);let i=s.map(o=>o.name===t?{...o,always_keep:!o.always_keep}:o);p(i)},w=async()=>{let t=await e.LocalStorage.getItem("presetKeepApps"),i=t?JSON.parse(t):[];s.forEach(o=>{if(!o.keep&&!i.includes(o.name)){let c=o.name.trim();(0,u.exec)(`pgrep -x "${c}"`,(g,h,k)=>{if(g||k){console.error(`Failed to find ${c}: ${g||k}`);return}let a=h.trim();a&&(0,u.exec)(`kill -9 ${a}`,(f,R,S)=>{f||S?console.error(`Failed to force close ${c}: ${f||S}`):console.log(`${c} was forced to close.`)})})}}),(0,e.closeMainWindow)()},K=s.filter(t=>t.always_keep),L=s.filter(t=>!t.always_keep);return(0,n.jsxs)(e.List,{isLoading:r,children:[(0,n.jsx)(e.List.Section,{title:"App List",children:L.map((t,i)=>(0,n.jsx)(e.List.Item,{title:t.name,icon:t.keep?e.Icon.Checkmark:e.Icon.Circle,accessories:[...t.keep?[{tag:{value:"Keep",color:e.Color.Orange}}]:[],...t.always_keep?[{tag:{value:"Always Keep",color:e.Color.Green}}]:[]],actions:(0,n.jsxs)(e.ActionPanel,{children:[(0,n.jsx)(e.Action,{icon:{source:e.Icon.Check},title:"Set Keep",onAction:()=>A(t.name)}),(0,n.jsx)(e.Action,{icon:{source:e.Icon.Lock},title:"Set Always Keep",onAction:()=>d(t.name)}),(0,n.jsx)(e.Action,{icon:{source:e.Icon.XMarkCircle,tintColor:e.Color.Red},title:"Close Other Apps",onAction:()=>w()})]})},`other-${i}`))}),K.length>0&&(0,n.jsx)(e.List.Section,{title:"Always Keep Apps",children:K.map((t,i)=>(0,n.jsx)(e.List.Item,{title:t.name,icon:e.Icon.Checkmark,accessories:[...t.always_keep?[{tag:{value:"Always Keep",color:e.Color.Red}}]:[]],actions:(0,n.jsxs)(e.ActionPanel,{children:[(0,n.jsx)(e.Action,{icon:{source:e.Icon.LockDisabled},title:"Clear Always Keep",onAction:()=>d(t.name)}),(0,n.jsx)(e.Action,{icon:{source:e.Icon.XMarkCircle,tintColor:e.Color.Red},title:"Close Other Apps",onAction:()=>w()})]})},`always-${i}`))})]})}
