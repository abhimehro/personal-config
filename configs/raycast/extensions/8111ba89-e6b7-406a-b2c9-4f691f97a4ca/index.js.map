{
  "version": 3,
  "sources": ["../src/index.tsx"],
  "sourcesContent": ["import { useState, useEffect } from \"react\";\nimport { ActionPanel, Action, List, showToast, Toast, Color, Icon, LocalStorage, closeMainWindow } from \"@raycast/api\";\nimport { exec } from \"child_process\";\n\ntype App = {\n  name: string;\n  keep: boolean;\n  always_keep: boolean;\n};\n\nasync function toggleAppInPresetKeepApps(appName: string) {\n  // \u5C1D\u8BD5\u4ECELocalStorage\u4E2D\u8BFB\u53D6presetKeepApps\n  const presetKeepAppsStr = await LocalStorage.getItem<string>(\"presetKeepApps\");\n  let presetKeepApps = presetKeepAppsStr ? JSON.parse(presetKeepAppsStr) : [];\n\n  // \u68C0\u67E5appName\u662F\u5426\u5DF2\u7ECF\u5B58\u5728\u4E8E\u5217\u8868\u4E2D\n  if (presetKeepApps.includes(appName)) {\n    // \u5982\u679C\u5B58\u5728\uFF0C\u5219\u4ECE\u5217\u8868\u4E2D\u5220\u9664\n    presetKeepApps = presetKeepApps.filter((app: string) => app !== appName);\n    console.log(`Removed ${appName} from presetKeepApps.`);\n  } else {\n    // \u5982\u679C\u4E0D\u5B58\u5728\uFF0C\u5219\u6DFB\u52A0\u5230\u5217\u8868\u4E2D\n    presetKeepApps.push(appName);\n    console.log(`Added ${appName} to presetKeepApps.`);\n  }\n\n  // \u4FDD\u5B58\u66F4\u65B0\u540E\u7684\u5217\u8868\u5230LocalStorage\n  await LocalStorage.setItem(\"presetKeepApps\", JSON.stringify(presetKeepApps));\n}\n\nexport default function Command() {\n  const [apps, setApps] = useState<App[]>([]);\n  const [isLoading, setIsLoading] = useState(true); // \u6DFB\u52A0isLoading\u72B6\u6001\n  apps.sort((a, b) => (a.keep === b.keep ? 0 : a.keep ? -1 : 1));\n\n  // \u83B7\u53D6\u5DF2\u6253\u5F00\u7684\u5E94\u7528\u7A0B\u5E8F\u5217\u8868\n  useEffect(() => {\n    // \u9996\u5148\u83B7\u53D6\u9884\u8BBE\u4FDD\u7559\u7684\u5E94\u7528\u7A0B\u5E8F\u5217\u8868\n    const getPresetKeepApps = async () => {\n      const presetKeepAppsStr = await LocalStorage.getItem<string>(\"presetKeepApps\");\n      const presetKeepApps = presetKeepAppsStr ? JSON.parse(presetKeepAppsStr) : [];\n      return presetKeepApps;\n    };\n\n    // \u7136\u540E\u83B7\u53D6\u7CFB\u7EDF\u4E2D\u7684\u5E94\u7528\u7A0B\u5E8F\u5217\u8868\uFF0C\u5E76\u8BBE\u7F6Ekeep\u548Calways_keep\u5C5E\u6027\n    const fetchApps = async () => {\n      setIsLoading(true); // \u5F00\u59CB\u52A0\u8F7D\uFF0C\u8BBE\u7F6EisLoading\u4E3Atrue\n      const presetKeepApps = await getPresetKeepApps();\n      exec(\n        `osascript -e 'tell application \"System Events\" to get name of (processes where background only is false)'`,\n        (err, stdout) => {\n          setIsLoading(false); // \u52A0\u8F7D\u5B8C\u6210\uFF0C\u8BBE\u7F6EisLoading\u4E3Afalse\n          if (err) {\n            showToast({ title: \"Error fetching apps\", message: err.message, style: Toast.Style.Failure });\n            return;\n          }\n\n          const appNames = stdout.split(\", \");\n          const apps = appNames\n            .map((name) => ({\n              name,\n              keep: false, // \u9ED8\u8BA4\u4E0D\u4FDD\u7559\n              always_keep: presetKeepApps.includes(name), // \u5982\u679C\u5728\u9884\u8BBE\u5217\u8868\u4E2D\uFF0C\u5219always_keep\u4E3Atrue\n            }))\n            .sort((a, b) => (a.keep === b.keep ? 0 : a.keep ? -1 : 1));\n          setApps(apps);\n        },\n      );\n    };\n\n    fetchApps();\n  }, []);\n\n  // \u66F4\u6539\u5E94\u7528\u7A0B\u5E8F\u7684\u4FDD\u7559\u72B6\u6001\n  const toggleKeepApp = (appName: string) => {\n    const updatedApps = apps.map((app) => {\n      if (app.name === appName) {\n        return { ...app, keep: !app.keep }; // \u5207\u6362keep\u72B6\u6001\n      }\n      return app;\n    });\n    setApps(updatedApps);\n  };\n\n  // \u5F53\u4FEE\u6539\u9ED8\u8BA4\u503C\u65F6\u66F4\u65B0app.always_keep\u503C\n  const handleToggleAlwaysKeepApp = async (appName: string) => {\n    // \u9996\u5148\uFF0C\u5207\u6362presetKeepApps\u4E2D\u7684\u72B6\u6001\n    await toggleAppInPresetKeepApps(appName);\n\n    // \u7136\u540E\uFF0C\u66F4\u65B0apps\u6570\u7EC4\n    const updatedApps = apps.map((app) => {\n      if (app.name === appName) {\n        // \u5207\u6362app\u7684always_keep\u72B6\u6001\n        return { ...app, always_keep: !app.always_keep };\n      }\n      return app;\n    });\n\n    // \u6700\u540E\uFF0C\u4F7F\u7528\u66F4\u65B0\u540E\u7684apps\u6570\u7EC4\u66F4\u65B0\u72B6\u6001\n    setApps(updatedApps);\n  };\n\n  // \u5173\u95ED\u7A0B\u5E8F\uFF08Finder \u4F7F\u7528kill\u547D\u4EE4\u662F\u5173\u4E0D\u6389\u7684\uFF09\n  const closeApps = async () => {\n    const presetKeepAppsStr = await LocalStorage.getItem<string>(\"presetKeepApps\");\n    const presetKeepApps = presetKeepAppsStr ? JSON.parse(presetKeepAppsStr) : [];\n    apps.forEach((app) => {\n      if (!app.keep && !presetKeepApps.includes(app.name)) {\n        // \u4F7F\u7528trim()\u65B9\u6CD5\u79FB\u9664appName\u4E24\u7AEF\u7684\u7A7A\u767D\u7B26\n        const trimmedAppName = app.name.trim();\n        exec(`pgrep -x \"${trimmedAppName}\"`, (err, stdout, stderr) => {\n          if (err || stderr) {\n            console.error(`Failed to find ${trimmedAppName}: ${err || stderr}`);\n            return;\n          }\n          const pid = stdout.trim();\n          if (pid) {\n            exec(`kill -9 ${pid}`, (killErr, _, killStderr) => {\n              if (killErr || killStderr) {\n                console.error(`Failed to force close ${trimmedAppName}: ${killErr || killStderr}`);\n              } else {\n                console.log(`${trimmedAppName} was forced to close.`);\n              }\n            });\n          }\n        });\n      }\n    });\n    closeMainWindow();\n  };\n\n  const alwaysKeepApps = apps.filter((app) => app.always_keep);\n  const otherApps = apps.filter((app) => !app.always_keep);\n\n  return (\n    <List isLoading={isLoading}>\n      <List.Section title=\"App List\">\n        {otherApps.map((app, index) => (\n          <List.Item\n            key={`other-${index}`}\n            title={app.name}\n            icon={app.keep ? Icon.Checkmark : Icon.Circle} // \u5176\u4ED6\u5E94\u7528\u6839\u636Ekeep\u72B6\u6001\u9009\u62E9\u56FE\u6807\n            accessories={[\n              ...(app.keep ? [{ tag: { value: \"Keep\", color: Color.Orange } }] : []),\n              ...(app.always_keep ? [{ tag: { value: \"Always Keep\", color: Color.Green } }] : []), // \u5B9E\u9645\u4E0A\u8FD9\u884C\u4F1A\u59CB\u7EC8\u4E3Afalse\u5E76\u53EF\u4EE5\u79FB\u9664\n              // ...(app.keep ? [{ icon: Icon.CircleFilled }] : []),\n            ]}\n            actions={\n              <ActionPanel>\n                <Action icon={{ source: Icon.Check }} title=\"Set Keep\" onAction={() => toggleKeepApp(app.name)} />\n                <Action\n                  icon={{ source: Icon.Lock }}\n                  title=\"Set Always Keep\"\n                  onAction={() => handleToggleAlwaysKeepApp(app.name)}\n                />\n                <Action\n                  icon={{ source: Icon.XMarkCircle, tintColor: Color.Red }}\n                  title=\"Close Other Apps\"\n                  onAction={() => closeApps()}\n                />\n              </ActionPanel>\n            }\n          />\n        ))}\n      </List.Section>\n      {alwaysKeepApps.length > 0 && (\n        <List.Section title=\"Always Keep Apps\">\n          {alwaysKeepApps.map((app, index) => (\n            <List.Item\n              key={`always-${index}`}\n              title={app.name}\n              icon={Icon.Checkmark} // \u9ED8\u8BA4\u4FDD\u7559\u7684\u5E94\u7528\u4F7F\u7528Checkmark\u56FE\u6807\n              accessories={[...(app.always_keep ? [{ tag: { value: \"Always Keep\", color: Color.Red } }] : [])]}\n              actions={\n                <ActionPanel>\n                  <Action\n                    icon={{ source: Icon.LockDisabled }}\n                    title=\"Clear Always Keep\"\n                    onAction={() => handleToggleAlwaysKeepApp(app.name)}\n                  />\n                  <Action\n                    icon={{ source: Icon.XMarkCircle, tintColor: Color.Red }}\n                    title=\"Close Other Apps\"\n                    onAction={() => closeApps()}\n                  />\n                </ActionPanel>\n              }\n            />\n          ))}\n        </List.Section>\n      )}\n    </List>\n  );\n}\n"],
  "mappings": "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",
  "names": ["index_exports", "__export", "Command", "__toCommonJS", "import_react", "import_api", "import_child_process", "import_jsx_runtime", "toggleAppInPresetKeepApps", "appName", "presetKeepAppsStr", "presetKeepApps", "app", "apps", "setApps", "isLoading", "setIsLoading", "a", "b", "getPresetKeepApps", "err", "stdout", "name", "toggleKeepApp", "updatedApps", "handleToggleAlwaysKeepApp", "closeApps", "trimmedAppName", "stderr", "pid", "killErr", "_", "killStderr", "alwaysKeepApps", "otherApps", "index"]
}
