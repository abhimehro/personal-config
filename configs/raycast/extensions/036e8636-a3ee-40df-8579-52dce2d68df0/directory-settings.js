"use strict";var S=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var R=(n,r)=>{for(var o in r)S(n,o,{get:r[o],enumerable:!0})},N=(n,r,o,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of I(r))!L.call(n,s)&&s!==o&&S(n,s,{get:()=>r[s],enumerable:!(a=F(r,s))||a.enumerable});return n};var O=n=>N(S({},"__esModule",{value:!0}),n);var J={};R(J,{default:()=>E});module.exports=O(J);var e=require("@raycast/api"),h=require("react");var P=require("@raycast/api");var D=require("@raycast/api"),A=class{constructor(){this.listeners=[]}addListener(r){return D.environment.isDevelopment&&console.log("Template event listener added, total:",this.listeners.length+1),this.listeners.push(r),()=>{this.listeners=this.listeners.filter(o=>o!==r),D.environment.isDevelopment&&console.log("Template event listener removed, remaining:",this.listeners.length)}}emit(){D.environment.isDevelopment&&console.log("Template update event emitted to",this.listeners.length,"listeners"),this.listeners.forEach(r=>r())}},M=new A;var j={PROJECT_DIRECTORIES:"project_directories",PROJECT_TEMPLATES:"project_templates"},u=class{static async getDirectories(){let r=await P.LocalStorage.getItem(j.PROJECT_DIRECTORIES);if(!r)return[];try{return JSON.parse(r)}catch{return[]}}static async saveDirectories(r){await P.LocalStorage.setItem(j.PROJECT_DIRECTORIES,JSON.stringify(r))}static async addDirectory(r){let o=await this.getDirectories();o.find(s=>s.path===r.path)||(o.push(r),await this.saveDirectories(o))}static async removeDirectory(r){let a=(await this.getDirectories()).filter(s=>s.path!==r);await this.saveDirectories(a)}static async toggleDirectory(r){let o=await this.getDirectories(),a=o.find(s=>s.path===r);a&&(a.enabled=!a.enabled,await this.saveDirectories(o))}};var g=require("fs/promises"),C=require("path");async function W(n){let r=["package.json","Cargo.toml","go.mod","pom.xml","build.gradle","requirements.txt","pyproject.toml","Gemfile","composer.json",".git","Makefile","CMakeLists.txt","Dockerfile"];try{let o=await(0,g.readdir)(n);return r.some(a=>o.includes(a))}catch{return!1}}async function w(n,r,o,a=0,s=3){let l=[];if(a>s)return l;try{let f=await(0,g.readdir)(n);for(let y of f){if(y.startsWith("."))continue;let d=(0,C.join)(n,y);try{(await(0,g.stat)(d)).isDirectory()&&(await W(d)?l.push({name:y,path:d,parentDirectory:o}):r&&l.push(...await w(d,r,o,a+1,s)))}catch{continue}}}catch{}return l}var t=require("react/jsx-runtime");function E(){let[n,r]=(0,h.useState)([]),[o,a]=(0,h.useState)(!0);(0,h.useEffect)(()=>{s()},[]);async function s(){try{a(!0);let i=await u.getDirectories(),c=await Promise.all(i.map(async m=>{try{let p=await w(m.path,!!m.recursive,m.path);return{...m,projectCount:p.length}}catch{return{...m,projectCount:0,hasError:!0}}}));r(c)}catch(i){(0,e.showToast)({style:e.Toast.Style.Failure,title:"Failed to load",message:i instanceof Error?i.message:"Unknown error"})}finally{a(!1)}}async function l(i){try{await u.toggleDirectory(i),await s(),(0,e.showHUD)("Directory status updated")}catch(c){(0,e.showToast)({style:e.Toast.Style.Failure,title:"Operation failed",message:c instanceof Error?c.message:"Unknown error"})}}async function f(i){try{await u.removeDirectory(i),await s(),(0,e.showHUD)("Directory removed")}catch(c){(0,e.showToast)({style:e.Toast.Style.Failure,title:"Failed to remove",message:c instanceof Error?c.message:"Unknown error"})}}let y=i=>i.hasError?{source:e.Icon.XMarkCircle,tintColor:e.Color.Red}:{source:e.Icon.Folder,tintColor:i.enabled?e.Color.Green:e.Color.SecondaryText},d=i=>{let c=[];return i.hasError?c.push({text:"Invalid Path",icon:e.Icon.XMarkCircle}):c.push({text:`${i.projectCount||0} projects`,icon:e.Icon.Document}),i.recursive&&c.push({text:"Recursive Scan",icon:e.Icon.Layers}),c.push({text:i.enabled?"Enabled":"Disabled",icon:i.enabled?e.Icon.CheckCircle:e.Icon.XMarkCircle}),c};return(0,t.jsx)(e.List,{isLoading:o,navigationTitle:"Project Directory Settings",actions:(0,t.jsx)(e.ActionPanel,{children:(0,t.jsx)(e.Action.Push,{title:"Add New Directory",target:(0,t.jsx)(v,{onAdded:s}),icon:e.Icon.Plus,shortcut:{modifiers:["cmd"],key:"n"}})}),children:n.length===0?(0,t.jsx)(e.List.EmptyView,{icon:e.Icon.Folder,title:"No Project Directories",description:"Add a project directory to start scanning for projects",actions:(0,t.jsx)(e.ActionPanel,{children:(0,t.jsx)(e.Action.Push,{title:"Add Directory",target:(0,t.jsx)(v,{onAdded:s}),icon:e.Icon.Plus})})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.List.Section,{title:"Actions",children:(0,t.jsx)(e.List.Item,{title:"Add New Directory...",icon:e.Icon.Plus,actions:(0,t.jsx)(e.ActionPanel,{children:(0,t.jsx)(e.Action.Push,{title:"Add New Directory",target:(0,t.jsx)(v,{onAdded:s}),icon:e.Icon.Plus,shortcut:{modifiers:["cmd"],key:"n"}})})},"add-directory")}),(0,t.jsx)(e.List.Section,{title:`Configured Directories (${n.length})`,children:n.map(i=>(0,t.jsx)(e.List.Item,{title:i.name,subtitle:i.path,icon:y(i),accessories:d(i),actions:(0,t.jsxs)(e.ActionPanel,{children:[(0,t.jsx)(e.ActionPanel.Section,{title:"Directory Status",children:(0,t.jsx)(e.Action,{title:i.enabled?"Disable":"Enable",icon:i.enabled?e.Icon.XMarkCircle:e.Icon.CheckCircle,onAction:()=>l(i.path)})}),(0,t.jsxs)(e.ActionPanel.Section,{title:"File Actions",children:[(0,t.jsx)(e.Action.ShowInFinder,{title:"Show in Finder",path:i.path,icon:e.Icon.Finder}),(0,t.jsx)(e.Action.CopyToClipboard,{title:"Copy Path",content:i.path,icon:e.Icon.Clipboard})]}),(0,t.jsxs)(e.ActionPanel.Section,{title:"Management",children:[(0,t.jsx)(e.Action,{title:"Refresh",icon:e.Icon.ArrowClockwise,onAction:s,shortcut:{modifiers:["cmd"],key:"r"}}),(0,t.jsx)(e.Action.Push,{title:"Add New Directory",icon:e.Icon.Plus,target:(0,t.jsx)(v,{onAdded:s}),shortcut:{modifiers:["cmd"],key:"n"}}),(0,t.jsx)(e.Action,{title:"Remove Directory",icon:e.Icon.Trash,style:e.Action.Style.Destructive,onAction:()=>f(i.path),shortcut:{modifiers:["cmd"],key:"backspace"}})]})]})},i.path))})]})})}function v({onAdded:n}){let{pop:r}=(0,e.useNavigation)(),[o,a]=(0,h.useState)([]),[s,l]=(0,h.useState)(""),[f,y]=(0,h.useState)(!1);async function d(){if(o.length===0){(0,e.showToast)({style:e.Toast.Style.Failure,title:"Please select at least one directory"});return}try{(0,e.showToast)({style:e.Toast.Style.Animated,title:"Adding directories..."});let i=await u.getDirectories(),c=0,m=0;for(let p of o){if(i.some(k=>k.path===p))continue;let x=await w(p,f,p);m+=x.length;let T=p.split("/").pop()||p,b=s.trim()?`${s.trim()}-${T}`:T;await u.addDirectory({path:p.trim(),name:b,enabled:!0,recursive:f}),c++}c>0?(0,e.showToast)({style:e.Toast.Style.Success,title:"Successfully Added",message:`Added ${c} directories, found ${m} projects`}):(0,e.showToast)({style:e.Toast.Style.Animated,title:"All Directories Already Exist",message:"The selected directories are already in the list"}),n(),r()}catch(i){(0,e.showToast)({style:e.Toast.Style.Failure,title:"Failed to Add",message:i instanceof Error?i.message:"Unknown error"})}}return(0,t.jsxs)(e.Form,{navigationTitle:"Add Project Directory",actions:(0,t.jsx)(e.ActionPanel,{children:(0,t.jsx)(e.Action.SubmitForm,{title:"Add Directory",onSubmit:d})}),children:[(0,t.jsx)(e.Form.Description,{text:"Select the root directories containing your projects, and the extension will automatically scan them."}),(0,t.jsx)(e.Form.FilePicker,{id:"directoryPaths",title:"Select Project Directories",allowMultipleSelection:!0,canChooseDirectories:!0,canChooseFiles:!1,value:o,onChange:a,info:"You can select multiple directories, and each will be scanned."}),(0,t.jsx)(e.Form.TextField,{id:"namePrefix",title:"Display Name Prefix",placeholder:"Work Projects",value:s,onChange:l,info:"An optional prefix to distinguish directories from different sources."}),(0,t.jsx)(e.Form.Checkbox,{id:"recursive",title:"Recursive Scan",label:"Scan all subdirectories for projects",value:f,onChange:y,info:"When enabled, all levels of subdirectories will be scanned, which may increase scan time."}),(0,t.jsx)(e.Form.Description,{text:`Selected ${o.length} directories`}),o.length>0&&(0,t.jsx)(e.Form.Description,{text:`Directory list:
${o.map(i=>`\u2022 ${i}`).join(`
`)}`})]})}
