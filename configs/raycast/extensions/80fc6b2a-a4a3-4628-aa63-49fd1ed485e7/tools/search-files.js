"use strict";var h=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var L=(t,e)=>{for(var r in e)h(t,r,{get:e[r],enumerable:!0})},R=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of x(e))!y.call(t,s)&&s!==r&&h(t,s,{get:()=>e[s],enumerable:!(o=v(e,s))||o.enumerable});return t};var W=t=>R(h({},"__esModule",{value:!0}),t);var z={};L(z,{default:()=>C});module.exports=W(z);var E=require("node:fs/promises"),f=require("node:path");var k=require("@raycast/api"),a=require("node:path"),d=()=>{let t=(0,k.getPreferenceValues)();if(!t.workspaceRoot)throw new Error("Workspace root directory is not configured. Please set it in the extension preferences.");return(0,a.resolve)(t.workspaceRoot)};var P=t=>{if(!t)throw new Error("Path is required");let e=d(),r=(0,a.resolve)(e,t),o=(0,a.resolve)(e),s=(0,a.resolve)(r),n=(0,a.relative)(o,s);if(n.startsWith("..")||n==="..")throw new Error(`Path "${t}" is outside the configured workspace root "${e}". All file operations must be within the workspace root directory.`);return s};async function b(t,e,r){let o=[],s=e.toLowerCase();try{let n=await(0,E.readdir)(t,{withFileTypes:!0});for(let i of n){let l=(0,f.join)(t,i.name);if(i.isDirectory()){if(["node_modules",".git",".next",".vscode","dist","build"].includes(i.name))continue;let p=await b(l,e,r);o.push(...p)}let u=i.name.toLowerCase();if(A(u,s)){let c=(0,f.relative)(r,l);o.push(c)}}}catch(n){console.error(`Error reading directory ${t}:`,n)}return o}function A(t,e){if(t.includes(e))return!0;let r=0;for(let o=0;o<t.length&&r<e.length;o++)t[o]===e[r]&&r++;return r===e.length}async function C({query:t,path:e="."}){if(!t||t.trim()==="")throw new Error("Search query is required");let r=d(),o=P(e),s=await b(o,t,r);return s.sort((n,i)=>{let l=n.split("/").pop()?.toLowerCase()||"",u=i.split("/").pop()?.toLowerCase()||"",c=t.toLowerCase(),p=l===c?0:1,w=u===c?0:1;if(p!==w)return p-w;let m=l.startsWith(c)?0:1,g=u.startsWith(c)?0:1;return m!==g?m-g:n.length-i.length}),s}
