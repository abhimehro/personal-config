"use strict";var u=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var $=(t,e)=>{for(var n in e)u(t,n,{get:e[n],enumerable:!0})},b=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of O(e))!R.call(t,o)&&o!==n&&u(t,o,{get:()=>e[o],enumerable:!(r=E(e,o))||r.enumerable});return t};var _=t=>b(u({},"__esModule",{value:!0}),t);var I={};$(I,{confirmation:()=>T,default:()=>W});module.exports=_(I);var S=require("node:child_process"),A=require("node:util");var f=require("@raycast/api"),l=require("node:path"),g=()=>{let t=(0,f.getPreferenceValues)();if(!t.workspaceRoot)throw new Error("Workspace root directory is not configured. Please set it in the extension preferences.");return(0,l.resolve)(t.workspaceRoot)},m=()=>(0,f.getPreferenceValues)().autoEdit===!0;var x=(0,A.promisify)(S.execFile),y=["status","diff","log","branch","show"],P=new Set(["list","show"]),w=new Set(["--force","--force-with-lease","--hard","--delete","-D"]),C={push:new Set(["-f"]),clean:new Set(["-f","-d"]),branch:new Set(["-D"])},d=1e4,D=3e4;function p(t){let e=[],n="",r=null;for(let o=0;o<t.length;o++){let s=t[o];r?s===r?(e.push(n),n="",r=null):n+=s:s==='"'||s==="'"?(n&&(e.push(n),n=""),r=s):/\s/.test(s)?n&&(e.push(n),n=""):n+=s}return n&&e.push(n),e}function G(t){let e=t.indexOf("=");return e!==-1?t.slice(0,e):t}function F(t){return t.startsWith("-")&&!t.startsWith("--")&&t.length>2?t.slice(1).split("").map(e=>`-${e}`):[t]}function k(t,e){let n=p(e),r=C[t]||new Set;for(let o of n){if(!o.startsWith("-"))continue;if(o.startsWith("--")){let i=G(o).toLowerCase();if(w.has(i))return i;continue}let s=F(o);for(let i of s){if(w.has(i))return i;if(r.has(i))return`${i} (in git ${t})`}}return null}function v(t,e){if(y.includes(t))return!0;if(t==="stash"){let r=p(e)[0];return r===void 0?!1:P.has(r)}return!1}function h(t,e){return t.length<=e?t:t.slice(0,e)+`
... (truncated, ${t.length-e} more characters)`}async function T({subcommand:t,args:e=""}){let n=k(t,e);if(n)throw new Error(`Dangerous git operation detected: "${n}". This operation is blocked for safety. Please use the git CLI directly if you really need this.`);return v(t,e)||m()?void 0:{message:"Execute git command?",info:[{name:"Command",value:`git ${t}${e?` ${e}`:""}`}]}}async function W({subcommand:t,args:e=""}){let n=["status","diff","log","add","commit","branch","show","stash","checkout","pull","fetch"];if(!n.includes(t))throw new Error(`Invalid git subcommand: "${t}". Allowed commands: ${n.join(", ")}`);let r=k(t,e);if(r)throw new Error(`Dangerous git operation blocked: "${r}"`);let o=g(),s=`git ${t}${e?` ${e}`:""}`,i=[t,...p(e)];try{let{stdout:a,stderr:c}=await x("git",i,{cwd:o,timeout:D,maxBuffer:5242880,env:{...process.env,GIT_PAGER:"",FORCE_COLOR:"0",NO_COLOR:"1"}});return{success:!0,command:s,output:h(a||c,d)}}catch(a){let c=a;return{success:!1,command:s,exitCode:c.code||1,output:h(c.stdout||"",d),error:h(c.stderr||c.message||"Unknown error",d)}}}0&&(module.exports={confirmation});
