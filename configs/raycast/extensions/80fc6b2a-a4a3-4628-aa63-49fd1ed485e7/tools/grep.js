"use strict";var u=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var S=(e,t)=>{for(var o in t)u(e,o,{get:t[o],enumerable:!0})},M=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of A(t))!I.call(e,n)&&n!==o&&u(e,n,{get:()=>t[n],enumerable:!(r=R(t,n))||r.enumerable});return e};var _=e=>M(u({},"__esModule",{value:!0}),e);var j={};S(j,{default:()=>T});module.exports=_(j);var l=require("node:fs/promises"),s=require("node:path");var x=require("@raycast/api"),i=require("node:path"),g=()=>{let e=(0,x.getPreferenceValues)();if(!e.workspaceRoot)throw new Error("Workspace root directory is not configured. Please set it in the extension preferences.");return(0,i.resolve)(e.workspaceRoot)};var E=e=>{if(!e)throw new Error("Path is required");let t=g(),o=(0,i.resolve)(t,e),r=(0,i.resolve)(t),n=(0,i.resolve)(o),c=(0,i.relative)(r,n);if(c.startsWith("..")||c==="..")throw new Error(`Path "${e}" is outside the configured workspace root "${t}". All file operations must be within the workspace root directory.`);return n};var $=["node_modules",".git","dist","build",".next",".cache",".vscode","coverage"],d=100,z=200,N=[".png",".jpg",".jpeg",".gif",".ico",".svg",".webp",".woff",".woff2",".ttf",".eot",".otf",".pdf",".zip",".tar",".gz",".7z",".rar",".exe",".dll",".so",".dylib",".mp3",".mp4",".avi",".mov",".mkv",".db",".sqlite",".lock"];function W(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function b(e,t){if(t.includes("{")&&t.includes("}")){let r=t.match(/\{([^}]+)\}/);if(r)return r[1].split(",").some(c=>{let f=t.replace(r[0],c.trim());return b(e,f)})}let o=t.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${o}$`,"i").test(e)}function F(e){let t=(0,s.extname)(e).toLowerCase();return N.includes(t)}async function*k(e){try{let t=await(0,l.readdir)(e,{withFileTypes:!0});for(let o of t){if($.includes(o.name))continue;let r=(0,s.join)(e,o.name);o.isDirectory()?yield*k(r):o.isFile()&&!F(o.name)&&(yield r)}}catch{}}async function T({query:e,path:t=".",glob:o,caseSensitive:r=!1}){if(!e||e.trim()==="")throw new Error("Search query is required");let n=g(),c=E(t),f=r?"g":"gi",P=W(e),h=new RegExp(P,f),a=[],m=0;for await(let p of k(c)){if(o){let w=(0,s.basename)(p);if(!b(w,o))continue}if(a.length>=d)break;m++;try{(await(0,l.readFile)(p,"utf8")).split(`
`).forEach((y,v)=>{h.lastIndex=0,h.test(y)&&a.length<d&&a.push({file:(0,s.relative)(n,p),line:v+1,content:y.trim().slice(0,z)})})}catch{}}return{matches:a,totalMatches:a.length,filesSearched:m,truncated:a.length>=d}}
