{
  "version": 3,
  "sources": ["../../src/tools/apply-edit.ts", "../../src/utils/workspace.ts"],
  "sourcesContent": ["import { readFile, writeFile } from \"node:fs/promises\";\nimport { resolveAndValidatePath, isAutoEditEnabled } from \"../utils/workspace\";\n\ntype Input = {\n  /**\n   * The relative path to the file from the workspace root\n   */\n  path: string;\n  /**\n   * The original text to be replaced (must match exactly)\n   */\n  oldText: string;\n  /**\n   * The new text to replace with\n   */\n  newText: string;\n  /**\n   * Optional: Whether to replace all occurrences (default: false, only replaces first occurrence)\n   */\n  replaceAll?: boolean;\n};\n\nexport async function confirmation({ path, oldText, newText, replaceAll = false }: Input) {\n  if (isAutoEditEnabled()) {\n    return undefined;\n  }\n\n  const filePath = resolveAndValidatePath(path);\n  const content = await readFile(filePath, \"utf8\");\n\n  // Check if the old text exists in the file\n  if (!content.includes(oldText)) {\n    throw new Error(`Could not find the specified text in the file: \"${oldText.substring(0, 50)}...\"`);\n  }\n\n  // Count occurrences\n  const occurrences = content.split(oldText).length - 1;\n  const willReplace = replaceAll ? occurrences : 1;\n\n  // Truncate text for display\n  const truncate = (text: string, maxLength = 100) => {\n    if (text.length <= maxLength) return text;\n    return text.substring(0, maxLength) + \"...\";\n  };\n\n  return {\n    message: `Are you sure you want to replace text in ${path}?`,\n    info: [\n      { name: \"File Path\", value: path },\n      { name: \"Replace Mode\", value: replaceAll ? `Replace All (${occurrences} occurrences)` : \"Replace First Only\" },\n      { name: \"Will Replace\", value: `${willReplace} occurrence${willReplace > 1 ? \"s\" : \"\"}` },\n      { name: \"Old Text\", value: truncate(oldText) },\n      { name: \"New Text\", value: truncate(newText) },\n    ],\n  };\n}\n\nexport default async function ({ path, oldText, newText, replaceAll = false }: Input) {\n  if (!oldText) {\n    throw new Error(\"oldText is required\");\n  }\n\n  const filePath = resolveAndValidatePath(path);\n  const content = await readFile(filePath, \"utf8\");\n\n  // Check if the old text exists in the file\n  if (!content.includes(oldText)) {\n    throw new Error(`Could not find the specified text in the file: \"${oldText.substring(0, 50)}...\"`);\n  }\n\n  // Perform the replacement\n  let updatedContent: string;\n  if (replaceAll) {\n    // Replace all occurrences\n    updatedContent = content.split(oldText).join(newText);\n  } else {\n    // Replace only the first occurrence\n    const index = content.indexOf(oldText);\n    updatedContent = content.substring(0, index) + newText + content.substring(index + oldText.length);\n  }\n\n  // Write the updated content back to the file\n  await writeFile(filePath, updatedContent, \"utf8\");\n\n  return {\n    success: true,\n    message: `Successfully applied edit to ${path}`,\n    replacedOccurrences: replaceAll ? content.split(oldText).length - 1 : 1,\n  };\n}\n", "import { getPreferenceValues } from \"@raycast/api\";\nimport { resolve, relative } from \"node:path\";\n\nexport const getWorkspaceRoot = () => {\n  const preferences = getPreferenceValues<Preferences>();\n\n  if (!preferences.workspaceRoot) {\n    throw new Error(\"Workspace root directory is not configured. Please set it in the extension preferences.\");\n  }\n\n  return resolve(preferences.workspaceRoot);\n};\n\nexport const isAutoEditEnabled = () => {\n  const preferences = getPreferenceValues<Preferences>();\n  return preferences.autoEdit === true;\n};\n\nexport const resolveAndValidatePath = (userPath: string) => {\n  if (!userPath) {\n    throw new Error(\"Path is required\");\n  }\n\n  const workspaceRoot = getWorkspaceRoot();\n\n  const absolutePath = resolve(workspaceRoot, userPath);\n\n  const normalizedWorkspaceRoot = resolve(workspaceRoot);\n  const normalizedAbsolutePath = resolve(absolutePath);\n\n  const relativePath = relative(normalizedWorkspaceRoot, normalizedAbsolutePath);\n\n  if (relativePath.startsWith(\"..\") || relativePath === \"..\") {\n    throw new Error(\n      `Path \"${userPath}\" is outside the configured workspace root \"${workspaceRoot}\". ` +\n        \"All file operations must be within the workspace root directory.\",\n    );\n  }\n\n  return normalizedAbsolutePath;\n};\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,kBAAAE,EAAA,YAAAC,IAAA,eAAAC,EAAAJ,GAAA,IAAAK,EAAoC,4BCApC,IAAAC,EAAoC,wBACpCC,EAAkC,qBAErBC,EAAmB,IAAM,CACpC,IAAMC,KAAc,uBAAiC,EAErD,GAAI,CAACA,EAAY,cACf,MAAM,IAAI,MAAM,yFAAyF,EAG3G,SAAO,WAAQA,EAAY,aAAa,CAC1C,EAEaC,EAAoB,OACX,uBAAiC,EAClC,WAAa,GAGrBC,EAA0BC,GAAqB,CAC1D,GAAI,CAACA,EACH,MAAM,IAAI,MAAM,kBAAkB,EAGpC,IAAMC,EAAgBL,EAAiB,EAEjCM,KAAe,WAAQD,EAAeD,CAAQ,EAE9CG,KAA0B,WAAQF,CAAa,EAC/CG,KAAyB,WAAQF,CAAY,EAE7CG,KAAe,YAASF,EAAyBC,CAAsB,EAE7E,GAAIC,EAAa,WAAW,IAAI,GAAKA,IAAiB,KACpD,MAAM,IAAI,MACR,SAASL,CAAQ,+CAA+CC,CAAa,qEAE/E,EAGF,OAAOG,CACT,EDlBA,eAAsBE,EAAa,CAAE,KAAAC,EAAM,QAAAC,EAAS,QAAAC,EAAS,WAAAC,EAAa,EAAM,EAAU,CACxF,GAAIC,EAAkB,EACpB,OAGF,IAAMC,EAAWC,EAAuBN,CAAI,EACtCO,EAAU,QAAM,YAASF,EAAU,MAAM,EAG/C,GAAI,CAACE,EAAQ,SAASN,CAAO,EAC3B,MAAM,IAAI,MAAM,mDAAmDA,EAAQ,UAAU,EAAG,EAAE,CAAC,MAAM,EAInG,IAAMO,EAAcD,EAAQ,MAAMN,CAAO,EAAE,OAAS,EAC9CQ,EAAcN,EAAaK,EAAc,EAGzCE,EAAW,CAACC,EAAcC,EAAY,MACtCD,EAAK,QAAUC,EAAkBD,EAC9BA,EAAK,UAAU,EAAGC,CAAS,EAAI,MAGxC,MAAO,CACL,QAAS,4CAA4CZ,CAAI,IACzD,KAAM,CACJ,CAAE,KAAM,YAAa,MAAOA,CAAK,EACjC,CAAE,KAAM,eAAgB,MAAOG,EAAa,gBAAgBK,CAAW,gBAAkB,oBAAqB,EAC9G,CAAE,KAAM,eAAgB,MAAO,GAAGC,CAAW,cAAcA,EAAc,EAAI,IAAM,EAAE,EAAG,EACxF,CAAE,KAAM,WAAY,MAAOC,EAAST,CAAO,CAAE,EAC7C,CAAE,KAAM,WAAY,MAAOS,EAASR,CAAO,CAAE,CAC/C,CACF,CACF,CAEA,eAAOW,EAAwB,CAAE,KAAAb,EAAM,QAAAC,EAAS,QAAAC,EAAS,WAAAC,EAAa,EAAM,EAAU,CACpF,GAAI,CAACF,EACH,MAAM,IAAI,MAAM,qBAAqB,EAGvC,IAAMI,EAAWC,EAAuBN,CAAI,EACtCO,EAAU,QAAM,YAASF,EAAU,MAAM,EAG/C,GAAI,CAACE,EAAQ,SAASN,CAAO,EAC3B,MAAM,IAAI,MAAM,mDAAmDA,EAAQ,UAAU,EAAG,EAAE,CAAC,MAAM,EAInG,IAAIa,EACJ,GAAIX,EAEFW,EAAiBP,EAAQ,MAAMN,CAAO,EAAE,KAAKC,CAAO,MAC/C,CAEL,IAAMa,EAAQR,EAAQ,QAAQN,CAAO,EACrCa,EAAiBP,EAAQ,UAAU,EAAGQ,CAAK,EAAIb,EAAUK,EAAQ,UAAUQ,EAAQd,EAAQ,MAAM,CACnG,CAGA,eAAM,aAAUI,EAAUS,EAAgB,MAAM,EAEzC,CACL,QAAS,GACT,QAAS,gCAAgCd,CAAI,GAC7C,oBAAqBG,EAAaI,EAAQ,MAAMN,CAAO,EAAE,OAAS,EAAI,CACxE,CACF",
  "names": ["apply_edit_exports", "__export", "confirmation", "apply_edit_default", "__toCommonJS", "import_promises", "import_api", "import_node_path", "getWorkspaceRoot", "preferences", "isAutoEditEnabled", "resolveAndValidatePath", "userPath", "workspaceRoot", "absolutePath", "normalizedWorkspaceRoot", "normalizedAbsolutePath", "relativePath", "confirmation", "path", "oldText", "newText", "replaceAll", "isAutoEditEnabled", "filePath", "resolveAndValidatePath", "content", "occurrences", "willReplace", "truncate", "text", "maxLength", "apply_edit_default", "updatedContent", "index"]
}
