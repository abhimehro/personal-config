"use strict";var p=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var w=Object.prototype.hasOwnProperty;var P=(t,n)=>{for(var a in n)p(t,a,{get:n[a],enumerable:!0})},k=(t,n,a,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let s of v(n))!w.call(t,s)&&s!==a&&p(t,s,{get:()=>n[s],enumerable:!(i=T(n,s))||i.enumerable});return t};var C=t=>k(p({},"__esModule",{value:!0}),t);var $={};P($,{default:()=>y});module.exports=C($);var e=require("@raycast/api"),u=require("react");var o=require("@raycast/api");var h="http://localhost:3049",m=1e3;var d=(t,n="info")=>{console.log(`[TIDAL] [${n.toUpperCase()}] ${t}`)},f=()=>{let{localApiAuthToken:t}=(0,o.getPreferenceValues)();if(!t){let n="Auth token not found in Raycast preferences.";throw d(n,"error"),new Error(n)}return{"Content-Type":"application/json",Authorization:`Bearer ${t}`}},g=async()=>{try{let t=await fetch(`${h}/current-track`,{headers:f(),signal:AbortSignal.timeout(m)});if(t.ok){let n=await t.json();return"status"in n&&n.status==="no-data"?null:n}return(t.status===401||t.status===403)&&d("Authentication failed when getting current track.","error"),null}catch(t){return d(`Failed to get current track: ${t}`,"error"),null}},S=async(t,n)=>{if(n&&n!=="connected")return(0,o.showToast)({style:o.Toast.Style.Failure,title:"Not Connected",message:"Server connection lost"}),!1;try{let a=await fetch(`${h}/send-command`,{method:"POST",headers:f(),body:JSON.stringify({action:t}),signal:AbortSignal.timeout(m)});if(a.ok)return d(`Command sent: ${t}`),!0;{let i=await a.text();throw new Error(`Command failed: ${a.status} - ${i}`)}}catch(a){return d(`Command error: ${a}`,"error"),(0,o.showToast)({style:o.Toast.Style.Failure,title:"Command Failed",message:String(a)}),!1}};var r=require("react/jsx-runtime");function y(){let[t,n]=(0,u.useState)(null),[a,i]=(0,u.useState)(!0),s=async()=>{let l=await g();n(l),i(!1)},c=async l=>{await S(l),setTimeout(s,2e3)};return(0,u.useEffect)(()=>{s();let l=setInterval(s,2e3);return()=>clearInterval(l)},[]),a?(0,r.jsx)(e.List,{isLoading:!0}):t?(0,r.jsxs)(e.List,{children:[(0,r.jsxs)(e.List.Section,{title:"Current Track",children:[(0,r.jsx)(e.List.Item,{title:t.title,subtitle:`by ${t.artist}`,icon:{source:t.isLiked?e.Icon.Heart:e.Icon.Music,tintColor:t.isLiked?e.Color.Red:e.Color.Blue},accessories:[{text:t.isPlaying?"Playing":"Paused"},{icon:{source:t.isPlaying?e.Icon.Play:e.Icon.Pause,tintColor:t.isPlaying?e.Color.Green:e.Color.Orange}}],actions:(0,r.jsxs)(e.ActionPanel,{children:[(0,r.jsx)(e.Action,{title:t.isPlaying?"Pause":"Play",onAction:()=>c(t.isPlaying?"pause":"play"),icon:t.isPlaying?e.Icon.Pause:e.Icon.Play}),(0,r.jsx)(e.Action,{title:"Previous",onAction:()=>c("previous"),icon:e.Icon.Rewind}),(0,r.jsx)(e.Action,{title:"Next",onAction:()=>c("next"),icon:e.Icon.Forward})]})}),(0,r.jsx)(e.List.Item,{title:"Duration",subtitle:`${t.currentTime} / ${t.duration}`,icon:{source:e.Icon.Clock,tintColor:e.Color.Blue}}),t.playingFrom&&(0,r.jsx)(e.List.Item,{title:"Playing From",subtitle:t.playingFrom,icon:{source:e.Icon.List,tintColor:e.Color.Purple}})]}),(0,r.jsxs)(e.List.Section,{title:"Controls",children:[(0,r.jsx)(e.List.Item,{title:t.isLiked?"Unlike":"Like",icon:{source:t.isLiked?e.Icon.HeartDisabled:e.Icon.Heart,tintColor:e.Color.Red},actions:(0,r.jsx)(e.ActionPanel,{children:(0,r.jsx)(e.Action,{title:t.isLiked?"Unlike":"Like",onAction:()=>c("toggleLike")})})}),(0,r.jsx)(e.List.Item,{title:`Shuffle: ${t.isShuffled?"On":"Off"}`,icon:{source:e.Icon.Shuffle,tintColor:t.isShuffled?e.Color.Green:e.Color.SecondaryText},actions:(0,r.jsx)(e.ActionPanel,{children:(0,r.jsx)(e.Action,{title:"Toggle Shuffle",onAction:()=>c("toggleShuffle")})})}),(0,r.jsx)(e.List.Item,{title:`Repeat: ${t.repeatMode.charAt(0).toUpperCase()+t.repeatMode.slice(1)}`,icon:{source:e.Icon.Repeat,tintColor:t.repeatMode!=="off"?e.Color.Green:e.Color.SecondaryText},actions:(0,r.jsx)(e.ActionPanel,{children:(0,r.jsx)(e.Action,{title:"Toggle Repeat",onAction:()=>c("toggleRepeat")})})})]})]}):(0,r.jsx)(e.List,{children:(0,r.jsx)(e.List.Item,{title:"No Track Playing",subtitle:"Open Tidal and start playing music",icon:{source:e.Icon.Music,tintColor:e.Color.Orange}})})}
