"use strict";var i=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var y=(e,t)=>{for(var n in t)i(e,n,{get:t[n],enumerable:!0})},v=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of g(t))!S.call(e,a)&&a!==n&&i(e,a,{get:()=>t[a],enumerable:!(o=f(t,a))||o.enumerable});return e};var w=e=>v(i({},"__esModule",{value:!0}),e);var T={};y(T,{default:()=>m});module.exports=w(T);var c=require("@raycast/api");var r=require("@raycast/api");var l="http://localhost:3049",d=1e3;var s=(e,t="info")=>{console.log(`[TIDAL] [${t.toUpperCase()}] ${e}`)},u=()=>{let{localApiAuthToken:e}=(0,r.getPreferenceValues)();if(!e){let t="Auth token not found in Raycast preferences.";throw s(t,"error"),new Error(t)}return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}},p=async()=>{try{let e=await fetch(`${l}/current-track`,{headers:u(),signal:AbortSignal.timeout(d)});if(e.ok){let t=await e.json();return"status"in t&&t.status==="no-data"?null:t}return(e.status===401||e.status===403)&&s("Authentication failed when getting current track.","error"),null}catch(e){return s(`Failed to get current track: ${e}`,"error"),null}},h=async(e,t)=>{if(t&&t!=="connected")return(0,r.showToast)({style:r.Toast.Style.Failure,title:"Not Connected",message:"Server connection lost"}),!1;try{let n=await fetch(`${l}/send-command`,{method:"POST",headers:u(),body:JSON.stringify({action:e}),signal:AbortSignal.timeout(d)});if(n.ok)return s(`Command sent: ${e}`),!0;{let o=await n.text();throw new Error(`Command failed: ${n.status} - ${o}`)}}catch(n){return s(`Command error: ${n}`,"error"),(0,r.showToast)({style:r.Toast.Style.Failure,title:"Command Failed",message:String(n)}),!1}};async function m(){let e=await p();if(await h("toggleRepeat")){let n=e?.repeatMode??"off",a={off:"All",all:"One",one:"Off"}[n.toLowerCase()]||"Off";await(0,c.showHUD)(`\u{1F501} Repeat: ${a}`)}else await(0,c.showHUD)("\u274C Failed to toggle repeat")}
