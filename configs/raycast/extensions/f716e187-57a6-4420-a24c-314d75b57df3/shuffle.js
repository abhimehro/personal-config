"use strict";var i=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var S=Object.prototype.hasOwnProperty;var y=(e,t)=>{for(var n in t)i(e,n,{get:t[n],enumerable:!0})},w=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of g(t))!S.call(e,o)&&o!==n&&i(e,o,{get:()=>t[o],enumerable:!(a=f(t,o))||a.enumerable});return e};var v=e=>w(i({},"__esModule",{value:!0}),e);var T={};y(T,{default:()=>m});module.exports=v(T);var c=require("@raycast/api");var r=require("@raycast/api");var l="http://localhost:3049",d=1e3;var s=(e,t="info")=>{console.log(`[TIDAL] [${t.toUpperCase()}] ${e}`)},u=()=>{let{localApiAuthToken:e}=(0,r.getPreferenceValues)();if(!e){let t="Auth token not found in Raycast preferences.";throw s(t,"error"),new Error(t)}return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}},p=async()=>{try{let e=await fetch(`${l}/current-track`,{headers:u(),signal:AbortSignal.timeout(d)});if(e.ok){let t=await e.json();return"status"in t&&t.status==="no-data"?null:t}return(e.status===401||e.status===403)&&s("Authentication failed when getting current track.","error"),null}catch(e){return s(`Failed to get current track: ${e}`,"error"),null}},h=async(e,t)=>{if(t&&t!=="connected")return(0,r.showToast)({style:r.Toast.Style.Failure,title:"Not Connected",message:"Server connection lost"}),!1;try{let n=await fetch(`${l}/send-command`,{method:"POST",headers:u(),body:JSON.stringify({action:e}),signal:AbortSignal.timeout(d)});if(n.ok)return s(`Command sent: ${e}`),!0;{let a=await n.text();throw new Error(`Command failed: ${n.status} - ${a}`)}}catch(n){return s(`Command error: ${n}`,"error"),(0,r.showToast)({style:r.Toast.Style.Failure,title:"Command Failed",message:String(n)}),!1}};async function m(){if(await h("toggleShuffle")){await new Promise(a=>setTimeout(a,200));let n=(await p())?.isShuffled?"Off":"On";await(0,c.showHUD)(`\u{1F500} Shuffle: ${n}`)}else await(0,c.showHUD)("\u274C Failed to toggle shuffle")}
