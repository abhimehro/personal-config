{
  "version": 3,
  "sources": ["../src/now-playing.ts", "../src/util/fn.ts", "../node_modules/run-applescript/index.js"],
  "sourcesContent": ["import { closeMainWindow } from \"@raycast/api\";\n\nimport { runTidalCommand, showMessage, getNowPlaying } from \"./util/fn\";\n\nexport default async function showNowPlaying() {\n  await runTidalCommand(async () => {\n    await closeMainWindow();\n\n    // Get the window title from AppleScript\n    const nowPlayingFull: string = (await getNowPlaying()).full;\n\n    nowPlayingFull !== null && nowPlayingFull !== \"TIDAL\"\n      ? showMessage(nowPlayingFull)\n      : showMessage(\"Now Playing is Not Available - Open Tidal\");\n  });\n}\n", "import { showHUD } from \"@raycast/api\";\nimport { runAppleScript } from \"run-applescript\";\nimport { getPreferenceValues } from \"@raycast/api\";\nimport { LanguageCode, getMenuOptionsByLanguage, MenuOptions } from \"./lang\";\n\nexport async function checkTidalRunning(options?: { silent?: boolean }): Promise<boolean> {\n  try {\n    const res = await runAppleScript(`\n        tell application \"System Events\"\n          if exists (processes where name is \"TIDAL\") then\n            return \"true\"\n          else\n            return \"false\"\n          end if\n        end tell\n      `);\n    const isRunning = res.trim().toLowerCase() === \"true\";\n    if (!isRunning && !options?.silent) {\n      await showHUD(\"Tidal: Not running \u274C\");\n    }\n    return isRunning;\n  } catch (error) {\n    console.error(\"Error checking if Tidal is running:\", error);\n    if (!options?.silent) {\n      await showHUD(\"Tidal: Error checking if running \u274C\");\n    }\n    return false;\n  }\n}\n\nexport async function runTidalCommand(fn: () => Promise<void>, options?: { silent?: boolean }): Promise<void> {\n  const tidalRunning = await checkTidalRunning(options);\n  if (tidalRunning) {\n    try {\n      await fn();\n    } catch (err) {\n      console.error(\"Error running Tidal command:\", err);\n      await showHUD(\"Tidal: Error running command! \u274C\\nDid you choose the right language in your settings?\");\n    }\n  }\n}\n\ninterface Preferences {\n  showMessages: boolean;\n  language: LanguageCode;\n}\n\nexport function getPreferences(): Preferences {\n  return getPreferenceValues<Preferences>();\n}\n\nexport function getMenuOptions(): MenuOptions {\n  return getMenuOptionsByLanguage(getPreferences().language);\n}\n\nexport function showMessage(message: string) {\n  if (getPreferences().showMessages) {\n    showHUD(message);\n  }\n}\n\nexport async function getNowPlaying(): Promise<{ full: string; formatted: string; short: string }> {\n  /*\n    This script hits an error when it can't get the name of the window --\n    this is often due to the window being (closed as opposed to being minimized)\n    since we have to use AS to get the data & can only access what is available,\n    there is no clear workaround for this use case.\n\n    I return \"TIDAL\" (the default window name) and handle it the same as if it were\n    paused or closed.\n   */\n  const songInfo = await runAppleScript(`\n      tell application \"System Events\"\n        try\n        tell process \"TIDAL\"\n          set windowTitle to name of window 1\n          return windowTitle\n        end tell\n        on error\n          return \"TIDAL\"\n        end try\n      end tell`);\n  // the full single line song info\n  const full = songInfo;\n  // formatted returns a newline (\\n) after the first space after the 40ch\n  const formatted = songInfo.replace(/(.{40}\\S*?)(\\s+|$)/g, \"$1\\n\");\n  // get and set the short title -- trimmed to the first 20ch\n  const short = songInfo.length > 20 ? songInfo.slice(0, 20) + \"...\" : songInfo;\n\n  return { full, formatted, short };\n}\n", "import process from 'node:process';\nimport {promisify} from 'node:util';\nimport {execFile, execFileSync} from 'node:child_process';\n\nconst execFileAsync = promisify(execFile);\n\nexport async function runAppleScript(script, {humanReadableOutput = true} = {}) {\n\tif (process.platform !== 'darwin') {\n\t\tthrow new Error('macOS only');\n\t}\n\n\tconst outputArguments = humanReadableOutput ? [] : ['-ss'];\n\n\tconst {stdout} = await execFileAsync('osascript', ['-e', script, outputArguments]);\n\treturn stdout.trim();\n}\n\nexport function runAppleScriptSync(script, {humanReadableOutput = true} = {}) {\n\tif (process.platform !== 'darwin') {\n\t\tthrow new Error('macOS only');\n\t}\n\n\tconst outputArguments = humanReadableOutput ? [] : ['-ss'];\n\n\tconst stdout = execFileSync('osascript', ['-e', script, ...outputArguments], {\n\t\tencoding: 'utf8',\n\t\tstdio: ['ignore', 'pipe', 'ignore'],\n\t\ttimeout: 500,\n\t});\n\n\treturn stdout.trim();\n}\n"],
  "mappings": "0jBAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAAgC,wBCAhC,IAAAC,EAAwB,wBCAxB,IAAAC,EAAoB,6BACpBC,EAAwB,qBACxBC,EAAqC,8BAE/BC,KAAgB,aAAU,UAAQ,EAExC,eAAsBC,EAAeC,EAAQ,CAAC,oBAAAC,EAAsB,EAAI,EAAI,CAAC,EAAG,CAC/E,GAAI,EAAAC,QAAQ,WAAa,SACxB,MAAM,IAAI,MAAM,YAAY,EAG7B,IAAMC,EAAkBF,EAAsB,CAAC,EAAI,CAAC,KAAK,EAEnD,CAAC,OAAAG,CAAM,EAAI,MAAMN,EAAc,YAAa,CAAC,KAAME,EAAQG,CAAe,CAAC,EACjF,OAAOC,EAAO,KAAK,CACpB,CDbA,IAAAC,EAAoC,wBAGpC,eAAsBC,EAAkBC,EAAkD,CACxF,GAAI,CAUF,IAAMC,GATM,MAAMC,EAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAQ9B,GACmB,KAAK,EAAE,YAAY,IAAM,OAC/C,MAAI,CAACD,GAAa,CAACD,GAAS,QAC1B,QAAM,WAAQ,2BAAsB,EAE/BC,CACT,OAASE,EAAO,CACd,eAAQ,MAAM,sCAAuCA,CAAK,EACrDH,GAAS,QACZ,QAAM,WAAQ,yCAAoC,EAE7C,EACT,CACF,CAEA,eAAsBI,EAAgBC,EAAyBL,EAA+C,CAE5G,GADqB,MAAMD,EAAkBC,CAAO,EAElD,GAAI,CACF,MAAMK,EAAG,CACX,OAASC,EAAK,CACZ,QAAQ,MAAM,+BAAgCA,CAAG,EACjD,QAAM,WAAQ;AAAA,oDAAsF,CACtG,CAEJ,CAOO,SAASC,GAA8B,CAC5C,SAAO,uBAAiC,CAC1C,CAMO,SAASC,EAAYC,EAAiB,CACvCC,EAAe,EAAE,iBACnB,WAAQD,CAAO,CAEnB,CAEA,eAAsBE,GAA6E,CAUjG,IAAMC,EAAW,MAAMC,EAAe;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAUzB,EAEPC,EAAOF,EAEPG,EAAYH,EAAS,QAAQ,sBAAuB;AAAA,CAAM,EAE1DI,EAAQJ,EAAS,OAAS,GAAKA,EAAS,MAAM,EAAG,EAAE,EAAI,MAAQA,EAErE,MAAO,CAAE,KAAAE,EAAM,UAAAC,EAAW,MAAAC,CAAM,CAClC,CDtFA,eAAOC,GAAwC,CAC7C,MAAMC,EAAgB,SAAY,CAChC,QAAM,mBAAgB,EAGtB,IAAMC,GAA0B,MAAMC,EAAc,GAAG,KAEvDD,IAAmB,MAAQA,IAAmB,QAC1CE,EAAYF,CAAc,EAC1BE,EAAY,2CAA2C,CAC7D,CAAC,CACH",
  "names": ["now_playing_exports", "__export", "showNowPlaying", "__toCommonJS", "import_api", "import_api", "import_node_process", "import_node_util", "import_node_child_process", "execFileAsync", "runAppleScript", "script", "humanReadableOutput", "process", "outputArguments", "stdout", "import_api", "checkTidalRunning", "options", "isRunning", "runAppleScript", "error", "runTidalCommand", "fn", "err", "getPreferences", "showMessage", "message", "getPreferences", "getNowPlaying", "songInfo", "runAppleScript", "full", "formatted", "short", "showNowPlaying", "runTidalCommand", "nowPlayingFull", "getNowPlaying", "showMessage"]
}
