"use strict";var Ut=Object.create;var oe=Object.defineProperty;var Lt=Object.getOwnPropertyDescriptor;var Dt=Object.getOwnPropertyNames;var Nt=Object.getPrototypeOf,Bt=Object.prototype.hasOwnProperty;var Vt=(e,r)=>{for(var t in r)oe(e,t,{get:r[t],enumerable:!0})},Ve=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of Dt(r))!Bt.call(e,a)&&a!==t&&oe(e,a,{get:()=>r[a],enumerable:!(n=Lt(r,a))||n.enumerable});return e};var V=(e,r,t)=>(t=e!=null?Ut(Nt(e)):{},Ve(r||!e||!e.__esModule?oe(t,"default",{value:e,enumerable:!0}):t,e)),Mt=e=>Ve(oe({},"__esModule",{value:!0}),e);var $r={};Vt($r,{default:()=>At});module.exports=Mt($r);var Pt=require("react"),v=require("@raycast/api");var ut=require("fs");var de=V(require("path"));var Me=["Application Support","BraveSoftware","Brave-Browser"],Fe=["Application Support","BraveSoftware","Brave-Browser-Beta"],We=["Application Support","BraveSoftware","Brave-Browser-Nightly"],ze=["Application Support","BraveSoftware","Brave-Browser","Local State"],_="Default",M="BRAVE_PROFILE_KEY",ce="BRAVE_PROFILES_KEY",je=`
# \u{1F6A8}Error: Brave browser is not installed
## This extension depends on Brave browser. You must install it to continue.
  
If you have [Homebrew](https://brew.sh/) installed then press \u23CE (Enter Key) to install Brave browser.

[Click here](https://brave.com/download/) if you want to download manually.
  
[![Brave](https://brave.com/static-assets/images/brave-logo.svg)]()
`;var He=`
# \u{1F6A8}Error: Something happened while trying to run your command
  
[![Brave](https://brave.com/static-assets/images/brave-logo.svg)]()
`,le="An Error Occurred",ue="Brave not installed";var Ge=require("@raycast/api"),{browserOption:Ft}=(0,Ge.getPreferenceValues)(),fe;switch(Ft){case"Brave Browser Beta":fe=Fe;break;case"Brave Browser Nightly":fe=We;break;default:fe=Me}var Ke=()=>{if(!process.env.HOME)throw new Error("$HOME environment variable is not set.");return de.default.join(process.env.HOME,"Library")},he=e=>de.default.join(Ke(),...fe,e??_,"History"),Je=()=>de.default.join(Ke(),...ze);var J=require("react");var h=V(require("react")),f=require("@raycast/api");var Ze=Object.prototype.hasOwnProperty;function pe(e,r){var t,n;if(e===r)return!0;if(e&&r&&(t=e.constructor)===r.constructor){if(t===Date)return e.getTime()===r.getTime();if(t===RegExp)return e.toString()===r.toString();if(t===Array){if((n=e.length)===r.length)for(;n--&&pe(e[n],r[n]););return n===-1}if(!t||typeof e=="object"){n=0;for(t in e)if(Ze.call(e,t)&&++n&&!Ze.call(r,t)||!(t in r)||!pe(e[t],r[t]))return!1;return Object.keys(r).length===n}}return e!==e&&r!==r}var L=V(require("node:fs")),W=V(require("node:path")),rt=V(require("node:crypto")),be=V(require("node:child_process")),nt=require("node:buffer"),X=V(require("node:stream")),at=require("node:util"),I=require("node:fs/promises");var R=require("react/jsx-runtime"),$e=V(require("node:os")),st=require("node:url"),ve=globalThis;function Wt(e){let r=(0,h.useRef)(e),t=(0,h.useRef)(0);return pe(e,r.current)||(r.current=e,t.current+=1),(0,h.useMemo)(()=>r.current,[t.current])}function T(e){let r=(0,h.useRef)(e);return r.current=e,r}function re(e,r){let t=e instanceof Error?e.message:String(e);return(0,f.showToast)({style:f.Toast.Style.Failure,title:r?.title??"Something went wrong",message:r?.message??t,primaryAction:r?.primaryAction??Ye(e),secondaryAction:r?.primaryAction?Ye(e):void 0})}var Ye=e=>{let r=!0,t="[Extension Name]...",n="";try{let s=JSON.parse((0,L.readFileSync)((0,W.join)(f.environment.assetsPath,"..","package.json"),"utf8"));t=`[${s.title}]...`,n=`https://raycast.com/${s.owner||s.author}/${s.name}`,(!s.owner||s.access==="public")&&(r=!1)}catch{}let a=f.environment.isDevelopment||r,i=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:a?"Copy Logs":"Report Error",onAction(s){s.hide(),a?f.Clipboard.copy(i):(0,f.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(t)}&extension-url=${encodeURI(n)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${i}
\`\`\`
`)}`)}}};function it(e,r,t){let n=(0,h.useRef)(0),[a,i]=(0,h.useState)({isLoading:!0}),s=T(e),l=T(t?.abortable),c=T(r||[]),o=T(t?.onError),u=T(t?.onData),d=T(t?.onWillExecute),m=T(t?.failureToastOptions),x=T(a.data),k=(0,h.useRef)(null),b=(0,h.useRef)({page:0}),$=(0,h.useRef)(!1),A=(0,h.useRef)(!0),G=(0,h.useRef)(50),E=(0,h.useCallback)(()=>(l.current&&(l.current.current?.abort(),l.current.current=new AbortController),++n.current),[l]),y=(0,h.useCallback)((...B)=>{let S=E();d.current?.(B),i(g=>({...g,isLoading:!0}));let Y=zt(s.current)(...B);function q(g){return g.name=="AbortError"||S===n.current&&(o.current?o.current(g):f.environment.launchType!==f.LaunchType.Background&&re(g,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(K){K.hide(),k.current?.(...c.current||[])}},...m.current}),i({error:g,isLoading:!1})),g}return typeof Y=="function"?($.current=!0,Y(b.current).then(({data:g,hasMore:K,cursor:Ct})=>(S===n.current&&(b.current&&(b.current.cursor=Ct,b.current.lastItem=g?.[g.length-1]),u.current&&u.current(g,b.current),K&&(G.current=g.length),A.current=K,i(Ot=>b.current.page===0?{data:g,isLoading:!1}:{data:(Ot.data||[])?.concat(g),isLoading:!1})),g),g=>(A.current=!1,q(g)))):($.current=!1,Y.then(g=>(S===n.current&&(u.current&&u.current(g),i({data:g,isLoading:!1})),g),q))},[u,o,c,s,i,k,d,b,m,E]);k.current=y;let N=(0,h.useCallback)(()=>{b.current={page:0};let B=c.current||[];return y(...B)},[y,c]),Z=(0,h.useCallback)(async(B,S)=>{let Y;try{if(S?.optimisticUpdate){E(),typeof S?.rollbackOnError!="function"&&S?.rollbackOnError!==!1&&(Y=structuredClone(x.current?.value));let q=S.optimisticUpdate;i(g=>({...g,data:q(g.data)}))}return await B}catch(q){if(typeof S?.rollbackOnError=="function"){let g=S.rollbackOnError;i(K=>({...K,data:g(K.data)}))}else S?.optimisticUpdate&&S?.rollbackOnError!==!1&&i(g=>({...g,data:Y}));throw q}finally{S?.shouldRevalidateAfter!==!1&&(f.environment.launchType===f.LaunchType.Background||f.environment.commandMode==="menu-bar"?await N():N())}},[N,x,i,E]),ie=(0,h.useCallback)(()=>{b.current.page+=1;let B=c.current||[];y(...B)},[b,c,y]);(0,h.useEffect)(()=>{b.current={page:0},t?.execute!==!1?y(...r||[]):E()},[Wt([r,t?.execute,y]),l,b]),(0,h.useEffect)(()=>()=>{E()},[E]);let _t=t?.execute!==!1?a.isLoading:!1,Rt={...a,isLoading:_t},It=$.current?{pageSize:G.current,hasMore:A.current,onLoadMore:ie}:void 0;return{...Rt,revalidate:N,mutate:Z,pagination:It}}function zt(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}function qe(e){return typeof e!="function"?!1:/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(e))!==null}function jt(e){return e instanceof URLSearchParams?e.toString():e}function ot(e,r=[]){function t(n){return"update"in e?e.update(n,"utf8"):e.write(n)}return{dispatch:function(n){n=jt(n),n===null?this._null():this["_"+typeof n](n)},_object:function(n){let a=/\[object (.*)\]/i,i=Object.prototype.toString.call(n),s=a.exec(i)?.[1]??"unknown:["+i+"]";s=s.toLowerCase();let l=null;if((l=r.indexOf(n))>=0){this.dispatch("[CIRCULAR:"+l+"]");return}else r.push(n);if(Buffer.isBuffer(n))return t("buffer:"),t(n.toString("utf8"));if(s!=="object"&&s!=="function"&&s!=="asyncfunction")if(this["_"+s])this["_"+s](n);else throw new Error('Unknown object type "'+s+'"');else{let c=Object.keys(n);c=c.sort(),qe(n)||c.splice(0,0,"prototype","__proto__","constructor"),t("object:"+c.length+":");let o=this;return c.forEach(function(u){o.dispatch(u),t(":"),o.dispatch(n[u]),t(",")})}},_array:function(n,a){a=typeof a<"u"?a:!1;let i=this;if(t("array:"+n.length+":"),!a||n.length<=1){n.forEach(function(c){i.dispatch(c)});return}let s=[],l=n.map(function(c){let o=Ht(),u=r.slice();return ot(o,u).dispatch(c),s=s.concat(u.slice(r.length)),o.read().toString()});r=r.concat(s),l.sort(),this._array(l,!1)},_date:function(n){t("date:"+n.toJSON())},_symbol:function(n){t("symbol:"+n.toString())},_error:function(n){t("error:"+n.toString())},_boolean:function(n){t("bool:"+n.toString())},_string:function(n){t("string:"+n.length+":"),t(n.toString())},_function:function(n){t("fn:"),qe(n)?this.dispatch("[native]"):this.dispatch(n.toString()),this.dispatch("function-name:"+String(n.name)),this._object(n)},_number:function(n){t("number:"+n.toString())},_xml:function(n){t("xml:"+n.toString())},_null:function(){t("Null")},_undefined:function(){t("Undefined")},_regexp:function(n){t("regex:"+n.toString())},_uint8array:function(n){t("uint8array:"),this.dispatch(Array.prototype.slice.call(n))},_uint8clampedarray:function(n){t("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(n))},_int8array:function(n){t("int8array:"),this.dispatch(Array.prototype.slice.call(n))},_uint16array:function(n){t("uint16array:"),this.dispatch(Array.prototype.slice.call(n))},_int16array:function(n){t("int16array:"),this.dispatch(Array.prototype.slice.call(n))},_uint32array:function(n){t("uint32array:"),this.dispatch(Array.prototype.slice.call(n))},_int32array:function(n){t("int32array:"),this.dispatch(Array.prototype.slice.call(n))},_float32array:function(n){t("float32array:"),this.dispatch(Array.prototype.slice.call(n))},_float64array:function(n){t("float64array:"),this.dispatch(Array.prototype.slice.call(n))},_arraybuffer:function(n){t("arraybuffer:"),this.dispatch(new Uint8Array(n))},_url:function(n){t("url:"+n.toString())},_map:function(n){t("map:");let a=Array.from(n);this._array(a,!0)},_set:function(n){t("set:");let a=Array.from(n);this._array(a,!0)},_file:function(n){t("file:"),this.dispatch([n.name,n.size,n.type,n.lastModified])},_blob:function(){throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){t("domwindow")},_bigint:function(n){t("bigint:"+n.toString())},_process:function(){t("process")},_timer:function(){t("timer")},_pipe:function(){t("pipe")},_tcp:function(){t("tcp")},_udp:function(){t("udp")},_tty:function(){t("tty")},_statwatcher:function(){t("statwatcher")},_securecontext:function(){t("securecontext")},_connection:function(){t("connection")},_zlib:function(){t("zlib")},_context:function(){t("context")},_nodescript:function(){t("nodescript")},_httpparser:function(){t("httpparser")},_dataview:function(){t("dataview")},_signal:function(){t("signal")},_fsevent:function(){t("fsevent")},_tlswrap:function(){t("tlswrap")}}}function Ht(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}function Gt(e,r){let t=this[e];return t instanceof Date?`__raycast_cached_date__${t.toISOString()}`:Buffer.isBuffer(t)?`__raycast_cached_buffer__${t.toString("base64")}`:r}function Kt(e,r){return typeof r=="string"&&r.startsWith("__raycast_cached_date__")?new Date(r.replace("__raycast_cached_date__","")):typeof r=="string"&&r.startsWith("__raycast_cached_buffer__")?Buffer.from(r.replace("__raycast_cached_buffer__",""),"base64"):r}function ge(e){let r=rt.default.createHash("sha1");return ot(r).dispatch(e),r.digest("hex")}var Jt=Symbol("cache without namespace"),Qe=new Map;function U(e,r,t){let n=t?.cacheNamespace||Jt,a=Qe.get(n)||Qe.set(n,new f.Cache({namespace:t?.cacheNamespace})).get(n);if(!a)throw new Error("Missing cache");let i=T(e),s=T(r),l=(0,h.useSyncExternalStore)(a.subscribe,()=>{try{return a.get(i.current)}catch(d){console.error("Could not get Cache data:",d);return}}),c=(0,h.useMemo)(()=>{if(typeof l<"u"){if(l==="undefined")return;try{return JSON.parse(l,Kt)}catch(d){return console.warn("The cached data is corrupted",d),s.current}}else return s.current},[l,s]),o=T(c),u=(0,h.useCallback)(d=>{let m=typeof d=="function"?d(o.current):d;if(typeof m>"u")a.set(i.current,"undefined");else{let x=JSON.stringify(m,Gt);a.set(i.current,x)}return m},[a,i,o]);return[c,u]}var Q=Symbol();function ct(e,r,t){let{initialData:n,keepPreviousData:a,internal_cacheKeySuffix:i,...s}=t||{},l=(0,h.useRef)(null),[c,o]=U(ge(r||[])+i,Q,{cacheNamespace:ge(e)}),u=(0,h.useRef)(c!==Q?c:n),d=(0,h.useRef)(void 0),{mutate:m,revalidate:x,...k}=it(e,r||[],{...s,onData(E,y){d.current=y,s.onData&&s.onData(E,y),!(y&&y.page>0)&&(l.current="promise",u.current=E,o(E))}}),b,$=k.pagination;d.current&&d.current.page>0&&k.data?b=k.data:l.current==="promise"?b=u.current:a&&c!==Q?(b=c,$&&($.hasMore=!0,$.pageSize=c.length)):a&&c===Q?b=u.current:c!==Q?(b=c,$&&($.hasMore=!0,$.pageSize=c.length)):b=n;let A=T(b),G=(0,h.useCallback)(async(E,y)=>{let N;try{if(y?.optimisticUpdate){typeof y?.rollbackOnError!="function"&&y?.rollbackOnError!==!1&&(N=structuredClone(A.current));let Z=y.optimisticUpdate(A.current);l.current="cache",u.current=Z,o(Z)}return await m(E,{shouldRevalidateAfter:y?.shouldRevalidateAfter})}catch(Z){if(typeof y?.rollbackOnError=="function"){let ie=y.rollbackOnError(A.current);l.current="cache",u.current=ie,o(ie)}else y?.optimisticUpdate&&y?.rollbackOnError!==!1&&(l.current="cache",u.current=N,o(N));throw Z}},[o,m,A,u,l]);return(0,h.useEffect)(()=>{c!==Q&&(l.current="cache",u.current=c)},[c]),{data:b,isLoading:k.isLoading,error:k.error,mutate:d.current&&d.current.page>0?m:G,pagination:$,revalidate:x}}var me=e=>!!e&&typeof e=="object"&&typeof e.removeListener=="function"&&typeof e.emit=="function"&&typeof e.reallyExit=="function"&&typeof e.listeners=="function"&&typeof e.kill=="function"&&typeof e.pid=="number"&&typeof e.on=="function",Ee=Symbol.for("signal-exit emitter"),Te=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),ve[Ee])return ve[Ee];Object.defineProperty(ve,Ee,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(r,t){this.listeners[r].push(t)}removeListener(r,t){let n=this.listeners[r],a=n.indexOf(t);a!==-1&&(a===0&&n.length===1?n.length=0:n.splice(a,1))}emit(r,t,n){if(this.emitted[r])return!1;this.emitted[r]=!0;let a=!1;for(let i of this.listeners[r])a=i(t,n)===!0||a;return r==="exit"&&(a=this.emit("afterExit",t,n)||a),a}},Pe=class{onExit(){return()=>{}}load(){}unload(){}},Ae=class{#o;#t;#e;#s;#i;#a;#n;#r;constructor(r){this.#o=process.platform==="win32"?"SIGINT":"SIGHUP",this.#t=new Te,this.#a={},this.#n=!1,this.#r=[],this.#r.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#r.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#r.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#e=r,this.#a={};for(let t of this.#r)this.#a[t]=()=>{let n=this.#e.listeners(t),{count:a}=this.#t,i=r;if(typeof i.__signal_exit_emitter__=="object"&&typeof i.__signal_exit_emitter__.count=="number"&&(a+=i.__signal_exit_emitter__.count),n.length===a){this.unload();let s=this.#t.emit("exit",null,t),l=t==="SIGHUP"?this.#o:t;s||r.kill(r.pid,l)}};this.#i=r.reallyExit,this.#s=r.emit}onExit(r,t){if(!me(this.#e))return()=>{};this.#n===!1&&this.load();let n=t?.alwaysLast?"afterExit":"exit";return this.#t.on(n,r),()=>{this.#t.removeListener(n,r),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#n){this.#n=!0,this.#t.count+=1;for(let r of this.#r)try{let t=this.#a[r];t&&this.#e.on(r,t)}catch{}this.#e.emit=(r,...t)=>this.#l(r,...t),this.#e.reallyExit=r=>this.#c(r)}}unload(){this.#n&&(this.#n=!1,this.#r.forEach(r=>{let t=this.#a[r];if(!t)throw new Error("Listener not defined for signal: "+r);try{this.#e.removeListener(r,t)}catch{}}),this.#e.emit=this.#s,this.#e.reallyExit=this.#i,this.#t.count-=1)}#c(r){return me(this.#e)?(this.#e.exitCode=r||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#l(r,...t){let n=this.#s;if(r==="exit"&&me(this.#e)){typeof t[0]=="number"&&(this.#e.exitCode=t[0]);let a=n.call(this.#e,r,...t);return this.#t.emit("exit",this.#e.exitCode,null),a}else return n.call(this.#e,r,...t)}},Se=null,Zt=(e,r)=>(Se||(Se=me(process)?new Ae(process):new Pe),Se.onExit(e,r));function _e(e,{timeout:r}={}){let t=new Promise((l,c)=>{e.on("exit",(o,u)=>{l({exitCode:o,signal:u,timedOut:!1})}),e.on("error",o=>{c(o)}),e.stdin&&e.stdin.on("error",o=>{c(o)})}),n=Zt(()=>{e.kill()});if(r===0||r===void 0)return t.finally(()=>n());let a,i=new Promise((l,c)=>{a=setTimeout(()=>{e.kill("SIGTERM"),c(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},r)}),s=t.finally(()=>{clearTimeout(a)});return Promise.race([i,s]).finally(()=>n())}var Re=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function Yt(e){let{encoding:r}=e,t=r==="buffer",n=new X.default.PassThrough({objectMode:!1});r&&r!=="buffer"&&n.setEncoding(r);let a=0,i=[];return n.on("data",s=>{i.push(s),a+=s.length}),n.getBufferedValue=()=>t?Buffer.concat(i,a):i.join(""),n.getBufferedLength=()=>a,n}async function Xe(e,r){let t=Yt(r);return await new Promise((n,a)=>{let i=s=>{s&&t.getBufferedLength()<=nt.constants.MAX_LENGTH&&(s.bufferedData=t.getBufferedValue()),a(s)};(async()=>{try{await(0,at.promisify)(X.default.pipeline)(e,t),n()}catch(s){i(s)}})(),t.on("data",()=>{t.getBufferedLength()>8e7&&i(new Re)})}),t.getBufferedValue()}async function et(e,r){e.destroy();try{return await r}catch(t){return t.bufferedData}}async function Ie({stdout:e,stderr:r},{encoding:t},n){let a=Xe(e,{encoding:t}),i=Xe(r,{encoding:t});try{return await Promise.all([n,a,i])}catch(s){return Promise.all([{error:s,exitCode:null,signal:s.signal,timedOut:s.timedOut||!1},et(e,a),et(r,i)])}}function qt(e){let r=typeof e=="string"?`
`:10,t=typeof e=="string"?"\r":13;return e[e.length-1]===r&&(e=e.slice(0,-1)),e[e.length-1]===t&&(e=e.slice(0,-1)),e}function tt(e,r){return e.stripFinalNewline?qt(r):r}function Qt({timedOut:e,timeout:r,signal:t,exitCode:n}){return e?`timed out after ${r} milliseconds`:t!=null?`was killed with ${t}`:n!=null?`failed with exit code ${n}`:"failed"}function Xt({stdout:e,stderr:r,error:t,signal:n,exitCode:a,command:i,timedOut:s,options:l,parentError:c}){let u=`Command ${Qt({timedOut:s,timeout:l?.timeout,signal:n,exitCode:a})}: ${i}`,d=t?`${u}
${t.message}`:u,m=[d,r,e].filter(Boolean).join(`
`);return t?t.originalMessage=t.message:t=c,t.message=m,t.shortMessage=d,t.command=i,t.exitCode=a,t.signal=n,t.stdout=e,t.stderr=r,"bufferedData"in t&&delete t.bufferedData,t}function er({stdout:e,stderr:r,error:t,exitCode:n,signal:a,timedOut:i,command:s,options:l,parentError:c}){if(t||n!==0||a!==null)throw Xt({error:t,exitCode:n,signal:a,stdout:e,stderr:r,command:s,timedOut:i,options:l,parentError:c});return e}var ye=class extends Error{constructor(r){super(r),this.name="PermissionError"}};function tr(e){return e instanceof Error&&e.name==="PermissionError"}async function rr(e,r,t){if(!(0,L.existsSync)(e))throw new Error("The database does not exist");let n;try{n=await(o=>import(o))("node:sqlite")}catch{return nr(e,r,t)}let a=new n.DatabaseSync(e,{open:!1,readOnly:!0}),i=t?.signal;try{a.open()}catch(c){if(console.log(c),c.message.match("(5)")||c.message.match("(14)")){let o;if(!o){let u=W.default.join($e.default.tmpdir(),"useSQL",ge(e));await(0,I.mkdir)(u,{recursive:!0}),F(i),o=W.default.join(u,"db.db"),await(0,I.copyFile)(e,o),await(0,I.writeFile)(o+"-shm",""),await(0,I.writeFile)(o+"-wal",""),F(i)}a=new n.DatabaseSync(o,{open:!1,readOnly:!0}),a.open(),F(i)}}let s=a.prepare(r);F(i);let l=s.all();return a.close(),l}async function nr(e,r,t){let n=t?.signal,a=be.default.spawn("sqlite3",["--json","--readonly",e,r],{signal:n}),i=_e(a),[{error:s,exitCode:l,signal:c},o,u]=await Ie(a,{encoding:"utf-8"},i);if(F(n),u.match("(5)")||u.match("(14)")){let d;if(!d){let m=W.default.join($e.default.tmpdir(),"useSQL",ge(e));await(0,I.mkdir)(m,{recursive:!0}),F(n),d=W.default.join(m,"db.db"),await(0,I.copyFile)(e,d),await(0,I.writeFile)(d+"-shm",""),await(0,I.writeFile)(d+"-wal",""),F(n)}a=be.default.spawn("sqlite3",["--json","--readonly","--vfs","unix-none",d,r],{signal:n}),i=_e(a),[{error:s,exitCode:l,signal:c},o,u]=await Ie(a,{encoding:"utf-8"},i),F(n)}if(s||l!==0||c!==null)throw u.includes("authorization denied")?new ye("You do not have permission to access the database."):new Error(u||"Unknown error");return JSON.parse(o.trim()||"[]")}function F(e){if(e?.aborted){let r=new Error("aborted");throw r.name="AbortError",r}}function lt(e,r,t){let{permissionPriming:n,...a}=t||{},[i,s]=(0,h.useState)(null),l=T(t||{}),c=(0,h.useRef)(null),o=(0,h.useCallback)(d=>{console.error(d);let m=d instanceof Error&&d.message.includes("authorization denied")?new ye("You do not have permission to access the database."):d;tr(m)?s((0,R.jsx)(ar,{priming:l.current.permissionPriming})):l.current.onError?l.current.onError(m):f.environment.launchType!==f.LaunchType.Background&&re(m,{title:"Cannot query the data"})},[l]),u=(0,h.useMemo)(()=>{if(!(0,L.existsSync)(e))throw new Error("The database does not exist");return async(d,m)=>{let x=c.current?.signal;return rr(d,m,{signal:x})}},[e]);return{...it(u,[e,r],{...a,onError:o}),permissionView:i}}function ar(e){let r=parseInt($e.default.release().split(".")[0])>=22,t=r?"Settings":"Preferences",n=r?{title:"Open System Settings -> Privacy",target:"x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles"}:{title:"Open System Preferences -> Security",target:"x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles"};return f.environment.commandMode==="menu-bar"?(0,R.jsxs)(f.MenuBarExtra,{icon:f.Icon.Warning,title:f.environment.commandName,children:[(0,R.jsx)(f.MenuBarExtra.Item,{title:"Raycast needs full disk access",tooltip:`You can revert this access in ${t} whenever you want`}),e.priming?(0,R.jsx)(f.MenuBarExtra.Item,{title:e.priming,tooltip:`You can revert this access in ${t} whenever you want`}):null,(0,R.jsx)(f.MenuBarExtra.Separator,{}),(0,R.jsx)(f.MenuBarExtra.Item,{title:n.title,onAction:()=>(0,f.open)(n.target)})]}):(0,R.jsx)(f.List,{children:(0,R.jsx)(f.List.EmptyView,{icon:{source:{light:"https://raycast.com/uploads/extensions-utils-security-permissions-light.png",dark:"https://raycast.com/uploads/extensions-utils-security-permissions-dark.png"}},title:"Raycast needs full disk access.",description:`${e.priming?e.priming+`
`:""}You can revert this access in ${t} whenever you want.`,actions:(0,R.jsx)(f.ActionPanel,{children:(0,R.jsx)(f.Action.Open,{...n})})})})}function we(e,r){try{let t=s=>s.startsWith("http")?s:`https://${s}`,a=(typeof e=="string"?new st.URL(t(e)):e).hostname;switch(process.env.FAVICON_PROVIDER??"raycast"){case"none":return{source:r?.fallback??f.Icon.Link,mask:r?.mask};case"apple":return{source:r?.fallback??f.Icon.Link,mask:r?.mask};case"duckduckgo":case"duckDuckGo":return{source:`https://icons.duckduckgo.com/ip3/${a}.ico`,fallback:r?.fallback??f.Icon.Link,mask:r?.mask};case"google":return{source:`https://www.google.com/s2/favicons?sz=${r?.size??64}&domain=${a}`,fallback:r?.fallback??f.Icon.Link,mask:r?.mask};case"legacy":case"raycast":default:return{source:`https://api.ray.so/favicon?url=${a}&size=${r?.size??64}`,fallback:r?.fallback??f.Icon.Link,mask:r?.mask}}}catch(t){return console.error(t),f.Icon.Link}}async function ee(e,r,t){if(process.platform!=="darwin")throw new Error("AppleScript is only supported on macOS");let{humanReadableOutput:n,language:a,timeout:i,...s}=Array.isArray(r)?t||{}:r||{},l=n!==!1?[]:["-ss"];a==="JavaScript"&&l.push("-l","JavaScript"),Array.isArray(r)&&l.push("-",...r);let c=be.default.spawn("osascript",l,{...s,env:{PATH:"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"}}),o=_e(c,{timeout:i??1e4});c.stdin.end(e);let[{error:u,exitCode:d,signal:m,timedOut:x},k,b]=await Ie(c,{encoding:"utf8"},o),$=tt({stripFinalNewline:!0},k),A=tt({stripFinalNewline:!0},b);return er({stdout:$,stderr:A,error:u,exitCode:d,signal:m,timedOut:x,command:"osascript",options:t,parentError:new Error})}var sr=(e,r)=>r.map(t=>`(${e}.title LIKE '%${t}%' OR ${e}.url LIKE '%${t}%')`).join(" AND "),ir=(e,r,t)=>`SELECT id,
            url,
             title,
             datetime(${r} / 1000000 + (strftime('%s', '1601-01-01')), 'unixepoch', 'localtime') as lastVisited
      FROM ${e}
      WHERE ${sr(e,t)}
      ORDER BY ${r} DESC LIMIT 100;`;function ft(e,r){let[t,n]=(0,J.useState)({}),[a,i]=(0,J.useState)(0),[s,l]=(0,J.useState)(he(e[0].id)),c=r?r.trim().split(" "):[""],o=ir("urls","last_visit_time",c),{data:u,isLoading:d,permissionView:m,revalidate:x}=lt(s,o);return(0,J.useEffect)(()=>{if(u!=null&&!d){let k={...t};k[e[a].id]={data:u,isLoading:d,errorView:m,revalidate:x,profile:e[a]},n(k),a<e.length-1&&(0,ut.existsSync)(he(e[a+1].id))&&(l(he(e[a+1].id)),i(a+1))}},[u,s,d]),(0,J.useEffect)(()=>{x()},[a]),Object.values(t)}var ht=require("react"),C=require("@raycast/api"),Ce=require("child_process");var pt=require("os"),mt=require("path"),ke=require("react/jsx-runtime"),or=(()=>{try{return(0,Ce.execSync)("brew --prefix",{encoding:"utf8"}).trim()}catch{return(0,pt.cpus)()[0].model.includes("Apple")?"/opt/homebrew":"/usr/local"}})();function dt(){return(0,mt.join)(or,"bin/brew")}function cr(e){try{return(0,Ce.execSync)(`${dt()} install --cask ${e}`,{maxBuffer:10*1024*1024})}catch(r){let t=r;throw t&&t.code===127?(t.stderr=`Brew executable not found at ${dt()}`,t):r}}function bt(){let[e,r]=(0,ht.useState)(!0);return(0,ke.jsx)(C.Detail,{actions:(0,ke.jsx)(C.ActionPanel,{children:e&&(0,ke.jsx)(C.ActionPanel.Item,{title:"Install with Homebrew",onAction:async()=>{if(!e)return;let t=new C.Toast({style:C.Toast.Style.Animated,title:"Installing..."});await t.show();try{cr("brave-browser"),await t.hide()}catch{await t.hide(),await(0,C.showToast)(C.Toast.Style.Failure,le,"An unknown error occurred while trying to install")}t.title="Installed! Please go back and try again.",t.style=C.Toast.Style.Success,await t.show(),r(!1)}})}),markdown:je})}var te=require("@raycast/api");var yt=require("react/jsx-runtime");function gt(){return(0,te.showToast)(te.Toast.Style.Failure,le,"Something happened while trying to run your command"),(0,yt.jsx)(te.Detail,{markdown:He})}var p=require("@raycast/api");var O=require("@raycast/api");var z=class e{constructor(r,t,n,a,i){this.title=r;this.url=t;this.favicon=n;this.windowsIndex=a;this.tabIndex=i}static TAB_CONTENTS_SEPARATOR="~~~";static parse(r){let t=r.split(this.TAB_CONTENTS_SEPARATOR);return new e(t[0],t[1],t[2],+t[3],+t[4])}key(){return`${this.windowsIndex}${e.TAB_CONTENTS_SEPARATOR}${this.tabIndex}`}urlWithoutScheme(){return this.url.replace(/(^\w+:|^)\/\//,"").replace("www.","")}googleFavicon(){return we(this.url)}};var $t=require("child_process");async function wt(e){let r=e?`execute of tab _tab_index of window _window_index javascript \xAC
                    "document.head.querySelector('link[rel~=icon]').href;"`:'""';await xt();let{browserOption:t}=(0,O.getPreferenceValues)();return(await ee(`
      set _output to ""
      tell application "${t}"
        set _window_index to 1
        repeat with w in windows
          set _tab_index to 1
          repeat with t in tabs of w
            set _title to get title of t
            set _url to get URL of t
            set _favicon to ${r}
            set _output to (_output & _title & "${z.TAB_CONTENTS_SEPARATOR}" & _url & "${z.TAB_CONTENTS_SEPARATOR}" & _favicon & "${z.TAB_CONTENTS_SEPARATOR}" & _window_index & "${z.TAB_CONTENTS_SEPARATOR}" & _tab_index & "\\n")
            set _tab_index to _tab_index + 1
          end repeat
          set _window_index to _window_index + 1
          if _window_index > count windows then exit repeat
        end repeat
      end tell
      return _output
  `)).split(`
`).filter(a=>a.length!==0).map(a=>z.parse(a))}async function D({url:e,query:r,profileCurrent:t,profileOriginal:n,openTabInProfile:a,newWindow:i,incognito:s}){setTimeout(()=>{(0,O.popToRoot)({clearSearchBar:!0})},3e3),await xt()&&(0,O.closeMainWindow)({clearRootSearch:!0});let{browserOption:c}=(0,O.getPreferenceValues)(),o=e||(r?`https://www.google.com/search?q=${encodeURIComponent(r)}`:""),u=b=>new Promise(($,A)=>{(0,$t.exec)(b,G=>{G?A(G):$(!0)})}),d=b=>{let $=[];return b&&$.push(`--profile-directory=${b}`),i&&$.push("--new-window"),s&&$.push("--incognito"),o&&$.push(o),$},m=[];switch(a){case"default":m=d();break;case"profile_current":m=d(t);break;case"profile_original":m=d(n);break}let x=m.map(b=>`"${b}"`).join(" "),k=`open -na "${c}" --args ${x}`;return u(k)}async function Oe(e){let{browserOption:r}=(0,O.getPreferenceValues)();await ee(`tell application "${r}}"
    tell window 1
      delete tab ${e}
    end tell
  end tell`)}async function kt(e){let{browserOption:r}=(0,O.getPreferenceValues)();await ee(`
    tell application "${r}"
      activate
      set index of window (${e.windowsIndex} as number) to (${e.windowsIndex} as number)
      set active tab index of window (${e.windowsIndex} as number) to (${e.tabIndex} as number)
    end tell
    return true
  `)}var xt=async()=>{let{browserOption:e}=(0,O.getPreferenceValues)();if(await ee(`
set isInstalled to false
try
    do shell script "osascript -e 'exists application \\"${e}\\"'"
    set isInstalled to true
end try

return isInstalled`)==="false")throw new Error(ue);return!0};async function vt(e){let{browserOption:r}=(0,O.getPreferenceValues)();try{let n=decodeURIComponent(e).replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f"),a=`
      tell application "${r}"
        activate
        tell active tab of front window
          execute javascript "${n}"
        end tell
      end tell
    `;await ee(a),await(0,O.closeMainWindow)()}catch(t){console.error(t),t instanceof Error&&t.message.includes("Allow JavaScript from Apple Events")?await re("Enable 'View > Developer > Allow JavaScript from Apple Events' in Brave."):await re("Could not run bookmarklet",{message:t instanceof Error?t.message:String(t)})}}var w=require("react/jsx-runtime"),j=class{static NewTab=ur;static TabList=fr;static TabHistory=dr};function ur({query:e,incognito:r}){let{openTabInProfile:t}=(0,p.getPreferenceValues)(),[n]=U(M,_);return(0,w.jsx)(p.ActionPanel,{title:"New Tab",children:(0,w.jsx)(p.Action,{onAction:()=>D({query:e,profileCurrent:n,openTabInProfile:t,incognito:r}),title:e?`Search "${e}"`:"Open New Tab",icon:p.Icon.Globe})})}function fr({tab:e}){let{openTabInProfile:r}=(0,p.getPreferenceValues)(),[t]=U(M,_);return(0,w.jsxs)(p.ActionPanel,{title:e.title,children:[(0,w.jsx)(hr,{tab:e}),(0,w.jsx)(p.Action,{title:"Move to New Window",icon:p.Icon.Window,onAction:async()=>{await Oe(e.tabIndex),await D({url:e.url,profileCurrent:t,openTabInProfile:r,newWindow:!0})}}),(0,w.jsx)(p.Action,{title:"Move to Incognito Window",icon:p.Icon.EyeDisabled,onAction:async()=>{await Oe(e.tabIndex),await D({url:e.url,profileCurrent:t,openTabInProfile:r,incognito:!0})}}),(0,w.jsx)(p.Action.CopyToClipboard,{title:"Copy URL",content:e.url})]})}function dr({title:e,url:r,profile:t}){let{openTabInProfile:n}=(0,p.getPreferenceValues)(),[a]=U(M,_);if(r.startsWith("javascript:")){let i=r.substring(11);return(0,w.jsxs)(p.ActionPanel,{title:e,children:[(0,w.jsx)(p.Action,{onAction:()=>vt(i),icon:p.Icon.Play,title:"Run Bookmarklet"}),(0,w.jsx)(p.Action.CopyToClipboard,{title:"Copy Code",content:i,shortcut:{modifiers:["cmd"],key:"c"}})]})}return(0,w.jsxs)(p.ActionPanel,{title:e,children:[(0,w.jsx)(p.Action,{onAction:async()=>await D({url:r,profileOriginal:t,profileCurrent:a,openTabInProfile:n}),icon:p.Icon.Eye,title:"Open"}),(0,w.jsx)(p.Action,{title:"Open in New Window",icon:p.Icon.Window,onAction:async()=>await D({url:r,profileOriginal:t,profileCurrent:a,openTabInProfile:n,newWindow:!0})}),(0,w.jsx)(p.Action,{title:"Open in Incognito Window",icon:p.Icon.EyeDisabled,onAction:async()=>await D({url:r,profileOriginal:t,profileCurrent:a,openTabInProfile:n,incognito:!0})}),(0,w.jsxs)(p.ActionPanel.Section,{title:"Open in profile",children:[(0,w.jsx)(p.Action,{onAction:()=>D({url:r,profileOriginal:t,profileCurrent:a,openTabInProfile:"profile_current"}),title:"Open in Current Profile"}),(0,w.jsx)(p.Action,{onAction:()=>D({url:r,profileOriginal:t,profileCurrent:a,openTabInProfile:"profile_original"}),title:"Open in Original Profile"})]}),(0,w.jsx)(p.Action.CopyToClipboard,{title:"Copy URL",content:r,shortcut:{modifiers:["cmd"],key:"c"}})]})}function hr(e){async function r(){await kt(e.tab),await(0,p.closeMainWindow)()}return(0,w.jsx)(p.ActionPanel.Item,{title:"Open Tab",icon:{source:p.Icon.Eye},onAction:r})}var se=require("@raycast/api");var ae=require("react/jsx-runtime"),ne=class{static TabList=br;static TabHistory=mr};function pr(e){try{let r=new URL(e);return r.protocol==="http:"||r.protocol==="https:"}catch{return!1}}function Et(e){try{let r=new URL(e),t=r.hostname.replace("www.","").split("."),n=r.pathname.split("/").filter(a=>a.length>0);return[...t,...n,r.hostname,e]}catch{return[e]}}function mr({profile:e,entry:{url:r,title:t,id:n}}){return(0,ae.jsx)(se.List.Item,{id:`${e}-${n}`,title:t,subtitle:r,keywords:Et(r),icon:pr(r)?we(r):se.Icon.Globe,actions:(0,ae.jsx)(j.TabHistory,{title:t,url:r,profile:e})})}function br(e){return(0,ae.jsx)(se.List.Item,{title:e.tab.title,subtitle:e.tab.urlWithoutScheme(),keywords:Et(e.tab.url),actions:(0,ae.jsx)(j.TabList,{tab:e.tab}),icon:e.useOriginalFavicon?e.tab.favicon:e.tab.googleFavicon()})}var H=require("react");var St=require("@raycast/api");var Ue=require("react/jsx-runtime");function Tt(e){let{useOriginalFavicon:r}=(0,St.getPreferenceValues)(),[t,n]=(0,H.useState)([]),[a,i]=(0,H.useState)(!0),[s,l]=(0,H.useState)(),c=(0,H.useCallback)(async()=>{let o=await wt(r);e&&(o=o.filter(u=>u.title.toLowerCase().includes(e.toLowerCase())||u.urlWithoutScheme().toLowerCase().includes(e.toLowerCase()))),n(o)},[e]);return(0,H.useEffect)(()=>{c().then(()=>i(!1)).catch(o=>{o.message===ue?l((0,Ue.jsx)(bt,{})):l((0,Ue.jsx)(gt,{})),i(!1)})},[e]),{data:t,isLoading:a,errorView:s,revalidate:c,profile:{name:"",id:""}}}var Le=require("@raycast/api"),De=require("react");var xe=require("fs");var Ne=require("react/jsx-runtime");async function gr(){let e=Je();if(!(0,xe.existsSync)(e))return[{name:"Default",id:"Default"}];let r=await xe.promises.readFile(e,"utf-8"),t=JSON.parse(r).profile.info_cache;return Object.entries(t).map(([n,a])=>({name:a.name,id:n}))}function Be({onProfileSelected:e}){let[r,t]=U(M,_),[n,a]=U(ce,[{name:"Default",id:_}]),{data:i}=ct(gr);return(0,De.useEffect)(()=>{i&&(a(i),r||t(n[0].id))},[i]),(0,De.useEffect)(()=>{r&&e?.(r)},[r]),!n||n.length<2?null:(0,Ne.jsx)(Le.List.Dropdown,{tooltip:"Select Brave Profile",value:r,onChange:t,children:n.map(s=>(0,Ne.jsx)(Le.List.Dropdown.Item,{value:s.id,title:s.name},s.id))})}var P=require("react/jsx-runtime");function yr(e,r){if(!r?.length)return[];let t=r?.findIndex(n=>n.profile.id===e);return t&&r&&r.unshift(r.splice(t,1)[0]),r??[]}function At(){let[e,r]=(0,Pt.useState)(),[t]=U(ce,[{name:"Default",id:_}]),[n]=U(M,_),a=ft(t,e),{data:i,isLoading:s,errorView:l}=Tt(),{useOriginalFavicon:c}=(0,v.getPreferenceValues)();if(l||a?.some(o=>o.errorView)){let o=a?.find(u=>u.errorView)?.errorView;return l||o}return(0,P.jsxs)(v.List,{onSearchTextChange:r,isLoading:s||a?.find(o=>o.isLoading)?.isLoading,searchBarAccessory:(0,P.jsx)(Be,{}),children:[(0,P.jsxs)(v.List.Section,{title:"New Tab",children:[(0,P.jsx)(v.List.Item,{title:e?`Search "${e}"`:"Open New Tab",icon:{source:e?v.Icon.MagnifyingGlass:v.Icon.Plus},actions:(0,P.jsx)(j.NewTab,{query:e})}),(0,P.jsx)(v.List.Item,{title:e?`Search "${e}" In Incognito`:"Open New Incognito Tab",icon:{source:e?v.Icon.MagnifyingGlass:v.Icon.Plus},actions:(0,P.jsx)(j.NewTab,{query:e,incognito:!0})})]},"new-tab"),(0,P.jsx)(v.List.Section,{title:"Open Tabs - All",children:i?.map(o=>(0,P.jsx)(ne.TabList,{tab:o,useOriginalFavicon:c},o.key()))},"open-tabs"),yr(n,a).map(o=>(0,P.jsx)(v.List.Section,{title:`History - ${o.profile.name}`,children:o.data?.map(u=>(0,P.jsx)(ne.TabHistory,{entry:u,profile:o.profile.id},`${o.profile.id}-${u.id}`))},o.profile.id))]})}
