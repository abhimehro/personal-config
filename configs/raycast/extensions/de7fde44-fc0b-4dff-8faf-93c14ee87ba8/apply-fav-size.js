"use strict";var D=Object.defineProperty;var ue=Object.getOwnPropertyDescriptor;var fe=Object.getOwnPropertyNames;var we=Object.prototype.hasOwnProperty;var me=(o,i)=>{for(var a in i)D(o,a,{get:i[a],enumerable:!0})},pe=(o,i,a,c)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of fe(i))!we.call(o,s)&&s!==a&&D(o,s,{get:()=>i[s],enumerable:!(c=ue(i,s))||c.enumerable});return o};var ge=o=>pe(D({},"__esModule",{value:!0}),o);var he={};me(he,{default:()=>le});module.exports=ge(he);var L=require("@raycast/api");var W=require("@raycast/api");var re=require("@raycast/api");var z=require("react");var J=require("@raycast/api"),U=require("path"),G=require("fs/promises"),B=require("child_process");async function K(o,...i){if(process.platform==="win32")return Promise.reject(new Error("Swift functions are not supported on Windows"));let a=(0,U.join)(J.environment.assetsPath,"compiled_raycast_swift/swift");return await(0,G.chmod)(a,"755"),new Promise((c,s)=>{let r=[o];for(let l of i)try{r.push(JSON.stringify(l,(w,m)=>m===void 0?null:m))}catch(w){s(new O("Failed to serialize input to JSON: "+w.message));return}let e=(0,B.spawn)(a,r),u=[],d=[];e.stdout?.on("data",l=>{u.push(l.toString())}),e.stderr?.on("data",l=>{d.push(l.toString())}),e.on("exit",l=>{if(l===0)try{let w=u.join("").trim();w.length!=0?c(JSON.parse(w)):c(null)}catch(w){let m=new O("Failed to deserialize result from JSON: "+w.message);m.stdout=u.join("").trim(),m.stderr=d.join("").trim(),s(m)}else{let w=new O(d.join("").trim()||u.join("").trim()||"Could not get any data");w.stdout=u.join("").trim(),w.stderr=d.join("").trim(),s(w)}}),e.on("error",l=>{s(l)})})}async function x(){return await K("getActiveWindowInfo")}async function X(o,i,a,c,s,r,e,u,d,l){return await K("resizeWindow",o,i,a,c,s,r,e,u,d,l)}var O=class extends Error{constructor(i){super(i),this.name="SwiftError"}};function q(o,i,a,c,s=!1){return X(void 0,o,i,a,c,void 0,void 0,void 0,void 0,s)}var j=new Set,M=new Set,Y=1e3;function Q(o,i){try{return`${String(o)}_${JSON.stringify(i)}`}catch{return String(o)}}function v(o,...i){let a=Q(o,i);j.has(a)||(j.add(a),setTimeout(()=>{j.delete(a)},Y),console.log(o,...i))}function h(o,...i){let a=Q(o,i);M.has(a)||(M.add(a),setTimeout(()=>{M.delete(a)},Y),console.error(o,...i))}function Z(){let[o,i]=(0,z.useState)(null),[a,c]=(0,z.useState)(!1),[s,r]=(0,z.useState)(null),e=(0,z.useRef)(!0);(0,z.useEffect)(()=>()=>{e.current=!1},[]);let u=async()=>{e.current&&(c(!0),r(null));try{let d=await x();if(!d)throw new Error("Failed to get window information");if(typeof d=="string"&&d.startsWith("Error:"))throw new Error(d);if(typeof d=="object"&&!Array.isArray(d)){let l=d;if(l.error)throw l.message?new Error(l.message):new Error("Unknown error occurred");if(l.window){let{position:w,size:m}=l.window,y={x:w.x,y:w.y,width:m.width,height:m.height};return l.app?v(`Active window info: ${l.app.name}.${l.app.processID}`,y):v("Active window info:",y),e.current&&i(y),y}}throw new Error("Invalid window information format")}catch(d){if(e.current){let l=d instanceof Error?d.message:String(d);h("Error getting window info:",l),r(new Error(l))}return null}finally{e.current&&c(!1)}};return{windowInfo:o,isLoading:a,error:s,getWindowInfo:u,refreshWindowInfo:u}}var $=require("@raycast/api"),g=require("react");function ee(o,i){return!o||i<=0?!1:Date.now()-o.timestamp<i}function N(o){return{value:o,timestamp:Date.now()}}var H=3600*1e3;var k="window-states",te=H,ne=50;function oe(){let[o,i]=(0,g.useState)(null),a=(0,g.useRef)(!0),c=(0,g.useRef)([]),s=(0,g.useCallback)(n=>{a.current&&i(n)},[]),r=(0,g.useCallback)(()=>{let n=new AbortController;return a.current?c.current.push(n):n.abort(),n},[]),e=(0,g.useCallback)(n=>{n.signal.aborted||(c.current=c.current.filter(t=>t!==n))},[]),u=(0,g.useCallback)(async()=>{let n=r();try{if(o&&ee(o,te))return e(n),o.value;if(n.signal.aborted)throw new Error("Operation aborted");let t=await $.LocalStorage.getItem(k);if(t&&!n.signal.aborted){let f=JSON.parse(t);return s(N(f)),e(n),f}}catch(t){t instanceof Error&&t.message==="Operation aborted"?v("Load operation aborted"):h("Error loading window states:",t)}if(!n.signal.aborted){let t=N({});return s(t),e(n),t.value}return e(n),{}},[o,r,e,s]),d=(0,g.useCallback)(async n=>{let t=r();try{if(t.signal.aborted)return;s(N(n)),await $.LocalStorage.setItem(k,JSON.stringify(n))}catch(f){h("Error saving window states:",f)}finally{e(t)}},[r,e,s]),l=(0,g.useCallback)(async n=>{if(Object.keys(n).length<=ne)return n;let t=Object.entries(n).sort(([,I],[,R])=>I.timestamp-R.timestamp),f=t.slice(-ne),p=Object.fromEntries(f);return v(`Limited window states from ${t.length} to ${f.length}`),p},[]),w=(0,g.useCallback)(async(n,t)=>{let f=r();try{if(f.signal.aborted)return!1;let p=o?.value??await u();if(f.signal.aborted)return!1;let I={...p,[n]:t},R=await l(I);if(f.signal.aborted)return!1;try{await $.LocalStorage.setItem(k,JSON.stringify(R));let F=N(R);return s(F),!0}catch(F){return h(`Error persisting window state for ${n}:`,F),!1}}catch(p){return h(`Error updating window state for ${n}:`,p),!1}finally{e(f)}},[o,u,s,l,r,e]),m=(0,g.useCallback)(async()=>{let n=r();try{if(n.signal.aborted)return null;let t=await x();if(n.signal.aborted)return null;if(t.error||!t.app||!t.window)throw new Error("Failed to get window information");let f=String(t.app.processID),p=t.window.size,I=t.window.position;return{windowId:t.windowRefID?`${encodeURIComponent(t.app.name)}_${f}_${t.windowRefID}`:`${encodeURIComponent(t.app.name)}_${f}`,size:{width:p.width,height:p.height},position:{x:I.x,y:I.y},timestamp:Date.now()}}catch(t){return h("Error getting window info:",t),null}finally{e(n)}},[r,e]),y=(0,g.useCallback)(async()=>{let n=r();try{if(n.signal.aborted)return!1;let t=await m();if(n.signal.aborted)return!1;if(!t)return h("No active window found"),!1;let f=t.windowId,p=await w(f,t);return p&&v("Saved window info: ",t),p}catch(t){return h("Error saving window state:",t),!1}finally{e(n)}},[m,w,r,e]),E=(0,g.useCallback)(async()=>{let n=r();try{if(n.signal.aborted)return;let t=await u();if(n.signal.aborted)return;let f=Date.now(),p=!1,I={...t};for(let R in I)f-I[R].timestamp>te&&(v(`Removing expired window info: ${R}`),delete I[R],p=!0);p&&!n.signal.aborted&&await d(I)}catch(t){h("Error cleaning up expired states:",t)}finally{e(n)}},[u,d,r,e]),V=(0,g.useCallback)(async()=>{let n=r();try{if(n.signal.aborted)return null;let t=await m();if(n.signal.aborted)return null;if(!t)return h("No active window found for getting state"),null;let f=t.windowId,p=await u();return n.signal.aborted?null:p[f]?(v(`Found state for ${f}`),p[f]):(v(`No state found for ${f}`),null)}catch(t){return h("Error getting window state:",t),null}finally{e(n)}},[m,u,r,e]);return(0,g.useEffect)(()=>{a.current=!0,E();let n=setInterval(()=>{E()},H);return()=>{a.current=!1,clearInterval(n),c.current.forEach(t=>{t.abort()}),c.current=[]}},[E]),{saveWindowState:y,cleanupExpiredStates:E,getWindowState:V,createOperation:r}}function ie(){let{getWindowInfo:o}=Z(),{saveWindowState:i}=oe();async function a(c,s,r){try{let e=await o();if(!e){await r.onNoWindow();return}let{x:u,y:d,width:l,height:w}=e;if(l===c&&w===s){await r.onAlreadyResized(c,s);return}await i()||h("Failed to save window state before resize"),await(0,re.closeMainWindow)();try{let y=await q(c,s,u,d);v(`Size comparison - Requested: ${c}\xD7${s}, Actual: ${y.width}\xD7${y.height}`);let{width:E,height:V,requestedWidth:n,requestedHeight:t}=y,f=5,p=Math.abs(E-n)>f||Math.abs(V-t)>f;await r.onResizeComplete(y.width,y.height,p)}catch{throw new Error("Failed to set window size")}}catch(e){h("\u{1F6D1} Error resizing window:",e),await r.onError(e)}}return{adjustWindowSize:a}}function se(){let{adjustWindowSize:o}=ie();async function i(a,c){await o(a,c,{onNoWindow:async()=>{await(0,W.showHUD)("\u{1F6D1} No focused window",{popToRootType:W.PopToRootType.Immediate})},onAlreadyResized:async(s,r)=>{await(0,W.showHUD)(`\u2714\uFE0F Already in ${s}\xD7${r}`,{popToRootType:W.PopToRootType.Immediate})},onResizeComplete:async(s,r,e)=>{await(0,W.showHUD)(`\u2199\u2197 Resized to ${s}\xD7${r}${e?" (Restricted)":""}`,{popToRootType:W.PopToRootType.Immediate})},onError:async s=>{let r=String(s);r.includes("frontmost")||r.includes("window")||r.includes("process")||r.includes("Failed to get screen information")?await(0,W.showHUD)("\u{1F6D1} No focused window",{popToRootType:W.PopToRootType.Immediate}):await(0,W.showHUD)("\u{1F6D1} Resize failed",{popToRootType:W.PopToRootType.Immediate})}})}return{resizeWindow:i}}var de=require("@raycast/api"),b=require("react");var S=require("@raycast/api"),_=require("react"),P=require("react/jsx-runtime");function A({isResizing:o=!1,isInvalidSize:i=!1}){let[a,c]=(0,_.useState)(!1);(0,_.useEffect)(()=>{let d=setTimeout(()=>{c(!0)},50);return()=>clearTimeout(d)},[]);let s=()=>a?i?"invalid":o?"resizing":"empty":"initializing",r=d=>({invalid:{icon:"icons/fav-size-invalid.svg",title:"Invalid or Missing Size Value",description:"Set positive numbers for both width and height."},resizing:{icon:"icons/fav-size-resizing.svg",title:"Resizing Window...",description:""},empty:{icon:"icons/fav-size-empty.svg",title:"Set your Favorite Size first",description:"Press \u23CE to open the command settings."},initializing:{icon:"icons/fav-size-empty.svg",title:"Loading...",description:""}})[d],e=s(),u=r(e);return(0,P.jsx)(S.List,{filtering:!1,isLoading:!a,children:(0,P.jsx)(S.List.EmptyView,{icon:u.icon,title:u.title,description:u.description,actions:e!=="resizing"&&(0,P.jsx)(S.ActionPanel,{children:(0,P.jsx)(S.Action,{title:"Open Settings",icon:S.Icon.Gear,onAction:async()=>{await(0,S.openCommandPreferences)(),await(0,S.popToRoot)()}})})})})}var ae=require("@raycast/api"),T=require("react");function ce(){let[o,i]=(0,T.useState)(null),[a,c]=(0,T.useState)(!0),[s,r]=(0,T.useState)(!0);return(0,T.useEffect)(()=>{try{let e=(0,ae.getPreferenceValues)(),u=e.favWidth?(()=>{let m=parseInt(e.favWidth,10);return isNaN(m)?null:m})():null,d=e.favHeight?(()=>{let m=parseInt(e.favHeight,10);return isNaN(m)?null:m})():null,l=!e.favWidth||!isNaN(Number(e.favWidth)),w=!e.favHeight||!isNaN(Number(e.favHeight));l&&w&&u&&d&&u>0&&d>0?(i({width:u,height:d}),r(!0)):e.favWidth||e.favHeight?(i(null),r(!1)):(i(null),r(!0))}catch(e){console.error("Error loading saved resolution:",e),i(null),r(!1)}finally{c(!1)}},[]),{savedResolution:o,isLoading:a,isValid:s}}var C=require("react/jsx-runtime");function le(){let{resizeWindow:o}=se(),[i,a]=(0,b.useState)(!1),{savedResolution:c,isLoading:s,isValid:r}=ce(),e=(0,b.useRef)(!1),u=(0,b.useRef)(!1);return(0,b.useEffect)(()=>{if(e.current||u.current)return;async function d(){if(c){e.current=!0;try{a(!0),await o(c.width,c.height),await(0,de.popToRoot)(),u.current=!0}catch(l){console.error("Error applying saved resolution:",l),await(0,L.showToast)({style:L.Toast.Style.Failure,title:"Resize failed"})}finally{a(!1),e.current=!1}}}d()},[c,o]),i?(0,C.jsx)(A,{isResizing:!0}):s?(0,C.jsx)(A,{}):r?c?(0,C.jsx)(A,{isResizing:!0}):(0,C.jsx)(A,{}):(0,C.jsx)(A,{isInvalidSize:!0})}
