"use strict";var te=Object.create;var $=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ae=Object.getPrototypeOf,se=Object.prototype.hasOwnProperty;var ie=(t,e)=>{for(var r in e)$(t,r,{get:e[r],enumerable:!0})},I=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of ne(e))!se.call(t,a)&&a!==r&&$(t,a,{get:()=>e[a],enumerable:!(n=re(e,a))||n.enumerable});return t};var y=(t,e,r)=>(r=t!=null?te(ae(t)):{},I(e||!t||!t.__esModule?$(r,"default",{value:t,enumerable:!0}):r,t)),oe=t=>I($({},"__esModule",{value:!0}),t);var Ie={};ie(Ie,{default:()=>Q});module.exports=oe(Ie);var Z=require("@raycast/api");var p=y(require("react")),c=require("@raycast/api");var m=y(require("node:fs")),w=y(require("node:path"));var M=y(require("node:child_process")),N=require("node:buffer"),b=y(require("node:stream")),B=require("node:util");var W=require("react/jsx-runtime");var x=globalThis;function T(t,e){let r=t instanceof Error?t.message:String(t);return(0,c.showToast)({style:c.Toast.Style.Failure,title:e?.title??"Something went wrong",message:e?.message??r,primaryAction:e?.primaryAction??C(t),secondaryAction:e?.primaryAction?C(t):void 0})}var C=t=>{let e=!0,r="[Extension Name]...",n="";try{let s=JSON.parse((0,m.readFileSync)((0,w.join)(c.environment.assetsPath,"..","package.json"),"utf8"));r=`[${s.title}]...`,n=`https://raycast.com/${s.owner||s.author}/${s.name}`,(!s.owner||s.access==="public")&&(e=!1)}catch{}let a=c.environment.isDevelopment||e,i=t instanceof Error?t?.stack||t?.message||"":String(t);return{title:a?"Copy Logs":"Report Error",onAction(s){s.hide(),a?c.Clipboard.copy(i):(0,c.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(n)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${i}
\`\`\`
`)}`)}}};var k=t=>!!t&&typeof t=="object"&&typeof t.removeListener=="function"&&typeof t.emit=="function"&&typeof t.reallyExit=="function"&&typeof t.listeners=="function"&&typeof t.kill=="function"&&typeof t.pid=="number"&&typeof t.on=="function",v=Symbol.for("signal-exit emitter"),E=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),x[v])return x[v];Object.defineProperty(x,v,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(e,r){this.listeners[e].push(r)}removeListener(e,r){let n=this.listeners[e],a=n.indexOf(r);a!==-1&&(a===0&&n.length===1?n.length=0:n.splice(a,1))}emit(e,r,n){if(this.emitted[e])return!1;this.emitted[e]=!0;let a=!1;for(let i of this.listeners[e])a=i(r,n)===!0||a;return e==="exit"&&(a=this.emit("afterExit",r,n)||a),a}},A=class{onExit(){return()=>{}}load(){}unload(){}},_=class{#o;#t;#e;#s;#i;#a;#n;#r;constructor(e){this.#o=process.platform==="win32"?"SIGINT":"SIGHUP",this.#t=new E,this.#a={},this.#n=!1,this.#r=[],this.#r.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#r.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#r.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#e=e,this.#a={};for(let r of this.#r)this.#a[r]=()=>{let n=this.#e.listeners(r),{count:a}=this.#t,i=e;if(typeof i.__signal_exit_emitter__=="object"&&typeof i.__signal_exit_emitter__.count=="number"&&(a+=i.__signal_exit_emitter__.count),n.length===a){this.unload();let s=this.#t.emit("exit",null,r),f=r==="SIGHUP"?this.#o:r;s||e.kill(e.pid,f)}};this.#i=e.reallyExit,this.#s=e.emit}onExit(e,r){if(!k(this.#e))return()=>{};this.#n===!1&&this.load();let n=r?.alwaysLast?"afterExit":"exit";return this.#t.on(n,e),()=>{this.#t.removeListener(n,e),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#n){this.#n=!0,this.#t.count+=1;for(let e of this.#r)try{let r=this.#a[e];r&&this.#e.on(e,r)}catch{}this.#e.emit=(e,...r)=>this.#l(e,...r),this.#e.reallyExit=e=>this.#c(e)}}unload(){this.#n&&(this.#n=!1,this.#r.forEach(e=>{let r=this.#a[e];if(!r)throw new Error("Listener not defined for signal: "+e);try{this.#e.removeListener(e,r)}catch{}}),this.#e.emit=this.#s,this.#e.reallyExit=this.#i,this.#t.count-=1)}#c(e){return k(this.#e)?(this.#e.exitCode=e||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#l(e,...r){let n=this.#s;if(e==="exit"&&k(this.#e)){typeof r[0]=="number"&&(this.#e.exitCode=r[0]);let a=n.call(this.#e,e,...r);return this.#t.emit("exit",this.#e.exitCode,null),a}else return n.call(this.#e,e,...r)}},S=null,ce=(t,e)=>(S||(S=k(process)?new _(process):new A),S.onExit(t,e));function le(t,{timeout:e}={}){let r=new Promise((f,o)=>{t.on("exit",(h,d)=>{f({exitCode:h,signal:d,timedOut:!1})}),t.on("error",h=>{o(h)}),t.stdin&&t.stdin.on("error",h=>{o(h)})}),n=ce(()=>{t.kill()});if(e===0||e===void 0)return r.finally(()=>n());let a,i=new Promise((f,o)=>{a=setTimeout(()=>{t.kill("SIGTERM"),o(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},e)}),s=r.finally(()=>{clearTimeout(a)});return Promise.race([i,s]).finally(()=>n())}var R=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function ue(t){let{encoding:e}=t,r=e==="buffer",n=new b.default.PassThrough({objectMode:!1});e&&e!=="buffer"&&n.setEncoding(e);let a=0,i=[];return n.on("data",s=>{i.push(s),a+=s.length}),n.getBufferedValue=()=>r?Buffer.concat(i,a):i.join(""),n.getBufferedLength=()=>a,n}async function U(t,e){let r=ue(e);return await new Promise((n,a)=>{let i=s=>{s&&r.getBufferedLength()<=N.constants.MAX_LENGTH&&(s.bufferedData=r.getBufferedValue()),a(s)};(async()=>{try{await(0,B.promisify)(b.default.pipeline)(t,r),n()}catch(s){i(s)}})(),r.on("data",()=>{r.getBufferedLength()>8e7&&i(new R)})}),r.getBufferedValue()}async function L(t,e){t.destroy();try{return await e}catch(r){return r.bufferedData}}async function fe({stdout:t,stderr:e},{encoding:r},n){let a=U(t,{encoding:r}),i=U(e,{encoding:r});try{return await Promise.all([n,a,i])}catch(s){return Promise.all([{error:s,exitCode:null,signal:s.signal,timedOut:s.timedOut||!1},L(t,a),L(e,i)])}}function de(t){let e=typeof t=="string"?`
`:10,r=typeof t=="string"?"\r":13;return t[t.length-1]===e&&(t=t.slice(0,-1)),t[t.length-1]===r&&(t=t.slice(0,-1)),t}function D(t,e){return t.stripFinalNewline?de(e):e}function he({timedOut:t,timeout:e,signal:r,exitCode:n}){return t?`timed out after ${e} milliseconds`:r!=null?`was killed with ${r}`:n!=null?`failed with exit code ${n}`:"failed"}function pe({stdout:t,stderr:e,error:r,signal:n,exitCode:a,command:i,timedOut:s,options:f,parentError:o}){let d=`Command ${he({timedOut:s,timeout:f?.timeout,signal:n,exitCode:a})}: ${i}`,l=r?`${d}
${r.message}`:d,u=[l,e,t].filter(Boolean).join(`
`);return r?r.originalMessage=r.message:r=o,r.message=u,r.shortMessage=l,r.command=i,r.exitCode=a,r.signal=n,r.stdout=t,r.stderr=e,"bufferedData"in r&&delete r.bufferedData,r}function me({stdout:t,stderr:e,error:r,exitCode:n,signal:a,timedOut:i,command:s,options:f,parentError:o}){if(r||n!==0||a!==null)throw pe({error:r,exitCode:n,signal:a,stdout:t,stderr:e,command:s,timedOut:i,options:f,parentError:o});return t}async function P(t,e,r){if(process.platform!=="darwin")throw new Error("AppleScript is only supported on macOS");let{humanReadableOutput:n,language:a,timeout:i,...s}=Array.isArray(e)?r||{}:e||{},f=n!==!1?[]:["-ss"];a==="JavaScript"&&f.push("-l","JavaScript"),Array.isArray(e)&&f.push("-",...e);let o=M.default.spawn("osascript",f,{...s,env:{PATH:"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"}}),h=le(o,{timeout:i??1e4});o.stdin.end(t);let[{error:d,exitCode:l,signal:u,timedOut:g},Y,q]=await fe(o,{encoding:"utf8"},h),X=D({stripFinalNewline:!0},Y),ee=D({stripFinalNewline:!0},q);return me({stdout:X,stderr:ee,error:d,exitCode:l,signal:u,timedOut:g,command:"osascript",options:r,parentError:new Error})}function V(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),r.push.apply(r,n)}return r}function F(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?V(Object(r),!0).forEach(function(n){ge(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):V(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function ge(t,e,r){return e=be(e),e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function be(t){var e=ye(t,"string");return typeof e=="symbol"?e:String(e)}function ye(t,e){if(typeof t!="object"||t===null)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var $e=j({}),O=$e;function j(t){return e.withOptions=r=>j(F(F({},t),r)),e;function e(r,...n){let a=typeof r=="string"?[r]:r.raw,{alignValues:i=!1,escapeSpecialCharacters:s=Array.isArray(r),trimWhitespace:f=!0}=t,o="";for(let l=0;l<a.length;l++){let u=a[l];if(s&&(u=u.replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`").replace(/\\\$/g,"$").replace(/\\\{/g,"{")),o+=u,l<n.length){let g=i?ke(n[l],o):n[l];o+=g}}let h=o.split(`
`),d=null;for(let l of h){let u=l.match(/^(\s+)\S+/);if(u){let g=u[1].length;d?d=Math.min(d,g):d=g}}if(d!==null){let l=d;o=h.map(u=>u[0]===" "||u[0]==="	"?u.slice(l):u).join(`
`)}return f&&(o=o.trim()),s&&(o=o.replace(/\\n/g,`
`)),o}}function ke(t,e){if(typeof t!="string"||!t.includes(`
`))return t;let n=e.slice(e.lastIndexOf(`
`)+1).match(/^(\s+)/);if(n){let a=n[1];return t.replace(/\n/g,`
${a}`)}return t}var z=require("@raycast/api");function K(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}var H=require("react"),Pe=require("@raycast/api");var Oe=require("react/jsx-runtime");async function J(t){if(t){let e=K(t);await P(O`
        tell application "Dia"
          activate
          tell application "System Events"
            tell process "Dia"
              tell menu bar item "File" of menu bar 1
                click
                tell menu item "New Window" of menu "File"
                  click
                  delay 0.1
                  click menu item "New ${e} Window" of menu 1
                end tell
              end tell
            end tell
          end tell
        end tell
      `)}else await P(O`
        tell application "Dia"
          activate
          tell application "System Events"
            keystroke "n" using {command down}
          end tell
        end tell
      `)}async function Q(t){try{await(0,Z.closeMainWindow)(),await J(t.arguments.profile)}catch(e){await T(e,{title:"Could not open a new Dia window"})}}
