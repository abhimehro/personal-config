"use strict";var _e=Object.create;var M=Object.defineProperty;var Te=Object.getOwnPropertyDescriptor;var Pe=Object.getOwnPropertyNames;var Re=Object.getPrototypeOf,Ie=Object.prototype.hasOwnProperty;var Ce=(e,t)=>{for(var r in t)M(e,r,{get:t[r],enumerable:!0})},oe=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Pe(t))!Ie.call(e,a)&&a!==r&&M(e,a,{get:()=>t[a],enumerable:!(n=Te(t,a))||n.enumerable});return e};var N=(e,t,r)=>(r=e!=null?_e(Re(e)):{},oe(t||!e||!e.__esModule?M(r,"default",{value:e,enumerable:!0}):r,e)),Oe=e=>oe(M({},"__esModule",{value:!0}),e);var je={};Ce(je,{default:()=>$e});module.exports=Oe(je);var g=require("@raycast/api"),se=require("react");var Q="Dia is not installed",Y="No bookmarks found",q="Bookmarks file not found";function X(e){if(!e)return{includeTerms:[],excludeTerms:[]};let t=e.trim().split(/\s+/),r=[],n=[];for(let a of t)a.startsWith("\\-")&&a.length>1?r.push(a.slice(1).toLowerCase()):a.startsWith("-")&&a.length>1?n.push(a.slice(1).toLowerCase()):a.length>0&&a!=="-"&&r.push(a.toLowerCase());return{includeTerms:r,excludeTerms:n}}function V(e,t){let{includeTerms:r,excludeTerms:n}=t,a=r.length===0||r.every(s=>e.includes(s)),i=n.length===0||!n.some(s=>e.includes(s));return a&&i}var re=N(require("fs"));var f=N(require("react")),o=require("@raycast/api");var ce=Object.prototype.hasOwnProperty;function W(e,t){var r,n;if(e===t)return!0;if(e&&t&&(r=e.constructor)===t.constructor){if(r===Date)return e.getTime()===t.getTime();if(r===RegExp)return e.toString()===t.toString();if(r===Array){if((n=e.length)===t.length)for(;n--&&W(e[n],t[n]););return n===-1}if(!r||typeof e=="object"){n=0;for(r in e)if(ce.call(e,r)&&++n&&!ce.call(t,r)||!(r in t)||!W(e[r],t[r]))return!1;return Object.keys(t).length===n}}return e!==e&&t!==t}var P=N(require("node:fs")),F=N(require("node:path"));var ue=require("react/jsx-runtime");var fe=require("node:url");function Ue(e){let t=(0,f.useRef)(e),r=(0,f.useRef)(0);return W(e,t.current)||(t.current=e,r.current+=1),(0,f.useMemo)(()=>t.current,[r.current])}function E(e){let t=(0,f.useRef)(e);return t.current=e,t}function de(e,t){let r=e instanceof Error?e.message:String(e);return(0,o.showToast)({style:o.Toast.Style.Failure,title:t?.title??"Something went wrong",message:t?.message??r,primaryAction:t?.primaryAction??le(e),secondaryAction:t?.primaryAction?le(e):void 0})}var le=e=>{let t=!0,r="[Extension Name]...",n="";try{let s=JSON.parse((0,P.readFileSync)((0,F.join)(o.environment.assetsPath,"..","package.json"),"utf8"));r=`[${s.title}]...`,n=`https://raycast.com/${s.owner||s.author}/${s.name}`,(!s.owner||s.access==="public")&&(t=!1)}catch{}let a=o.environment.isDevelopment||t,i=e instanceof Error?e?.stack||e?.message||"":String(e);return{title:a?"Copy Logs":"Report Error",onAction(s){s.hide(),a?o.Clipboard.copy(i):(0,o.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(r)}&extension-url=${encodeURI(n)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${i}
\`\`\`
`)}`)}}};function ee(e,t,r){let n=(0,f.useRef)(0),[a,i]=(0,f.useState)({isLoading:!0}),s=E(e),h=E(r?.abortable),u=E(t||[]),w=E(r?.onError),d=E(r?.onData),p=E(r?.onWillExecute),m=E(r?.failureToastOptions),c=E(a.data),v=(0,f.useRef)(null),$=(0,f.useRef)({page:0}),J=(0,f.useRef)(!1),Z=(0,f.useRef)(!0),ie=(0,f.useRef)(50),A=(0,f.useCallback)(()=>(h.current&&(h.current.current?.abort(),h.current.current=new AbortController),++n.current),[h]),_=(0,f.useCallback)((...S)=>{let k=A();p.current?.(S),i(l=>({...l,isLoading:!0}));let I=Le(s.current)(...S);function C(l){return l.name=="AbortError"||k===n.current&&(w.current?w.current(l):o.environment.launchType!==o.LaunchType.Background&&de(l,{title:"Failed to fetch latest data",primaryAction:{title:"Retry",onAction(T){T.hide(),v.current?.(...u.current||[])}},...m.current}),i({error:l,isLoading:!1})),l}return typeof I=="function"?(J.current=!0,I($.current).then(({data:l,hasMore:T,cursor:Ee})=>(k===n.current&&($.current&&($.current.cursor=Ee,$.current.lastItem=l?.[l.length-1]),d.current&&d.current(l,$.current),T&&(ie.current=l.length),Z.current=T,i(Ae=>$.current.page===0?{data:l,isLoading:!1}:{data:(Ae.data||[])?.concat(l),isLoading:!1})),l),l=>(Z.current=!1,C(l)))):(J.current=!1,I.then(l=>(k===n.current&&(d.current&&d.current(l),i({data:l,isLoading:!1})),l),C))},[d,w,u,s,i,v,p,$,m,A]);v.current=_;let B=(0,f.useCallback)(()=>{$.current={page:0};let S=u.current||[];return _(...S)},[_,u]),ke=(0,f.useCallback)(async(S,k)=>{let I;try{if(k?.optimisticUpdate){A(),typeof k?.rollbackOnError!="function"&&k?.rollbackOnError!==!1&&(I=structuredClone(c.current?.value));let C=k.optimisticUpdate;i(l=>({...l,data:C(l.data)}))}return await S}catch(C){if(typeof k?.rollbackOnError=="function"){let l=k.rollbackOnError;i(T=>({...T,data:l(T.data)}))}else k?.optimisticUpdate&&k?.rollbackOnError!==!1&&i(l=>({...l,data:I}));throw C}finally{k?.shouldRevalidateAfter!==!1&&(o.environment.launchType===o.LaunchType.Background||o.environment.commandMode==="menu-bar"?await B():B())}},[B,c,i,A]),we=(0,f.useCallback)(()=>{$.current.page+=1;let S=u.current||[];_(...S)},[$,u,_]);(0,f.useEffect)(()=>{$.current={page:0},r?.execute!==!1?_(...t||[]):A()},[Ue([t,r?.execute,_]),h,$]),(0,f.useEffect)(()=>()=>{A()},[A]);let xe=r?.execute!==!1?a.isLoading:!1,ve={...a,isLoading:xe},Se=J.current?{pageSize:ie.current,hasMore:Z.current,onLoadMore:we}:void 0;return{...ve,revalidate:B,mutate:ke,pagination:Se}}function Le(e){return e===Promise.all||e===Promise.race||e===Promise.resolve||e===Promise.reject?e.bind(Promise):e}function he(e,t){try{let r=s=>s.startsWith("http")?s:`https://${s}`,a=(typeof e=="string"?new fe.URL(r(e)):e).hostname;switch(process.env.FAVICON_PROVIDER??"raycast"){case"none":return{source:t?.fallback??o.Icon.Link,mask:t?.mask};case"apple":return{source:t?.fallback??o.Icon.Link,mask:t?.mask};case"duckduckgo":case"duckDuckGo":return{source:`https://icons.duckduckgo.com/ip3/${a}.ico`,fallback:t?.fallback??o.Icon.Link,mask:t?.mask};case"google":return{source:`https://www.google.com/s2/favicons?sz=${t?.size??64}&domain=${a}`,fallback:t?.fallback??o.Icon.Link,mask:t?.mask};case"legacy":case"raycast":default:return{source:`https://api.ray.so/favicon?url=${a}&size=${t?.size??64}`,fallback:t?.fallback??o.Icon.Link,mask:t?.mask}}}catch(r){return console.error(r),o.Icon.Link}}var O=require("path"),z=require("os"),te=require("fs");function pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pe(Object(r),!0).forEach(function(n){De(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pe(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function De(e,t,r){return t=Be(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Be(e){var t=Me(e,"string");return typeof t=="symbol"?t:String(t)}function Me(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Qe=ge({});function ge(e){return t.withOptions=r=>ge(me(me({},e),r)),t;function t(r,...n){let a=typeof r=="string"?[r]:r.raw,{alignValues:i=!1,escapeSpecialCharacters:s=Array.isArray(r),trimWhitespace:h=!0}=e,u="";for(let p=0;p<a.length;p++){let m=a[p];if(s&&(m=m.replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`").replace(/\\\$/g,"$").replace(/\\\{/g,"{")),u+=m,p<n.length){let c=i?Ne(n[p],u):n[p];u+=c}}let w=u.split(`
`),d=null;for(let p of w){let m=p.match(/^(\s+)\S+/);if(m){let c=m[1].length;d?d=Math.min(d,c):d=c}}if(d!==null){let p=d;u=w.map(m=>m[0]===" "||m[0]==="	"?m.slice(p):m).join(`
`)}return h&&(u=u.trim()),s&&(u=u.replace(/\\n/g,`
`)),u}}function Ne(e,t){if(typeof e!="string"||!e.includes(`
`))return e;let n=t.slice(t.lastIndexOf(`
`)+1).match(/^(\s+)/);if(n){let a=n[1];return e.replace(/\n/g,`
${a}`)}return e}var j=require("@raycast/api");function be(e){let t=["javascript:","data:","about:","chrome:","file:"],r=e.toLowerCase().trim();return t.some(n=>r.startsWith(n))?{source:j.Icon.Link,tintColor:j.Color.SecondaryText}:he(e)}function Ve(){let e=(0,O.resolve)((0,z.homedir)(),"Library/Application Support/Dia/User Data/Local State");try{let t=(0,te.readFileSync)(e,"utf-8"),n=JSON.parse(t).profile.last_used||"Default";return(0,O.resolve)((0,z.homedir)(),`Library/Application Support/Dia/User Data/${n}`)}catch(t){return console.error("Error reading Local State:",t),(0,O.resolve)((0,z.homedir)(),"Library/Application Support/Dia/User Data/Default")}}function ye(){return(0,O.resolve)(Ve(),"Bookmarks")}async function K(){let e=ye();if(!re.default.existsSync(e))throw new Error(q);let t=await re.default.promises.readFile(e,{encoding:"utf-8"}),r=JSON.parse(t),n={id:"root",name:"Bookmarks",type:"folder",date_added:"0",children:[]};return r.roots&&Object.entries(r.roots).forEach(([a,i])=>{if(i&&typeof i=="object"&&"children"in i){let s=i,h=a==="bookmark_bar"?"Bookmarks Bar":a==="other"?"Other Bookmarks":a==="synced"?"Mobile Bookmarks":s.name||a;n.children.push({...s,name:h})}}),n}function ne(e,t){if(t.length===0)return e;let r=e;for(let n of t){let a=r.children.find(i=>i.id===n&&i.type==="folder");if(!a)return null;r=a}return r}function U(e,t,r){return{id:e.id,name:e.name,type:e.type,url:e.url,path:t,idPath:r,children:e.children}}function G(e,t,r=[],n=[]){let a=[],i=X(t);for(let s of e.children)if(s.type==="url"&&s.url){let h=`${s.name.toLowerCase()} ${s.url.toLowerCase()}`;V(h,i)&&a.push(U(s,[...r,s.name],[...n]))}else if(s.type==="folder"){let h=V(s.name.toLowerCase(),i),u=[...n,s.id];h&&a.push(U(s,[...r,s.name],u)),a.push(...G(s,t,[...r,s.name],u))}return a}var L=require("react"),D=require("@raycast/api");var R=require("react/jsx-runtime");function We(){return(0,R.jsx)(D.List,{children:(0,R.jsx)(D.List.EmptyView,{title:"Dia is not installed",description:"Please install Dia browser to use this extension"})})}function Fe(){return(0,R.jsx)(D.List,{children:(0,R.jsx)(D.List.EmptyView,{title:"An error occurred",description:"Please try again later"})})}function ae(e,t){let[r,n]=(0,L.useState)(!1),[a,i]=(0,L.useState)(),{isLoading:s,data:h,revalidate:u}=ee(async()=>{let d=await K();return i(void 0),n(d.children.length===0),d},[],{onError(d){d.message===Q?i((0,R.jsx)(We,{})):d.message===Y?n(!0):i((0,R.jsx)(Fe,{}))}}),w=(0,L.useMemo)(()=>{if(!h||r)return[];if(e.trim())return G(h,e);let d=ne(h,t);if(!d)return[];let p=[],m=h;for(let c of t){let v=m.children.find($=>$.id===c&&$.type==="folder");v&&(p.push(v.name),m=v)}return d.children.map(c=>{let v=c.type==="folder"?[...t,c.id]:t;return U(c,[...p,c.name],v)})},[h,e,t,r]);return{errorView:a,isLoading:s,items:w,currentPath:t,revalidate:u}}var b=require("@raycast/api");var x=require("react/jsx-runtime");function H({item:e,onNavigate:t}){if(e.type==="folder"){if(!t)return null;let r=e.children?.length||0;return(0,x.jsx)(b.List.Item,{id:e.id,title:e.name,icon:{source:b.Icon.Folder,tintColor:b.Color.Blue},accessories:[{text:`${r} item${r!==1?"s":""}`}],actions:(0,x.jsx)(b.ActionPanel,{title:e.name,children:(0,x.jsx)(b.Action,{title:"Open Folder",icon:b.Icon.ArrowRight,onAction:()=>t(e.idPath)})})})}if(e.url){let r=e.path.length>1?e.path.slice(0,-1).join(" \u203A "):void 0;return(0,x.jsx)(b.List.Item,{id:e.id,title:e.name,subtitle:r,icon:be(e.url),actions:(0,x.jsxs)(b.ActionPanel,{title:e.name,children:[(0,x.jsx)(b.Action.Open,{icon:b.Icon.Globe,title:"Open Tab",target:e.url,application:"company.thebrowser.dia"}),(0,x.jsx)(b.Action.OpenInBrowser,{url:e.url,shortcut:{modifiers:["cmd"],key:"o"}}),(0,x.jsx)(b.Action.CopyToClipboard,{title:"Copy URL",content:e.url,shortcut:{modifiers:["cmd"],key:"c"}}),(0,x.jsx)(b.Action.CopyToClipboard,{title:"Copy Title",content:e.name,shortcut:{modifiers:["cmd","shift"],key:"c"}})]})})}return null}var y=require("react/jsx-runtime");function $e(){let[e,t]=(0,se.useState)(""),[r,n]=(0,se.useState)([]),{items:a,isLoading:i,errorView:s,currentPath:h}=ae(e,r);if(s)return s;let u=c=>{n(c),t("")},w=()=>{r.length>0&&(n(r.slice(0,-1)),t(""))},d=h.length>0?h.join(" \u203A "):"Bookmarks",p=a.filter(c=>c.type==="folder"),m=a.filter(c=>c.type==="url");return(0,y.jsxs)(g.List,{onSearchTextChange:t,isLoading:i,throttle:!0,searchBarPlaceholder:e?"Search all bookmarks...":"Search or browse bookmarks...",navigationTitle:d,actions:r.length>0?(0,y.jsx)(g.ActionPanel,{children:(0,y.jsx)(g.Action,{title:"Go Back",icon:g.Icon.ArrowLeft,onAction:w})}):void 0,children:[!e&&r.length>0&&(0,y.jsx)(g.List.Item,{title:"Back",icon:{source:g.Icon.ArrowLeft,tintColor:"#999"},actions:(0,y.jsx)(g.ActionPanel,{children:(0,y.jsx)(g.Action,{title:"Go Back",icon:g.Icon.ArrowLeft,onAction:w})})},"back"),!e&&p.length>0&&(0,y.jsx)(g.List.Section,{title:"Folders",children:p.map(c=>(0,y.jsx)(H,{item:c,onNavigate:u},c.id))}),!e&&m.length>0&&(0,y.jsx)(g.List.Section,{title:p.length>0?"Bookmarks":void 0,children:m.map(c=>(0,y.jsx)(H,{item:c,onNavigate:u},c.id))}),e&&a.length>0&&(0,y.jsx)(g.List.Section,{title:`${a.length} result${a.length!==1?"s":""}`,children:a.map(c=>(0,y.jsx)(H,{item:c,onNavigate:u},c.id))}),!i&&a.length===0&&e&&(0,y.jsx)(g.List.EmptyView,{title:"No bookmarks found",description:`No bookmarks match "${e}"`,icon:g.Icon.MagnifyingGlass}),!i&&a.length===0&&!e&&r.length>0&&(0,y.jsx)(g.List.EmptyView,{title:"Empty folder",description:"This folder contains no bookmarks",icon:g.Icon.Folder})]})}
