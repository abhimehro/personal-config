"use strict";var Pe=Object.create;var _=Object.defineProperty;var Ie=Object.getOwnPropertyDescriptor;var Ae=Object.getOwnPropertyNames;var Ce=Object.getPrototypeOf,Ee=Object.prototype.hasOwnProperty;var Te=(r,c)=>{for(var h in c)_(r,h,{get:c[h],enumerable:!0})},X=(r,c,h,k)=>{if(c&&typeof c=="object"||typeof c=="function")for(let b of Ae(c))!Ee.call(r,b)&&b!==h&&_(r,b,{get:()=>c[b],enumerable:!(k=Ie(c,b))||k.enumerable});return r};var F=(r,c,h)=>(h=r!=null?Pe(Ce(r)):{},X(c||!r||!r.__esModule?_(h,"default",{value:r,enumerable:!0}):h,r)),Re=r=>X(_({},"__esModule",{value:!0}),r);var Ue={};Te(Ue,{default:()=>ie});module.exports=Re(Ue);var P=require("react"),e=require("@raycast/api"),ne=require("child_process"),ae=require("util"),w=require("os"),se=require("dns");var x=F(require("react")),u=require("@raycast/api");var v=F(require("node:fs")),N=F(require("node:path"));var te=require("react/jsx-runtime");function re(r,c){let h=r instanceof Error?r.message:String(r);return(0,u.showToast)({style:u.Toast.Style.Failure,title:c?.title??"Something went wrong",message:c?.message??h,primaryAction:c?.primaryAction??ee(r),secondaryAction:c?.primaryAction?ee(r):void 0})}var ee=r=>{let c=!0,h="[Extension Name]...",k="";try{let $=JSON.parse((0,v.readFileSync)((0,N.join)(u.environment.assetsPath,"..","package.json"),"utf8"));h=`[${$.title}]...`,k=`https://raycast.com/${$.owner||$.author}/${$.name}`,(!$.owner||$.access==="public")&&(c=!1)}catch{}let b=u.environment.isDevelopment||c,I=r instanceof Error?r?.stack||r?.message||"":String(r);return{title:b?"Copy Logs":"Report Error",onAction($){$.hide(),b?u.Clipboard.copy(I):(0,u.open)(`https://github.com/raycast/extensions/issues/new?&labels=extension%2Cbug&template=extension_bug_report.yml&title=${encodeURIComponent(h)}&extension-url=${encodeURI(k)}&description=${encodeURIComponent(`#### Error:
\`\`\`
${I}
\`\`\`
`)}`)}}};var a=require("react/jsx-runtime"),A=(0,ae.promisify)(ne.exec);function ie(){let[r,c]=(0,P.useState)(null),[h,k]=(0,P.useState)(!0),[b,I]=(0,P.useState)([]),[$,oe]=(0,P.useState)(!1),m=(0,e.getPreferenceValues)(),{push:W,pop:z}=(0,e.useNavigation)(),V="auto",C="blue",E="hierarchical",j=!0,O=V;(0,P.useEffect)(()=>{ce(),le()},[]);let ce=async()=>{try{let t=fe(),n=de(t);c({localIP:t,subnet:n,assignedIPs:[],recommendedIPs:[],devices:[],isScanning:!1,scanProgress:0}),m.autoScanOnOpen&&setTimeout(()=>{J()},500)}catch(t){re(t,{title:"Failed to initialize network information"})}finally{k(!1)}},le=async()=>{try{let t=await e.LocalStorage.getItem("scanHistory");if(t){let n=JSON.parse(t);I(n.map(s=>({...s,timestamp:new Date(s.timestamp)})))}}catch(t){console.error("Failed to load scan history:",t)}},ue=async(t,n,s)=>{try{let i=[{subnet:t,timestamp:new Date,assignedCount:n,recommendedCount:s},...b.slice(0,9)];I(i),await e.LocalStorage.setItem("scanHistory",JSON.stringify(i))}catch(i){console.error("Failed to save scan history:",i)}},fe=()=>{let t=(0,w.networkInterfaces)();for(let n of Object.keys(t)){let s=t[n];if(s){for(let i of s)if(i.family==="IPv4"&&!i.internal&&i.address)return i.address}}return"192.168.1.1"},de=t=>{let n=t.split(".");return`${n[0]}.${n[1]}.${n[2]}.0/24`},he=async()=>{let t=new Map;try{let s=(0,w.platform)()==="win32"?"arp -a":"arp -n",{stdout:i}=await A(s),o=i.split(`
`);for(let f of o){let l=f.match(/(\d+\.\d+\.\d+\.\d+)\s+([0-9a-fA-F-:]+)/);if(l){let d=l[1],y=l[2].replace(/-/g,":").toUpperCase();t.set(d,y)}}}catch(n){console.error("Failed to get ARP table:",n)}return t},me=async t=>{try{let n=se.promises.reverse(t),s=new Promise((o,f)=>setTimeout(()=>f(new Error("DNS timeout")),2e3)),i=await Promise.race([n,s]);return i&&i.length>0?i[0]:void 0}catch{return}},T=t=>({21:"FTP",22:"SSH",23:"Telnet",25:"SMTP",53:"DNS",80:"HTTP",110:"POP3",143:"IMAP",443:"HTTPS",993:"IMAPS",995:"POP3S",8080:"HTTP-Alt",8443:"HTTPS-Alt",3306:"MySQL",5432:"PostgreSQL",27017:"MongoDB",6379:"Redis",9200:"Elasticsearch",11211:"Memcached"})[t]||`Port ${t}`,G=async(t,n)=>{let s=[],i=(0,w.platform)()==="win32",o=(0,w.platform)()==="darwin",f=n.length>0?n:[21,22,23,25,53,80,110,143,443,993,995,8080,8443];for(let l of f)try{let d="",y=!1;i?d=`powershell -Command "Test-NetConnection -ComputerName ${t} -Port ${l} -InformationLevel Quiet"`:o?d=`nc -z -G 1 ${t} ${l}`:d=`nc -z -w 1 ${t} ${l}`;try{await A(d,{timeout:2e3}),y=!0}catch{if(!i)try{d=`timeout 2 bash -c "</dev/tcp/${t}/${l}"`,await A(d,{timeout:2e3}),y=!0}catch{}}y&&s.push(l)}catch{}return s},D=(t,n)=>(0,w.platform)()==="win32"?`ping -n 1 -w ${n*1e3} ${t}`:`ping -c 1 -W ${n} ${t}`,pe=t=>(0,w.platform)()==="win32"?t.includes("Reply from")&&!t.includes("Request timed out"):t.includes("1 packets transmitted, 1 received")||t.includes("1 received")||t.includes("bytes from")||t.includes("time="),ge=t=>{if(!/^(\d{1,3}\.){3}\d{1,3}\/\d{1,2}$/.test(t))return!1;let s=t.split("/");if(s.length!==2)return!1;let i=s[0],o=parseInt(s[1]||"0",10);if(!i||Number.isNaN(o)||o<1||o>32)return!1;let f=i.split(".").map(l=>Number(l));return f.length!==4?!1:f.every(l=>!Number.isNaN(l)&&l>=0&&l<=255)},H=async(t,n,s,i)=>{if(r){c(o=>o?{...o,isScanning:!0,scanProgress:0}:null);try{(0,e.showToast)({style:e.Toast.Style.Animated,title:"Scanning Network",message:`Scanning ${t}...`});let o=[],f=[],l=t.split("/");if(l.length!==2)throw new Error("Invalid subnet format");let d=l[0],y=parseInt(l[1]||"0",10);if(!d||Number.isNaN(y))throw new Error("Invalid subnet format");let R=Math.pow(2,32-y)-2,xe=d.split(".").map(g=>Number(g));m.scanCommonRanges&&(R=Math.min(R,254));let M=Math.min(s,50),q=Math.ceil(R/M);for(let g=0;g<q;g++){let U=[];for(let S=0;S<M;S++){let p=g*M+S;if(p>=R)break;let L=B(xe,p);U.push(be(L,n,o))}if(await Promise.all(U),m.showProgressBar){let S=Math.round((g+1)/q*100);c(p=>p?{...p,scanProgress:S}:null)}}if(m.gatherDeviceInfo&&o.length>0){(0,e.showToast)({style:e.Toast.Style.Animated,title:"Gathering Device Info",message:m.scanPorts?"Getting MAC addresses, hostnames, and scanning ports...":"Getting MAC addresses and hostnames..."});let g=await he(),U=o.map(async p=>{let L=g.get(p),[ve,Q]=await Promise.all([me(p),m.scanPorts?G(p,[]):Promise.resolve([])]);return{ip:p,mac:L,manufacturer:void 0,hostname:ve,openPorts:Q.length>0?Q:void 0,isOnline:!0,lastSeen:new Date}}),S=await Promise.allSettled(U);f.push(...S.filter(p=>p.status==="fulfilled").map(p=>p.value))}else f.push(...o.map(g=>({ip:g,mac:void 0,manufacturer:void 0,hostname:void 0,openPorts:void 0,isOnline:!0,lastSeen:new Date})));let Y=$e(t,o,i);c(g=>g?{...g,assignedIPs:o,recommendedIPs:Y,devices:f,isScanning:!1,scanProgress:100,lastScanTime:new Date}:null),await ue(t,o.length,Y.length),(0,e.showToast)({style:e.Toast.Style.Success,title:"Scan Complete",message:`Found ${o.length} assigned IPs`})}catch(o){(0,e.showToast)({style:e.Toast.Style.Failure,title:"Scan Failed",message:o instanceof Error?o.message:"Unknown error"}),c(f=>f?{...f,isScanning:!1}:null)}}},B=(t,n)=>{let s=[...t];s[3]!==void 0&&(s[3]=s[3]+n+1);for(let i=3;i>0;i--)s[i]!==void 0&&s[i]>255&&(s[i]=s[i]%256,s[i-1]!==void 0&&s[i-1]++);return s.join(".")},be=async(t,n,s)=>{try{let i=D(t,n),{stdout:o}=await A(i,{timeout:(n+1)*1e3});pe(o)&&s.push(t)}catch{}},$e=(t,n,s)=>{let i=t.split("/");if(i.length!==2)return[];let o=i[0];if(!o)return[];let f=o.split(".").map(d=>Number(d)),l=[];for(let d=1;d<=254&&l.length<s;d++){let y=B(f,d-1);n.includes(y)||l.push(y)}return l},K=async(t,n,s)=>{let i=parseInt(m.defaultRecommendations,10)||10;await H(t,n,s,i)},J=()=>{if(!r)return;let t=parseFloat(m.defaultTimeout)||1,n=parseInt(m.defaultMaxThreads,10)||50;K(r.subnet,t,n)},ye=t=>{let n=t.subnet.trim();if(!ge(n)){(0,e.showToast)({style:e.Toast.Style.Failure,title:"Invalid Subnet",message:"Please enter a valid subnet in CIDR notation (e.g., 192.168.1.0/24)"});return}let s=parseFloat(t.timeout)||1,i=parseInt(t.maxThreads,10)||50,o=parseInt(t.recommendations,10)||10;c(f=>f?{...f,subnet:n,assignedIPs:[],recommendedIPs:[],devices:[],isScanning:!1,scanProgress:0}:null),z(),setTimeout(()=>{H(n,s,i,o)},100)},we=()=>{W((0,a.jsxs)(e.Form,{actions:(0,a.jsxs)(e.ActionPanel,{children:[(0,a.jsx)(e.Action.SubmitForm,{title:"Start Custom Scan",icon:e.Icon.Play,onSubmit:ye}),(0,a.jsx)(e.Action,{title:"Cancel",icon:e.Icon.XmarkCircle,onAction:()=>z()})]}),children:[(0,a.jsx)(e.Form.TextField,{id:"subnet",title:"Subnet to Scan",placeholder:"192.168.1.0/24",defaultValue:r?.subnet||"",info:"Enter subnet in CIDR notation (e.g., 192.168.1.0/24, 10.0.0.0/16)"}),(0,a.jsx)(e.Form.TextField,{id:"timeout",title:"Timeout (seconds)",placeholder:"1.0",defaultValue:m.defaultTimeout||"1.0",info:"Timeout for each ping attempt"}),(0,a.jsx)(e.Form.TextField,{id:"maxThreads",title:"Max Threads",placeholder:"50",defaultValue:m.defaultMaxThreads||"50",info:"Maximum concurrent ping attempts"}),(0,a.jsx)(e.Form.TextField,{id:"recommendations",title:"Recommendations",placeholder:"10",defaultValue:m.defaultRecommendations||"10",info:"Number of available IPs to recommend"})]}))},ke=()=>{r&&W((0,a.jsx)(e.Detail,{markdown:Z(r),actions:(0,a.jsxs)(e.ActionPanel,{children:[(0,a.jsx)(e.Action.CopyToClipboard,{title:"Copy Network Info",content:Z(r)}),(0,a.jsx)(e.Action.CopyToClipboard,{title:"Copy Assigned Ips",content:r.assignedIPs.join(`
`)}),(0,a.jsx)(e.Action.CopyToClipboard,{title:"Copy Recommended Ips",content:r.recommendedIPs.join(`
`)}),(0,a.jsx)(e.Action,{title:"Export as JSON",icon:e.Icon.Document,onAction:async()=>{let t={timestamp:new Date().toISOString(),localIP:r.localIP,subnet:r.subnet,assignedIPs:r.assignedIPs,recommendedIPs:r.recommendedIPs};await e.Clipboard.copy(JSON.stringify(t,null,2)),(0,e.showHUD)("Exported to clipboard")}})]})}))},Z=t=>{let n=`**Theme**: ${O} \u2022 **Color Scheme**: ${C} \u2022 **Map Layout**: ${E}`;return`# Network Analysis Report

## Network Information
- **Local IP**: ${t.localIP}
- **Subnet**: ${t.subnet}
- **Devices Found**: ${t.devices.length}
- **Recommended IPs**: ${t.recommendedIPs.length}
${t.lastScanTime?`- **Last Scan**: ${t.lastScanTime.toLocaleString()}`:""}
- ${n}

## Network Devices
${t.devices.length>0?t.devices.map(s=>`### ${s.ip}
- **MAC Address**: ${s.mac||"Unknown"}
- **Hostname**: ${s.hostname||"Unknown"}
- **Manufacturer**: ${s.manufacturer||"Unknown"}
- **Open Ports**: ${s.openPorts&&s.openPorts.length>0?s.openPorts.map(i=>`${i} (${T(i)})`).join(", "):"None detected"}
- **Status**: Online
- **Last Seen**: ${s.lastSeen.toLocaleString()}
`).join(`
`):"No devices found"}

## Recommended Available IPs
${t.recommendedIPs.length>0?t.recommendedIPs.map((s,i)=>`${i+1}. ${s}`).join(`
`):"No available IPs found"}

## Visual Settings
- **Current Theme**: ${O}
- **Color Scheme**: ${C}
- **Map Layout**: ${E}
- **Network Map**: ${j?"Enabled":"Disabled"}

---
*Generated by IP Finder with ${C} theme*`},Se=async()=>{await(0,e.confirmAlert)({title:"Clear Scan History",message:"Are you sure you want to clear all scan history?",primaryAction:{title:"Clear History",style:e.Alert.ActionStyle.Destructive}})&&(I([]),await e.LocalStorage.removeItem("scanHistory"),(0,e.showHUD)("Scan history cleared"))};return h?(0,a.jsx)(e.List,{isLoading:!0,children:(0,a.jsx)(e.List.Item,{title:"Initializing...",icon:e.Icon.Network})}):r?(0,a.jsxs)(e.List,{isLoading:r.isScanning,searchBarPlaceholder:"Search IP addresses...",children:[(0,a.jsxs)(e.List.Section,{title:"Network Information",children:[(0,a.jsx)(e.List.Item,{title:"Local IP Address",subtitle:r.localIP,icon:e.Icon.Desktop,accessories:[{text:"Your Device",icon:e.Icon.Person}]}),(0,a.jsx)(e.List.Item,{title:"Network Subnet",subtitle:r.subnet,icon:e.Icon.Network,accessories:[{text:"Scan Range",icon:e.Icon.Gear}]}),r.lastScanTime&&(0,a.jsx)(e.List.Item,{title:"Last Scan",subtitle:r.lastScanTime.toLocaleString(),icon:e.Icon.Clock,accessories:[{text:`${r.assignedIPs.length} found`,icon:e.Icon.Check}]})]}),(0,a.jsxs)(e.List.Section,{title:"Scan Controls",children:[(0,a.jsx)(e.List.Item,{title:r.isScanning?"Scanning Network...":"Start Network Scan",subtitle:r.isScanning?m.showProgressBar?`Progress: ${r.scanProgress}%`:"Scanning...":"Detect assigned IPs and get recommendations",icon:r.isScanning?e.Icon.Clock:e.Icon.Play,accessories:[{text:r.isScanning?"In Progress":"Ready",icon:r.isScanning?e.Icon.Clock:e.Icon.Check}],actions:(0,a.jsxs)(e.ActionPanel,{children:[!r.isScanning&&(0,a.jsx)(e.Action,{title:"Start Scan",icon:e.Icon.Play,onAction:J}),(0,a.jsx)(e.Action,{title:"View Details",icon:e.Icon.Document,onAction:ke}),(0,a.jsx)(e.Action.CopyToClipboard,{title:"Copy Local IP",content:r.localIP}),(0,a.jsx)(e.Action.CopyToClipboard,{title:"Copy Subnet",content:r.subnet})]})}),(0,a.jsx)(e.List.Item,{title:"Custom Network Scan",subtitle:"Scan a specific subnet or IP range",icon:e.Icon.Gear,accessories:[{text:"Custom",icon:e.Icon.Pencil}],actions:(0,a.jsxs)(e.ActionPanel,{children:[(0,a.jsx)(e.Action,{title:"Configure Custom Scan",icon:e.Icon.Gear,onAction:we}),(0,a.jsx)(e.Action.CopyToClipboard,{title:"Copy Local IP",content:r.localIP})]})}),b.length>0&&(0,a.jsx)(e.List.Item,{title:"Scan History",subtitle:`${b.length} previous scans`,icon:e.Icon.Clock,accessories:[{text:"History",icon:e.Icon.List}],actions:(0,a.jsxs)(e.ActionPanel,{children:[(0,a.jsx)(e.Action,{title:"View History",icon:e.Icon.Clock,onAction:()=>oe(!$)}),(0,a.jsx)(e.Action,{title:"Clear History",icon:e.Icon.Trash,style:e.Action.Style.Destructive,onAction:Se})]})}),(0,a.jsx)(e.List.Item,{title:"Visual Settings",subtitle:`${C} theme \u2022 ${O} mode \u2022 ${E} layout`,icon:e.Icon.Gear,accessories:[{text:"Customize",icon:e.Icon.Gear}],actions:(0,a.jsxs)(e.ActionPanel,{children:[(0,a.jsx)(e.Action,{title:"Open Extension Preferences",icon:e.Icon.Gear,onAction:()=>{(0,e.showToast)({style:e.Toast.Style.Success,title:"Open Preferences",message:"Go to Raycast Preferences > Extensions > IP Finder to customize themes and layouts"})}}),(0,a.jsx)(e.Action.CopyToClipboard,{title:"Copy Current Theme Info",content:`Theme: ${V}
Color Scheme: ${C}
Map Layout: ${E}
Network Map: ${j?"Enabled":"Disabled"}`})]})})]}),r.devices.length>0&&(0,a.jsx)(e.List.Section,{title:"Network Devices",children:r.devices.map(t=>(0,a.jsx)(e.List.Item,{title:t.ip,subtitle:t.hostname||t.manufacturer||"Unknown device",icon:e.Icon.Circle,accessories:[{text:"Active",icon:e.Icon.Check},...t.mac?[{text:t.mac,icon:e.Icon.Network}]:[],...t.openPorts&&t.openPorts.length>0?[{text:t.openPorts.map(n=>`${n} (${T(n)})`).join(", "),icon:e.Icon.Gear}]:[]],actions:(0,a.jsxs)(e.ActionPanel,{children:[(0,a.jsx)(e.Action.CopyToClipboard,{title:"Copy IP Address",content:t.ip}),(0,a.jsx)(e.Action.CopyToClipboard,{title:"Copy Device Info",content:`IP: ${t.ip}
MAC: ${t.mac||"Unknown"}
Hostname: ${t.hostname||"Unknown"}
Manufacturer: ${t.manufacturer||"Unknown"}
Open Ports: ${t.openPorts&&t.openPorts.length>0?t.openPorts.map(n=>`${n} (${T(n)})`).join(", "):"None detected"}`}),(0,a.jsx)(e.Action.OpenInBrowser,{title:"Open in Browser",url:`http://${t.ip}`}),(0,a.jsx)(e.Action,{title:"Scan This IP Range",icon:e.Icon.MagnifyingGlass,onAction:()=>{let n=t.ip.split(".").slice(0,3).join(".")+".0/24";c(o=>o?{...o,subnet:n,assignedIPs:[],recommendedIPs:[],devices:[],isScanning:!1,scanProgress:0}:null);let s=parseFloat(m.defaultTimeout)||1,i=parseInt(m.defaultMaxThreads,10)||50;K(n,s,i)}}),(0,a.jsx)(e.Action,{title:"Ping IP",icon:e.Icon.Network,onAction:async()=>{try{let n=D(t.ip,2);await A(n),(0,e.showHUD)(`Ping successful: ${t.ip}`)}catch{(0,e.showHUD)(`Ping failed: ${t.ip}`)}}}),(0,a.jsx)(e.Action,{title:"Scan Ports",icon:e.Icon.Gear,onAction:async()=>{try{(0,e.showToast)({style:e.Toast.Style.Animated,title:"Scanning Ports",message:`Checking ports on ${t.ip}...`});let n=await G(t.ip,[]),s=n.map(i=>`${i} (${T(i)})`);n.length>0?(0,e.showHUD)(`Found ${n.length} open ports: ${s.join(", ")}`):(0,e.showHUD)(`No open ports found on ${t.ip}`)}catch{(0,e.showHUD)(`Port scan failed: ${t.ip}`)}}})]})},t.ip))}),r.recommendedIPs.length>0&&(0,a.jsx)(e.List.Section,{title:"Recommended Available IPs",children:r.recommendedIPs.map((t,n)=>(0,a.jsx)(e.List.Item,{title:t,subtitle:`Recommendation #${n+1}`,icon:e.Icon.Star,accessories:[{text:"Available",icon:e.Icon.Circle}],actions:(0,a.jsxs)(e.ActionPanel,{children:[(0,a.jsx)(e.Action.CopyToClipboard,{title:"Copy IP Address",content:t}),(0,a.jsx)(e.Action.CopyToClipboard,{title:"Copy as Static IP",content:`IP Address: ${t}
Subnet Mask: 255.255.255.0
Gateway: ${r.localIP.split(".").slice(0,3).join(".")}.1`}),(0,a.jsx)(e.Action,{title:"Test IP Availability",icon:e.Icon.MagnifyingGlass,onAction:async()=>{try{let s=D(t,1);await A(s),(0,e.showHUD)(`IP ${t} is NOT available (ping successful)`)}catch{(0,e.showHUD)(`IP ${t} is available (ping failed)`)}}})]})},t))}),r.assignedIPs.length===0&&r.recommendedIPs.length===0&&!r.isScanning&&(0,a.jsx)(e.List.Section,{title:"No Scan Results",children:(0,a.jsx)(e.List.Item,{title:"No scan performed yet",subtitle:"Click 'Start Network Scan' to begin",icon:e.Icon.Info})})]}):(0,a.jsx)(e.List,{children:(0,a.jsx)(e.List.Item,{title:"Network Information Unavailable",subtitle:"Failed to detect network configuration",icon:e.Icon.ExclamationMark})})}
