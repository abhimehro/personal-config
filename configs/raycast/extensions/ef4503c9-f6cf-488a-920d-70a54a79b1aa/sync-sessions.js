"use strict";var ba=Object.create;var xt=Object.defineProperty;var wa=Object.getOwnPropertyDescriptor;var Sa=Object.getOwnPropertyNames;var Ta=Object.getPrototypeOf,xa=Object.prototype.hasOwnProperty;var O=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Ea=(r,e)=>{for(var t in e)xt(r,t,{get:e[t],enumerable:!0})},ii=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Sa(e))!xa.call(r,i)&&i!==t&&xt(r,i,{get:()=>e[i],enumerable:!(n=wa(e,i))||n.enumerable});return r};var Et=(r,e,t)=>(t=r!=null?ba(Ta(r)):{},ii(e||!r||!r.__esModule?xt(t,"default",{value:r,enumerable:!0}):t,r)),va=r=>ii(xt({},"__esModule",{value:!0}),r);var pe=O(vt=>{"use strict";vt.getBooleanOption=(r,e)=>{let t=!1;if(e in r&&typeof(t=r[e])!="boolean")throw new TypeError(`Expected the "${e}" option to be a boolean`);return t};vt.cppdb=Symbol();vt.inspect=Symbol.for("nodejs.util.inspect.custom")});var $r=O((Tl,oi)=>{"use strict";var Or={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function Ce(r,e){if(new.target!==Ce)return new Ce(r,e);if(typeof e!="string")throw new TypeError("Expected second argument to be a string");Error.call(this,r),Or.value=""+r,Object.defineProperty(this,"message",Or),Error.captureStackTrace(this,Ce),this.code=e}Object.setPrototypeOf(Ce,Error);Object.setPrototypeOf(Ce.prototype,Error.prototype);Object.defineProperty(Ce.prototype,"name",Or);oi.exports=Ce});var ai=O((xl,si)=>{var Ot=require("path").sep||"/";si.exports=Oa;function Oa(r){if(typeof r!="string"||r.length<=7||r.substring(0,7)!="file://")throw new TypeError("must pass in a file:// URI to convert to a file path");var e=decodeURI(r.substring(7)),t=e.indexOf("/"),n=e.substring(0,t),i=e.substring(t+1);return n=="localhost"&&(n=""),n&&(n=Ot+Ot+n),i=i.replace(/^(.+)\|/,"$1:"),Ot=="\\"&&(i=i.replace(/\//g,"\\")),/^.+\:/.test(i)||(i=Ot+i),n+i}});var qr=O((Re,ci)=>{var Cr=require("fs"),Ct=require("path"),$a=ai(),$t=Ct.join,Ca=Ct.dirname,ui=Cr.accessSync&&function(r){try{Cr.accessSync(r)}catch{return!1}return!0}||Cr.existsSync||Ct.existsSync,li={arrow:process.env.NODE_BINDINGS_ARROW||" \u2192 ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};function qa(r){typeof r=="string"?r={bindings:r}:r||(r={}),Object.keys(li).map(function(l){l in r||(r[l]=li[l])}),r.module_root||(r.module_root=Re.getRoot(Re.getFileName())),Ct.extname(r.bindings)!=".node"&&(r.bindings+=".node");for(var e=typeof __webpack_require__=="function"?__non_webpack_require__:require,t=[],n=0,i=r.try.length,o,s,a;n<i;n++){o=$t.apply(null,r.try[n].map(function(l){return r[l]||l})),t.push(o);try{return s=r.path?e.resolve(o):e(o),r.path||(s.path=o),s}catch(l){if(l.code!=="MODULE_NOT_FOUND"&&l.code!=="QUALIFIED_PATH_RESOLUTION_FAILED"&&!/not find/i.test(l.message))throw l}}throw a=new Error(`Could not locate the bindings file. Tried:
`+t.map(function(l){return r.arrow+l}).join(`
`)),a.tries=t,a}ci.exports=Re=qa;Re.getFileName=function(e){var t=Error.prepareStackTrace,n=Error.stackTraceLimit,i={},o;Error.stackTraceLimit=10,Error.prepareStackTrace=function(a,l){for(var m=0,u=l.length;m<u;m++)if(o=l[m].getFileName(),o!==__filename)if(e){if(o!==e)return}else return},Error.captureStackTrace(i),i.stack,Error.prepareStackTrace=t,Error.stackTraceLimit=n;var s="file://";return o.indexOf(s)===0&&(o=$a(o)),o};Re.getRoot=function(e){for(var t=Ca(e),n;;){if(t==="."&&(t=process.cwd()),ui($t(t,"package.json"))||ui($t(t,"node_modules")))return t;if(n===t)throw new Error('Could not find module root given file: "'+e+'". Do you have a `package.json` file? ');n=t,t=$t(t,"..")}}});var fi=O(he=>{"use strict";var{cppdb:oe}=pe();he.prepare=function(e){return this[oe].prepare(e,this,!1)};he.key=function(r){if(!Buffer.isBuffer(r))throw new TypeError("Expected first argument to be a Buffer");return this[oe].key(r,r.length)};he.rekey=function(e){if(!Buffer.isBuffer(e))throw new TypeError("Expected first argument to be a Buffer");return this[oe].rekey(e,e.length)};he.exec=function(e){return this[oe].exec(e),this};he.close=function(){return this[oe].close(),this};he.loadExtension=function(...e){return this[oe].loadExtension(...e),this};he.defaultSafeIntegers=function(...e){return this[oe].defaultSafeIntegers(...e),this};he.unsafeMode=function(...e){return this[oe].unsafeMode(...e),this};he.getters={name:{get:function(){return this[oe].name},enumerable:!0},open:{get:function(){return this[oe].open},enumerable:!0},inTransaction:{get:function(){return this[oe].inTransaction},enumerable:!0},readonly:{get:function(){return this[oe].readonly},enumerable:!0},memory:{get:function(){return this[oe].memory},enumerable:!0}}});var hi=O((vl,pi)=>{"use strict";var{cppdb:Na}=pe(),mi=new WeakMap;pi.exports=function(e){if(typeof e!="function")throw new TypeError("Expected first argument to be a function");let t=this[Na],n=_a(t,this),{apply:i}=Function.prototype,o={default:{value:qt(i,e,t,n.default)},deferred:{value:qt(i,e,t,n.deferred)},immediate:{value:qt(i,e,t,n.immediate)},exclusive:{value:qt(i,e,t,n.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(o.default.value,o),Object.defineProperties(o.deferred.value,o),Object.defineProperties(o.immediate.value,o),Object.defineProperties(o.exclusive.value,o),o.default.value};var _a=(r,e)=>{let t=mi.get(r);if(!t){let n={commit:r.prepare("COMMIT",e,!1),rollback:r.prepare("ROLLBACK",e,!1),savepoint:r.prepare("SAVEPOINT `	_bs3.	`",e,!1),release:r.prepare("RELEASE `	_bs3.	`",e,!1),rollbackTo:r.prepare("ROLLBACK TO `	_bs3.	`",e,!1)};mi.set(r,t={default:Object.assign({begin:r.prepare("BEGIN",e,!1)},n),deferred:Object.assign({begin:r.prepare("BEGIN DEFERRED",e,!1)},n),immediate:Object.assign({begin:r.prepare("BEGIN IMMEDIATE",e,!1)},n),exclusive:Object.assign({begin:r.prepare("BEGIN EXCLUSIVE",e,!1)},n)})}return t},qt=(r,e,t,{begin:n,commit:i,rollback:o,savepoint:s,release:a,rollbackTo:l})=>function(){let u,p,d;t.inTransaction?(u=s,p=a,d=l):(u=n,p=i,d=o),u.run();try{let y=r.call(e,this,arguments);if(y&&typeof y.then=="function")throw new TypeError("Transaction function cannot return a promise");return p.run(),y}catch(y){throw t.inTransaction&&(d.run(),d!==o&&p.run()),y}}});var yi=O((Ol,di)=>{"use strict";var{getBooleanOption:La,cppdb:ja}=pe();di.exports=function(e,t){if(t==null&&(t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");let n=La(t,"simple"),i=this[ja].prepare(`PRAGMA ${e}`,this,!0);return n?i.pluck().get():i.all()}});var wi=O(($l,bi)=>{"use strict";var Ia=require("fs"),Da=require("path"),{promisify:Qa}=require("util"),{cppdb:Ba}=pe(),gi=Qa(Ia.access);bi.exports=async function(e,t){if(t==null&&(t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");e=e.trim();let n="attached"in t?t.attached:"main",i="progress"in t?t.progress:null;if(!e)throw new TypeError("Backup filename cannot be an empty string");if(e===":memory:")throw new TypeError('Invalid backup filename ":memory:"');if(typeof n!="string")throw new TypeError('Expected the "attached" option to be a string');if(!n)throw new TypeError('The "attached" option cannot be an empty string');if(i!=null&&typeof i!="function")throw new TypeError('Expected the "progress" option to be a function');await gi(Da.dirname(e)).catch(()=>{throw new TypeError("Cannot save backup because the directory does not exist")});let o=await gi(e).then(()=>!1,()=>!0);return Aa(this[Ba].backup(this,n,e,o),i||null)};var Aa=(r,e)=>{let t=0,n=!0;return new Promise((i,o)=>{setImmediate(function s(){try{let a=r.transfer(t);if(!a.remainingPages){r.close(),i(a);return}if(n&&(n=!1,t=100),e){let l=e(a);if(l!==void 0)if(typeof l=="number"&&l===l)t=Math.max(0,Math.min(2147483647,Math.round(l)));else throw new TypeError("Expected progress callback to return a number or undefined")}setImmediate(s)}catch(a){r.close(),o(a)}})})}});var Ti=O((Cl,Si)=>{"use strict";var{cppdb:Pa}=pe();Si.exports=function(e){if(e==null&&(e={}),typeof e!="object")throw new TypeError("Expected first argument to be an options object");let t="attached"in e?e.attached:"main";if(typeof t!="string")throw new TypeError('Expected the "attached" option to be a string');if(!t)throw new TypeError('The "attached" option cannot be an empty string');return this[Pa].serialize(t)}});var Ei=O((ql,xi)=>{"use strict";var{getBooleanOption:Nt,cppdb:Fa}=pe();xi.exports=function(e,t,n){if(t==null&&(t={}),typeof t=="function"&&(n=t,t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof n!="function")throw new TypeError("Expected last argument to be a function");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");if(!e)throw new TypeError("User-defined function name cannot be an empty string");let i="safeIntegers"in t?+Nt(t,"safeIntegers"):2,o=Nt(t,"deterministic"),s=Nt(t,"directOnly"),a=Nt(t,"varargs"),l=-1;if(!a){if(l=n.length,!Number.isInteger(l)||l<0)throw new TypeError("Expected function.length to be a positive integer");if(l>100)throw new RangeError("User-defined functions cannot have more than 100 arguments")}return this[Fa].function(n,e,l,i,o,s),this}});var $i=O((Nl,Oi)=>{"use strict";var{getBooleanOption:_t,cppdb:Ra}=pe();Oi.exports=function(e,t){if(typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object"||t===null)throw new TypeError("Expected second argument to be an options object");if(!e)throw new TypeError("User-defined function name cannot be an empty string");let n="start"in t?t.start:null,i=Nr(t,"step",!0),o=Nr(t,"inverse",!1),s=Nr(t,"result",!1),a="safeIntegers"in t?+_t(t,"safeIntegers"):2,l=_t(t,"deterministic"),m=_t(t,"directOnly"),u=_t(t,"varargs"),p=-1;if(!u&&(p=Math.max(vi(i),o?vi(o):0),p>0&&(p-=1),p>100))throw new RangeError("User-defined functions cannot have more than 100 arguments");return this[Ra].aggregate(n,i,o,s,e,p,a,l,m),this};var Nr=(r,e,t)=>{let n=e in r?r[e]:null;if(typeof n=="function")return n;if(n!=null)throw new TypeError(`Expected the "${e}" option to be a function`);if(t)throw new TypeError(`Missing required option "${e}"`);return null},vi=({length:r})=>{if(Number.isInteger(r)&&r>=0)return r;throw new TypeError("Expected function.length to be a positive integer")}});var _i=O((_l,Ni)=>{"use strict";var{cppdb:Ma}=pe();Ni.exports=function(e,t){if(typeof e!="string")throw new TypeError("Expected first argument to be a string");if(!e)throw new TypeError("Virtual table module name cannot be an empty string");let n=!1;if(typeof t=="object"&&t!==null)n=!0,t=Ga(qi(t,"used",e));else{if(typeof t!="function")throw new TypeError("Expected second argument to be a function or a table definition object");t=Va(t)}return this[Ma].table(t,e,n),this};function Va(r){return function(t,n,i,...o){let s={module:t,database:n,table:i},a=Wa.call(r,s,o);if(typeof a!="object"||a===null)throw new TypeError(`Virtual table module "${t}" did not return a table definition object`);return qi(a,"returned",t)}}function qi(r,e,t){if(!et.call(r,"rows"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition without a "rows" property`);if(!et.call(r,"columns"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition without a "columns" property`);let n=r.rows;if(typeof n!="function"||Object.getPrototypeOf(n)!==Ja)throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "rows" property (should be a generator function)`);let i=r.columns;if(!Array.isArray(i)||!(i=[...i]).every(m=>typeof m=="string"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "columns" property (should be an array of strings)`);if(i.length!==new Set(i).size)throw new TypeError(`Virtual table module "${t}" ${e} a table definition with duplicate column names`);if(!i.length)throw new RangeError(`Virtual table module "${t}" ${e} a table definition with zero columns`);let o;if(et.call(r,"parameters")){if(o=r.parameters,!Array.isArray(o)||!(o=[...o]).every(m=>typeof m=="string"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "parameters" property (should be an array of strings)`)}else o=ka(n);if(o.length!==new Set(o).size)throw new TypeError(`Virtual table module "${t}" ${e} a table definition with duplicate parameter names`);if(o.length>32)throw new RangeError(`Virtual table module "${t}" ${e} a table definition with more than the maximum number of 32 parameters`);for(let m of o)if(i.includes(m))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with column "${m}" which was ambiguously defined as both a column and parameter`);let s=2;if(et.call(r,"safeIntegers")){let m=r.safeIntegers;if(typeof m!="boolean")throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "safeIntegers" property (should be a boolean)`);s=+m}let a=!1;if(et.call(r,"directOnly")&&(a=r.directOnly,typeof a!="boolean"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "directOnly" property (should be a boolean)`);return[`CREATE TABLE x(${[...o.map(Ci).map(m=>`${m} HIDDEN`),...i.map(Ci)].join(", ")});`,Ka(n,new Map(i.map((m,u)=>[m,o.length+u])),t),o,s,a]}function Ka(r,e,t){return function*(...i){let o=i.map(s=>Buffer.isBuffer(s)?Buffer.from(s):s);for(let s=0;s<e.size;++s)o.push(null);for(let s of r(...i))if(Array.isArray(s))za(s,o,e.size,t),yield o;else if(typeof s=="object"&&s!==null)Ua(s,o,e,t),yield o;else throw new TypeError(`Virtual table module "${t}" yielded something that isn't a valid row object`)}}function za(r,e,t,n){if(r.length!==t)throw new TypeError(`Virtual table module "${n}" yielded a row with an incorrect number of columns`);let i=e.length-t;for(let o=0;o<t;++o)e[o+i]=r[o]}function Ua(r,e,t,n){let i=0;for(let o of Object.keys(r)){let s=t.get(o);if(s===void 0)throw new TypeError(`Virtual table module "${n}" yielded a row with an undeclared column "${o}"`);e[s]=r[o],i+=1}if(i!==t.size)throw new TypeError(`Virtual table module "${n}" yielded a row with missing columns`)}function ka({length:r}){if(!Number.isInteger(r)||r<0)throw new TypeError("Expected function.length to be a positive integer");let e=[];for(let t=0;t<r;++t)e.push(`$${t+1}`);return e}var{hasOwnProperty:et}=Object.prototype,{apply:Wa}=Function.prototype,Ja=Object.getPrototypeOf(function*(){}),Ci=r=>`"${r.replace(/"/g,'""')}"`,Ga=r=>()=>r});var ji=O((Ll,Li)=>{"use strict";var Ya=function(){};Li.exports=function(e,t){return Object.assign(new Ya,this)}});var Bi=O((jl,Qi)=>{"use strict";var Ha=require("fs"),Ii=require("path"),Lt=pe(),Xa=$r(),Di;function G(r,e){if(new.target==null)return new G(r,e);let t;if(Buffer.isBuffer(r)&&(t=r,r=":memory:"),r==null&&(r=""),e==null&&(e={}),typeof r!="string")throw new TypeError("Expected first argument to be a string");if(typeof e!="object")throw new TypeError("Expected second argument to be an options object");if("readOnly"in e)throw new TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in e)throw new TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let n=r.trim(),i=n===""||n===":memory:",o=Lt.getBooleanOption(e,"readonly"),s=Lt.getBooleanOption(e,"fileMustExist"),a="timeout"in e?e.timeout:5e3,l="verbose"in e?e.verbose:null,m="nativeBinding"in e?e.nativeBinding:null;if(o&&i&&!t)throw new TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(a)||a<0)throw new TypeError('Expected the "timeout" option to be a positive integer');if(a>2147483647)throw new RangeError('Option "timeout" cannot be greater than 2147483647');if(l!=null&&typeof l!="function")throw new TypeError('Expected the "verbose" option to be a function');if(m!=null&&typeof m!="string"&&typeof m!="object")throw new TypeError('Expected the "nativeBinding" option to be a string or addon object');let u;if(m==null?u=Di||(Di=qr()("better_sqlite3.node")):typeof m=="string"?u=(typeof __non_webpack_require__=="function"?__non_webpack_require__:require)(Ii.resolve(m).replace(/(\.node)?$/,".node")):u=m,u.isInitialized||(u.setErrorConstructor(Xa),u.isInitialized=!0),!i&&!Ha.existsSync(Ii.dirname(n)))throw new TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[Lt.cppdb]:{value:new u.Database(n,r,i,o,s,a,l||null,t||null)},...be.getters})}var be=fi();G.prototype.prepare=be.prepare;G.prototype.transaction=hi();G.prototype.pragma=yi();G.prototype.backup=wi();G.prototype.serialize=Ti();G.prototype.function=Ei();G.prototype.aggregate=$i();G.prototype.table=_i();G.prototype.loadExtension=be.loadExtension;G.prototype.exec=be.exec;G.prototype.key=be.key;G.prototype.rekey=be.rekey;G.prototype.close=be.close;G.prototype.defaultSafeIntegers=be.defaultSafeIntegers;G.prototype.unsafeMode=be.unsafeMode;G.prototype[Lt.inspect]=ji();Qi.exports=G});var Lr=O((Il,_r)=>{"use strict";_r.exports=Bi();_r.exports.SqliteError=$r()});var de=O(jt=>{"use strict";jt.getBooleanOption=(r,e)=>{let t=!1;if(e in r&&typeof(t=r[e])!="boolean")throw new TypeError(`Expected the "${e}" option to be a boolean`);return t};jt.cppdb=Symbol();jt.inspect=Symbol.for("nodejs.util.inspect.custom")});var Ir=O((Ql,Ai)=>{"use strict";var jr={value:"SqliteError",writable:!0,enumerable:!1,configurable:!0};function qe(r,e){if(new.target!==qe)return new qe(r,e);if(typeof e!="string")throw new TypeError("Expected second argument to be a string");Error.call(this,r),jr.value=""+r,Object.defineProperty(this,"message",jr),Error.captureStackTrace(this,qe),this.code=e}Object.setPrototypeOf(qe,Error);Object.setPrototypeOf(qe.prototype,Error.prototype);Object.defineProperty(qe.prototype,"name",jr);Ai.exports=qe});var Pi=O(Te=>{"use strict";var{cppdb:fe}=de();Te.prepare=function(e){return this[fe].prepare(e,this,!1)};Te.exec=function(e){return this[fe].exec(e),this};Te.close=function(){return this[fe].close(),this};Te.loadExtension=function(...e){return this[fe].loadExtension(...e),this};Te.defaultSafeIntegers=function(...e){return this[fe].defaultSafeIntegers(...e),this};Te.unsafeMode=function(...e){return this[fe].unsafeMode(...e),this};Te.getters={name:{get:function(){return this[fe].name},enumerable:!0},open:{get:function(){return this[fe].open},enumerable:!0},inTransaction:{get:function(){return this[fe].inTransaction},enumerable:!0},readonly:{get:function(){return this[fe].readonly},enumerable:!0},memory:{get:function(){return this[fe].memory},enumerable:!0}}});var Mi=O((Al,Ri)=>{"use strict";var{cppdb:Za}=de(),Fi=new WeakMap;Ri.exports=function(e){if(typeof e!="function")throw new TypeError("Expected first argument to be a function");let t=this[Za],n=eu(t,this),{apply:i}=Function.prototype,o={default:{value:It(i,e,t,n.default)},deferred:{value:It(i,e,t,n.deferred)},immediate:{value:It(i,e,t,n.immediate)},exclusive:{value:It(i,e,t,n.exclusive)},database:{value:this,enumerable:!0}};return Object.defineProperties(o.default.value,o),Object.defineProperties(o.deferred.value,o),Object.defineProperties(o.immediate.value,o),Object.defineProperties(o.exclusive.value,o),o.default.value};var eu=(r,e)=>{let t=Fi.get(r);if(!t){let n={commit:r.prepare("COMMIT",e,!1),rollback:r.prepare("ROLLBACK",e,!1),savepoint:r.prepare("SAVEPOINT `	_bs3.	`",e,!1),release:r.prepare("RELEASE `	_bs3.	`",e,!1),rollbackTo:r.prepare("ROLLBACK TO `	_bs3.	`",e,!1)};Fi.set(r,t={default:Object.assign({begin:r.prepare("BEGIN",e,!1)},n),deferred:Object.assign({begin:r.prepare("BEGIN DEFERRED",e,!1)},n),immediate:Object.assign({begin:r.prepare("BEGIN IMMEDIATE",e,!1)},n),exclusive:Object.assign({begin:r.prepare("BEGIN EXCLUSIVE",e,!1)},n)})}return t},It=(r,e,t,{begin:n,commit:i,rollback:o,savepoint:s,release:a,rollbackTo:l})=>function(){let u,p,d;t.inTransaction?(u=s,p=a,d=l):(u=n,p=i,d=o),u.run();try{let y=r.call(e,this,arguments);if(y&&typeof y.then=="function")throw new TypeError("Transaction function cannot return a promise");return p.run(),y}catch(y){throw t.inTransaction&&(d.run(),d!==o&&p.run()),y}}});var Ki=O((Pl,Vi)=>{"use strict";var{getBooleanOption:tu,cppdb:ru}=de();Vi.exports=function(e,t){if(t==null&&(t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");let n=tu(t,"simple"),i=this[ru].prepare(`PRAGMA ${e}`,this,!0);return n?i.pluck().get():i.all()}});var ki=O((Fl,Ui)=>{"use strict";var nu=require("fs"),iu=require("path"),{promisify:ou}=require("util"),{cppdb:su}=de(),zi=ou(nu.access);Ui.exports=async function(e,t){if(t==null&&(t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");e=e.trim();let n="attached"in t?t.attached:"main",i="progress"in t?t.progress:null;if(!e)throw new TypeError("Backup filename cannot be an empty string");if(e===":memory:")throw new TypeError('Invalid backup filename ":memory:"');if(typeof n!="string")throw new TypeError('Expected the "attached" option to be a string');if(!n)throw new TypeError('The "attached" option cannot be an empty string');if(i!=null&&typeof i!="function")throw new TypeError('Expected the "progress" option to be a function');await zi(iu.dirname(e)).catch(()=>{throw new TypeError("Cannot save backup because the directory does not exist")});let o=await zi(e).then(()=>!1,()=>!0);return au(this[su].backup(this,n,e,o),i||null)};var au=(r,e)=>{let t=0,n=!0;return new Promise((i,o)=>{setImmediate(function s(){try{let a=r.transfer(t);if(!a.remainingPages){r.close(),i(a);return}if(n&&(n=!1,t=100),e){let l=e(a);if(l!==void 0)if(typeof l=="number"&&l===l)t=Math.max(0,Math.min(2147483647,Math.round(l)));else throw new TypeError("Expected progress callback to return a number or undefined")}setImmediate(s)}catch(a){r.close(),o(a)}})})}});var Ji=O((Rl,Wi)=>{"use strict";var{cppdb:uu}=de();Wi.exports=function(e){if(e==null&&(e={}),typeof e!="object")throw new TypeError("Expected first argument to be an options object");let t="attached"in e?e.attached:"main";if(typeof t!="string")throw new TypeError('Expected the "attached" option to be a string');if(!t)throw new TypeError('The "attached" option cannot be an empty string');return this[uu].serialize(t)}});var Yi=O((Ml,Gi)=>{"use strict";var{getBooleanOption:Dt,cppdb:lu}=de();Gi.exports=function(e,t,n){if(t==null&&(t={}),typeof t=="function"&&(n=t,t={}),typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof n!="function")throw new TypeError("Expected last argument to be a function");if(typeof t!="object")throw new TypeError("Expected second argument to be an options object");if(!e)throw new TypeError("User-defined function name cannot be an empty string");let i="safeIntegers"in t?+Dt(t,"safeIntegers"):2,o=Dt(t,"deterministic"),s=Dt(t,"directOnly"),a=Dt(t,"varargs"),l=-1;if(!a){if(l=n.length,!Number.isInteger(l)||l<0)throw new TypeError("Expected function.length to be a positive integer");if(l>100)throw new RangeError("User-defined functions cannot have more than 100 arguments")}return this[lu].function(n,e,l,i,o,s),this}});var Zi=O((Vl,Xi)=>{"use strict";var{getBooleanOption:Qt,cppdb:cu}=de();Xi.exports=function(e,t){if(typeof e!="string")throw new TypeError("Expected first argument to be a string");if(typeof t!="object"||t===null)throw new TypeError("Expected second argument to be an options object");if(!e)throw new TypeError("User-defined function name cannot be an empty string");let n="start"in t?t.start:null,i=Dr(t,"step",!0),o=Dr(t,"inverse",!1),s=Dr(t,"result",!1),a="safeIntegers"in t?+Qt(t,"safeIntegers"):2,l=Qt(t,"deterministic"),m=Qt(t,"directOnly"),u=Qt(t,"varargs"),p=-1;if(!u&&(p=Math.max(Hi(i),o?Hi(o):0),p>0&&(p-=1),p>100))throw new RangeError("User-defined functions cannot have more than 100 arguments");return this[cu].aggregate(n,i,o,s,e,p,a,l,m),this};var Dr=(r,e,t)=>{let n=e in r?r[e]:null;if(typeof n=="function")return n;if(n!=null)throw new TypeError(`Expected the "${e}" option to be a function`);if(t)throw new TypeError(`Missing required option "${e}"`);return null},Hi=({length:r})=>{if(Number.isInteger(r)&&r>=0)return r;throw new TypeError("Expected function.length to be a positive integer")}});var no=O((Kl,ro)=>{"use strict";var{cppdb:fu}=de();ro.exports=function(e,t){if(typeof e!="string")throw new TypeError("Expected first argument to be a string");if(!e)throw new TypeError("Virtual table module name cannot be an empty string");let n=!1;if(typeof t=="object"&&t!==null)n=!0,t=wu(to(t,"used",e));else{if(typeof t!="function")throw new TypeError("Expected second argument to be a function or a table definition object");t=mu(t)}return this[fu].table(t,e,n),this};function mu(r){return function(t,n,i,...o){let s={module:t,database:n,table:i},a=gu.call(r,s,o);if(typeof a!="object"||a===null)throw new TypeError(`Virtual table module "${t}" did not return a table definition object`);return to(a,"returned",t)}}function to(r,e,t){if(!tt.call(r,"rows"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition without a "rows" property`);if(!tt.call(r,"columns"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition without a "columns" property`);let n=r.rows;if(typeof n!="function"||Object.getPrototypeOf(n)!==bu)throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "rows" property (should be a generator function)`);let i=r.columns;if(!Array.isArray(i)||!(i=[...i]).every(m=>typeof m=="string"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "columns" property (should be an array of strings)`);if(i.length!==new Set(i).size)throw new TypeError(`Virtual table module "${t}" ${e} a table definition with duplicate column names`);if(!i.length)throw new RangeError(`Virtual table module "${t}" ${e} a table definition with zero columns`);let o;if(tt.call(r,"parameters")){if(o=r.parameters,!Array.isArray(o)||!(o=[...o]).every(m=>typeof m=="string"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "parameters" property (should be an array of strings)`)}else o=yu(n);if(o.length!==new Set(o).size)throw new TypeError(`Virtual table module "${t}" ${e} a table definition with duplicate parameter names`);if(o.length>32)throw new RangeError(`Virtual table module "${t}" ${e} a table definition with more than the maximum number of 32 parameters`);for(let m of o)if(i.includes(m))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with column "${m}" which was ambiguously defined as both a column and parameter`);let s=2;if(tt.call(r,"safeIntegers")){let m=r.safeIntegers;if(typeof m!="boolean")throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "safeIntegers" property (should be a boolean)`);s=+m}let a=!1;if(tt.call(r,"directOnly")&&(a=r.directOnly,typeof a!="boolean"))throw new TypeError(`Virtual table module "${t}" ${e} a table definition with an invalid "directOnly" property (should be a boolean)`);return[`CREATE TABLE x(${[...o.map(eo).map(m=>`${m} HIDDEN`),...i.map(eo)].join(", ")});`,pu(n,new Map(i.map((m,u)=>[m,o.length+u])),t),o,s,a]}function pu(r,e,t){return function*(...i){let o=i.map(s=>Buffer.isBuffer(s)?Buffer.from(s):s);for(let s=0;s<e.size;++s)o.push(null);for(let s of r(...i))if(Array.isArray(s))hu(s,o,e.size,t),yield o;else if(typeof s=="object"&&s!==null)du(s,o,e,t),yield o;else throw new TypeError(`Virtual table module "${t}" yielded something that isn't a valid row object`)}}function hu(r,e,t,n){if(r.length!==t)throw new TypeError(`Virtual table module "${n}" yielded a row with an incorrect number of columns`);let i=e.length-t;for(let o=0;o<t;++o)e[o+i]=r[o]}function du(r,e,t,n){let i=0;for(let o of Object.keys(r)){let s=t.get(o);if(s===void 0)throw new TypeError(`Virtual table module "${n}" yielded a row with an undeclared column "${o}"`);e[s]=r[o],i+=1}if(i!==t.size)throw new TypeError(`Virtual table module "${n}" yielded a row with missing columns`)}function yu({length:r}){if(!Number.isInteger(r)||r<0)throw new TypeError("Expected function.length to be a positive integer");let e=[];for(let t=0;t<r;++t)e.push(`$${t+1}`);return e}var{hasOwnProperty:tt}=Object.prototype,{apply:gu}=Function.prototype,bu=Object.getPrototypeOf(function*(){}),eo=r=>`"${r.replace(/"/g,'""')}"`,wu=r=>()=>r});var oo=O((zl,io)=>{"use strict";var Su=function(){};io.exports=function(e,t){return Object.assign(new Su,this)}});var lo=O((Ul,uo)=>{"use strict";var Tu=require("fs"),so=require("path"),Bt=de(),xu=Ir(),ao;function Z(r,e){if(new.target==null)return new Z(r,e);let t;if(Buffer.isBuffer(r)&&(t=r,r=":memory:"),r==null&&(r=""),e==null&&(e={}),typeof r!="string")throw new TypeError("Expected first argument to be a string");if(typeof e!="object")throw new TypeError("Expected second argument to be an options object");if("readOnly"in e)throw new TypeError('Misspelled option "readOnly" should be "readonly"');if("memory"in e)throw new TypeError('Option "memory" was removed in v7.0.0 (use ":memory:" filename instead)');let n=r.trim(),i=n===""||n===":memory:",o=Bt.getBooleanOption(e,"readonly"),s=Bt.getBooleanOption(e,"fileMustExist"),a="timeout"in e?e.timeout:5e3,l="verbose"in e?e.verbose:null,m="nativeBinding"in e?e.nativeBinding:null;if(o&&i&&!t)throw new TypeError("In-memory/temporary databases cannot be readonly");if(!Number.isInteger(a)||a<0)throw new TypeError('Expected the "timeout" option to be a positive integer');if(a>2147483647)throw new RangeError('Option "timeout" cannot be greater than 2147483647');if(l!=null&&typeof l!="function")throw new TypeError('Expected the "verbose" option to be a function');if(m!=null&&typeof m!="string"&&typeof m!="object")throw new TypeError('Expected the "nativeBinding" option to be a string or addon object');let u;if(m==null?u=ao||(ao=qr()("better_sqlite3.node")):typeof m=="string"?u=(typeof __non_webpack_require__=="function"?__non_webpack_require__:require)(so.resolve(m).replace(/(\.node)?$/,".node")):u=m,u.isInitialized||(u.setErrorConstructor(xu),u.isInitialized=!0),!i&&!Tu.existsSync(so.dirname(n)))throw new TypeError("Cannot open database because the directory does not exist");Object.defineProperties(this,{[Bt.cppdb]:{value:new u.Database(n,r,i,o,s,a,l||null,t||null)},...Ne.getters})}var Ne=Pi();Z.prototype.prepare=Ne.prepare;Z.prototype.transaction=Mi();Z.prototype.pragma=Ki();Z.prototype.backup=ki();Z.prototype.serialize=Ji();Z.prototype.function=Yi();Z.prototype.aggregate=Zi();Z.prototype.table=no();Z.prototype.loadExtension=Ne.loadExtension;Z.prototype.exec=Ne.exec;Z.prototype.close=Ne.close;Z.prototype.defaultSafeIntegers=Ne.defaultSafeIntegers;Z.prototype.unsafeMode=Ne.unsafeMode;Z.prototype[Bt.inspect]=oo();uo.exports=Z});var co=O((kl,Qr)=>{"use strict";Qr.exports=lo();Qr.exports.SqliteError=Ir()});var Ps=O((Ih,As)=>{var Oe=require("constants"),Vu=process.cwd,hr=null,Ku=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return hr||(hr=Vu.call(process)),hr};try{process.cwd()}catch{}typeof process.chdir=="function"&&(Un=process.chdir,process.chdir=function(r){hr=null,Un.call(process,r)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,Un));var Un;As.exports=zu;function zu(r){Oe.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(r),r.lutimes||t(r),r.chown=o(r.chown),r.fchown=o(r.fchown),r.lchown=o(r.lchown),r.chmod=n(r.chmod),r.fchmod=n(r.fchmod),r.lchmod=n(r.lchmod),r.chownSync=s(r.chownSync),r.fchownSync=s(r.fchownSync),r.lchownSync=s(r.lchownSync),r.chmodSync=i(r.chmodSync),r.fchmodSync=i(r.fchmodSync),r.lchmodSync=i(r.lchmodSync),r.stat=a(r.stat),r.fstat=a(r.fstat),r.lstat=a(r.lstat),r.statSync=l(r.statSync),r.fstatSync=l(r.fstatSync),r.lstatSync=l(r.lstatSync),r.chmod&&!r.lchmod&&(r.lchmod=function(u,p,d){d&&process.nextTick(d)},r.lchmodSync=function(){}),r.chown&&!r.lchown&&(r.lchown=function(u,p,d,y){y&&process.nextTick(y)},r.lchownSync=function(){}),Ku==="win32"&&(r.rename=typeof r.rename!="function"?r.rename:(function(u){function p(d,y,b){var S=Date.now(),x=0;u(d,y,function E(D){if(D&&(D.code==="EACCES"||D.code==="EPERM"||D.code==="EBUSY")&&Date.now()-S<6e4){setTimeout(function(){r.stat(y,function(N,C){N&&N.code==="ENOENT"?u(d,y,E):b(D)})},x),x<100&&(x+=10);return}b&&b(D)})}return Object.setPrototypeOf&&Object.setPrototypeOf(p,u),p})(r.rename)),r.read=typeof r.read!="function"?r.read:(function(u){function p(d,y,b,S,x,E){var D;if(E&&typeof E=="function"){var N=0;D=function(C,ae,re){if(C&&C.code==="EAGAIN"&&N<10)return N++,u.call(r,d,y,b,S,x,D);E.apply(this,arguments)}}return u.call(r,d,y,b,S,x,D)}return Object.setPrototypeOf&&Object.setPrototypeOf(p,u),p})(r.read),r.readSync=typeof r.readSync!="function"?r.readSync:(function(u){return function(p,d,y,b,S){for(var x=0;;)try{return u.call(r,p,d,y,b,S)}catch(E){if(E.code==="EAGAIN"&&x<10){x++;continue}throw E}}})(r.readSync);function e(u){u.lchmod=function(p,d,y){u.open(p,Oe.O_WRONLY|Oe.O_SYMLINK,d,function(b,S){if(b){y&&y(b);return}u.fchmod(S,d,function(x){u.close(S,function(E){y&&y(x||E)})})})},u.lchmodSync=function(p,d){var y=u.openSync(p,Oe.O_WRONLY|Oe.O_SYMLINK,d),b=!0,S;try{S=u.fchmodSync(y,d),b=!1}finally{if(b)try{u.closeSync(y)}catch{}else u.closeSync(y)}return S}}function t(u){Oe.hasOwnProperty("O_SYMLINK")&&u.futimes?(u.lutimes=function(p,d,y,b){u.open(p,Oe.O_SYMLINK,function(S,x){if(S){b&&b(S);return}u.futimes(x,d,y,function(E){u.close(x,function(D){b&&b(E||D)})})})},u.lutimesSync=function(p,d,y){var b=u.openSync(p,Oe.O_SYMLINK),S,x=!0;try{S=u.futimesSync(b,d,y),x=!1}finally{if(x)try{u.closeSync(b)}catch{}else u.closeSync(b)}return S}):u.futimes&&(u.lutimes=function(p,d,y,b){b&&process.nextTick(b)},u.lutimesSync=function(){})}function n(u){return u&&function(p,d,y){return u.call(r,p,d,function(b){m(b)&&(b=null),y&&y.apply(this,arguments)})}}function i(u){return u&&function(p,d){try{return u.call(r,p,d)}catch(y){if(!m(y))throw y}}}function o(u){return u&&function(p,d,y,b){return u.call(r,p,d,y,function(S){m(S)&&(S=null),b&&b.apply(this,arguments)})}}function s(u){return u&&function(p,d,y){try{return u.call(r,p,d,y)}catch(b){if(!m(b))throw b}}}function a(u){return u&&function(p,d,y){typeof d=="function"&&(y=d,d=null);function b(S,x){x&&(x.uid<0&&(x.uid+=4294967296),x.gid<0&&(x.gid+=4294967296)),y&&y.apply(this,arguments)}return d?u.call(r,p,d,b):u.call(r,p,b)}}function l(u){return u&&function(p,d){var y=d?u.call(r,p,d):u.call(r,p);return y&&(y.uid<0&&(y.uid+=4294967296),y.gid<0&&(y.gid+=4294967296)),y}}function m(u){if(!u||u.code==="ENOSYS")return!0;var p=!process.getuid||process.getuid()!==0;return!!(p&&(u.code==="EINVAL"||u.code==="EPERM"))}}});var Ms=O((Dh,Rs)=>{var Fs=require("stream").Stream;Rs.exports=Uu;function Uu(r){return{ReadStream:e,WriteStream:t};function e(n,i){if(!(this instanceof e))return new e(n,i);Fs.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,l=s.length;a<l;a++){var m=s[a];this[m]=i[m]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}r.open(this.path,this.flags,this.mode,function(u,p){if(u){o.emit("error",u),o.readable=!1;return}o.fd=p,o.emit("open",p),o._read()})}function t(n,i){if(!(this instanceof t))return new t(n,i);Fs.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var l=o[s];this[l]=i[l]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=r.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var Ks=O((Qh,Vs)=>{"use strict";Vs.exports=Wu;var ku=Object.getPrototypeOf||function(r){return r.__proto__};function Wu(r){if(r===null||typeof r!="object")return r;if(r instanceof Object)var e={__proto__:ku(r)};else var e=Object.create(null);return Object.getOwnPropertyNames(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}),e}});var Gn=O((Bh,Jn)=>{var K=require("fs"),Ju=Ps(),Gu=Ms(),Yu=Ks(),dr=require("util"),X,gr;typeof Symbol=="function"&&typeof Symbol.for=="function"?(X=Symbol.for("graceful-fs.queue"),gr=Symbol.for("graceful-fs.previous")):(X="___graceful-fs.queue",gr="___graceful-fs.previous");function Hu(){}function ks(r,e){Object.defineProperty(r,X,{get:function(){return e}})}var Be=Hu;dr.debuglog?Be=dr.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(Be=function(){var r=dr.format.apply(dr,arguments);r="GFS4: "+r.split(/\n/).join(`
GFS4: `),console.error(r)});K[X]||(zs=global[X]||[],ks(K,zs),K.close=(function(r){function e(t,n){return r.call(K,t,function(i){i||Us(),typeof n=="function"&&n.apply(this,arguments)})}return Object.defineProperty(e,gr,{value:r}),e})(K.close),K.closeSync=(function(r){function e(t){r.apply(K,arguments),Us()}return Object.defineProperty(e,gr,{value:r}),e})(K.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){Be(K[X]),require("assert").equal(K[X].length,0)}));var zs;global[X]||ks(global,K[X]);Jn.exports=kn(Yu(K));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!K.__patched&&(Jn.exports=kn(K),K.__patched=!0);function kn(r){Ju(r),r.gracefulify=kn,r.createReadStream=ae,r.createWriteStream=re;var e=r.readFile;r.readFile=t;function t(T,q,$){return typeof q=="function"&&($=q,q=null),A(T,q,$);function A(j,I,Q,P){return e(j,I,function(B){B&&(B.code==="EMFILE"||B.code==="ENFILE")?Ge([A,[j,I,Q],B,P||Date.now(),Date.now()]):typeof Q=="function"&&Q.apply(this,arguments)})}}var n=r.writeFile;r.writeFile=i;function i(T,q,$,A){return typeof $=="function"&&(A=$,$=null),j(T,q,$,A);function j(I,Q,P,B,k){return n(I,Q,P,function(F){F&&(F.code==="EMFILE"||F.code==="ENFILE")?Ge([j,[I,Q,P,B],F,k||Date.now(),Date.now()]):typeof B=="function"&&B.apply(this,arguments)})}}var o=r.appendFile;o&&(r.appendFile=s);function s(T,q,$,A){return typeof $=="function"&&(A=$,$=null),j(T,q,$,A);function j(I,Q,P,B,k){return o(I,Q,P,function(F){F&&(F.code==="EMFILE"||F.code==="ENFILE")?Ge([j,[I,Q,P,B],F,k||Date.now(),Date.now()]):typeof B=="function"&&B.apply(this,arguments)})}}var a=r.copyFile;a&&(r.copyFile=l);function l(T,q,$,A){return typeof $=="function"&&(A=$,$=0),j(T,q,$,A);function j(I,Q,P,B,k){return a(I,Q,P,function(F){F&&(F.code==="EMFILE"||F.code==="ENFILE")?Ge([j,[I,Q,P,B],F,k||Date.now(),Date.now()]):typeof B=="function"&&B.apply(this,arguments)})}}var m=r.readdir;r.readdir=p;var u=/^v[0-5]\./;function p(T,q,$){typeof q=="function"&&($=q,q=null);var A=u.test(process.version)?function(Q,P,B,k){return m(Q,j(Q,P,B,k))}:function(Q,P,B,k){return m(Q,P,j(Q,P,B,k))};return A(T,q,$);function j(I,Q,P,B){return function(k,F){k&&(k.code==="EMFILE"||k.code==="ENFILE")?Ge([A,[I,Q,P],k,B||Date.now(),Date.now()]):(F&&F.sort&&F.sort(),typeof P=="function"&&P.call(this,k,F))}}}if(process.version.substr(0,4)==="v0.8"){var d=Gu(r);E=d.ReadStream,N=d.WriteStream}var y=r.ReadStream;y&&(E.prototype=Object.create(y.prototype),E.prototype.open=D);var b=r.WriteStream;b&&(N.prototype=Object.create(b.prototype),N.prototype.open=C),Object.defineProperty(r,"ReadStream",{get:function(){return E},set:function(T){E=T},enumerable:!0,configurable:!0}),Object.defineProperty(r,"WriteStream",{get:function(){return N},set:function(T){N=T},enumerable:!0,configurable:!0});var S=E;Object.defineProperty(r,"FileReadStream",{get:function(){return S},set:function(T){S=T},enumerable:!0,configurable:!0});var x=N;Object.defineProperty(r,"FileWriteStream",{get:function(){return x},set:function(T){x=T},enumerable:!0,configurable:!0});function E(T,q){return this instanceof E?(y.apply(this,arguments),this):E.apply(Object.create(E.prototype),arguments)}function D(){var T=this;L(T.path,T.flags,T.mode,function(q,$){q?(T.autoClose&&T.destroy(),T.emit("error",q)):(T.fd=$,T.emit("open",$),T.read())})}function N(T,q){return this instanceof N?(b.apply(this,arguments),this):N.apply(Object.create(N.prototype),arguments)}function C(){var T=this;L(T.path,T.flags,T.mode,function(q,$){q?(T.destroy(),T.emit("error",q)):(T.fd=$,T.emit("open",$))})}function ae(T,q){return new r.ReadStream(T,q)}function re(T,q){return new r.WriteStream(T,q)}var v=r.open;r.open=L;function L(T,q,$,A){return typeof $=="function"&&(A=$,$=null),j(T,q,$,A);function j(I,Q,P,B,k){return v(I,Q,P,function(F,bl){F&&(F.code==="EMFILE"||F.code==="ENFILE")?Ge([j,[I,Q,P,B],F,k||Date.now(),Date.now()]):typeof B=="function"&&B.apply(this,arguments)})}}return r}function Ge(r){Be("ENQUEUE",r[0].name,r[1]),K[X].push(r),Wn()}var yr;function Us(){for(var r=Date.now(),e=0;e<K[X].length;++e)K[X][e].length>2&&(K[X][e][3]=r,K[X][e][4]=r);Wn()}function Wn(){if(clearTimeout(yr),yr=void 0,K[X].length!==0){var r=K[X].shift(),e=r[0],t=r[1],n=r[2],i=r[3],o=r[4];if(i===void 0)Be("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){Be("TIMEOUT",e.name,t);var s=t.pop();typeof s=="function"&&s.call(null,n)}else{var a=Date.now()-o,l=Math.max(o-i,1),m=Math.min(l*1.2,100);a>=m?(Be("RETRY",e.name,t),e.apply(null,t.concat([i]))):K[X].push(r)}yr===void 0&&(yr=setTimeout(Wn,0))}}});var Js=O((Ah,Ws)=>{function ce(r,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(r)),this._timeouts=r,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}Ws.exports=ce;ce.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts};ce.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null};ce.prototype.retry=function(r){if(this._timeout&&clearTimeout(this._timeout),!r)return!1;var e=new Date().getTime();if(r&&e-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(r);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),t=this._timeouts.shift();else return!1;var n=this,i=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},t);return this._options.unref&&i.unref(),!0};ce.prototype.attempt=function(r,e){this._fn=r,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};ce.prototype.try=function(r){console.log("Using RetryOperation.try() is deprecated"),this.attempt(r)};ce.prototype.start=function(r){console.log("Using RetryOperation.start() is deprecated"),this.attempt(r)};ce.prototype.start=ce.prototype.try;ce.prototype.errors=function(){return this._errors};ce.prototype.attempts=function(){return this._attempts};ce.prototype.mainError=function(){if(this._errors.length===0)return null;for(var r={},e=null,t=0,n=0;n<this._errors.length;n++){var i=this._errors[n],o=i.message,s=(r[o]||0)+1;r[o]=s,s>=t&&(e=i,t=s)}return e}});var Gs=O(Ae=>{var Xu=Js();Ae.operation=function(r){var e=Ae.timeouts(r);return new Xu(e,{forever:r&&r.forever,unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})};Ae.timeouts=function(r){if(r instanceof Array)return[].concat(r);var e={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var t in r)e[t]=r[t];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],i=0;i<e.retries;i++)n.push(this.createTimeout(i,e));return r&&r.forever&&!n.length&&n.push(this.createTimeout(i,e)),n.sort(function(o,s){return o-s}),n};Ae.createTimeout=function(r,e){var t=e.randomize?Math.random()+1:1,n=Math.round(t*e.minTimeout*Math.pow(e.factor,r));return n=Math.min(n,e.maxTimeout),n};Ae.wrap=function(r,e,t){if(e instanceof Array&&(t=e,e=null),!t){t=[];for(var n in r)typeof r[n]=="function"&&t.push(n)}for(var i=0;i<t.length;i++){var o=t[i],s=r[o];r[o]=function(l){var m=Ae.operation(e),u=Array.prototype.slice.call(arguments,1),p=u.pop();u.push(function(d){m.retry(d)||(d&&(arguments[0]=m.mainError()),p.apply(this,arguments))}),m.attempt(function(){l.apply(r,u)})}.bind(r,s),r[o].options=e}}});var Hs=O((Fh,Ys)=>{Ys.exports=Gs()});var Xs=O((Rh,br)=>{br.exports=["SIGABRT","SIGALRM","SIGHUP","SIGINT","SIGTERM"];process.platform!=="win32"&&br.exports.push("SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT");process.platform==="linux"&&br.exports.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT","SIGUNUSED")});var na=O((Mh,Xe)=>{var R=global.process,Pe=function(r){return r&&typeof r=="object"&&typeof r.removeListener=="function"&&typeof r.emit=="function"&&typeof r.reallyExit=="function"&&typeof r.listeners=="function"&&typeof r.kill=="function"&&typeof r.pid=="number"&&typeof r.on=="function"};Pe(R)?(Zs=require("assert"),Ye=Xs(),ea=/^win/i.test(R.platform),wt=require("events"),typeof wt!="function"&&(wt=wt.EventEmitter),R.__signal_exit_emitter__?Y=R.__signal_exit_emitter__:(Y=R.__signal_exit_emitter__=new wt,Y.count=0,Y.emitted={}),Y.infinite||(Y.setMaxListeners(1/0),Y.infinite=!0),Xe.exports=function(r,e){if(!Pe(global.process))return function(){};Zs.equal(typeof r,"function","a callback must be provided for exit handler"),He===!1&&Yn();var t="exit";e&&e.alwaysLast&&(t="afterexit");var n=function(){Y.removeListener(t,r),Y.listeners("exit").length===0&&Y.listeners("afterexit").length===0&&wr()};return Y.on(t,r),n},wr=function(){!He||!Pe(global.process)||(He=!1,Ye.forEach(function(e){try{R.removeListener(e,Sr[e])}catch{}}),R.emit=Tr,R.reallyExit=Hn,Y.count-=1)},Xe.exports.unload=wr,Fe=function(e,t,n){Y.emitted[e]||(Y.emitted[e]=!0,Y.emit(e,t,n))},Sr={},Ye.forEach(function(r){Sr[r]=function(){if(Pe(global.process)){var t=R.listeners(r);t.length===Y.count&&(wr(),Fe("exit",null,r),Fe("afterexit",null,r),ea&&r==="SIGHUP"&&(r="SIGINT"),R.kill(R.pid,r))}}}),Xe.exports.signals=function(){return Ye},He=!1,Yn=function(){He||!Pe(global.process)||(He=!0,Y.count+=1,Ye=Ye.filter(function(e){try{return R.on(e,Sr[e]),!0}catch{return!1}}),R.emit=ra,R.reallyExit=ta)},Xe.exports.load=Yn,Hn=R.reallyExit,ta=function(e){Pe(global.process)&&(R.exitCode=e||0,Fe("exit",R.exitCode,null),Fe("afterexit",R.exitCode,null),Hn.call(R,R.exitCode))},Tr=R.emit,ra=function(e,t){if(e==="exit"&&Pe(global.process)){t!==void 0&&(R.exitCode=t);var n=Tr.apply(this,arguments);return Fe("exit",R.exitCode,null),Fe("afterexit",R.exitCode,null),n}else return Tr.apply(this,arguments)}):Xe.exports=function(){return function(){}};var Zs,Ye,ea,wt,Y,wr,Fe,Sr,He,Yn,Hn,ta,Tr,ra});var oa=O((Vh,Xn)=>{"use strict";var ia=Symbol();function Zu(r,e,t){let n=e[ia];if(n)return e.stat(r,(o,s)=>{if(o)return t(o);t(null,s.mtime,n)});let i=new Date(Math.ceil(Date.now()/1e3)*1e3+5);e.utimes(r,i,i,o=>{if(o)return t(o);e.stat(r,(s,a)=>{if(s)return t(s);let l=a.mtime.getTime()%1e3===0?"s":"ms";Object.defineProperty(e,ia,{value:l}),t(null,a.mtime,l)})})}function el(r){let e=Date.now();return r==="s"&&(e=Math.ceil(e/1e3)*1e3),new Date(e)}Xn.exports.probe=Zu;Xn.exports.getMtime=el});var ca=O((Kh,Tt)=>{"use strict";var tl=require("path"),ti=Gn(),rl=Hs(),nl=na(),sa=oa(),Se={};function St(r,e){return e.lockfilePath||`${r}.lock`}function ri(r,e,t){if(!e.realpath)return t(null,tl.resolve(r));e.fs.realpath(r,t)}function ei(r,e,t){let n=St(r,e);e.fs.mkdir(n,i=>{if(!i)return sa.probe(n,e.fs,(o,s,a)=>{if(o)return e.fs.rmdir(n,()=>{}),t(o);t(null,s,a)});if(i.code!=="EEXIST")return t(i);if(e.stale<=0)return t(Object.assign(new Error("Lock file is already being held"),{code:"ELOCKED",file:r}));e.fs.stat(n,(o,s)=>{if(o)return o.code==="ENOENT"?ei(r,{...e,stale:0},t):t(o);if(!aa(s,e))return t(Object.assign(new Error("Lock file is already being held"),{code:"ELOCKED",file:r}));ua(r,e,a=>{if(a)return t(a);ei(r,{...e,stale:0},t)})})})}function aa(r,e){return r.mtime.getTime()<Date.now()-e.stale}function ua(r,e,t){e.fs.rmdir(St(r,e),n=>{if(n&&n.code!=="ENOENT")return t(n);t()})}function xr(r,e){let t=Se[r];t.updateTimeout||(t.updateDelay=t.updateDelay||e.update,t.updateTimeout=setTimeout(()=>{t.updateTimeout=null,e.fs.stat(t.lockfilePath,(n,i)=>{let o=t.lastUpdate+e.stale<Date.now();if(n)return n.code==="ENOENT"||o?Zn(r,t,Object.assign(n,{code:"ECOMPROMISED"})):(t.updateDelay=1e3,xr(r,e));if(!(t.mtime.getTime()===i.mtime.getTime()))return Zn(r,t,Object.assign(new Error("Unable to update lock within the stale threshold"),{code:"ECOMPROMISED"}));let a=sa.getMtime(t.mtimePrecision);e.fs.utimes(t.lockfilePath,a,a,l=>{let m=t.lastUpdate+e.stale<Date.now();if(!t.released){if(l)return l.code==="ENOENT"||m?Zn(r,t,Object.assign(l,{code:"ECOMPROMISED"})):(t.updateDelay=1e3,xr(r,e));t.mtime=a,t.lastUpdate=Date.now(),t.updateDelay=null,xr(r,e)}})})},t.updateDelay),t.updateTimeout.unref&&t.updateTimeout.unref())}function Zn(r,e,t){e.released=!0,e.updateTimeout&&clearTimeout(e.updateTimeout),Se[r]===e&&delete Se[r],e.options.onCompromised(t)}function il(r,e,t){e={stale:1e4,update:null,realpath:!0,retries:0,fs:ti,onCompromised:n=>{throw n},...e},e.retries=e.retries||0,e.retries=typeof e.retries=="number"?{retries:e.retries}:e.retries,e.stale=Math.max(e.stale||0,2e3),e.update=e.update==null?e.stale/2:e.update||0,e.update=Math.max(Math.min(e.update,e.stale/2),1e3),ri(r,e,(n,i)=>{if(n)return t(n);let o=rl.operation(e.retries);o.attempt(()=>{ei(i,e,(s,a,l)=>{if(o.retry(s))return;if(s)return t(o.mainError());let m=Se[i]={lockfilePath:St(i,e),mtime:a,mtimePrecision:l,options:e,lastUpdate:Date.now()};xr(i,e),t(null,u=>{if(m.released)return u&&u(Object.assign(new Error("Lock is already released"),{code:"ERELEASED"}));la(i,{...e,realpath:!1},u)})})})})}function la(r,e,t){e={fs:ti,realpath:!0,...e},ri(r,e,(n,i)=>{if(n)return t(n);let o=Se[i];if(!o)return t(Object.assign(new Error("Lock is not acquired/owned by you"),{code:"ENOTACQUIRED"}));o.updateTimeout&&clearTimeout(o.updateTimeout),o.released=!0,delete Se[i],ua(i,e,t)})}function ol(r,e,t){e={stale:1e4,realpath:!0,fs:ti,...e},e.stale=Math.max(e.stale||0,2e3),ri(r,e,(n,i)=>{if(n)return t(n);e.fs.stat(St(i,e),(o,s)=>o?o.code==="ENOENT"?t(null,!1):t(o):t(null,!aa(s,e)))})}function sl(){return Se}nl(()=>{for(let r in Se){let e=Se[r].options;try{e.fs.rmdirSync(St(r,e))}catch{}}});Tt.exports.lock=il;Tt.exports.unlock=la;Tt.exports.check=ol;Tt.exports.getLocks=sl});var ma=O((zh,fa)=>{"use strict";var al=Gn();function ul(r){let e=["mkdir","realpath","stat","rmdir","utimes"],t={...r};return e.forEach(n=>{t[n]=(...i)=>{let o=i.pop(),s;try{s=r[`${n}Sync`](...i)}catch(a){return o(a)}o(null,s)}}),t}function ll(r){return(...e)=>new Promise((t,n)=>{e.push((i,o)=>{i?n(i):t(o)}),r(...e)})}function cl(r){return(...e)=>{let t,n;if(e.push((i,o)=>{t=i,n=o}),r(...e),t)throw t;return n}}function fl(r){if(r={...r},r.fs=ul(r.fs||al),typeof r.retries=="number"&&r.retries>0||r.retries&&typeof r.retries.retries=="number"&&r.retries.retries>0)throw Object.assign(new Error("Cannot use retries with the sync api"),{code:"ESYNC"});return r}fa.exports={toPromise:ll,toSync:cl,toSyncOptions:fl}});var ha=O((Uh,$e)=>{"use strict";var Ze=ca(),{toPromise:Er,toSync:vr,toSyncOptions:ni}=ma();async function pa(r,e){let t=await Er(Ze.lock)(r,e);return Er(t)}function ml(r,e){let t=vr(Ze.lock)(r,ni(e));return vr(t)}function pl(r,e){return Er(Ze.unlock)(r,e)}function hl(r,e){return vr(Ze.unlock)(r,ni(e))}function dl(r,e){return Er(Ze.check)(r,e)}function yl(r,e){return vr(Ze.check)(r,ni(e))}$e.exports=pa;$e.exports.lock=pa;$e.exports.unlock=pl;$e.exports.lockSync=ml;$e.exports.unlockSync=hl;$e.exports.check=dl;$e.exports.checkSync=yl});var gl={};Ea(gl,{default:()=>ga});module.exports=va(gl);var Ss=require("@raycast/api");var mr=require("@raycast/api"),bt=require("path"),ds=require("os"),ys=Et(Lr());var gt=Et(co(),1);var f=Symbol.for("drizzle:entityKind"),Wl=Symbol.for("drizzle:hasOwnEntityKind");function h(r,e){if(!r||typeof r!="object")return!1;if(r instanceof e)return!0;if(!Object.prototype.hasOwnProperty.call(e,f))throw new Error(`Class "${e.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let t=Object.getPrototypeOf(r).constructor;if(t)for(;t;){if(f in t&&t[f]===e[f])return!0;t=Object.getPrototypeOf(t)}return!1}var Br=class{static[f]="ConsoleLogWriter";write(e){console.log(e)}},At=class{static[f]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new Br}logQuery(e,t){let n=t.map(o=>{try{return JSON.stringify(o)}catch{return String(o)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},Pt=class{static[f]="NoopLogger";logQuery(){}};var ee=Symbol.for("drizzle:Name");var Ft=Symbol.for("drizzle:Schema"),Rt=Symbol.for("drizzle:Columns"),fo=Symbol.for("drizzle:ExtraConfigColumns"),Ar=Symbol.for("drizzle:OriginalName"),Pr=Symbol.for("drizzle:BaseName"),rt=Symbol.for("drizzle:IsAlias"),mo=Symbol.for("drizzle:ExtraConfigBuilder"),Eu=Symbol.for("drizzle:IsDrizzleTable"),g=class{static[f]="Table";static Symbol={Name:ee,Schema:Ft,OriginalName:Ar,Columns:Rt,ExtraConfigColumns:fo,BaseName:Pr,IsAlias:rt,ExtraConfigBuilder:mo};[ee];[Ar];[Ft];[Rt];[fo];[Pr];[rt]=!1;[Eu]=!0;[mo]=void 0;constructor(e,t,n){this[ee]=this[Ar]=e,this[Ft]=t,this[Pr]=n}};function xe(r){return r[ee]}function _e(r){return`${r[Ft]??"public"}.${r[ee]}`}var _=class{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity}static[f]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}};var Me=class{static[f]="ColumnBuilder";config;constructor(e,t,n){this.config={name:e,keyAsName:e==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:n,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){this.config.name===""&&(this.config.name=e)}};var Mt=class{static[f]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:n,columns:i,foreignColumns:o}=e();return{name:n,columns:i,foreignTable:o[0].table,foreignColumns:o}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e===void 0?"no action":e,this}onDelete(e){return this._onDelete=e===void 0?"no action":e,this}build(e){return new Fr(e,this)}},Fr=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[f]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:n}=this.reference(),i=t.map(a=>a.name),o=n.map(a=>a.name),s=[this.table[ee],...i,n[0].table[ee],...o];return e??`${s.join("_")}_fk`}};function Vt(r,...e){return r(...e)}function Vr(r,e){return`${r[ee]}_${e.join("_")}_unique`}var Rr=class{constructor(e,t){this.name=t,this.columns=e}static[f]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new Mr(e,this.columns,this.nullsNotDistinctConfig,this.name)}},po=class{static[f]="PgUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new Rr(e,this.name)}},Mr=class{constructor(e,t,n,i){this.table=e,this.columns=t,this.name=i??Vr(this.table,this.columns.map(o=>o.name)),this.nullsNotDistinct=n}static[f]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}};function ho(r,e,t){for(let n=e;n<r.length;n++){let i=r[n];if(i==="\\"){n++;continue}if(i==='"')return[r.slice(e,n).replace(/\\/g,""),n+1];if(!t&&(i===","||i==="}"))return[r.slice(e,n).replace(/\\/g,""),n]}return[r.slice(e).replace(/\\/g,""),r.length]}function yo(r,e=0){let t=[],n=e,i=!1;for(;n<r.length;){let o=r[n];if(o===","){(i||n===e)&&t.push(""),i=!0,n++;continue}if(i=!1,o==="\\"){n+=2;continue}if(o==='"'){let[l,m]=ho(r,n+1,!0);t.push(l),n=m;continue}if(o==="}")return[t,n+1];if(o==="{"){let[l,m]=yo(r,n+1);t.push(l),n=m;continue}let[s,a]=ho(r,n,!1);t.push(s),n=a}return[t,n]}function go(r){let[e]=yo(r,1);return e}function Kr(r){return`{${r.map(e=>Array.isArray(e)?Kr(e):typeof e=="string"?`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${e}`).join(",")}}`}var Ve=class extends Me{foreignKeyConfigs=[];static[f]="PgColumnBuilder";array(e){return new Ur(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>Vt((o,s)=>{let a=new Mt(()=>{let l=o();return{columns:[e],foreignColumns:[l]}});return s.onUpdate&&a.onUpdate(s.onUpdate),s.onDelete&&a.onDelete(s.onDelete),a.build(t)},n,i))}buildExtraConfigColumn(e){return new zr(e,this.config)}},Le=class extends _{constructor(e,t){t.uniqueName||(t.uniqueName=Vr(e,[t.name])),super(e,t),this.table=e}static[f]="PgColumn"},zr=class extends Le{static[f]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}},bo=class{static[f]="IndexedColumn";constructor(e,t,n,i){this.name=e,this.keyAsName=t,this.type=n,this.indexConfig=i}name;keyAsName;type;indexConfig},Ur=class extends Ve{static[f]="PgArrayBuilder";constructor(e,t,n){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=n}build(e){let t=this.config.baseBuilder.build(e);return new kr(e,this.config,t)}},kr=class r extends Le{constructor(e,t,n,i){super(e,t),this.baseColumn=n,this.range=i,this.size=t.size}size;static[f]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size=="number"?this.size:""}]`}mapFromDriverValue(e){return typeof e=="string"&&(e=go(e)),e.map(t=>this.baseColumn.mapFromDriverValue(t))}mapToDriverValue(e,t=!1){let n=e.map(i=>i===null?null:h(this.baseColumn,r)?this.baseColumn.mapToDriverValue(i,!0):this.baseColumn.mapToDriverValue(i));return t?n:Kr(n)}};var wo=class extends Ve{static[f]="PgEnumObjectColumnBuilder";constructor(e,t){super(e,"string","PgEnumObjectColumn"),this.config.enum=t}build(e){return new Wr(e,this.config)}},Wr=class extends Le{static[f]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}},So=Symbol.for("drizzle:isPgEnum");function xo(r){return!!r&&typeof r=="function"&&So in r&&r[So]===!0}var To=class extends Ve{static[f]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new Jr(e,this.config)}},Jr=class extends Le{static[f]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}};var W=class{static[f]="Subquery";constructor(e,t,n,i=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:n,isWith:i}}},Ke=class extends W{static[f]="WithSubquery"};var Eo="0.43.1";var Gr,Yr,vo={startActiveSpan(r,e){return Gr?(Yr||(Yr=Gr.trace.getTracer("drizzle-orm",Eo)),Vt((t,n)=>n.startActiveSpan(r,i=>{try{return e(i)}catch(o){throw i.setStatus({code:t.SpanStatusCode.ERROR,message:o instanceof Error?o.message:"Unknown error"}),o}finally{i.end()}}),Gr,Yr)):e()}};var M=Symbol.for("drizzle:ViewBaseConfig");var Oo=class{static[f]="FakePrimitiveParam"};function Hr(r){return r!=null&&typeof r.getSQL=="function"}function vu(r){let e={sql:"",params:[]};for(let t of r)e.sql+=t.sql,e.params.push(...t.params),t.typings?.length&&(e.typings||(e.typings=[]),e.typings.push(...t.typings));return e}var z=class{static[f]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new w([this])}},w=class r{constructor(e){this.queryChunks=e}static[f]="SQL";decoder=Co;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return vo.startActiveSpan("drizzle.buildSQL",t=>{let n=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":n.sql,"drizzle.query.params":JSON.stringify(n.params)}),n})}buildQueryFromSourceParams(e,t){let n=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:i,escapeName:o,escapeParam:s,prepareTyping:a,inlineParams:l,paramStartIndex:m}=n;return vu(e.map(u=>{if(h(u,z))return{sql:u.value.join(""),params:[]};if(h(u,nt))return{sql:o(u.value),params:[]};if(u===void 0)return{sql:"",params:[]};if(Array.isArray(u)){let p=[new z("(")];for(let[d,y]of u.entries())p.push(y),d<u.length-1&&p.push(new z(", "));return p.push(new z(")")),this.buildQueryFromSourceParams(p,n)}if(h(u,r))return this.buildQueryFromSourceParams(u.queryChunks,{...n,inlineParams:l||u.shouldInlineParams});if(h(u,g)){let p=u[g.Symbol.Schema],d=u[g.Symbol.Name];return{sql:p===void 0||u[rt]?o(d):o(p)+"."+o(d),params:[]}}if(h(u,_)){let p=i.getColumnCasing(u);if(t.invokeSource==="indexes")return{sql:o(p),params:[]};let d=u.table[g.Symbol.Schema];return{sql:u.table[rt]||d===void 0?o(u.table[g.Symbol.Name])+"."+o(p):o(d)+"."+o(u.table[g.Symbol.Name])+"."+o(p),params:[]}}if(h(u,se)){let p=u[M].schema,d=u[M].name;return{sql:p===void 0||u[M].isAlias?o(d):o(p)+"."+o(d),params:[]}}if(h(u,ne)){if(h(u.value,we))return{sql:s(m.value++,u),params:[u],typings:["none"]};let p=u.value===null?null:u.encoder.mapToDriverValue(u.value);if(h(p,r))return this.buildQueryFromSourceParams([p],n);if(l)return{sql:this.mapInlineParam(p,n),params:[]};let d=["none"];return a&&(d=[a(u.encoder)]),{sql:s(m.value++,p),params:[p],typings:d}}return h(u,we)?{sql:s(m.value++,u),params:[u],typings:["none"]}:h(u,r.Aliased)&&u.fieldAlias!==void 0?{sql:o(u.fieldAlias),params:[]}:h(u,W)?u._.isWith?{sql:o(u._.alias),params:[]}:this.buildQueryFromSourceParams([new z("("),u._.sql,new z(") "),new nt(u._.alias)],n):xo(u)?u.schema?{sql:o(u.schema)+"."+o(u.enumName),params:[]}:{sql:o(u.enumName),params:[]}:Hr(u)?u.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([u.getSQL()],n):this.buildQueryFromSourceParams([new z("("),u.getSQL(),new z(")")],n):l?{sql:this.mapInlineParam(u,n),params:[]}:{sql:s(m.value++,u),params:[u],typings:["none"]}}))}mapInlineParam(e,{escapeString:t}){if(e===null)return"null";if(typeof e=="number"||typeof e=="boolean")return e.toString();if(typeof e=="string")return t(e);if(typeof e=="object"){let n=e.toString();return t(n==="[object Object]"?JSON.stringify(e):n)}throw new Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return e===void 0?this:new r.Aliased(this,e)}mapWith(e){return this.decoder=typeof e=="function"?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}},nt=class{constructor(e){this.value=e}static[f]="Name";brand;getSQL(){return new w([this])}};function $o(r){return typeof r=="object"&&r!==null&&"mapToDriverValue"in r&&typeof r.mapToDriverValue=="function"}var Co={mapFromDriverValue:r=>r},qo={mapToDriverValue:r=>r},Pc={...Co,...qo},ne=class{constructor(e,t=qo){this.value=e,this.encoder=t}static[f]="Param";brand;getSQL(){return new w([this])}};function c(r,...e){let t=[];(e.length>0||r.length>0&&r[0]!=="")&&t.push(new z(r[0]));for(let[n,i]of e.entries())t.push(i,new z(r[n+1]));return new w(t)}(r=>{function e(){return new w([])}r.empty=e;function t(l){return new w(l)}r.fromList=t;function n(l){return new w([new z(l)])}r.raw=n;function i(l,m){let u=[];for(let[p,d]of l.entries())p>0&&m!==void 0&&u.push(m),u.push(d);return new w(u)}r.join=i;function o(l){return new nt(l)}r.identifier=o;function s(l){return new we(l)}r.placeholder=s;function a(l,m){return new ne(l,m)}r.param=a})(c||(c={}));(r=>{class e{constructor(n,i){this.sql=n,this.fieldAlias=i}static[f]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new e(this.sql,this.fieldAlias)}}r.Aliased=e})(w||(w={}));var we=class{constructor(e){this.name=e}static[f]="Placeholder";getSQL(){return new w([this])}};function it(r,e){return r.map(t=>{if(h(t,we)){if(!(t.name in e))throw new Error(`No value for placeholder "${t.name}" was provided`);return e[t.name]}if(h(t,ne)&&h(t.value,we)){if(!(t.value.name in e))throw new Error(`No value for placeholder "${t.value.name}" was provided`);return t.encoder.mapToDriverValue(e[t.value.name])}return t})}var Ou=Symbol.for("drizzle:IsDrizzleView"),se=class{static[f]="View";[M];[Ou]=!0;constructor({name:e,schema:t,selectedFields:n,query:i}){this[M]={name:e,originalName:e,schema:t,selectedFields:n,query:i,isExisting:!i,isAlias:!1}}getSQL(){return new w([this])}};_.prototype.getSQL=function(){return new w([this])};g.prototype.getSQL=function(){return new w([this])};W.prototype.getSQL=function(){return new w([this])};function Xr(r,e,t){let n={},i=r.reduce((o,{path:s,field:a},l)=>{let m;h(a,_)?m=a:h(a,w)?m=a.decoder:m=a.sql.decoder;let u=o;for(let[p,d]of s.entries())if(p<s.length-1)d in u||(u[d]={}),u=u[d];else{let y=e[l],b=u[d]=y===null?null:m.mapFromDriverValue(y);if(t&&h(a,_)&&s.length===2){let S=s[0];S in n?typeof n[S]=="string"&&n[S]!==xe(a.table)&&(n[S]=!1):n[S]=b===null?xe(a.table):!1}}return o},{});if(t&&Object.keys(n).length>0)for(let[o,s]of Object.entries(n))typeof s=="string"&&!t[s]&&(i[o]=null);return i}function ue(r,e){return Object.entries(r).reduce((t,[n,i])=>{if(typeof n!="string")return t;let o=e?[...e,n]:[n];return h(i,_)||h(i,w)||h(i,w.Aliased)?t.push({path:o,field:i}):h(i,g)?t.push(...ue(i[g.Symbol.Columns],o)):t.push(...ue(i,o)),t},[])}function ot(r,e){let t=Object.keys(r),n=Object.keys(e);if(t.length!==n.length)return!1;for(let[i,o]of t.entries())if(o!==n[i])return!1;return!0}function Kt(r,e){let t=Object.entries(e).filter(([,n])=>n!==void 0).map(([n,i])=>h(i,w)||h(i,_)?[n,i]:[n,new ne(i,r[g.Symbol.Columns][n])]);if(t.length===0)throw new Error("No values to set");return Object.fromEntries(t)}function No(r,e){for(let t of e)for(let n of Object.getOwnPropertyNames(t.prototype))n!=="constructor"&&Object.defineProperty(r.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n)||Object.create(null))}function _o(r){return r[g.Symbol.Columns]}function st(r){return h(r,W)?r._.alias:h(r,se)?r[M].name:h(r,w)?void 0:r[g.Symbol.IsAlias]?r[g.Symbol.Name]:r[g.Symbol.BaseName]}function ye(r,e){return{name:typeof r=="string"&&r.length>0?r:"",config:typeof r=="object"?r:e}}function Lo(r){if(typeof r!="object"||r===null||r.constructor.name!=="Object")return!1;if("logger"in r){let e=typeof r.logger;return!(e!=="boolean"&&(e!=="object"||typeof r.logger.logQuery!="function")&&e!=="undefined")}if("schema"in r){let e=typeof r.schema;return!(e!=="object"&&e!=="undefined")}if("casing"in r){let e=typeof r.casing;return!(e!=="string"&&e!=="undefined")}if("mode"in r)return!(r.mode!=="default"||r.mode!=="planetscale"||r.mode!==void 0);if("connection"in r){let e=typeof r.connection;return!(e!=="string"&&e!=="object"&&e!=="undefined")}if("client"in r){let e=typeof r.client;return!(e!=="object"&&e!=="function"&&e!=="undefined")}return Object.keys(r).length===0}var jo=Symbol.for("drizzle:PgInlineForeignKeys"),Io=Symbol.for("drizzle:EnableRLS"),zt=class extends g{static[f]="PgTable";static Symbol=Object.assign({},g.Symbol,{InlineForeignKeys:jo,EnableRLS:Io});[jo]=[];[Io]=!1;[g.Symbol.ExtraConfigBuilder]=void 0;[g.Symbol.ExtraConfigColumns]={}};var Ut=class{static[f]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new Zr(e,this.columns,this.name)}},Zr=class{constructor(e,t,n){this.table=e,this.columns=t,this.name=n}static[f]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[zt.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}};function ie(r,e){return $o(e)&&!Hr(r)&&!h(r,ne)&&!h(r,we)&&!h(r,_)&&!h(r,g)&&!h(r,se)?new ne(r,e):r}var kt=(r,e)=>c`${r} = ${ie(e,r)}`,Do=(r,e)=>c`${r} <> ${ie(e,r)}`;function at(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new w(e):new w([new z("("),c.join(e,new z(" and ")),new z(")")])}function Qo(...r){let e=r.filter(t=>t!==void 0);if(e.length!==0)return e.length===1?new w(e):new w([new z("("),c.join(e,new z(" or ")),new z(")")])}function Bo(r){return c`not ${r}`}var Ao=(r,e)=>c`${r} > ${ie(e,r)}`,Po=(r,e)=>c`${r} >= ${ie(e,r)}`,Fo=(r,e)=>c`${r} < ${ie(e,r)}`,Ro=(r,e)=>c`${r} <= ${ie(e,r)}`;function Mo(r,e){return Array.isArray(e)?e.length===0?c`false`:c`${r} in ${e.map(t=>ie(t,r))}`:c`${r} in ${ie(e,r)}`}function Vo(r,e){return Array.isArray(e)?e.length===0?c`true`:c`${r} not in ${e.map(t=>ie(t,r))}`:c`${r} not in ${ie(e,r)}`}function Ko(r){return c`${r} is null`}function zo(r){return c`${r} is not null`}function Uo(r){return c`exists ${r}`}function ko(r){return c`not exists ${r}`}function Wo(r,e,t){return c`${r} between ${ie(e,r)} and ${ie(t,r)}`}function Jo(r,e,t){return c`${r} not between ${ie(e,r)} and ${ie(t,r)}`}function Go(r,e){return c`${r} like ${e}`}function Yo(r,e){return c`${r} not like ${e}`}function Ho(r,e){return c`${r} ilike ${e}`}function Xo(r,e){return c`${r} not ilike ${e}`}function Zo(r){return c`${r} asc`}function es(r){return c`${r} desc`}var Wt=class{constructor(e,t,n){this.sourceTable=e,this.referencedTable=t,this.relationName=n,this.referencedTableName=t[g.Symbol.Name]}static[f]="Relation";referencedTableName;fieldName},en=class{constructor(e,t){this.table=e,this.config=t}static[f]="Relations"},Ee=class r extends Wt{constructor(e,t,n,i){super(e,t,n?.relationName),this.config=n,this.isNullable=i}static[f]="One";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}},ut=class r extends Wt{constructor(e,t,n){super(e,t,n?.relationName),this.config=n}static[f]="Many";withFieldName(e){let t=new r(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}};function ts(){return{and:at,between:Wo,eq:kt,exists:Uo,gt:Ao,gte:Po,ilike:Ho,inArray:Mo,isNull:Ko,isNotNull:zo,like:Go,lt:Fo,lte:Ro,ne:Do,not:Bo,notBetween:Jo,notExists:ko,notLike:Yo,notIlike:Xo,notInArray:Vo,or:Qo,sql:c}}function rs(){return{sql:c,asc:Zo,desc:es}}function ns(r,e){Object.keys(r).length===1&&"default"in r&&!h(r.default,g)&&(r=r.default);let t={},n={},i={};for(let[o,s]of Object.entries(r))if(h(s,g)){let a=_e(s),l=n[a];t[a]=o,i[o]={tsName:o,dbName:s[g.Symbol.Name],schema:s[g.Symbol.Schema],columns:s[g.Symbol.Columns],relations:l?.relations??{},primaryKey:l?.primaryKey??[]};for(let u of Object.values(s[g.Symbol.Columns]))u.primary&&i[o].primaryKey.push(u);let m=s[g.Symbol.ExtraConfigBuilder]?.(s[g.Symbol.ExtraConfigColumns]);if(m)for(let u of Object.values(m))h(u,Ut)&&i[o].primaryKey.push(...u.columns)}else if(h(s,en)){let a=_e(s.table),l=t[a],m=s.config(e(s.table)),u;for(let[p,d]of Object.entries(m))if(l){let y=i[l];y.relations[p]=d,u&&y.primaryKey.push(...u)}else a in n||(n[a]={relations:{},primaryKey:u}),n[a].relations[p]=d}return{tables:i,tableNamesMap:t}}function $u(r){return function(t,n){return new Ee(r,t,n,n?.fields.reduce((i,o)=>i&&o.notNull,!0)??!1)}}function Cu(r){return function(t,n){return new ut(r,t,n)}}function is(r,e,t){if(h(t,Ee)&&t.config)return{fields:t.config.fields,references:t.config.references};let n=e[_e(t.referencedTable)];if(!n)throw new Error(`Table "${t.referencedTable[g.Symbol.Name]}" not found in schema`);let i=r[n];if(!i)throw new Error(`Table "${n}" not found in schema`);let o=t.sourceTable,s=e[_e(o)];if(!s)throw new Error(`Table "${o[g.Symbol.Name]}" not found in schema`);let a=[];for(let l of Object.values(i.relations))(t.relationName&&t!==l&&l.relationName===t.relationName||!t.relationName&&l.referencedTable===t.sourceTable)&&a.push(l);if(a.length>1)throw t.relationName?new Error(`There are multiple relations with name "${t.relationName}" in table "${n}"`):new Error(`There are multiple relations between "${n}" and "${t.sourceTable[g.Symbol.Name]}". Please specify relation name`);if(a[0]&&h(a[0],Ee)&&a[0].config)return{fields:a[0].config.references,references:a[0].config.fields};throw new Error(`There is not enough information to infer relation "${s}.${t.fieldName}"`)}function os(r){return{one:$u(r),many:Cu(r)}}function Jt(r,e,t,n,i=o=>o){let o={};for(let[s,a]of n.entries())if(a.isJson){let l=e.relations[a.tsKey],m=t[s],u=typeof m=="string"?JSON.parse(m):m;o[a.tsKey]=h(l,Ee)?u&&Jt(r,r[a.relationTableTsKey],u,a.selection,i):u.map(p=>Jt(r,r[a.relationTableTsKey],p,a.selection,i))}else{let l=i(t[s]),m=a.field,u;h(m,_)?u=m:h(m,w)?u=m.decoder:u=m.sql.decoder,o[a.tsKey]=l===null?null:u.mapFromDriverValue(l)}return o}var je=class{constructor(e){this.table=e}static[f]="ColumnAliasProxyHandler";get(e,t){return t==="table"?this.table:e[t]}},ze=class{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static[f]="TableAliasProxyHandler";get(e,t){if(t===g.Symbol.IsAlias)return!0;if(t===g.Symbol.Name)return this.alias;if(this.replaceOriginalName&&t===g.Symbol.OriginalName)return this.alias;if(t===M)return{...e[M],name:this.alias,isAlias:!0};if(t===g.Symbol.Columns){let i=e[g.Symbol.Columns];if(!i)return i;let o={};return Object.keys(i).map(s=>{o[s]=new Proxy(i[s],new je(new Proxy(e,this)))}),o}let n=e[t];return h(n,_)?new Proxy(n,new je(new Proxy(e,this))):n}},ss=class{constructor(e){this.alias=e}static[f]="RelationTableAliasProxyHandler";get(e,t){return t==="sourceTable"?lt(e.sourceTable,this.alias):e[t]}};function lt(r,e){return new Proxy(r,new ze(e,!1))}function ge(r,e){return new Proxy(r,new je(new Proxy(r.table,new ze(e,!1))))}function tn(r,e){return new w.Aliased(ct(r.sql,e),r.fieldAlias)}function ct(r,e){return c.join(r.queryChunks.map(t=>h(t,_)?ge(t,e):h(t,w)?ct(t,e):h(t,w.Aliased)?tn(t,e):t))}var U=class r{static[f]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if(t==="_")return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===M)return{...e[M],selectedFields:new Proxy(e[M].selectedFields,this)};if(typeof t=="symbol")return e[t];let i=(h(e,W)?e._.selectedFields:h(e,se)?e[M].selectedFields:e)[t];if(h(i,w.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!i.isSelectionField)return i.sql;let o=i.clone();return o.isSelectionField=!0,o}if(h(i,w)){if(this.config.sqlBehavior==="sql")return i;throw new Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return h(i,_)?this.config.alias?new Proxy(i,new je(new Proxy(i.table,new ze(this.config.alias,this.config.replaceOriginalName??!1)))):i:typeof i!="object"||i===null?i:new Proxy(i,new r(this.config))}};var te=class{static[f]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}};var Gt=class{static[f]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(e,t){this.reference=()=>{let{name:n,columns:i,foreignColumns:o}=e();return{name:n,columns:i,foreignTable:o[0].table,foreignColumns:o}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=e,this}onDelete(e){return this._onDelete=e,this}build(e){return new rn(e,this)}},rn=class{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static[f]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:n}=this.reference(),i=t.map(a=>a.name),o=n.map(a=>a.name),s=[this.table[ee],...i,n[0].table[ee],...o];return e??`${s.join("_")}_fk`}};function an(r,e){return`${r[ee]}_${e.join("_")}_unique`}function as(r){return new on(r)}var nn=class{constructor(e,t){this.name=t,this.columns=e}static[f]="SQLiteUniqueConstraintBuilder";columns;build(e){return new sn(e,this.columns,this.name)}},on=class{static[f]="SQLiteUniqueOnConstraintBuilder";name;constructor(e){this.name=e}on(...e){return new nn(e,this.name)}},sn=class{constructor(e,t,n){this.table=e,this.columns=t,this.name=n??an(this.table,this.columns.map(i=>i.name))}static[f]="SQLiteUniqueConstraint";columns;name;getName(){return this.name}};var J=class extends Me{static[f]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e){return this.config.isUnique=!0,this.config.uniqueName=e,this}generatedAlwaysAs(e,t){return this.config.generated={as:e,type:"always",mode:t?.mode??"virtual"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:n,actions:i})=>((o,s)=>{let a=new Gt(()=>{let l=o();return{columns:[e],foreignColumns:[l]}});return s.onUpdate&&a.onUpdate(s.onUpdate),s.onDelete&&a.onDelete(s.onDelete),a.build(t)})(n,i))}},V=class extends _{constructor(e,t){t.uniqueName||(t.uniqueName=an(e,[t.name])),super(e,t),this.table=e}static[f]="SQLiteColumn"};var un=class extends J{static[f]="SQLiteBigIntBuilder";constructor(e){super(e,"bigint","SQLiteBigInt")}build(e){return new ln(e,this.config)}},ln=class extends V{static[f]="SQLiteBigInt";getSQLType(){return"blob"}mapFromDriverValue(e){if(Buffer.isBuffer(e))return BigInt(e.toString());if(e instanceof ArrayBuffer){let t=new TextDecoder;return BigInt(t.decode(e))}return BigInt(String.fromCodePoint(...e))}mapToDriverValue(e){return Buffer.from(e.toString())}},cn=class extends J{static[f]="SQLiteBlobJsonBuilder";constructor(e){super(e,"json","SQLiteBlobJson")}build(e){return new fn(e,this.config)}},fn=class extends V{static[f]="SQLiteBlobJson";getSQLType(){return"blob"}mapFromDriverValue(e){if(Buffer.isBuffer(e))return JSON.parse(e.toString());if(e instanceof ArrayBuffer){let t=new TextDecoder;return JSON.parse(t.decode(e))}return JSON.parse(String.fromCodePoint(...e))}mapToDriverValue(e){return Buffer.from(JSON.stringify(e))}},mn=class extends J{static[f]="SQLiteBlobBufferBuilder";constructor(e){super(e,"buffer","SQLiteBlobBuffer")}build(e){return new pn(e,this.config)}},pn=class extends V{static[f]="SQLiteBlobBuffer";mapFromDriverValue(e){return Buffer.isBuffer(e)?e:Buffer.from(e)}getSQLType(){return"blob"}};function us(r,e){let{name:t,config:n}=ye(r,e);return n?.mode==="json"?new cn(t):n?.mode==="bigint"?new un(t):new mn(t)}var hn=class extends J{static[f]="SQLiteCustomColumnBuilder";constructor(e,t,n){super(e,"custom","SQLiteCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=n}build(e){return new dn(e,this.config)}},dn=class extends V{static[f]="SQLiteCustomColumn";sqlName;mapTo;mapFrom;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return typeof this.mapFrom=="function"?this.mapFrom(e):e}mapToDriverValue(e){return typeof this.mapTo=="function"?this.mapTo(e):e}};function ls(r){return(e,t)=>{let{name:n,config:i}=ye(e,t);return new hn(n,i,r)}}var ft=class extends J{static[f]="SQLiteBaseIntegerBuilder";constructor(e,t,n){super(e,t,n),this.config.autoIncrement=!1}primaryKey(e){return e?.autoIncrement&&(this.config.autoIncrement=!0),this.config.hasDefault=!0,super.primaryKey()}},mt=class extends V{static[f]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}},yn=class extends ft{static[f]="SQLiteIntegerBuilder";constructor(e){super(e,"number","SQLiteInteger")}build(e){return new gn(e,this.config)}},gn=class extends mt{static[f]="SQLiteInteger"},bn=class extends ft{static[f]="SQLiteTimestampBuilder";constructor(e,t){super(e,"date","SQLiteTimestamp"),this.config.mode=t}defaultNow(){return this.default(c`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(e){return new wn(e,this.config)}},wn=class extends mt{static[f]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(e){return this.config.mode==="timestamp"?new Date(e*1e3):new Date(e)}mapToDriverValue(e){let t=e.getTime();return this.config.mode==="timestamp"?Math.floor(t/1e3):t}},Sn=class extends ft{static[f]="SQLiteBooleanBuilder";constructor(e,t){super(e,"boolean","SQLiteBoolean"),this.config.mode=t}build(e){return new Tn(e,this.config)}},Tn=class extends mt{static[f]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(e){return Number(e)===1}mapToDriverValue(e){return e?1:0}};function xn(r,e){let{name:t,config:n}=ye(r,e);return n?.mode==="timestamp"||n?.mode==="timestamp_ms"?new bn(t,n.mode):n?.mode==="boolean"?new Sn(t,n.mode):new yn(t)}var Yt=xn;var En=class extends J{static[f]="SQLiteNumericBuilder";constructor(e){super(e,"string","SQLiteNumeric")}build(e){return new vn(e,this.config)}},vn=class extends V{static[f]="SQLiteNumeric";mapFromDriverValue(e){return typeof e=="string"?e:String(e)}getSQLType(){return"numeric"}},On=class extends J{static[f]="SQLiteNumericNumberBuilder";constructor(e){super(e,"number","SQLiteNumericNumber")}build(e){return new $n(e,this.config)}},$n=class extends V{static[f]="SQLiteNumericNumber";mapFromDriverValue(e){return typeof e=="number"?e:Number(e)}mapToDriverValue=String;getSQLType(){return"numeric"}},Cn=class extends J{static[f]="SQLiteNumericBigIntBuilder";constructor(e){super(e,"bigint","SQLiteNumericBigInt")}build(e){return new qn(e,this.config)}},qn=class extends V{static[f]="SQLiteNumericBigInt";mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return"numeric"}};function cs(r,e){let{name:t,config:n}=ye(r,e),i=n?.mode;return i==="number"?new On(t):i==="bigint"?new Cn(t):new En(t)}var Nn=class extends J{static[f]="SQLiteRealBuilder";constructor(e){super(e,"number","SQLiteReal")}build(e){return new _n(e,this.config)}},_n=class extends V{static[f]="SQLiteReal";getSQLType(){return"real"}};function fs(r){return new Nn(r??"")}var Ln=class extends J{static[f]="SQLiteTextBuilder";constructor(e,t){super(e,"string","SQLiteText"),this.config.enumValues=t.enum,this.config.length=t.length}build(e){return new jn(e,this.config)}},jn=class extends V{static[f]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(e,t){super(e,t)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}},In=class extends J{static[f]="SQLiteTextJsonBuilder";constructor(e){super(e,"json","SQLiteTextJson")}build(e){return new Dn(e,this.config)}},Dn=class extends V{static[f]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(e){return JSON.parse(e)}mapToDriverValue(e){return JSON.stringify(e)}};function Ht(r,e={}){let{name:t,config:n}=ye(r,e);return n.mode==="json"?new In(t):new Ln(t,n)}function ms(){return{blob:us,customType:ls,integer:xn,numeric:cs,real:fs,text:Ht}}var Qn=Symbol.for("drizzle:SQLiteInlineForeignKeys"),H=class extends g{static[f]="SQLiteTable";static Symbol=Object.assign({},g.Symbol,{InlineForeignKeys:Qn});[g.Symbol.Columns];[Qn]=[];[g.Symbol.ExtraConfigBuilder]=void 0};function qu(r,e,t,n,i=r){let o=new H(r,n,i),s=typeof e=="function"?e(ms()):e,a=Object.fromEntries(Object.entries(s).map(([m,u])=>{let p=u;p.setName(m);let d=p.build(o);return o[Qn].push(...p.buildForeignKeys(d,o)),[m,d]})),l=Object.assign(o,a);return l[g.Symbol.Columns]=a,l[g.Symbol.ExtraConfigColumns]=a,t&&(l[H.Symbol.ExtraConfigBuilder]=t),l}var ps=(r,e,t)=>qu(r,e,t);var pt=class extends te{constructor(e,t,n,i){super(),this.table=e,this.session=t,this.dialect=n,this.config={table:e,withList:i}}static[f]="SQLiteDelete";config;where(e){return this.config.where=e,this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.table[g.Symbol.Columns],new U({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(t)?t:[t];this.config.orderBy=n}else{let t=e;this.config.orderBy=t}return this}limit(e){return this.config.limit=e,this}returning(e=this.table[H.Symbol.Columns]){return this.config.returning=ue(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0)}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(e){return this._prepare().execute(e)}$dynamic(){return this}};function Nu(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(t=>t.toLowerCase()).join("_")}function _u(r){return(r.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((t,n,i)=>{let o=i===0?n.toLowerCase():`${n[0].toUpperCase()}${n.slice(1)}`;return t+o},"")}function Lu(r){return r}var Xt=class{static[f]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert=e==="snake_case"?Nu:e==="camelCase"?_u:Lu}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[g.Symbol.Schema]??"public",n=e.table[g.Symbol.OriginalName],i=`${t}.${n}.${e.name}`;return this.cache[i]||this.cacheTable(e.table),this.cache[i]}cacheTable(e){let t=e[g.Symbol.Schema]??"public",n=e[g.Symbol.OriginalName],i=`${t}.${n}`;if(!this.cachedTables[i]){for(let o of Object.values(e[g.Symbol.Columns])){let s=`${i}.${o.name}`;this.cache[s]=this.convert(o.name)}this.cachedTables[i]=!0}}clearCache(){this.cache={},this.cachedTables={}}};var Ie=class extends Error{static[f]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}},Zt=class extends Ie{static[f]="TransactionRollbackError";constructor(){super({message:"Rollback"})}};var ve=class extends se{static[f]="SQLiteViewBase"};var De=class{static[f]="SQLiteDialect";casing;constructor(e){this.casing=new Xt(e?.casing)}escapeName(e){return`"${e}"`}escapeParam(e){return"?"}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[c`with `];for(let[n,i]of e.entries())t.push(c`${c.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&t.push(c`, `);return t.push(c` `),c.join(t)}buildDeleteQuery({table:e,where:t,returning:n,withList:i,limit:o,orderBy:s}){let a=this.buildWithCTE(i),l=n?c` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,m=t?c` where ${t}`:void 0,u=this.buildOrderBy(s),p=this.buildLimit(o);return c`${a}delete from ${e}${m}${l}${u}${p}`}buildUpdateSet(e,t){let n=e[g.Symbol.Columns],i=Object.keys(n).filter(s=>t[s]!==void 0||n[s]?.onUpdateFn!==void 0),o=i.length;return c.join(i.flatMap((s,a)=>{let l=n[s],m=t[s]??c.param(l.onUpdateFn(),l),u=c`${c.identifier(this.casing.getColumnCasing(l))} = ${m}`;return a<o-1?[u,c.raw(", ")]:[u]}))}buildUpdateQuery({table:e,set:t,where:n,returning:i,withList:o,joins:s,from:a,limit:l,orderBy:m}){let u=this.buildWithCTE(o),p=this.buildUpdateSet(e,t),d=a&&c.join([c.raw(" from "),this.buildFromTable(a)]),y=this.buildJoins(s),b=i?c` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,S=n?c` where ${n}`:void 0,x=this.buildOrderBy(m),E=this.buildLimit(l);return c`${u}update ${e} set ${p}${d}${y}${S}${b}${x}${E}`}buildSelection(e,{isSingleTable:t=!1}={}){let n=e.length,i=e.flatMap(({field:o},s)=>{let a=[];if(h(o,w.Aliased)&&o.isSelectionField)a.push(c.identifier(o.fieldAlias));else if(h(o,w.Aliased)||h(o,w)){let l=h(o,w.Aliased)?o.sql:o;t?a.push(new w(l.queryChunks.map(m=>h(m,_)?c.identifier(this.casing.getColumnCasing(m)):m))):a.push(l),h(o,w.Aliased)&&a.push(c` as ${c.identifier(o.fieldAlias)}`)}else if(h(o,_)){let l=o.table[g.Symbol.Name];o.columnType==="SQLiteNumericBigInt"?t?a.push(c`cast(${c.identifier(this.casing.getColumnCasing(o))} as text)`):a.push(c`cast(${c.identifier(l)}.${c.identifier(this.casing.getColumnCasing(o))} as text)`):t?a.push(c.identifier(this.casing.getColumnCasing(o))):a.push(c`${c.identifier(l)}.${c.identifier(this.casing.getColumnCasing(o))}`)}return s<n-1&&a.push(c`, `),a});return c.join(i)}buildJoins(e){if(!e||e.length===0)return;let t=[];if(e)for(let[n,i]of e.entries()){n===0&&t.push(c` `);let o=i.table,s=i.on?c` on ${i.on}`:void 0;if(h(o,H)){let a=o[H.Symbol.Name],l=o[H.Symbol.Schema],m=o[H.Symbol.OriginalName],u=a===m?void 0:i.alias;t.push(c`${c.raw(i.joinType)} join ${l?c`${c.identifier(l)}.`:void 0}${c.identifier(m)}${u&&c` ${c.identifier(u)}`}${s}`)}else t.push(c`${c.raw(i.joinType)} join ${o}${s}`);n<e.length-1&&t.push(c` `)}return c.join(t)}buildLimit(e){return typeof e=="object"||typeof e=="number"&&e>=0?c` limit ${e}`:void 0}buildOrderBy(e){let t=[];if(e)for(let[n,i]of e.entries())t.push(i),n<e.length-1&&t.push(c`, `);return t.length>0?c` order by ${c.join(t)}`:void 0}buildFromTable(e){return h(e,g)&&e[g.Symbol.IsAlias]?c`${c`${c.identifier(e[g.Symbol.Schema]??"")}.`.if(e[g.Symbol.Schema])}${c.identifier(e[g.Symbol.OriginalName])} ${c.identifier(e[g.Symbol.Name])}`:e}buildSelectQuery({withList:e,fields:t,fieldsFlat:n,where:i,having:o,table:s,joins:a,orderBy:l,groupBy:m,limit:u,offset:p,distinct:d,setOperators:y}){let b=n??ue(t);for(let j of b)if(h(j.field,_)&&xe(j.field.table)!==(h(s,W)?s._.alias:h(s,ve)?s[M].name:h(s,w)?void 0:xe(s))&&!(I=>a?.some(({alias:Q})=>Q===(I[g.Symbol.IsAlias]?xe(I):I[g.Symbol.BaseName])))(j.field.table)){let I=xe(j.field.table);throw new Error(`Your "${j.path.join("->")}" field references a column "${I}"."${j.field.name}", but the table "${I}" is not part of the query! Did you forget to join it?`)}let S=!a||a.length===0,x=this.buildWithCTE(e),E=d?c` distinct`:void 0,D=this.buildSelection(b,{isSingleTable:S}),N=this.buildFromTable(s),C=this.buildJoins(a),ae=i?c` where ${i}`:void 0,re=o?c` having ${o}`:void 0,v=[];if(m)for(let[j,I]of m.entries())v.push(I),j<m.length-1&&v.push(c`, `);let L=v.length>0?c` group by ${c.join(v)}`:void 0,T=this.buildOrderBy(l),q=this.buildLimit(u),$=p?c` offset ${p}`:void 0,A=c`${x}select${E} ${D} from ${N}${C}${ae}${L}${re}${T}${q}${$}`;return y.length>0?this.buildSetOperations(A,y):A}buildSetOperations(e,t){let[n,...i]=t;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:n,rightSelect:i,limit:o,orderBy:s,offset:a}}){let l=c`${e.getSQL()} `,m=c`${i.getSQL()}`,u;if(s&&s.length>0){let b=[];for(let S of s)if(h(S,V))b.push(c.identifier(S.name));else if(h(S,w)){for(let x=0;x<S.queryChunks.length;x++){let E=S.queryChunks[x];h(E,V)&&(S.queryChunks[x]=c.identifier(this.casing.getColumnCasing(E)))}b.push(c`${S}`)}else b.push(c`${S}`);u=c` order by ${c.join(b,c`, `)}`}let p=typeof o=="object"||typeof o=="number"&&o>=0?c` limit ${o}`:void 0,d=c.raw(`${t} ${n?"all ":""}`),y=a?c` offset ${a}`:void 0;return c`${l}${d}${m}${u}${p}${y}`}buildInsertQuery({table:e,values:t,onConflict:n,returning:i,withList:o,select:s}){let a=[],l=e[g.Symbol.Columns],m=Object.entries(l).filter(([S,x])=>!x.shouldDisableInsert()),u=m.map(([,S])=>c.identifier(this.casing.getColumnCasing(S)));if(s){let S=t;h(S,w)?a.push(S):a.push(S.getSQL())}else{let S=t;a.push(c.raw("values "));for(let[x,E]of S.entries()){let D=[];for(let[N,C]of m){let ae=E[N];if(ae===void 0||h(ae,ne)&&ae.value===void 0){let re;if(C.default!==null&&C.default!==void 0)re=h(C.default,w)?C.default:c.param(C.default,C);else if(C.defaultFn!==void 0){let v=C.defaultFn();re=h(v,w)?v:c.param(v,C)}else if(!C.default&&C.onUpdateFn!==void 0){let v=C.onUpdateFn();re=h(v,w)?v:c.param(v,C)}else re=c`null`;D.push(re)}else D.push(ae)}a.push(D),x<S.length-1&&a.push(c`, `)}}let p=this.buildWithCTE(o),d=c.join(a),y=i?c` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,b=n?.length?c.join(n):void 0;return c`${p}insert into ${e} ${u} ${d}${b}${y}`}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:t})}buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:n,table:i,tableConfig:o,queryConfig:s,tableAlias:a,nestedQueryRelation:l,joinOn:m}){let u=[],p,d,y=[],b,S=[];if(s===!0)u=Object.entries(o.columns).map(([D,N])=>({dbKey:N.name,tsKey:D,field:ge(N,a),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let E=Object.fromEntries(Object.entries(o.columns).map(([v,L])=>[v,ge(L,a)]));if(s.where){let v=typeof s.where=="function"?s.where(E,ts()):s.where;b=v&&ct(v,a)}let D=[],N=[];if(s.columns){let v=!1;for(let[L,T]of Object.entries(s.columns))T!==void 0&&L in o.columns&&(!v&&T===!0&&(v=!0),N.push(L));N.length>0&&(N=v?N.filter(L=>s.columns?.[L]===!0):Object.keys(o.columns).filter(L=>!N.includes(L)))}else N=Object.keys(o.columns);for(let v of N){let L=o.columns[v];D.push({tsKey:v,value:L})}let C=[];s.with&&(C=Object.entries(s.with).filter(v=>!!v[1]).map(([v,L])=>({tsKey:v,queryConfig:L,relation:o.relations[v]})));let ae;if(s.extras){ae=typeof s.extras=="function"?s.extras(E,{sql:c}):s.extras;for(let[v,L]of Object.entries(ae))D.push({tsKey:v,value:tn(L,a)})}for(let{tsKey:v,value:L}of D)u.push({dbKey:h(L,w.Aliased)?L.fieldAlias:o.columns[v].name,tsKey:v,field:h(L,_)?ge(L,a):L,relationTableTsKey:void 0,isJson:!1,selection:[]});let re=typeof s.orderBy=="function"?s.orderBy(E,rs()):s.orderBy??[];Array.isArray(re)||(re=[re]),y=re.map(v=>h(v,_)?ge(v,a):ct(v,a)),p=s.limit,d=s.offset;for(let{tsKey:v,queryConfig:L,relation:T}of C){let q=is(t,n,T),$=_e(T.referencedTable),A=n[$],j=`${a}_${v}`,I=at(...q.fields.map((B,k)=>kt(ge(q.references[k],j),ge(B,a)))),Q=this.buildRelationalQuery({fullSchema:e,schema:t,tableNamesMap:n,table:e[A],tableConfig:t[A],queryConfig:h(T,Ee)?L===!0?{limit:1}:{...L,limit:1}:L,tableAlias:j,joinOn:I,nestedQueryRelation:T}),P=c`(${Q.sql})`.as(v);u.push({dbKey:v,tsKey:v,field:P,relationTableTsKey:A,isJson:!0,selection:Q.selection})}}if(u.length===0)throw new Ie({message:`No fields selected for table "${o.tsName}" ("${a}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});let x;if(b=at(m,b),l){let E=c`json_array(${c.join(u.map(({field:C})=>h(C,V)?c.identifier(this.casing.getColumnCasing(C)):h(C,w.Aliased)?C.sql:C),c`, `)})`;h(l,ut)&&(E=c`coalesce(json_group_array(${E}), json_array())`);let D=[{dbKey:"data",tsKey:"data",field:E.as("data"),isJson:!0,relationTableTsKey:o.tsName,selection:u}];p!==void 0||d!==void 0||y.length>0?(x=this.buildSelectQuery({table:lt(i,a),fields:{},fieldsFlat:[{path:[],field:c.raw("*")}],where:b,limit:p,offset:d,orderBy:y,setOperators:[]}),b=void 0,p=void 0,d=void 0,y=void 0):x=lt(i,a),x=this.buildSelectQuery({table:h(x,H)?x:new W(x,{},a),fields:{},fieldsFlat:D.map(({field:C})=>({path:[],field:h(C,_)?ge(C,a):C})),joins:S,where:b,limit:p,offset:d,orderBy:y,setOperators:[]})}else x=this.buildSelectQuery({table:lt(i,a),fields:{},fieldsFlat:u.map(({field:E})=>({path:[],field:h(E,_)?ge(E,a):E})),joins:S,where:b,limit:p,offset:d,orderBy:y,setOperators:[]});return{tableTsKey:o.tsName,sql:x,selection:u}}},Ue=class extends De{static[f]="SQLiteSyncDialect";migrate(e,t,n){let i=n===void 0||typeof n=="string"?"__drizzle_migrations":n.migrationsTable??"__drizzle_migrations",o=c`
			CREATE TABLE IF NOT EXISTS ${c.identifier(i)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;t.run(o);let a=t.values(c`SELECT id, hash, created_at FROM ${c.identifier(i)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;t.run(c`BEGIN`);try{for(let l of e)if(!a||Number(a[2])<l.folderMillis){for(let m of l.sql)t.run(c.raw(m));t.run(c`INSERT INTO ${c.identifier(i)} ("hash", "created_at") VALUES(${l.hash}, ${l.folderMillis})`)}t.run(c`COMMIT`)}catch(l){throw t.run(c`ROLLBACK`),l}}},hs=class extends De{static[f]="SQLiteAsyncDialect";async migrate(e,t,n){let i=n===void 0||typeof n=="string"?"__drizzle_migrations":n.migrationsTable??"__drizzle_migrations",o=c`
			CREATE TABLE IF NOT EXISTS ${c.identifier(i)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await t.run(o);let a=(await t.values(c`SELECT id, hash, created_at FROM ${c.identifier(i)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await t.transaction(async l=>{for(let m of e)if(!a||Number(a[2])<m.folderMillis){for(let u of m.sql)await l.run(c.raw(u));await l.run(c`INSERT INTO ${c.identifier(i)} ("hash", "created_at") VALUES(${m.hash}, ${m.folderMillis})`)}})}};var er=class{static[f]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var le=class{static[f]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,this.withList=e.withList,this.distinct=e.distinct}from(e){let t=!!this.fields,n;return this.fields?n=this.fields:h(e,W)?n=Object.fromEntries(Object.keys(e._.selectedFields).map(i=>[i,e[i]])):h(e,ve)?n=e[M].selectedFields:h(e,w)?n={}:n=_o(e),new tr({table:e,fields:n,isPartialSelect:t,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}},Bn=class extends er{static[f]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:n,session:i,dialect:o,withList:s,distinct:a}){super(),this.config={withList:s,table:e,fields:{...t},distinct:a,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=o,this._={selectedFields:t},this.tableName=st(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(t,n)=>{let i=this.tableName,o=st(t);if(typeof o=="string"&&this.config.joins?.some(s=>s.alias===o))throw new Error(`Alias "${o}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof o=="string"&&!h(t,w))){let s=h(t,W)?t._.selectedFields:h(t,se)?t[M].selectedFields:t[g.Symbol.Columns];this.config.fields[o]=s}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:t,joinType:e,alias:o}),typeof o=="string")switch(e){case"left":{this.joinsNotNullableMap[o]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[o]=!0;break}case"cross":case"inner":{this.joinsNotNullableMap[o]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[o]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(e,t){return n=>{let i=typeof n=="function"?n(ju()):n;if(!ot(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new U({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.fields,new U({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let t=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=t:this.config.orderBy=t}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new W(this.getSQL(),this.config.fields,e),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new U({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},tr=class extends Bn{static[f]="SQLiteSelect";_prepare(e=!0){if(!this.session)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");let t=ue(this.config.fields),n=this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),t,"all",!0);return n.joinsNotNullableMap=this.joinsNotNullableMap,n}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.all()}};No(tr,[te]);function rr(r,e){return(t,n,...i)=>{let o=[n,...i].map(s=>({type:r,isAll:e,rightSelect:s}));for(let s of o)if(!ot(t.getSelectedFields(),s.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return t.addSetOperators(o)}}var ju=()=>({union:Iu,unionAll:Du,intersect:Qu,except:Bu}),Iu=rr("union",!1),Du=rr("union",!0),Qu=rr("intersect",!1),Bu=rr("except",!1);var ke=class{static[f]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=h(e,De)?e:void 0,this.dialectConfig=h(e,De)?void 0:e}$with=(e,t)=>{let n=this;return{as:o=>(typeof o=="function"&&(o=o(n)),new Proxy(new Ke(o.getSQL(),t??("getSelectedFields"in o?o.getSelectedFields()??{}:{}),e,!0),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;function n(o){return new le({fields:o??void 0,session:void 0,dialect:t.getDialect(),withList:e})}function i(o){return new le({fields:o??void 0,session:void 0,dialect:t.getDialect(),withList:e,distinct:!0})}return{select:n,selectDistinct:i}}select(e){return new le({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new le({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new Ue(this.dialectConfig)),this.dialect}};var ht=class{constructor(e,t,n,i){this.table=e,this.session=t,this.dialect=n,this.withList=i}static[f]="SQLiteInsertBuilder";values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let t=e.map(n=>{let i={},o=this.table[g.Symbol.Columns];for(let s of Object.keys(n)){let a=n[s];i[s]=h(a,w)?a:new ne(a,o[s])}return i});return new nr(this.table,t,this.session,this.dialect,this.withList)}select(e){let t=typeof e=="function"?e(new ke):e;if(!h(t,w)&&!ot(this.table[Rt],t._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new nr(this.table,t,this.session,this.dialect,this.withList,!0)}},nr=class extends te{constructor(e,t,n,i,o,s){super(),this.session=n,this.dialect=i,this.config={table:e,values:t,withList:o,select:s}}static[f]="SQLiteInsert";config;returning(e=this.config.table[H.Symbol.Columns]){return this.config.returning=ue(e),this}onConflictDoNothing(e={}){if(this.config.onConflict||(this.config.onConflict=[]),e.target===void 0)this.config.onConflict.push(c` on conflict do nothing`);else{let t=Array.isArray(e.target)?c`${e.target}`:c`${[e.target]}`,n=e.where?c` where ${e.where}`:c``;this.config.onConflict.push(c` on conflict ${t} do nothing${n}`)}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');this.config.onConflict||(this.config.onConflict=[]);let t=e.where?c` where ${e.where}`:void 0,n=e.targetWhere?c` where ${e.targetWhere}`:void 0,i=e.setWhere?c` where ${e.setWhere}`:void 0,o=Array.isArray(e.target)?c`${e.target}`:c`${[e.target]}`,s=this.dialect.buildUpdateSet(this.config.table,Kt(this.config.table,e.set));return this.config.onConflict.push(c` on conflict ${o}${n} do update set ${s}${t}${i}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0)}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}};var dt=class{constructor(e,t,n,i){this.table=e,this.session=t,this.dialect=n,this.withList=i}static[f]="SQLiteUpdateBuilder";set(e){return new An(this.table,Kt(this.table,e),this.session,this.dialect,this.withList)}},An=class extends te{constructor(e,t,n,i,o){super(),this.session=n,this.dialect=i,this.config={set:t,table:e,withList:o,joins:[]}}static[f]="SQLiteUpdate";config;from(e){return this.config.from=e,this}createJoin(e){return(t,n)=>{let i=st(t);if(typeof i=="string"&&this.config.joins.some(o=>o.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let o=this.config.from?h(t,H)?t[g.Symbol.Columns]:h(t,W)?t._.selectedFields:h(t,ve)?t[M].selectedFields:void 0:void 0;n=n(new Proxy(this.config.table[g.Symbol.Columns],new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),o&&new Proxy(o,new U({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:n,table:t,joinType:e,alias:i}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}orderBy(...e){if(typeof e[0]=="function"){let t=e[0](new Proxy(this.config.table[g.Symbol.Columns],new U({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(t)?t:[t];this.config.orderBy=n}else{let t=e;this.config.orderBy=t}return this}limit(e){return this.config.limit=e,this}returning(e=this.config.table[H.Symbol.Columns]){return this.config.returning=ue(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e=!0){return this.session[e?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0)}prepare(){return this._prepare(!1)}run=e=>this._prepare().run(e);all=e=>this._prepare().all(e);get=e=>this._prepare().get(e);values=e=>this._prepare().values(e);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}};var ir=class r extends w{constructor(e){super(r.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.session=e.session,this.sql=r.buildCount(e.source,e.filters)}sql;static[f]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(e,t){return c`(select count(*) from ${e}${c.raw(" where ").if(t)}${t})`}static buildCount(e,t){return c`select count(*) from ${e}${c.raw(" where ").if(t)}${t}`}then(e,t){return Promise.resolve(this.session.count(this.sql)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}};var or=class{constructor(e,t,n,i,o,s,a,l){this.mode=e,this.fullSchema=t,this.schema=n,this.tableNamesMap=i,this.table=o,this.tableConfig=s,this.dialect=a,this.session=l}static[f]="SQLiteAsyncRelationalQueryBuilder";findMany(e){return this.mode==="sync"?new sr(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many"):new yt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return this.mode==="sync"?new sr(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first"):new yt(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},yt=class extends te{constructor(e,t,n,i,o,s,a,l,m){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=n,this.table=i,this.tableConfig=o,this.dialect=s,this.session=a,this.config=l,this.mode=m}static[f]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(e=!1){let{query:t,builtQuery:n}=this._toSQL();return this.session[e?"prepareOneTimeQuery":"prepareQuery"](n,void 0,this.mode==="first"?"get":"all",!0,(i,o)=>{let s=i.map(a=>Jt(this.schema,this.tableConfig,a,t.selection,o));return this.mode==="first"?s[0]:s})}prepare(){return this._prepare(!1)}_toSQL(){let e=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return this.mode==="first"?this._prepare(!1).get():this._prepare(!1).all()}async execute(){return this.executeRaw()}},sr=class extends yt{static[f]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}};var Qe=class extends te{constructor(e,t,n,i,o){super(),this.execute=e,this.getSQL=t,this.dialect=i,this.mapBatchResult=o,this.config={action:n}}static[f]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var We=class{constructor(e,t,n,i){this.resultKind=e,this.dialect=t,this.session=n,this._=i?{schema:i.schema,fullSchema:i.fullSchema,tableNamesMap:i.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};let o=this.query;if(this._.schema)for(let[s,a]of Object.entries(this._.schema))o[s]=new or(e,i.fullSchema,this._.schema,this._.tableNamesMap,i.fullSchema[s],a,t,n)}static[f]="BaseSQLiteDatabase";query;$with=(e,t)=>{let n=this;return{as:o=>(typeof o=="function"&&(o=o(new ke(n.dialect))),new Proxy(new Ke(o.getSQL(),t??("getSelectedFields"in o?o.getSelectedFields()??{}:{}),e,!0),new U({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new ir({source:e,filters:t,session:this.session})}with(...e){let t=this;function n(l){return new le({fields:l??void 0,session:t.session,dialect:t.dialect,withList:e})}function i(l){return new le({fields:l??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})}function o(l){return new dt(l,t.session,t.dialect,e)}function s(l){return new ht(l,t.session,t.dialect,e)}function a(l){return new pt(l,t.session,t.dialect,e)}return{select:n,selectDistinct:i,update:o,insert:s,delete:a}}select(e){return new le({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new le({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(e){return new dt(e,this.session,this.dialect)}insert(e){return new ht(e,this.session,this.dialect)}delete(e){return new pt(e,this.session,this.dialect)}run(e){let t=typeof e=="string"?c.raw(e):e.getSQL();return this.resultKind==="async"?new Qe(async()=>this.session.run(t),()=>t,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(t)}all(e){let t=typeof e=="string"?c.raw(e):e.getSQL();return this.resultKind==="async"?new Qe(async()=>this.session.all(t),()=>t,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(t)}get(e){let t=typeof e=="string"?c.raw(e):e.getSQL();return this.resultKind==="async"?new Qe(async()=>this.session.get(t),()=>t,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(t)}values(e){let t=typeof e=="string"?c.raw(e):e.getSQL();return this.resultKind==="async"?new Qe(async()=>this.session.values(t),()=>t,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(t)}transaction(e,t){return this.session.transaction(e,t)}};var Pn=class extends te{constructor(e){super(),this.resultCb=e}static[f]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}},ar=class{constructor(e,t,n){this.mode=e,this.executeMethod=t,this.query=n}static[f]="PreparedQuery";joinsNotNullableMap;getQuery(){return this.query}mapRunResult(e,t){return e}mapAllResult(e,t){throw new Error("Not implemented")}mapGetResult(e,t){throw new Error("Not implemented")}execute(e){return this.mode==="async"?this[this.executeMethod](e):new Pn(()=>this[this.executeMethod](e))}mapResult(e,t){switch(this.executeMethod){case"run":return this.mapRunResult(e,t);case"all":return this.mapAllResult(e,t);case"get":return this.mapGetResult(e,t)}}},ur=class{constructor(e){this.dialect=e}static[f]="SQLiteSession";prepareOneTimeQuery(e,t,n,i){return this.prepareQuery(e,t,n,i)}run(e){let t=this.dialect.sqlToQuery(e);try{return this.prepareOneTimeQuery(t,void 0,"run",!1).run()}catch(n){throw new Ie({cause:n,message:`Failed to run the query '${t.sql}'`})}}extractRawRunValueFromBatchResult(e){return e}all(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(e){throw new Error("Not implemented")}get(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(e){throw new Error("Not implemented")}values(e){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(e),void 0,"run",!1).values()}async count(e){return(await this.values(e))[0][0]}extractRawValuesValueFromBatchResult(e){throw new Error("Not implemented")}},lr=class extends We{constructor(e,t,n,i,o=0){super(e,t,n,i),this.schema=i,this.nestedIndex=o}static[f]="SQLiteTransaction";rollback(){throw new Zt}};var cr=class extends ur{constructor(e,t,n,i={}){super(t),this.client=e,this.schema=n,this.logger=i.logger??new Pt}static[f]="BetterSQLiteSession";logger;prepareQuery(e,t,n,i,o){let s=this.client.prepare(e.sql);return new Rn(s,e,this.logger,t,n,i,o)}transaction(e,t={}){let n=new Fn("sync",this.dialect,this,this.schema);return this.client.transaction(e)[t.behavior??"deferred"](n)}},Fn=class r extends lr{static[f]="BetterSQLiteTransaction";transaction(e){let t=`sp${this.nestedIndex}`,n=new r("sync",this.dialect,this.session,this.schema,this.nestedIndex+1);this.session.run(c.raw(`savepoint ${t}`));try{let i=e(n);return this.session.run(c.raw(`release savepoint ${t}`)),i}catch(i){throw this.session.run(c.raw(`rollback to savepoint ${t}`)),i}}},Rn=class extends ar{constructor(e,t,n,i,o,s,a){super("sync",o,t),this.stmt=e,this.logger=n,this.fields=i,this._isResponseInArrayMode=s,this.customResultMapper=a}static[f]="BetterSQLitePreparedQuery";run(e){let t=it(this.query.params,e??{});return this.logger.logQuery(this.query.sql,t),this.stmt.run(...t)}all(e){let{fields:t,joinsNotNullableMap:n,query:i,logger:o,stmt:s,customResultMapper:a}=this;if(!t&&!a){let m=it(i.params,e??{});return o.logQuery(i.sql,m),s.all(...m)}let l=this.values(e);return a?a(l):l.map(m=>Xr(t,m,n))}get(e){let t=it(this.query.params,e??{});this.logger.logQuery(this.query.sql,t);let{fields:n,stmt:i,joinsNotNullableMap:o,customResultMapper:s}=this;if(!n&&!s)return i.get(...t);let a=i.raw().get(...t);if(a)return s?s([a]):Xr(n,a,o)}values(e){let t=it(this.query.params,e??{});return this.logger.logQuery(this.query.sql,t),this.stmt.raw().all(...t)}isResponseInArrayMode(){return this._isResponseInArrayMode}};var Mn=class extends We{static[f]="BetterSQLite3Database"};function Je(r,e={}){let t=new Ue({casing:e.casing}),n;e.logger===!0?n=new At:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let a=ns(e.schema,os);i={fullSchema:e.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let o=new cr(r,t,i,{logger:n}),s=new Mn("sync",t,o,i);return s.$client=r,s}function fr(...r){if(r[0]===void 0||typeof r[0]=="string"){let e=r[0]===void 0?new gt.default:new gt.default(r[0]);return Je(e,r[1])}if(Lo(r[0])){let{connection:e,client:t,...n}=r[0];if(t)return Je(t,n);if(typeof e=="object"){let{source:o,...s}=e,a=new gt.default(o,s);return Je(a,n)}let i=new gt.default(e);return Je(i,n)}return Je(r[0],r[1])}(r=>{function e(t){return Je({},t)}r.mock=e})(fr||(fr={}));var Au=(function(){return(0,bt.resolve)(mr.environment.supportPath,`v${process.versions.modules}`)})(),Pu=(function(){return(0,bt.resolve)(Au,`better-sqlite3-v${process.versions.modules}-${(0,ds.arch)()}.node`)})(),gs=(function(){return(0,bt.resolve)(mr.environment.assetsPath,"drizzle")})(),Vn=(function(){return(0,bt.resolve)(mr.environment.supportPath,"sessions.db")})();function bs(){let r=new ys.default(Vn,{nativeBinding:Pu});return fr(r)}var ws=ps("sessions",{id:Yt().primaryKey({autoIncrement:!0}),goal:Ht().notNull(),duration:Yt().notNull(),timestamp:Yt().notNull().unique()},r=>[as().on(r.goal,r.timestamp)]);var pr=require("@raycast/api"),Ts=Et(Lr()),Kn=new Ss.Cache;function xs(r,e){return{start:r,goal:e}}function Es(){let r=Kn.get("currentSession");if(!r)return null;try{let{start:e,goal:t}=JSON.parse(r);return{start:new Date(e),goal:t}}catch{return(0,pr.showToast)({style:pr.Toast.Style.Failure,title:"Failed to parse cached session. Discarding."}),null}}function vs(r){Kn.set("currentSession",JSON.stringify(r))}function Os(){Kn.remove("currentSession")}async function $s(r){let e=r.start.getTime();try{await bs().insert(ws).values({goal:r.goal,duration:r.duration,timestamp:e})}catch(t){t instanceof Ts.SqliteError&&t.code==="SQLITE_CONSTRAINT_UNIQUE"?console.log(`Session already exists for timestamp ${r.start.toISOString()}, skipping duplicate`):console.error(`Failed to save session: ${t}`)}}var qs=require("@raycast/api"),Ns=require("child_process");function zn(r){let e=r.getFullYear(),t=String(r.getMonth()+1).padStart(2,"0"),n=String(r.getDate()).padStart(2,"0");return`${e}-${t}-${n} ${Fu(r)}`}function Fu(r){let e=r.getHours().toString().padStart(2,"0"),t=r.getMinutes().toString().padStart(2,"0"),n=r.getSeconds().toString().padStart(2,"0");return`${e}:${t}:${n}`}var Cs=new qs.Cache,Ru=`log show --predicate 'subsystem == "com.raycast.macos" AND category == "focus"' --info`;function _s(){let r=Cs.get("refreshedAt");if(r===void 0){let l=new Date;l.setHours(l.getHours()-24),r=zn(l)}let e=`${Ru} --start '${r}'`,t=(0,Ns.execSync)(e,{timeout:1e4}).toString().split(`
`),n=[],i=new Date,o="",s=!1;for(let l of t)if(l.includes("Start focus session")){let[m,u]=l.split(" ").slice(0,2);i=new Date(`${m} ${u}`)}else if(l.includes("Goal: "))o=l.replace(/.*Goal: /,""),n.push({type:"start",start:i,goal:o});else if(l.includes("Focus session activity summary"))s=!0;else if(s&&l.includes("Duration")){let m=l.replace(/.*Duration: /,""),u=parseInt(m)||0;n.push({type:"summary",duration:u}),s=!1}let a=new Date;return Cs.set("refreshedAt",zn(a)),n}var Ls=require("@raycast/api"),js=require("fs");var Is="lastInitializedMigration",Ds=new Ls.Cache;function Mu(){let r=(0,js.readdirSync)(gs).filter(e=>e.endsWith(".sql")).map(e=>e.match(/^(\d+)_/)).map(e=>e?parseInt(e[1],10):null).filter(e=>e!==null);return Math.max(...r)}function Qs(){let r=Ds.get(Is),e=Mu();return e===null||!r?!0:parseInt(r)<e}function Bs(){return Ds.get(Is)?"Database updates pending. Run 'View Sessions' or 'View Summaries' to update.":"Database not initialized. Run 'View Sessions' or 'View Summaries' first."}var me=require("@raycast/api"),ya=Et(ha());function da(r,e){return e===me.LaunchType.UserInitiated?(0,me.showToast)({style:me.Toast.Style.Failure,title:r}):(0,me.showHUD)(`Raycast Focus Stats: ${r}`)}async function ga(r){if(Qs())return da(Bs(),r.launchType);await(0,ya.lock)(Vn).then(async e=>{let t=_s();for(let n of t)if(n.type==="start"){let i=xs(n.start,n.goal);vs(i)}else if(n.type==="summary"){let i=Es();if(i===null){console.error("No current session found when processing summary event");continue}let o={...i,duration:n.duration};await $s(o),Os()}return r.launchType===me.LaunchType.UserInitiated?await(0,me.showToast)({style:me.Toast.Style.Success,title:`Synced ${t.length} Raycast Focus Events`}):e()}).catch(async e=>(console.error("Failed to obtain lock",e),await da("Another instance of Sync Sessions is already running",r.launchType)))}
