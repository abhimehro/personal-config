# ─ include the 1Password‑managed keys ───────────────
Include ~/.ssh/1Password/config
# Optional local overrides (not tracked in git)
Include ~/.ssh/config.local

# ─ GitHub configuration
# Uses 1Password SSH agent for key management
Host github.com
    HostName github.com
    User git
    IdentitiesOnly no
    # Keys provided by 1Password agent (overrides global IdentitiesOnly yes)

#  Proton Pass SSH agent: GitHub alias 
# Use Proton Pass SSH agent for GitHub under alias "github-proton".
# Requires Proton's ssh-agent running (see pp_ssh_agent_start) OR
# at least ~/.ssh/proton-pass-agent.sock pointing at a valid agent.
Host github-proton
    HostName github.com
    User git
    IdentitiesOnly yes
    IdentityAgent "~/.ssh/proton-pass-agent.sock"

#  Generic Proton-host pattern (optional) 
# Any host whose name matches "proton-*" will prefer Proton's agent.
# Example usage:
#   Host proton-example
#       HostName example.com
#       User myuser
Host proton-*
    IdentitiesOnly yes
    IdentityAgent "~/.ssh/proton-pass-agent.sock"

# ─ Dynamic configuration for primary development laptop ────────
# NOTE: Host definitions for dev-vpn/dev-local/dev-mdns/dev-auto live in
#       ~/.ssh/config.local (not tracked in git).
# See:  configs/ssh/config.local.example for a template you can copy and
#       customize on each machine.

# ─ global defaults for all hosts ─────────────────────
Host *
  IdentityAgent "~/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock"

    # Ensure compatibility with non-macOS OpenSSH
    IgnoreUnknown UseKeychain

    # Key management
    AddKeysToAgent yes
    UseKeychain yes
    IdentitiesOnly yes

    # Connection persistence and reliability
    ServerAliveInterval 60
    ServerAliveCountMax 3
    TCPKeepAlive yes

    # Connection multiplexing (ensure control directory exists)
    ControlMaster auto
    ControlPath ~/.ssh/control/%r@%h:%p
    ControlPersist 10m

    # Security settings
    StrictHostKeyChecking ask
    HashKnownHosts yes
    UserKnownHostsFile ~/.ssh/known_hosts

    # Performance and features
    Compression yes
    # SECURITY: Disable forwarding by default to prevent agent hijacking and X11 attacks
    ForwardAgent no
    ForwardX11 no
    ForwardX11Trusted no

    # Environment
    SendEnv LANG LC_*

    # Timeout settings
    ConnectTimeout 30

    # Prevent hanging connections
    ExitOnForwardFailure yes

    # Preferred key types (modern, secure)
    PubkeyAcceptedKeyTypes ssh-ed25519,ecdsa-sha2-nistp256,ssh-rsa
    HostkeyAlgorithms +ssh-ed25519,ecdsa-sha2-nistp256,ssh-rsa
    # Note: Removed trailing comma from KexAlgorithms for valid syntax
    KexAlgorithms +diffie-hellman-group-exchange-sha256,diffie-hellman-group14-sha256,curve25519-sha256
